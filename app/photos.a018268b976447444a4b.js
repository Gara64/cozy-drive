!function(e){function t(t){for(var r,i,c=t[0],u=t[1],l=t[2],f=0,p=[];f<c.length;f++)i=c[f],o[i]&&p.push(o[i][0]),o[i]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(s&&s(t);p.length;)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,c=1;c<n.length;c++){var u=n[c];0!==o[u]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={0:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var c=window.webpackJsonp=window.webpackJsonp||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var s=u;a.push([1,2]),n()}({"/OCp":function(e,t,n){e.exports={oops:"oops--O8MK8"}},"/beP":function(e,t,n){"use strict";var r=n("fvjX"),o=n("hzCD"),a=n.n(o),i=n("QwUF"),c=n("mz5Q"),u=n.n(c),l=n("/MKj"),s=n("XOpu"),f=n("Yo2A"),p=n("Z7XG"),d=n("17x9"),m=n.n(d),h=n("cSBT"),b=n("TSYQ"),y=n.n(b),v=n("bisv"),w=n.n(v),g=function(e){var t=e.t,n=e.current,r=e.total,o=e.progress;return u.a.createElement("div",{className:w.a["coz-upload-status-wrapper"]},u.a.createElement("progress",{max:r,value:n,className:y()(w.a["coz-upload-progress"],w.a["coz-upload-progress--global"])}),u.a.createElement("div",{className:w.a["coz-upload-status"]},u.a.createElement("div",{className:w.a["coz-progress-pic"]}),u.a.createElement("div",{className:w.a["coz-upload-status-content"]},t("mobile.settings.media_backup.media_upload",{smart_count:r-n}),void 0!==o?u.a.createElement("progress",{max:100,value:o,className:y()(w.a["coz-upload-progress"],w.a["coz-upload-progress--individual"])}):u.a.createElement("div",{className:w.a["infinite-progress"]}))))};g.propTypes={current:m.a.number.isRequired,total:m.a.number.isRequired,progress:m.a.number,t:m.a.func.isRequired};var O=g,_=function(e){var t=e.t;return u.a.createElement("div",{className:y()(w.a["coz-upload-status"],w.a["coz-upload-status--waiting"])},u.a.createElement("div",{className:w.a["coz-upload-status-content"]},t("mobile.settings.media_backup.no_wifi")))};_.propTypes={t:m.a.func.isRequired};var E=_,k=function(e){var t=e.t,n=e.url;return u.a.createElement("div",{className:y()(w.a["coz-upload-status"],w.a["coz-upload-status--error"])},u.a.createElement("div",{className:w.a["coz-upload-status-content"]},u.a.createElement("div",null,t("mobile.settings.media_backup.quota")),u.a.createElement("button",{className:w.a["coz-upload-status-link"],onClick:function(){return window.open(n,"_system")}},t("mobile.settings.media_backup.quota_contact"))))};k.propTypes={t:m.a.func.isRequired,url:m.a.string.isRequired};var S=k,x=function(e){var t=e.t;return u.a.createElement("div",{className:y()(w.a["coz-upload-status"],w.a["coz-upload-status--success"])},u.a.createElement("div",{className:w.a["coz-upload-status-content"]},t("mobile.settings.media_backup.media_uptodate")))};x.propTypes={t:m.a.func.isRequired};var j=x,C=function(e){var t=e.t;return u.a.createElement("div",{className:w.a["coz-upload-status-wrapper"]},u.a.createElement("div",{className:y()(w.a["infinite-progress"],w.a["infinite-progress--global"])}),u.a.createElement("div",{className:y()(w.a["coz-upload-status"],w.a["coz-upload-status--waiting"])},u.a.createElement("div",{className:w.a["coz-upload-status-content"]},t("mobile.settings.media_backup.preparing"))))};C.propTypes={t:m.a.func.isRequired};var P=C,A=n("aNx5");function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=function(e){var t=e.isEnabled,n=e.isPreparing,r=e.isUploading,o=e.isAborted,a=e.isQuotaReached,i=e.t,c=e.current,l=e.total,s=e.progress,f=e.serverUrl,p=f?f.replace(/(\w+)\./,"$1-settings.")+"/#/storage":"";return t?n?u.a.createElement(P,{t:i}):r?u.a.createElement(O,{t:i,current:c,total:l,progress:s}):o?u.a.createElement(E,{t:i}):a?u.a.createElement(S,{t:i,url:p}):u.a.createElement(j,{t:i}):null};T.propTypes={t:m.a.func.isRequired,current:m.a.number,total:m.a.number,progress:m.a.number,isEnabled:m.a.bool,isPreparing:m.a.bool,isUploading:m.a.bool,isAborted:m.a.bool,isQuotaReached:m.a.bool,serverUrl:m.a.string};Object(l.connect)(function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){N(e,t,n[t])})}return e}({serverUrl:Object(h.b)(e),isEnabled:Object(h.c)(e),isPreparing:Object(A.l)(e),isUploading:Object(A.n)(e),isAborted:Object(A.k)(e),isQuotaReached:Object(A.m)(e)},Object(A.j)(e))})(Object(s.c)()(T));var z=n("o0o1"),R=n.n(z),D=n("WrkV"),L=n("+FsC"),I=n("oAJy"),F=n.n(I);function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function q(e,t){return!t||"object"!==M(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Y(e,t,n){return(Y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=V(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function V(e){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Q=function(e,t){var n=function(n){function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),q(this,V(r).apply(this,arguments))}var o,a,i,c,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(r,e),o=r,(a=[{key:"componentWillMount",value:(c=R.a.mark(function e(){var n,o=this;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.a.getItem(t);case 2:n=e.sent,this.setState(function(e){return n||e},function(){Y(V(r.prototype),"componentStateRestored",o)&&Y(V(r.prototype),"componentStateRestored",o).call(o)});case 4:case"end":return e.stop()}},e,this)}),u=function(){var e=this,t=arguments;return new Promise(function(n,r){var o=c.apply(e,t);function a(e){U(o,n,r,a,i,"next",e)}function i(e){U(o,n,r,a,i,"throw",e)}a(void 0)})},function(){return u.apply(this,arguments)})},{key:"componentWillUpdate",value:function(e,n){Y(V(r.prototype),"componentWillUpdate",this)&&Y(V(r.prototype),"componentWillUpdate",this).call(this,e,n),F.a.setItem(t,n)}}])&&B(o.prototype,a),i&&B(o,i),r}();return n.displayName="WithPersistentState(".concat(e.displayName||e.name||"Component",")"),n},W=n("Ow0/"),G=n("VPDz"),K=n("rH+U"),X=n.n(K),Z=n("qxHO");function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function te(e){return(te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function re(e,t){return(re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ae="contact@cozycloud.cc",ie=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=te(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==J(o)&&"function"!=typeof o?ne(r):o,oe(ne(n),"state",{sending:!1}),oe(ne(n),"submitForm",function(){var e,t=(e=R.a.mark(function e(t){var r,o,a,i;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),r=n.context.t,o="Cozy Drive Mobile v".concat("1.15.3")+"\nOn ".concat(navigator.platform)+"\nFrom ".concat(navigator.vendor)+"\n".concat(navigator.userAgent),a=n.textarea.value.toString()+"\n_______________\n"+o,i={mode:"from",to:[{name:"Support",email:ae}],subject:r("mobile.rating.email.subject"),parts:[{type:"text/plain",body:a}]},e.prev=5,n.setState({sending:!0}),Object(Z.c)("feedback logs: ".concat(n.textarea.value.toString().substr(0,40)),cozy.client._url),e.next=10,cozy.client.jobs.create("sendmail",i);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(5);case 14:n.clearInput(),n.setState({sending:!1}),n.props.onClose(!0);case 17:case"end":return e.stop()}},e,null,[[5,12]])}),function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){$(a,r,o,i,c,"next",e)}function c(e){$(a,r,o,i,c,"throw",e)}i(void 0)})});return function(e){return t.apply(this,arguments)}}()),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&re(e,t)}(t,c["Component"]),n=t,(r=[{key:"registerElement",value:function(e){this.textarea=e}},{key:"clearInput",value:function(){this.textarea.value=""}},{key:"render",value:function(){var e=this,t=this.props.onClose,n=this.state.sending,r=this.context.t;return u.a.createElement(D.c,{title:r("mobile.rating.feedback.title"),dismissAction:function(){e.clearInput(),t(!1)}},u.a.createElement(D.a,{className:X.a["feedback-form"]},u.a.createElement("form",{className:"coz-form",onSubmit:this.submitForm},u.a.createElement("textarea",{className:X.a["feedback-text"],placeholder:r("mobile.rating.email.placeholder"),ref:this.registerElement.bind(this)}),u.a.createElement("div",{className:X.a["button-block"]},u.a.createElement(G.a,{theme:"secondary",onClick:function(n){n.preventDefault(),e.clearInput(),t(!1)},label:r("mobile.rating.feedback.no")}),u.a.createElement(G.a,{busy:n,label:r("mobile.rating.feedback.yes")})))))}}])&&ee(n.prototype,r),o&&ee(n,o),t}();ie.propTypes={onClose:m.a.func.isRequired};var ce=ie;function ue(){return(ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Oe(e,t,n[t])})}return e}function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function pe(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){fe(a,r,o,i,c,"next",e)}function c(e){fe(a,r,o,i,c,"throw",e)}i(void 0)})}}function de(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function he(e,t,n){return t&&me(e.prototype,t),n&&me(e,n),e}function be(e,t){return!t||"object"!==se(t)&&"function"!=typeof t?ve(e):t}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ve(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function we(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}function ge(e,t){return(ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _e="SCREEN_ENJOY",Ee="SCREEN_FEEDBACK",ke=1,Se=2,xe=7,je=function(e){function t(){var e,n;de(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return Oe(ve(n=be(this,(e=ye(t)).call.apply(e,[this].concat(o)))),"state",{screen:_e}),Oe(ve(n),"onUserReply",function(){var e=pe(R.a.mark(function e(t){var r,o;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=15;break}return e.prev=1,r=n.context.t,e.next=5,ze({title:r("mobile.rating.rate.title"),message:"",yes:r("mobile.rating.rate.yes"),no:r("mobile.rating.rate.no"),later:r("mobile.rating.rate.later"),appMarketID:W.a,appStoreID:W.b,softwareName:W.d});case 5:(o=e.sent)===Se?(L.b.info("mobile.rating.alert.later"),n.props.showLater()):o===ke?(L.b.info("mobile.rating.alert.rated"),n.props.dontShowAgain()):(L.b.info("mobile.rating.alert.declined"),n.props.dontShowAgain()),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),n.props.dontShowAgain(),e.t0;case 13:e.next=16;break;case 15:n.setState({screen:Ee});case 16:case"end":return e.stop()}},e,null,[[1,9]])}));return function(t){return e.apply(this,arguments)}}()),Oe(ve(n),"onCloseFeedback",function(e){e&&L.b.info("mobile.rating.alert.feedback"),n.props.dontShowAgain()}),n}return we(t,c["Component"]),he(t,[{key:"render",value:function(){return this.state.screen===_e?u.a.createElement(Ce,{onReply:this.onUserReply}):u.a.createElement(ce,{onClose:this.onCloseFeedback})}}]),t}();je.propTypes={dontShowAgain:m.a.func.isRequired,showLater:m.a.func.isRequired};var Ce=function(e,t){var n=e.onReply,r=t.t;return u.a.createElement(D.c,{title:r("mobile.rating.enjoy.title"),withCross:!1},u.a.createElement(D.a,null,u.a.createElement("div",{className:X.a["button-block"]},u.a.createElement(L.d,{theme:"secondary",onClick:function(){return n(!1)},label:r("mobile.rating.enjoy.no")}),u.a.createElement(L.d,{onClick:function(){return n(!0)},label:r("mobile.rating.enjoy.yes")}))))};Ce.propTypes={onReply:m.a.func.isRequired};var Pe,Ae,Ne,Te,ze=function(){var e=pe(R.a.mark(function e(t){var n,r,o,a,i,c,u,l;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.title,r=t.message,o=t.yes,a=t.no,i=t.later,c=t.softwareName,u=t.appMarketID,l=t.appStoreID,e.abrupt("return",new Promise(function(e,t){window.AppRate||t(new Error("No AppRate found"));try{window.AppRate.preferences={displayAppName:c,inAppReview:!0,storeAppURL:{ios:l,android:u},customLocale:{title:n,message:r,cancelButtonLabel:a,laterButtonLabel:i,rateButtonLabel:o,yesButtonLabel:o,noButtonLabel:a},callbacks:{onButtonClicked:e}},window.AppRate.promptForRating()}catch(e){t(e)}}));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Re=(Q((Pe=je,Ae=10,Ne=!1,(Te=function(e){function t(){var e,n;de(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return Oe(ve(n=be(this,(e=ye(t)).call.apply(e,[this].concat(o)))),"state",{bootCount:0,promptAfter:(new Date).getTime()+24*xe*60*60*1e3,prompted:!1}),Oe(ve(n),"dontShowAgain",function(){n.setState(function(e){return le({},e,{prompted:!0})})}),Oe(ve(n),"showLater",function(){n.setState(function(e){return le({},e,{bootCount:0,prompted:!1})})}),n}return we(t,c.Component),he(t,[{key:"componentStateRestored",value:function(){Ne||(this.setState(function(e){return{bootCount:++e.bootCount}}),Ne=!0)}},{key:"render",value:function(){var e=this.state,t=e.bootCount,n=e.promptAfter,r=e.prompted,o=n-(new Date).getTime();return!1===r&&t>=Ae&&o<=0&&u.a.createElement(Pe,ue({dontShowAgain:this.dontShowAgain,showLater:this.showLater},this.props))}}]),t}()).displayName="WithBootDelay(".concat(Pe.displayName||Pe.name||"Component",")"),Te),"DelayedRatingModal"),n("snfs"));function De(e){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Le(){return(Le=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Fe(e){return(Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Me(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ue(e,t){return(Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Be=Q(function(e){return function(t){function n(e){var t,r,o,a,i,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),r=this,o=Fe(n).call(this,e),t=!o||"object"!==De(o)&&"function"!=typeof o?Me(r):o,a=Me(t),c=function(){t.setState({viewed:!0})},(i="markAsViewed")in a?Object.defineProperty(a,i,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[i]=c,t.restored=!1,t.state={viewed:!1},t}var r,o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ue(e,t)}(n,c.Component),r=n,(o=[{key:"componentStateRestored",value:function(){this.restored=!0,this.setState(function(e){return e})}},{key:"render",value:function(){if(!this.restored)return null;var t=this.props.uploading,n=this.state.viewed;return t&&!n?u.a.createElement(e,Le({},this.props,{onClose:this.markAsViewed})):null}}])&&Ie(r.prototype,o),a&&Ie(r,a),n}()}(Object(s.c)()(function(e){var t=e.t,n=e.onClose;return u.a.createElement(D.c,{title:t("mobile.first_sync.title"),withCross:!1,into:"body"},u.a.createElement(D.a,null,u.a.createElement("h4",null,t("mobile.first_sync.tips")),u.a.createElement("ul",null,u.a.createElement("li",null,t("mobile.first_sync.tip_wifi")),u.a.createElement("li",null,t("mobile.first_sync.tip_bed")),Object(Re.isIOSApp)()&&u.a.createElement("li",null,t("mobile.first_sync.tip_lock"))),u.a.createElement("p",null,t("mobile.first_sync.result")),u.a.createElement(L.d,{onClick:n,extension:"full",label:t("mobile.first_sync.button")})))})),"OnlyOnceFirstUploadModal"),qe=(Object(l.connect)(function(e){var t=e.mobile.mediaBackup,n=t.uploading,r=void 0!==n&&n,o=t.currentUpload,a=(void 0===o?{messageData:{total:0}}:o).messageData;return{uploading:r&&a.total>=50}})(Be),n("yEaX")),Ye=n("QmKc"),Ve=n.n(Ye);function He(){return(He=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Qe(e){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function We(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ge(e){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xe(e,t){return(Xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ze(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $e=[{label:"name",attr:"name",css:"file",defaultOrder:"asc"},{label:"update",attr:"updated_at",css:"date",defaultOrder:"desc"}],et={attribute:"name",order:"asc"},tt=function(e){var t=e.t,n=e.label,r=e.css;return u.a.createElement("div",{className:y()(Ve.a["fil-content-header"],Ve.a["fil-content-".concat(r)])},t("table.head_".concat(n)))},nt=function(e){var t,n=e.t,r=e.label,o=e.attr,a=e.css,i=e.order,c=void 0===i?null:i,l=e.defaultOrder,s=e.onSort;return u.a.createElement("div",{onClick:function(){return s(o,c?"asc"===c?"desc":"asc":l)},className:y()(Ve.a["fil-content-header"],Ve.a["fil-content-".concat(a)],(t={},Je(t,Ve.a["fil-content-header-sortableasc"],null===c&&"asc"===l),Je(t,Ve.a["fil-content-header-sortabledesc"],null===c&&"desc"===l),Je(t,Ve.a["fil-content-header-sortasc"],"asc"===c),Je(t,Ve.a["fil-content-header-sortdesc"],"desc"===c),t))},n("table.head_".concat(r)))},rt=function(e){var t=e.t,n=e.sort,r=e.onSort,o=e.onClose;return u.a.createElement(L.a,{onClose:o},u.a.createElement("div",{className:Ve.a["fil-sort-menu"]},$e.map(function(e){var t=e.attr;return[{attr:t,order:"asc"},{attr:t,order:"desc"}]}).reduce(function(e,t){return[].concat(Ze(e),Ze(t))},[]).map(function(e){var a=e.attr,i=e.order;return u.a.createElement(L.j,{key:"key_".concat(a,"_").concat(i),className:y()(Ve.a["fil-sort-menu-item"],Je({},Ve.a["fil-sort-menu-item-selected"],n.order===i&&n.attribute===a)),onClick:function(){r(a,i),o()}},t("table.mobile.head_".concat(a,"_").concat(i)))})))},ot=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=Ge(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==Qe(o)&&"function"!=typeof o?Ke(r):o,Je(Ke(n),"state",{showSortMenu:!1}),Je(Ke(n),"showSortMenu",function(){return n.setState({showSortMenu:!0})}),Je(Ke(n),"hideSortMenu",function(){return n.setState({showSortMenu:!1})}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xe(e,t)}(t,c["Component"]),n=t,(r=[{key:"render",value:function(){var e,t=this.props,n=t.t,r=t.folderId,o=t.canSort,a=t.sort,i=t.onFolderSort;if(!o)return null;var c=a||et;return u.a.createElement("div",{className:y()(Ve.a["fil-content-mobile-head"],Ve.a["fil-content-row-head"])},u.a.createElement("div",{onClick:this.showSortMenu,className:y()(Ve.a["fil-content-mobile-header"],(e={},Je(e,Ve.a["fil-content-header-sortasc"],"asc"===c.order),Je(e,Ve.a["fil-content-header-sortdesc"],"desc"===c.order),e))},n("table.mobile.head_".concat(c.attribute,"_").concat(c.order))),this.state.showSortMenu&&u.a.createElement(rt,{t:n,sort:c,onClose:this.hideSortMenu,onSort:function(e,t){return i(r,e,t)}}))}}])&&We(n.prototype,r),o&&We(n,o),t}(),at=function(e){return{sort:Object(qe.g)(e),folderId:Object(qe.f)(e)}},it=function(e){return{onFolderSort:function(t,n,r){return e(Object(qe.k)(t,n,r))}}},ct=Object(l.connect)(at,it)(Object(s.c)()(function(e){var t=e.t,n=e.folderId,r=e.canSort,o=e.sort,a=e.onFolderSort,i=o||et;return u.a.createElement("div",{className:y()(Ve.a["fil-content-head"],Ve.a["fil-content-row-head"])},u.a.createElement("div",{className:y()(Ve.a["fil-content-header"],Ve.a["fil-content-file-select"])}),$e.map(function(e,o){if(!r)return u.a.createElement(tt,He({},e,{t:t}));var c=i&&i.attribute===e.attr;return u.a.createElement(nt,He({key:"key_cell_".concat(o)},e,{t:t,order:c?i.order:null,onSort:function(e,t){return a(n,e,t)}}))}),u.a.createElement("div",{className:y()(Ve.a["fil-content-header"],Ve.a["fil-content-size"])},t("table.head_size")),u.a.createElement("div",{className:y()(Ve.a["fil-content-header"],Ve.a["fil-content-header-status"])},t("table.head_status")),u.a.createElement("div",{className:y()(Ve.a["fil-content-header"],Ve.a["fil-content-header-action"])}))})),ut=Object(l.connect)(at,it)(Object(s.c)()(ot)),lt=n("4BeY"),st=n.n(lt),ft=n("IaFt"),pt=n.n(ft),dt=new st.a({id:"icon-folder-broken_6aea13ed766f34f5967acf158d5b3f17",use:"icon-folder-broken_6aea13ed766f34f5967acf158d5b3f17-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="icon-folder-broken_6aea13ed766f34f5967acf158d5b3f17">\n  <g fill="none" fill-rule="evenodd" transform="translate(0 2)">\n    <path fill="#FDD5D5" d="M0,4.00585866 C0,2.89805351 0.889261723,2 2.00174332,2 L29.9982567,2 C31.103789,2 32,2.89354265 32,4.00276013 L32,15 L24,19 L8,12 L0,16 L0,4.00585866 Z M0,18 L8,14 L24,21 L32,17 L32,26.007983 C32,27.1081436 31.1107383,28 29.9982567,28 L2.00174332,28 C0.89621101,28 0,27.1125667 0,26.000385 L0,18 Z" />\n    <path fill="#F52D2D" d="M0,0.990777969 C0,0.443586406 0.449948758,0 1.00684547,0 L12.9931545,0 C13.5492199,0 14.3125,0.3125 14.7107565,0.71075654 L15.2892435,1.28924346 C15.6817835,1.68178346 16.4446309,2 17.0008717,2 L30.0059397,2 C31.1072288,2 32,2.89470506 32,4 L32,4 L17.0008717,4 C16.4481055,4 15.6875,4.3125 15.2892435,4.71075654 L14.7107565,5.28924346 C14.3182165,5.68178346 13.5500512,6 12.9931545,6 L1.00684547,6 C0.450780073,6 0,5.54902482 0,5.00922203 L0,0.990777969 Z" />\n  </g>\n</symbol>'}),mt=(pt.a.add(dt),dt),ht=n("/OCp"),bt=n.n(ht),yt=function(){window.location.reload()},vt=Object(s.c)()(function(e){var t=e.t;return u.a.createElement(L.f,{title:t("error.open_folder"),icon:mt,className:bt.a.oops},u.a.createElement(L.d,{onClick:yt,label:t("error.button.reload")}))}),wt=n("KOJc"),gt=Object(l.connect)(function(e){return{isNavigating:Object(qe.i)(e),fetchStatus:e.view.fetchStatus}})(function(e){var t=e.fetchStatus,n=e.isNavigating,r=void 0!==n&&n;return(0,e.children)({isLoading:"pending"===t||r,isNavigating:r,isInError:"failed"===t})}),Ot=function(e,t,n){return e+function(e){var t=1e4*Math.sin(e);return t-Math.floor(t)}(n)*(t-e)},_t=function(e){var t=e.width;return u.a.createElement("div",{className:Ve.a["fil-content-file-placeholder"],style:{width:t}})};_t.propTypes={width:m.a.string},_t.defaultProps={width:"100%"};var Et=function(e){var t=e.index;return u.a.createElement("div",{className:Ve.a["fil-content-row"]},u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-file-select"])}),u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-file"])},u.a.createElement(_t,{width:"".concat(Ot(3,12,t),"rem")})),u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-date"])},u.a.createElement(_t,{width:"5rem"})),u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-size"])},u.a.createElement(_t,{width:"".concat(Ot(3.75,5,t),"rem")})),u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-status"])},u.a.createElement(_t,{width:"1.25rem"})))};Et.propTypes={index:m.a.number},Et.defaultProps={index:1};var kt=Et;function St(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var xt=function(e){var t=e.rows;return u.a.createElement("div",null,St(new Array(t)).map(function(e,t){return u.a.createElement(kt,{index:t,key:"key_file_placeholder_".concat(t)})}))};xt.propTypes={rows:m.a.number},xt.defaultProps={rows:8};var jt=xt,Ct=n("SdWe"),Pt=n.n(Ct),At=n("dtw8"),Nt=n("yLV6"),Tt=n.n(Nt),zt=n("zGKU"),Rt=n("mdCN"),Dt=n.n(Rt);function Lt(e){return(Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function It(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ft(e,t){return!t||"object"!==Lt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Mt(e){return(Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ut(e,t){return(Ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Bt=function(e){return""===e.toString()},qt=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ft(this,Mt(t).call(this,e))).state={value:e.name||"",working:!1,error:!1,hasBeenSubmitedOrAborted:!1},n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ut(e,t)}(t,c["Component"]),n=t,(r=[{key:"componentDidMount",value:function(){this.textInput.focus()}},{key:"handleKeyDown",value:function(e){13!==e.keyCode||Bt(this.state.value)?27===e.keyCode&&(this.setState({hasBeenSubmitedOrAborted:!0}),this.abort()):(this.setState({hasBeenSubmitedOrAborted:!0}),this.submit())}},{key:"handleChange",value:function(e){var t=e.target.value;this.setState({value:t}),this.props.onChange&&this.props.onChange(t)}},{key:"handleBlur",value:function(){this.state.hasBeenSubmitedOrAborted||(Bt(this.state.value)?this.abort(!0):this.submit())}},{key:"submit",value:function(){var e=this;this.setState({working:!0,error:!1}),this.props.onSubmit&&this.props.onSubmit(this.state.value).then(function(){return e.setState({working:!1})}).catch(function(){return e.setState({working:!1,error:!0})})}},{key:"abort",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.props.onAbort&&this.props.onAbort(e)}},{key:"render",value:function(e,t){var n=this,r=t.value,o=t.working,a=t.error;return u.a.createElement("div",{"data-test-id":"name-input",className:Dt.a["fil-file-name-input"]},u.a.createElement("input",{type:"text",value:r,ref:function(e){n.textInput=e},disabled:o,onChange:function(e){return n.handleChange(e)},onBlur:function(){return n.handleBlur()},onKeyDown:function(e){return n.handleKeyDown(e)},className:a?Dt.a.error:null}),o&&u.a.createElement(zt.a,null))}}])&&It(n.prototype,r),o&&It(n,o),t}(),Yt=n("JZSQ"),Vt=Object(l.connect)(function(e){return{name:Object(Yt.d)(e)}},function(e){return{updateRenaming:function(t){return e(Object(Yt.f)(t))},rename:function(){return e(Object(Yt.e)())},abortRenaming:function(){return e(Object(Yt.b)())}}})(function(e){var t=e.name,n=e.updateRenaming,r=e.rename,o=e.abortRenaming;return u.a.createElement(qt,{name:t,onChange:n,onSubmit:r,onAbort:o})}),Ht=n("8L3F");function Qt(e){return(Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gt(e){return(Gt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xt(e,t){return(Xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Zt=function(e){function t(){var e,n,r,o,a,i,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var u=arguments.length,l=new Array(u),s=0;s<u;s++)l[s]=arguments[s];return r=this,o=(e=Gt(t)).call.apply(e,[this].concat(l)),n=!o||"object"!==Qt(o)&&"function"!=typeof o?Kt(r):o,a=Kt(n),c=function(e){e.stopPropagation(),n.props.onClick&&n.props.onClick()},(i="onClick")in a?Object.defineProperty(a,i,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[i]=c,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xt(e,t)}(t,c["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.className,n=e.children;return u.a.createElement("div",null,u.a.createElement("a",{className:t,onClick:this.onClick},n))}}])&&Wt(n.prototype,r),o&&Wt(n,o),t}(),Jt=n("32XB"),$t=n.n(Jt);function en(e){return(en="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nn(e,t){return!t||"object"!==en(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function rn(e){return(rn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function on(e,t){return(on=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var an=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),nn(this,rn(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&on(e,t)}(t,c["Component"]),n=t,(r=[{key:"componentDidMount",value:function(){var e=this.props.reference,t=u.a.findDOMNode(e),n=u.a.findDOMNode(this.menuEl);this.popper=new Ht.a(t,n)}},{key:"componentWillUnmount",value:function(){this.popper.destroy()}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,r=t.file,o=t.actions,a=t.onClose,i=Object.keys(o).filter(function(e){var t=o[e];return void 0===t.displayCondition||t.displayCondition([r])});return u.a.createElement("div",{className:$t.a["fil-actionmenu"]},u.a.createElement(L.l,{onClick:a,onEscape:a,className:$t.a["fil-actionmenu-overlay"]}),u.a.createElement("div",{className:$t.a["fil-actionmenu-inner"],ref:function(t){e.menuEl=t}},i.map(function(e){var t=o[e].Component||Zt,i=o[e].action,c=i?function(){var e=i([r]);return a(),e}:void 0;return u.a.createElement(t,{key:e,className:y()($t.a["fil-action"],$t.a["fil-action-".concat(e)]),onClick:c,files:[r]},n("SelectionBar.".concat(e)))})))}}])&&tn(n.prototype,r),o&&tn(n,o),t}(),cn=Object(s.c)()(an),un=n("AXdK"),ln=function(e){var t=e.file,n=xn(t),r=n.filename,o=n.extension;return u.a.createElement("div",null,u.a.createElement("div",{className:y()($t.a["fil-mobileactionmenu-file"],$t.a["fil-mobileactionmenu-header"],jn(t))},u.a.createElement("span",{className:$t.a["fil-mobileactionmenu-file-name"]},r),u.a.createElement("span",{className:$t.a["fil-mobileactionmenu-file-ext"]},o)))},sn=Object(s.c)()(function(e){var t=e.t,n=e.file,r=e.actions,o=e.onClose,a=Object.keys(r).filter(function(e){var t=r[e];return void 0===t.displayCondition||t.displayCondition([n])});return u.a.createElement(un.a,{className:$t.a["fil-mobileactionmenu"],onClose:o},u.a.createElement(ln,{file:n}),u.a.createElement("hr",null),a.map(function(e){var a=r[e].Component||Zt,i=r[e].action,c=i?function(){var e=i([n]);return o(),e}:void 0;return u.a.createElement(a,{key:e,className:$t.a["fil-action-".concat(e)],onClick:c,files:[n]},t("SelectionBar.".concat(e)))}))}),fn=n("ommj"),pn=n("510Z"),dn=n("OsbH"),mn=n("Ieni"),hn=n("7oMs"),bn=n("iTW1");function yn(e){return(yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){En(e,t,n[t])})}return e}function wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gn(e){return(gn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function On(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _n(e,t){return(_n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function En(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kn(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Sn=Object(L.q)()(function(e){var t=e.breakpoints.isMobile,n=kn(e,["breakpoints"]);return t?u.a.createElement(sn,n):u.a.createElement(cn,n)}),xn=function(e){return Object(fn.b)(e)?{filename:e.name,extension:""}:{extension:e.name.slice(e.name.lastIndexOf(".")),filename:e.name.slice(0,e.name.lastIndexOf("."))}},jn=function(e){return Object(fn.b)(e)?Ve.a["fil-file-folder"]:Ve.a["fil-file-"+(Object(mn.a)(Ve.a,"fil-file-")(e.mime,e.name)||"files")]},Cn=function(e){var t=e.withSelectionCheckbox,n=e.selected,r=e.onClick;return u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-file-select"]),onClick:r},t&&u.a.createElement("span",{"data-input":"checkbox"},u.a.createElement("input",{type:"checkbox",checked:n}),u.a.createElement("label",null)))},Pn=function(e){var t=e.attributes,n=e.isRenaming,r=e.interactive,o=e.withFilePath,a=e.withSharedBadge,i=e.isMobile,c=e.formattedSize,l=e.formattedUpdatedAt,s=y()(Ve.a["fil-content-cell"],Ve.a["fil-content-file"],jn(t),En({},Ve.a["fil-content-file-openable"],!n&&r)),f=xn(t),p=f.filename,d=f.extension;return u.a.createElement("div",{className:s},"image"===t.class&&u.a.createElement(pn.a,{file:t,size:"small",render:function(e){return u.a.createElement("div",{className:Ve.a["fil-file-preview"],style:"background-image: url(".concat(e,");")})}}),a&&u.a.createElement(dn.c,{docId:t.id,className:Ve.a["fil-content-shared"],xsmall:!0}),n?u.a.createElement(Vt,null):u.a.createElement("div",{className:Ve.a["fil-file"]},u.a.createElement("div",{className:Ve.a["fil-file-filename"]},u.a.createElement("div",{className:Ve.a["fil-file-filename-wrapper"]},u.a.createElement("div",{"data-test-id":"fil-file-filename-and-ext",className:Ve.a["fil-file-filename-and-ext"]},p,d&&u.a.createElement("span",{className:Ve.a["fil-content-ext"]},d)))),o&&t.displayedPath&&(i?u.a.createElement(L.k,{className:Ve.a["fil-file-path"],text:t.displayedPath}):u.a.createElement(At.a,{to:"/folder/".concat(t.dir_id),className:Ve.a["fil-file-path"]},u.a.createElement(L.k,{text:t.displayedPath}))),!o&&(Object(fn.b)(t)||u.a.createElement("div",{className:Ve.a["fil-file-infos"]},"".concat(l).concat(c?" - ".concat(c):"")))))},An=function(e){var t=e.date,n=e.formatted,r=void 0===n?"-":n;return u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-date"])},u.a.createElement("time",{dateTime:t},r))},Nn=function(e){var t=e.filesize,n=void 0===t?"-":t;return u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-size"])},n)},Tn=function(e){var t=e.isAvailableOffline,n=e.id;return u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-status"])},t&&u.a.createElement("span",{className:Ve.a["fil-content-offline"]},u.a.createElement(L.g,{icon:"phone-download",color:"white",width:"14",height:"14"})),u.a.createElement(dn.e,{docId:n,className:Ve.a["fil-content-sharestatus"]}))},zn=function(e){var t=e.t,n=e.onClick;return u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-file-action"])},u.a.createElement(L.d,{theme:"action",onClick:n,extension:"narrow",icon:u.a.createElement(L.g,{icon:"dots",color:"charcoalGrey",width:"17",height:"17"}),iconOnly:!0,label:t("Toolbar.more")}))},Rn=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=gn(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==yn(o)&&"function"!=typeof o?On(r):o,En(On(n),"state",{actionMenuVisible:!1}),En(On(n),"showActionMenu",function(){n.setState(function(e){return vn({},e,{actionMenuVisible:!0})})}),En(On(n),"hideActionMenu",function(){n.setState(function(e){return vn({},e,{actionMenuVisible:!1})})}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_n(e,t)}(t,c["Component"]),n=t,(r=[{key:"componentDidMount",value:function(){var e=this;this.gesturesHandler=new Tt.a.Manager(this.filerow),this.gesturesHandler.add(new Tt.a.Tap({event:"singletap"})),this.gesturesHandler.add(new Tt.a.Press({event:"onpress"})),this.gesturesHandler.on("onpress singletap",function(t){e.state.actionMenuVisible||e.props.disabled||function(e){if(-1!==["INPUT","BUTTON"].indexOf(e.target.nodeName))return!1;var t=function e(t){return"div"===t.nodeName.toLowerCase()?t:e(t.parentNode)}(e.target);if(-1!==t.className.indexOf(Ve.a["fil-content-file-select"])||-1!==t.className.indexOf(Ve.a["fil-content-file-action"]))return!1;var n=function e(t){return t?"a"===t.nodeName.toLowerCase()?t:e(t.parentNode):null}(e.target);return!(n&&n.className.indexOf(Ve.a["fil-file-path"])>=0)}(t)&&(t.preventDefault(),"onpress"===t.type||e.props.selectionModeActive?e.toggle(t.srcEvent):e.open(t.srcEvent,e.props.attributes))})}},{key:"componentWillUnmount",value:function(){this.gesturesHandler.destroy()}},{key:"toggle",value:function(e){e.stopPropagation();var t=this.props,n=t.attributes,r=t.onCheckboxToggle,o=t.selected;r(n.id,o)}},{key:"open",value:function(e,t){e.stopPropagation(),Object(fn.b)(t)?this.props.onFolderOpen(t.id):this.props.onFileOpen(t,this.props.isAvailableOffline)}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.t,o=n.f,a=n.attributes,i=n.selected,c=n.actions,l=n.isRenaming,s=n.withSelectionCheckbox,f=n.withFilePath,p=n.withSharedBadge,d=n.isAvailableOffline,m=n.disabled,h=n.breakpoints,b=h.isExtraLarge,v=h.isMobile,w=this.state.actionMenuVisible,g=y()(Ve.a["fil-content-row"],(En(e={},Ve.a["fil-content-row-selected"],i),En(e,Ve.a["fil-content-row-actioned"],w),En(e,Ve.a["fil-content-row-disabled"],m),e)),O=Object(fn.b)(a)?void 0:Pt()(a.size,{base:10}),_=a.updated_at||a.created_at,E=o(_,r(b?"table.row_update_format_full":"table.row_update_format"));return u.a.createElement("div",{ref:function(e){t.filerow=e},className:g},u.a.createElement(Cn,{withSelectionCheckbox:s,selected:i,onClick:function(e){return t.toggle(e)}}),u.a.createElement(Pn,{attributes:a,isRenaming:l,interactive:!m,withFilePath:f,withSharedBadge:p,isMobile:v,formattedSize:O,formattedUpdatedAt:E}),u.a.createElement(An,{date:_,formatted:Object(fn.b)(a)?void 0:E}),u.a.createElement(Nn,{filesize:O}),u.a.createElement(Tn,{id:a.id,isAvailableOffline:d}),c&&u.a.createElement(zn,{t:r,ref:function(e){t.filerowMenuToggle=e},onClick:function(e){t.showActionMenu(),e.stopPropagation()}}),c&&w&&u.a.createElement(Sn,{file:a,reference:this.filerowMenuToggle,actions:c,onClose:this.hideActionMenu}))}}])&&wn(n.prototype,r),o&&wn(n,o),t}(),Dn=Object(L.q)()(Object(s.c)()(Rn)),Ln=Object(l.connect)(function(e,t){return{selected:Object(hn.d)(e,t.attributes.id),isAvailableOffline:Object(bn.c)(e,t.attributes.id)}},function(e){return{onCheckboxToggle:function(t,n){return e(Object(hn.g)(t,n))}}})(Dn);function In(){return(In=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Fn(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Mn=function(e){var t=e.onClick,n=e.isLoading,r=e.text;return u.a.createElement("div",{className:y()(Ve.a["fil-content-row"],Ve.a["fil-content-row--center"])},u.a.createElement(L.d,{theme:"secondary",onClick:t,label:n?u.a.createElement(L.m,{noMargin:!0}):r}))};Mn.propTypes={onClick:m.a.func,isLoading:m.a.bool,text:m.a.string.isRequired},Mn.defaultProps={onClick:null,isLoading:!1};var Un,Bn=Object(s.c)()((Un=Mn,function(e){var t=e.t,n=Fn(e,["t"]);return u.a.createElement(Un,In({text:t("table.load_more")},n))}));function qn(e){return(qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Gn(e,t,n[t])})}return e}function Vn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Hn(e){return(Hn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wn(e,t){return(Wn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Gn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n("Wr5T");var Kn=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=Hn(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==qn(o)&&"function"!=typeof o?Qn(r):o,Gn(Qn(n),"state",{isLoading:!1,hasNoMoreRows:!1}),Gn(Qn(n),"intersectionObserver",null),Gn(Qn(n),"loadMoreElement",null),Gn(Qn(n),"checkIntersectionsEntries",function(e){e.filter(function(e){return e.isIntersecting}).length>0&&(n.state.isLoading||n.loadMoreRows(p.a))}),Gn(Qn(n),"updateLoadMoreElement",function(e){n.loadMoreElement&&n.intersectionObserver.unobserve(n.loadMoreElement),e&&(n.loadMoreElement=u.a.findDOMNode(e),n.intersectionObserver.observe(n.loadMoreElement))}),Gn(Qn(n),"loadMoreRows",function(e){n.setState(function(e){return Yn({},e,{isLoading:!0})});var t=n.props.files.length;n.props.fetchMoreFiles(n.props.displayedFolder.id,t,e).then(function(e){n.setState(function(t){return Yn({},t,{isLoading:!1,hasNoMoreRows:e.files.length<p.a})})}).catch(function(){n.setState(function(e){return Yn({},e,{isLoading:!1})})})}),Gn(Qn(n),"rowRenderer",function(e){var t=e.index,r=e.key,o=n.props,a=o.displayedFolder,i=o.fileActions,c=o.onFolderOpen,l=o.onFileOpen,s=o.withSelectionCheckbox,f=o.withFilePath,p=o.withSharedBadge,d=void 0===p||p,m=o.isRenaming,h=o.renamingFile,b=n.props.files[t];if(!b)return u.a.createElement(kt,{key:r});var y=m&&h&&h.id===b.id;return u.a.createElement(Ln,{key:r,attributes:b,displayedFolder:a,actions:i,isRenaming:y,onFolderOpen:c,onFileOpen:l,withSelectionCheckbox:s,withFilePath:f,withSharedBadge:d})}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wn(e,t)}(t,c["PureComponent"]),n=t,(r=[{key:"componentWillMount",value:function(){this.intersectionObserver=new IntersectionObserver(this.checkIntersectionsEntries)}},{key:"componentWillUnmount",value:function(){this.intersectionObserver.disconnect()}},{key:"shouldDisplayLoadMore",value:function(){return!!this.props.displayedFolder&&(Object(Re.isMobileApp)()?!(this.props.files.length<p.a)&&!this.state.hasNoMoreRows:this.props.files.length<this.props.fileCount)}},{key:"render",value:function(){var e=this;return u.a.createElement("div",null,this.props.files.map(function(t,n){return e.rowRenderer({index:n,key:t.id})}),this.shouldDisplayLoadMore()&&u.a.createElement(Bn,{ref:this.updateLoadMoreElement,onClick:function(){e.loadMoreRows(p.a)},isLoading:this.state.isLoading}))}}])&&Vn(n.prototype,r),o&&Vn(n,o),t}();Kn.propTypes={files:m.a.array,fileCount:m.a.number,fetchMoreFiles:m.a.func,displayedFolder:m.a.object,fileActions:m.a.object,onFolderOpen:m.a.func,onFileOpen:m.a.func,withSelectionCheckbox:m.a.bool,withFilePath:m.a.bool,withSharedBadge:m.a.bool,isRenaming:m.a.bool,renamingFile:m.a.object};var Xn=Object(s.c)()(Kn),Zn=n("Q2ax"),Jn=n("37ak"),$n=Object(s.c)()(Object(l.connect)(function(e){return{visible:Object(Jn.c)(e)}},function(e){return{onSubmit:function(t){return e(Object(qe.a)(t)).then(function(){return e(Object(Jn.b)())})},onAbort:function(t){t&&Zn.a.info("alert.folder_abort"),e(Object(Jn.b)())}}})(function(e){var t=e.f,n=e.visible,r=e.onSubmit,o=e.onAbort;return n?u.a.createElement("div",{className:Ve.a["fil-content-row"]},u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-file-select"])}),u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-file"],Ve.a["fil-file-folder"])},u.a.createElement(qt,{onSubmit:r,onAbort:o})),u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-date"])},u.a.createElement("time",{dateTime:""},t(Date.now(),"MMM D, YYYY"))),u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-size"])},"—"),u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-status"])},"—"),u.a.createElement("div",{className:y()(Ve.a["fil-content-cell"],Ve.a["fil-content-file-action"])})):null}));function er(){return(er=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function tr(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var nr=function(e){var t=e.isTrashContext,n=e.canUpload;return t&&!e.params.folderId?u.a.createElement(wt.c,null):u.a.createElement(wt.a,{canUpload:n})};nr.propTypes={isTrashContext:m.a.bool,canUpload:m.a.bool,params:m.a.object},nr.defaultProps={isTrashContext:!1,canUpload:!1,params:{}};var rr=function(e){var t,n,r,o=e.files,a=e.selectionModeActive,i=e.isTypingNewFolderName,c=e.withSelectionCheckbox,l=tr(e,["files","selectionModeActive","isTypingNewFolderName","withSelectionCheckbox"]);return u.a.createElement("div",{"data-test-id":"fil-content-body",className:y()(Ve.a["fil-content-body"],(t={},n=Ve.a["fil-content-body--selectable"],r=a,n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t))},u.a.createElement($n,null),u.a.createElement(gt,null,function(e){var t=e.isLoading,n=e.isInError;return t?u.a.createElement(jt,null):n?u.a.createElement(vt,null):0!==o.length||i?u.a.createElement(Xn,er({files:o,withSelectionCheckbox:c},l)):u.a.createElement(nr,l)}))};rr.propTypes={selectionModeActive:m.a.bool,isTypingNewFolderName:m.a.bool,withSelectionCheckbox:m.a.bool,files:m.a.array,fileCount:m.a.number,fetchMoreFiles:m.a.fund,displayedFolder:m.a.object,fileActions:m.a.object,onFolderOpen:m.a.func,onFileOpen:m.a.func,withFilePath:m.a.bool,withSharedBadge:m.a.bool,isRenaming:m.a.bool,renamingFile:m.a.object};var or=Object(l.connect)(function(e){return{selectionModeActive:Object(hn.e)(e),isTypingNewFolderName:Object(Jn.c)(e)}})(rr),ar=function(e){var t=e.canSort,n=e.fileActions,r=e.withSelectionCheckbox,o=void 0===r||r,a=e.children,i=e.files,c=e.fileCount,l=e.fetchMoreFiles,s=e.displayedFolder,f=e.onFolderOpen,p=e.onFileOpen,d=e.withFilePath,m=e.withSharedBadge,h=e.isRenaming,b=e.renamingFile;return u.a.createElement("div",{className:Ve.a["fil-content-table"],role:"table"},u.a.createElement(ut,{canSort:t}),u.a.createElement(ct,{canSort:t}),u.a.Children.count(a)>0?a:u.a.createElement(or,{fileActions:n,withSelectionCheckbox:o,files:i,fileCount:c,fetchMoreFiles:l,displayedFolder:s,onFolderOpen:f,onFileOpen:p,withFilePath:d,withSharedBadge:m,isRenaming:h,renamingFile:b}))},ir=n("B7OX"),cr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=[],a=/^\/trash/.test(t),i=/^\/recent/.test(t),c=/^\/sharings/.test(t);if(e){o.push(e);var u=e.parent,l=r.includes(e.id),s=u&&r.includes(u.id);!u||!u.id||a&&u.id===p.b||c&&l||(o.unshift(u),!u.dir_id||a&&u.dir_id===p.b||c&&s||n||o.unshift({id:u.dir_id}))}if(n)return o;i||c||o[0]&&(o[0].id===p.b||o[0].id===p.c)||o.unshift({id:a?p.c:p.b});return o},ur=n("KVWx"),lr=n.n(ur);function sr(e){return(sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fr(){return(fr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function pr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function dr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mr(e,t,n){return t&&dr(e.prototype,t),n&&dr(e,n),e}function hr(e,t){return!t||"object"!==sr(t)&&"function"!=typeof t?yr(e):t}function br(e){return(br=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wr(e,t)}function wr(e,t){return(wr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function gr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Or,_r=function(e){function t(){var e,n;pr(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return gr(yr(n=hr(this,(e=br(t)).call.apply(e,[this].concat(o)))),"state",{deployed:!1}),gr(yr(n),"toggleDeploy",function(){n.state.deployed?n.closeMenu():n.openMenu()}),gr(yr(n),"handleClickOutside",function(e){n.menu&&!n.menu.contains(e.target)&&(e.stopPropagation(),n.closeMenu())}),n}return vr(t,c["Component"]),mr(t,[{key:"openMenu",value:function(){this.setState({deployed:!0}),document.addEventListener("click",this.handleClickOutside,!0)}},{key:"closeMenu",value:function(){this.setState({deployed:!1}),document.removeEventListener("click",this.handleClickOutside,!0)}},{key:"render",value:function(){var e=this,t=this.props,n=t.path,r=t.onBreadcrumbClick,o=t.opening,a=t.inlined,i=t.className,c=void 0===i?"":i,l=this.state.deployed;return!!n&&u.a.createElement("div",{className:y()(lr.a["fil-path-backdrop"],gr({},lr.a.deployed,l),gr({},lr.a.inlined,a),gr({},lr.a.mobile,!1),c)},u.a.createElement("h2",{"data-test-id":"path-title",className:lr.a["fil-path-title"],onClick:this.toggleDeploy,ref:function(t){e.menu=t}},n.map(function(t,a){return a<n.length-1?u.a.createElement("span",{className:lr.a["fil-path-link"],onClick:function(e){e.stopPropagation(),r(t)}},u.a.createElement("span",{className:lr.a["fil-path-link-name"]},t.name),u.a.createElement(ir.a,{icon:"forward",className:lr.a["fil-path-separator"]})):u.a.createElement("span",{className:lr.a["fil-path-current"],onClick:function(t){t.stopPropagation(),n.length>=2&&e.toggleDeploy()}},u.a.createElement("span",{className:lr.a["fil-path-current-name"]},t.name),n.length>=2&&u.a.createElement("span",{className:lr.a["fil-path-down"]}),o&&u.a.createElement(zt.a,null))})))}}]),t}(),Er=function(e){function t(){var e,n;pr(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return gr(yr(n=hr(this,(e=br(t)).call.apply(e,[this].concat(o)))),"state",{opening:!1}),gr(yr(n),"toggleOpening",function(){n.setState(function(e){return{opening:!e.opening}})}),gr(yr(n),"navigateToFolder",function(e){var t=n.props,r=t.router,o=t.location,a=t.goToFolder,i=t.getFolderUrl;n.toggleOpening(),a(e).then(function(){n.toggleOpening(),r.push(i(e,o))})}),gr(yr(n),"navigateToPath",function(e){n.props.router.push(e)}),gr(yr(n),"navigateTo",function(e){e.id?n.navigateToFolder(e.id):n.navigateToPath(e.url)}),n}return vr(t,c["Component"]),mr(t,[{key:"render",value:function(){var e=this.props.path,t=this.state.opening;return u.a.createElement(_r,{path:e,onBreadcrumbClick:this.navigateTo,opening:t})}}]),t}(),kr=function(e){var t=e.onClick;return u.a.createElement("button",{className:lr.a["fil-path-previous"],onClick:t})},Sr=function(e){function t(){var e,n;pr(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return gr(yr(n=hr(this,(e=br(t)).call.apply(e,[this].concat(o)))),"navigateToFolder",function(e){var t=n.props,r=t.router,o=t.location,a=t.goToFolder,i=t.getFolderUrl;a(e).then(function(){r.push(i(e,o))})}),gr(yr(n),"navigateToPath",function(e){n.props.router.push(e)}),gr(yr(n),"navigateBack",function(){var e=n.props.path[n.props.path.length-2];e.id?n.navigateToFolder(e.id):n.navigateToPath(e.url)}),n}return vr(t,c["Component"]),mr(t,[{key:"render",value:function(){return u.a.createElement(kr,{onClick:this.navigateBack})}}]),t}(),xr=Object(L.q)()(Object(At.f)(Object(s.c)()((Or=Object(l.connect)(function(e,t){return{path:(n=cr(e.view.displayedFolder,t.location.pathname,t.isPublic,t.sharedDocuments),r=t.location.pathname,o=t.t,"/recent"===r?n.unshift({name:o("breadcrumb.title_recent")}):r.match(/^\/sharings/)&&n.unshift({name:o("breadcrumb.title_sharings"),url:"/sharings"}),n.forEach(function(e){e.id===p.b?e.name=o("breadcrumb.title_drive"):e.id===p.c&&(e.name=o("breadcrumb.title_trash")),e.name||(e.name="…")}),n),getFolderUrl:qe.e};var n,r,o},function(e){return{goToFolder:function(t){return e(Object(qe.j)(t))}}})(function(e){var t=cozy.bar,n=t.BarCenter,r=t.BarLeft;return e.breakpoints.isMobile?u.a.createElement("div",null,e.path.length>=2&&u.a.createElement(r,null,u.a.createElement(Sr,e)),u.a.createElement(n,null,u.a.createElement(Er,e))):u.a.createElement(Er,e)}),function(e){function t(){return pr(this,t),hr(this,br(t).apply(this,arguments))}return vr(t,u.a.Component),mr(t,[{key:"render",value:function(){var e=this;return u.a.createElement(dn.d,null,function(t){var n=t.sharedDocuments;return u.a.createElement(Or,fr({sharedDocuments:n},e.props))})}}]),t}())))),jr=n("FrD0");function Cr(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Pr=Object(l.connect)(function(e){return{selected:Object(hn.b)(e),selectionModeActive:Object(hn.e)(e)}},function(e){return{hideSelectionBar:function(){return e(Object(hn.c)())}}})(function(e){var t=e.selectionModeActive,n=Cr(e,["selectionModeActive"]);return u.a.createElement("div",{style:{display:t?"inherit":"none"}},u.a.createElement(jr.a,n))}),Ar=n("yzbm"),Nr=n("W9Ej"),Tr=n.n(Nr);function zr(e){return(zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rr(){return(Rr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Dr(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Lr(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function Ir(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){qr(e,t,n[t])})}return e}function Fr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mr(e){return(Mr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ur(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Br(e,t){return(Br=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Yr=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=Mr(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==zr(o)&&"function"!=typeof o?Ur(r):o,qr(Ur(n),"state",{dropzoneActive:!1}),qr(Ur(n),"onDragEnter",function(e){Qr(e)&&n.setState(function(e){return Ir({},e,{dropzoneActive:!0})})}),qr(Ur(n),"onDragLeave",function(){return n.setState(function(e){return Ir({},e,{dropzoneActive:!1})})}),qr(Ur(n),"onDrop",function(){var e,t=(e=R.a.mark(function e(t,r,o){var a,i;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.props.displayedFolder.id,n.setState(function(e){return Ir({},e,{dropzoneActive:!1})}),Qr(o)){e.next=4;break}return e.abrupt("return");case 4:i=Hr(o)?o.dataTransfer.items:t,n.props.uploadFiles(i,a);case 6:case"end":return e.stop()}},e)}),function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Lr(a,r,o,i,c,"next",e)}function c(e){Lr(a,r,o,i,c,"throw",e)}i(void 0)})});return function(e,n,r){return t.apply(this,arguments)}}()),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Br(e,t)}(t,c["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.state.dropzoneActive,t=this.props,n=t.displayedFolder,r=t.children,o=Dr(t,["displayedFolder","children"]);return u.a.createElement(Ar.a,Rr({},o,{className:e?Tr.a["fil-dropzone-active"]:"",disableClick:!0,style:{},onDrop:this.onDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave}),e&&u.a.createElement(Vr,{currentFolder:n}),r)}}])&&Fr(n.prototype,r),o&&Fr(n,o),t}(),Vr=Object(L.p)()(function(e){var t=e.t,n=e.currentFolder;return u.a.createElement("div",{className:Tr.a["fil-dropzone-teaser"]},u.a.createElement("div",{className:Tr.a["fil-dropzone-teaser-claudy"]}),u.a.createElement("div",{className:Tr.a["fil-dropzone-teaser-content"]},u.a.createElement("p",null,t("Files.dropzone.teaser")),u.a.createElement("span",{className:Tr.a["fil-dropzone-teaser-folder"]},n&&n.name||"Drive")))}),Hr=function(e){if(!e.dataTransfer)return!1;var t=e.dataTransfer;return t.items&&t.items.length&&null!=t.items[0].webkitGetAsEntry},Qr=function(e){for(var t=e.dataTransfer.items,n=0;n<t.length;n+=1)if("file"!==t[n].kind)return!1;return!0},Wr=Object(l.connect)(null,function(e){return{uploadFiles:function(t,n){e(Object(qe.l)(t,n))}}})(Yr),Gr=n("e2oC"),Kr=n("f/Nf"),Xr=n("8IyR"),Zr=n.n(Xr);var Jr=function(e){var t,n,r,o=e.children,a=e.working,i=void 0!==a&&a,c=e.isPublic,l=void 0!==c&&c;return u.a.createElement(Gr.c,{className:y()(Zr.a["fil-content"],(t={},n=Zr.a["--working"],r=i,n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t))},!l&&u.a.createElement(Kr.a,null),o)};Jr.propTypes={isPublic:m.a.bool,working:m.a.bool,children:m.a.array};var $r=Jr,eo=n("XxWZ"),to=n.n(eo);function no(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ro=function(e){var t,n=e.children,r=e.hideOnMobile,o=void 0===r||r;return u.a.createElement("div",{className:y()(to.a["fil-topbar"],(t={},no(t,to.a.mobile,!1),no(t,to.a["hidden-mobile"],o),t))},n)};function oo(e){return(oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ao(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function io(e,t){return!t||"object"!==oo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function co(e){return(co=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function uo(e,t){return(uo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var lo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),io(this,co(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&uo(e,t)}(t,c["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.children,n=e.isTrashContext,r=this.props,o=r.displayedFolder,a=r.files,i=r.actions,c=r.Toolbar,l=r.canSort,s=r.canDrop,d=r.canUpload,m=r.canCreateFolder,h=n&&0===a.length,b=Object(qe.d)(this.props.location,this.props.params);p.b;return u.a.createElement($r,null,u.a.createElement(ro,null,u.a.createElement(xr,null),u.a.createElement(gt,null,function(e){var t=e.isLoading,n=e.isInError;return u.a.createElement(c,{folderId:b,canUpload:d,canCreateFolder:m,disabled:n||t||h})})),u.a.createElement(Wr,{role:"main",disabled:!s,displayedFolder:o},!1,u.a.createElement(Pr,{actions:i.selection}),u.a.createElement(ar,{canSort:l,fileActions:i.selection,files:this.props.files,fileCount:this.props.fileCount,fetchMoreFiles:this.props.fetchMoreFiles,displayedFolder:this.props.displayedFolder,onFolderOpen:this.props.onFolderOpen,onFileOpen:this.props.onFileOpen,withFilePath:this.props.withFilePath,withSharedBadge:this.props.withSharedBadge,isRenaming:this.props.isRenaming,renamingFile:this.props.renamingFile}),this.renderViewer(t)),u.a.createElement(f.a,null))}},{key:"renderViewer",value:function(e){var t=this;return e?u.a.Children.map(e,function(e){return u.a.cloneElement(e,{files:t.props.files||[]})}):null}}])&&ao(n.prototype,r),o&&ao(n,o),t}(),so=Object(s.c)()(lo),fo=n("MM/P"),po=n.n(fo),mo=Object(s.c)()(function(e){var t=e.t,n=e.fileCount,r=e.confirm,o=e.onClose,a=["forbidden","restore"].map(function(e){return u.a.createElement("p",{className:y()(po.a["fil-confirm-text"],po.a["icon-".concat(e)]),key:"key_destroy_".concat(e)},t("destroyconfirmation.".concat(e),n))});return u.a.createElement(D.c,{title:t("destroyconfirmation.title",n),description:a,secondaryType:"secondary",secondaryText:t("destroyconfirmation.cancel"),secondaryAction:o,primaryType:"danger",primaryText:t("destroyconfirmation.delete"),primaryAction:function(){return r().then(o).catch(o)}})}),ho=n("SvPG"),bo=n("Mlvp"),yo=n.n(bo);function vo(e){return(vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function go(e){return(go=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _o(e,t){return(_o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Eo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ko=function(e){var t=e.children,n=e.onClick;return u.a.createElement("div",{onClick:n,className:yo.a["coz-menu-item"]},t)},So=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=go(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==vo(o)&&"function"!=typeof o?Oo(r):o,Eo(Oo(n),"state",{opened:!1}),Eo(Oo(n),"toggle",function(){return n.state.opened?n.close():n.open()}),Eo(Oo(n),"handleSelect",function(){n.close()}),Eo(Oo(n),"open",function(){n.setState({opened:!0})}),Eo(Oo(n),"close",function(){n.setState({opened:!1})}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_o(e,t)}(t,c["Component"]),n=t,(r=[{key:"renderItems",value:function(){var e=this;return u.a.Children.map(this.props.children,function(t){return t?"hr"!==t.nodeName?u.a.cloneElement(t,{onClick:e.handleSelect.bind(e,t)}):u.a.cloneElement(t):t})}},{key:"render",value:function(){var e=this.props,t=e.title,n=e.disabled,r=e.className,o=e.innerClassName,a=e.button,i=e.buttonClassName,c=this.state.opened;return u.a.createElement("div",{className:y()(yo.a["coz-menu"],r)},a&&u.a.cloneElement(a,{disabled:n,onClick:this.toggle}),!a&&u.a.createElement("button",{role:"button",className:i||yo.a["c-btn"],disabled:n,onClick:this.toggle},t),c&&u.a.createElement(L.l,{onClick:this.close,onEscape:this.close,className:yo.a["cozy-menu-overlay"]}),u.a.createElement("div",{"data-test-id":"coz-menu-inner",className:y()(yo.a["coz-menu-inner"],o,Eo({},yo.a["coz-menu-inner--opened"],c))},this.renderItems()))}}])&&wo(n.prototype,r),o&&wo(n,o),t}(),xo=Object(s.c)()(function(e){var t=e.t,n=e.onConfirm,r=e.onClose,o=["forbidden","restore"].map(function(e){return u.a.createElement("p",{className:y()(po.a["fil-confirm-text"],po.a["icon-".concat(e)]),key:e},t("emptytrashconfirmation.".concat(e)))});return u.a.createElement(D.c,{title:t("emptytrashconfirmation.title"),description:o,secondaryType:"secondary",secondaryText:t("emptytrashconfirmation.cancel"),secondaryAction:r,primaryType:"danger",primaryText:t("emptytrashconfirmation.delete"),primaryAction:function(){return n().then(r).catch(r)}})});function jo(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function Co(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){jo(a,r,o,i,c,"next",e)}function c(e){jo(a,r,o,i,c,"throw",e)}i(void 0)})}}var Po={cancelSelection:!0,hideActionMenu:!0},Ao=n("z+SL"),No=n.n(Ao),To=function(){return{}},zo=function(e){return{showSelectionBar:function(){return e(Object(hn.f)())}}},Ro=function(e){return Object(l.connect)(To,zo)(e)}(function(e){return u.a.cloneElement(e.children,{onClick:e.showSelectionBar})}),Do=Object(s.c)()(Object(L.q)()(Object(l.connect)(function(e){return{selectionModeActive:Object(hn.e)(e)}},function(e){return{emptyTrash:function(){return e(Object(f.d)(u.a.createElement(xo,{onConfirm:function(){return e((t=Co(R.a.mark(function e(t){return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Zn.a.info("alert.empty_trash_progress"),t({type:"EMPTY_TRASH"}),e.prev=2,e.next=5,cozy.client.files.clearTrash();case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(2),Zn.a.error("alert.try_again"),e.abrupt("return",t({type:"EMPTY_TRASH_FAILURE"}));case 11:return Zn.a.info("alert.empty_trash_success"),e.abrupt("return",t({type:"EMPTY_TRASH_SUCCESS"}));case 13:case"end":return e.stop()}},e,null,[[2,7]])})),function(e){return t.apply(this,arguments)}));var t}})))}}})(function(e){var t=e.t,n=e.disabled,r=e.selectionModeActive,o=e.emptyTrash,a=e.breakpoints.isMobile,i=cozy.bar.BarRight,c=u.a.createElement(So,{title:t("toolbar.item_more"),disabled:n||r,className:No.a["fil-toolbar-menu"],button:u.a.createElement(ho.b,null)},u.a.createElement(ko,null,u.a.createElement("a",{className:No.a["fil-action-delete"],onClick:function(){return o()}},t("toolbar.empty_trash"))),u.a.createElement("hr",null),u.a.createElement(Ro,null,u.a.createElement("a",{className:No.a["fil-action-select"]},t("toolbar.menu_select"))));return u.a.createElement("div",{className:No.a["fil-toolbar-trash"],role:"toolbar"},u.a.createElement(L.d,{theme:"danger-outline",className:y()(No.a["u-hide--mob"]),onClick:function(){return o()},disabled:n||r,icon:"delete",label:t("toolbar.empty_trash")}),a?u.a.createElement(i,null,c):c)})));Object(s.c)()(Object(l.connect)(function(){return{isTrashContext:!0,canDrop:!1,canUpload:!1,withSharedBadge:!1,Toolbar:Do}},function(e,t){return{actions:Object.assign({},t.actions,{selection:{restore:{action:function(t){return e(function(e){return t=Co(R.a.mark(function t(n){var r,o,a,i,c,u,l,s;return R.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=Po,n({type:"RESTORE_FILES",files:e}),o=[],t.prev=3,a=!0,i=!1,c=void 0,t.prev=7,u=e[Symbol.iterator]();case 9:if(a=(l=u.next()).done){t.next=19;break}return s=l.value,t.t0=o,t.next=14,cozy.client.files.restoreById(s.id);case 14:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 16:a=!0,t.next=9;break;case 19:t.next=25;break;case 21:t.prev=21,t.t2=t.catch(7),i=!0,c=t.t2;case 25:t.prev=25,t.prev=26,a||null==u.return||u.return();case 28:if(t.prev=28,!i){t.next=31;break}throw c;case 31:return t.finish(28);case 32:return t.finish(25);case 33:t.next=39;break;case 35:return t.prev=35,t.t3=t.catch(3),Zn.a.error("alert.try_again"),t.abrupt("return",n({type:"RESTORE_FILES_FAILURE",meta:r}));case 39:return Zn.a.info("alert.restore_file_success"),t.abrupt("return",n({type:"RESTORE_FILES_SUCCESS",ids:e.map(function(e){return e.id}),meta:r}));case 41:case"end":return t.stop()}},t,null,[[3,35],[7,21,25,33],[26,,28,32]])})),function(e){return t.apply(this,arguments)};var t}(t))}},destroy:{action:function(t){return e(Object(f.d)(u.a.createElement(mo,{fileCount:t.length,confirm:function(){return e(function(e){return t=Co(R.a.mark(function t(n){var r,o,a,i,c,u,l,s;return R.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=Po,n({type:"DESTROY_FILES",files:e}),o=[],t.prev=3,a=!0,i=!1,c=void 0,t.prev=7,u=e[Symbol.iterator]();case 9:if(a=(l=u.next()).done){t.next=19;break}return s=l.value,t.t0=o,t.next=14,cozy.client.files.destroyById(s.id);case 14:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 16:a=!0,t.next=9;break;case 19:t.next=25;break;case 21:t.prev=21,t.t2=t.catch(7),i=!0,c=t.t2;case 25:t.prev=25,t.prev=26,a||null==u.return||u.return();case 28:if(t.prev=28,!i){t.next=31;break}throw c;case 31:return t.finish(28);case 32:return t.finish(25);case 33:t.next=39;break;case 35:return t.prev=35,t.t3=t.catch(3),Zn.a.error("alert.try_again"),t.abrupt("return",n({type:"DESTROY_FILES_FAILURE",meta:r}));case 39:return Zn.a.info("alert.destroy_file_success"),t.abrupt("return",n({type:"DESTROY_FILES_SUCCESS",ids:e.map(function(e){return e.id}),meta:r}));case 41:case"end":return t.stop()}},t,null,[[3,35],[7,21,25,33],[26,,28,32]])})),function(e){return t.apply(this,arguments)};var t}(t))}})))}}}})}})(so));function Lo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Io(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.d(t,"h",function(){return Bo}),n.d(t,"g",function(){return Vo}),n.d(t,"f",function(){return Ho}),n.d(t,"b",function(){return Qo}),n.d(t,"e",function(){return Xo}),n.d(t,"c",function(){return Zo}),n.d(t,"d",function(){return Jo});var Fo,Mo,Uo,Bo=function(e){var t=e.view;return t.hasDisplayedSomething&&t.isOpening},qo=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t.find(function(t){return t.id===e.id}))return t;var o=Yo(e,t,function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||{attribute:"name",order:"asc"};return"updated_at"===e.attribute?function(t,n){var r=new Date(t.updated_at).getTime(),o=new Date(n.updated_at).getTime();return"desc"===e.order?r>o?-1:1:r>o?1:-1}:function(t,n){return t.type!==n.type?Object(fn.b)(t)?-1:1:"desc"===e.order?n.name.localeCompare(t.name):t.name.localeCompare(n.name)}}(r));return o===t.length-1&&t.length<n?t:[].concat(Io(t.slice(0,o+1)),[e],Io(t.slice(o+1)))},Yo=function e(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.length;if(0===n.length)return-1;var i=parseInt(o+(a-o)/2,10),c=r(t,n[i]);if(a-o<=1)return-1===c?i-1:i;switch(c){case-1:return e(t,n,r,o,i);case 0:return i;case 1:return e(t,n,r,i,a)}},Vo=(t.a=Object(r.combineReducers)({hasDisplayedSomething:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];switch((arguments.length>1?arguments[1]:void 0).type){case i.n:case i.g:return!0;default:return e}},isOpening:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];switch((arguments.length>1?arguments[1]:void 0).type){case i.l:case i.e:case i.h:return!0;case i.n:case i.g:case i.j:return!1;default:return e}},displayedFolder:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i.n:return t.folder;case i.g:case i.j:return null;default:return e}},openedFolderId:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i.l:return t.folderId;case i.e:case i.h:return null;default:return e}},fileCount:(Fo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i.n:case i.g:case i.j:return t.fileCount;case i.b:case i.a:return e+1;case i.c:return e-1;case i.s:case"DESTROY_FILES_SUCCESS":case"RESTORE_FILES_SUCCESS":return e-t.ids.length;default:return e}},Mo=[],Uo=[],function(e,t){switch(t.type){case i.b:case i.a:return function(e,t){var n=t.file||t.folder;return Mo.includes(n.id)?e:(Mo.push(n.id),a()(Uo,n.id),Fo(e,t))}(e,t);case i.c:case i.s:case"DESTROY_FILES_SUCCESS":case"RESTORE_FILES_SUCCESS":return function(e,t){var n=(t.ids||[t.file.id]).filter(function(e){return!Uo.includes(e)});return 0===n.length?e:(Uo.push.apply(Uo,Io(n)),a.a.apply(void 0,[Mo].concat(Io(n))),t.ids=n,Fo(e,t))}(e,t);case i.n:case i.g:case i.j:return function(e,t){return Mo.length=0,Uo.length=0,Fo(e,t)}(e,t);default:return Fo(e,t)}}),sort:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i.p:return{attribute:t.sortAttribute,order:t.sortOrder};case i.g:return{attribute:"updated_at",order:"desc"};case i.n:case i.j:return null;default:return e}},files:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i.n:case i.g:case i.j:case i.r:return t.files;case i.d:var n=e.slice(0);return t.files.forEach(function(e,r){n[t.skip+r]=e}),n;case Yt.a:case i.t:return function(e,t){var n=t.find(function(t){return t.id===e.id}),r=t.indexOf(n),o=r>=0?1:0,a=t.slice();return a.splice(r,o,e),a}(t.file,e);case i.a:return qo(t.file,e,t.currentFileCount,t.currentSort);case i.b:return qo(t.folder,e,t.currentFileCount,t.currentSort);case i.s:case"RESTORE_FILES_SUCCESS":case"DESTROY_FILES_SUCCESS":return e.filter(function(e){return-1===t.ids.indexOf(e.id)});case i.c:return e.filter(function(e){return t.file.id!==e.id});case"EMPTY_TRASH_SUCCESS":return[];default:return e}},fetchStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pending";switch((arguments.length>1?arguments[1]:void 0).type){case"EMPTY_TRASH":case i.p:return"pending";case i.n:case i.r:case i.g:case i.j:case"EMPTY_TRASH_SUCCESS":case"EMPTY_TRASH_FAILURE":return"loaded";case i.m:case i.q:case i.f:case i.i:return"failed";default:return e}},lastFetch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch((arguments.length>1?arguments[1]:void 0).type){case i.n:case i.m:case i.r:case i.q:case i.g:case i.f:case i.j:case i.i:return Date.now();default:return e}}}),function(e){var t=e.view;return t.files.map(function(e){return Wo({view:t},e)})}),Ho=function(e){return e.view.sort},Qo=function(e,t){var n=e.view,r=n.files.find(function(e){return e&&e.id&&e.id===t});return r?Wo({view:n},r):null},Wo=function(e,t){var n=e.view;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Lo(e,t,n[t])})}return e}({},t,{displayedPath:Ko({view:n},t),path:Go({view:n},t)})},Go=function(e,t){var n=e.view.displayedFolder;if(Object(fn.b)(t))return t.path;var r=n?n.id!==p.b?n.path:"":t.path;return"".concat(r,"/").concat(t.name)},Ko=function(e,t){var n=e.view.displayedFolder;return t.path||(n?n.path:"")},Xo=function(e){return e.view.openedFolderId},Zo=function(e,t){return t.folderId?t.folderId:e.pathname.match(/^\/folder/)?p.b:e.pathname.match(/^\/trash/)?p.c:void 0},Jo=function(e,t){return void 0===e?"/folder":e===p.b?"/folder":e===p.c?"/trash":((n=t.pathname).match(/^\/sharings/)?"/sharings/":n.match(/^\/trash/)?"/trash/":"/folder/")+e;var n}},"0yyf":function(e,t,n){e.exports={"pho-sidebar":"pho-sidebar--1JZDr","pho-content":"pho-content--6vy4r","pho-content-wrapper":"pho-content-wrapper--1u34M",spin:"spin--OsM9y"}},1:function(e,t,n){n("201c"),n("Q+3J"),e.exports=n("oGE2")},"1BUi":function(e,t,n){e.exports={"recipient-status":"recipient-status--2uFD7","recipient-menu-btn":"recipient-menu-btn--2_GX0",spin:"spin--2Hvw_",recipient:"recipient--HkJgC","recipients-list-light":"recipients-list-light--3bHel","recipient-avatar":"recipient-avatar--1Cmmp","recipient-avatar--small":"recipient-avatar--small--2hoPQ","recipient-avatar-link":"recipient-avatar-link--3gLdE","recipient-avatar-plusx":"recipient-avatar-plusx--2ruV6","recipient-idents":"recipient-idents--3NhkH","recipient-ident-status":"recipient-ident-status--3W1WI","recipient-user":"recipient-user--2ON6I","recipient-url":"recipient-url--11rA9",avatar:"avatar--2xuqM","recipients-avatars":"recipients-avatars--1PuFV","--interactive":"_--interactive--3t-An","recipient-owner":"recipient-owner--3PukF","recipient-menu":"recipient-menu--Gn7vM","action-unshare":"action-unshare--W0mml","action-unshare-desc":"action-unshare-desc--8flsy"}},"1aVK":function(e,t,n){"use strict";n.d(t,"d",function(){return m}),n.d(t,"b",function(){return h}),n.d(t,"g",function(){return b}),n.d(t,"h",function(){return y}),n.d(t,"f",function(){return v}),n.d(t,"c",function(){return w}),n.d(t,"e",function(){return g}),n.d(t,"a",function(){return O});var r=n("o0o1"),o=n.n(r),a=n("snfs");function i(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function c(e){i(a,r,o,c,u,"next",e)}function u(e){i(a,r,o,c,u,"throw",e)}c(void 0)})}}var u=function(){return Object(a.isAndroidApp)()?window.cordova.file.externalRootDirectory:window.cordova.file.dataDirectory},l=function(e){return new Promise(function(t,n){window.resolveLocalFileSystemURL(e,t,function(t){console.error("".concat(e," could not be resolved: ").concat(t.message)),n(t)})})},s=function(){return l(u()+"Cozy/Cozy Drive/").catch(function(){return f()})},f=function(){return l(u()).then(function(e){return p(e,"Cozy").then(function(e){return p(e,"Cozy Drive")})})},p=function(e,t){return new Promise(function(n,r){e.getDirectory(t,{create:!0},n,function(e){console.warn("Error to get directory",t),console.warn(e),r("Error to get directory")})})},d=function(e,t,n){return new Promise(function(r,o){e.getFile(n,{create:!0,exclusive:!1},function(e){(function(e,t){return new Promise(function(n,r){e.createWriter(function(o){o.onwriteend=function(){n(e)},o.onerror=function(e){console.warn("Error to write file"),console.warn(e),r("Error to write file")},o.write(t)})})})(e,t).then(function(){r(e)}).catch(o)},function(e){console.warn("Error to get file"),console.warn(e),o("Error to get file")})})},m=function(e,t){return new Promise(function(n,r){var o=decodeURIComponent(e),a={error:r,success:n};window.cordova.plugins.fileOpener2.open(o,t,a)})},h=function(){var e=c(o.a.mark(function e(t){var n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s();case 2:return n=e.sent,e.next=5,l("".concat(n.nativeURL).concat(t));case 5:return r=e.sent,e.abrupt("return",r.remove());case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),b=function(e,t){return s().then(function(n){return d(n,e,t)})},y=function(e,t){return l(Object(a.isAndroidApp)()?window.cordova.file.externalCacheDirectory:window.cordova.file.cacheDirectory).then(function(n){return d(n,e,t)})},v=function(e,t){return y(e,t).then(function(t){return m(t.nativeURL,e.type)})},w=function(){var e=c(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s();case 2:return n=e.sent,e.abrupt("return",l("".concat(n.nativeURL).concat(t.id)));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=c(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(t);case 2:return n=e.sent,e.abrupt("return",m(n.nativeURL,t.mime));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=c(o.a.mark(function e(t,n){var r,a,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,cozy.client.files.downloadById(t);case 2:return r=e.sent,e.next=5,r.blob();case 5:return a=e.sent,e.next=8,y(a,n);case 8:return i=e.sent,e.abrupt("return",i);case 10:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},"1eh9":function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return f});var r=n("o0o1"),o=n.n(r),a=n("oAJy"),i=n.n(a);function c(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){c(a,r,o,i,u,"next",e)}function u(e){c(a,r,o,i,u,"throw",e)}i(void 0)})}}var l=function(){var e=u(o.a.mark(function e(t){var n,r,a,c,u,l,s,f,p,d,m,h,b,y,v;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.settings,r=n.firstReplication,a=n.client,c=n.indexes,u=n.offline,l=t.mobile.settings,s=l.authorized,f=l.token,p=l.serverUrl,d=l.backupImages,m=l.analytics,h=l.wifiOnly,b=t.mobile.authorization||{revoked:!1},y=b.revoked,v={mobile:{authorization:{authorized:s,revoked:y,client:a,token:f},settings:{offline:u,serverUrl:p,backupImages:d,analytics:m,wifiOnly:h},replication:{firstReplication:r,indexes:c},mediaBackup:t.mobile.mediaBackup},availableOffline:t.availableOffline},e.next=6,i.a.setItem("state",v);case 6:return console.info("Migrated persisted settings"),console.info("Previously persisted state: ",t),console.info("New persisted state: ",v),e.abrupt("return",v);case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),s=function(){var e=u(o.a.mark(function e(){var t,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.a.getItem("state");case 3:if(null!==(t=e.sent)){e.next=6;break}return e.abrupt("return",void 0);case 6:if(!t.hasOwnProperty("settings")){e.next=12;break}return console.warn("Migrating persisted settings"),e.next=10,l(t);case 10:return n=e.sent,e.abrupt("return",n);case 12:return e.abrupt("return",t);case 15:return e.prev=15,e.t0=e.catch(0),console.warn(e.t0),e.abrupt("return",void 0);case 19:case"end":return e.stop()}},e,null,[[0,15]])}));return function(){return e.apply(this,arguments)}}(),f=function(){return i.a.clear()}},"2OO4":function(e){e.exports={Nav:{photos:"Photos",albums:"Albums",shared:"Shared by me",trash:"Trash","btn-client":"Get Cozy Drive for desktop","btn-client-web":"Get Cozy","btn-client-mobile":"Get Cozy Drive on your mobile!","banner-txt-client":"Get Cozy Drive for Desktop and synchronise your files safely to make them accessible at all times.","banner-btn-client":"Download","link-client":"https://cozy.io/en/download/","link-client-desktop":"https://nuts.cozycloud.cc/download/channel/stable/","link-client-android":"https://play.google.com/store/apps/details?id=io.cozy.drive.mobile","link-client-ios":"https://itunes.apple.com/us/app/cozy-drive/id1224102389?mt=8","link-client-web":"https://cozy.io/fr/try-it?from=albumsharing"},empty:{timeline_photos_title:"You don't have any photos yet.",timeline_photos_text:'Click the "Upload" button to add photos.',albums_title:"You don't have any album yet.",albums_text:'Start by clicking "New album" to create your first album.',album_photos_title:"There is no photo in this album yet.",album_photos_text:'Start by clicking "Add photos to album" to add some.',shared_album_photos_title:"There is no photo in this album yet.",shared_album_photos_text:"Come back later"},Error:{albums_title:"An error occurred while retrieving the albums list. Please try again later.",album_photos_title:"An error occurred while retrieving the album's photos list. Please try again later.",timeline_photos_title:"An error occurred while retrieving the photos list. Please try again later.",public_album_error_title:"An error occurred while retrieving the photos list. Please try again later.",public_album_unshared_title:"Sorry, this link is no longer available.",public_album_unshared_text:"One lost, ten found... or just check out with the owner for help. This file might not be lost.",refresh:"Refresh now",generic:"An error occurred, please try again.",album_rename_abort:"The album name can not be empty."},Toolbar:{photo_upload:"Upload",album_new:"New album",album_delete:"Delete",album_quit:"Leave & delete shared album",album_download:"Download",more:"More",menu:{select_items:"Select photos",photo_upload:"Upload photos",rename_album:"Rename album",album_delete:"Delete album",album_quit:"Leave & delete shared album",download_album:"Download album",add_photos:"Add photos to album"}},loading:{photos_indexing:"Your photos are currently being indexed. Please wait.",albums_indexing:"Your albums are currently being indexed. Please wait.",photos_fetching:"Loading",albums_fetching:"Loading",photos_upload:"Uploading"},Board:{load_more:"Load more photos",select_all:"Select all",unselect_all:"Unselect all"},Alerter:{photos:{fetching_error:"An error occurred during photos fetching.",already_added_photo:"This album already contains this photo."}},SelectionBar:{selected_count:"item selected |||| items selected",delete:"Delete","album-add":"Add to album","album-remove":"Remove from album",download:"Download",close:"Close"},Share:{status:{pending:"Pending",accepted:"Accepted",refused:"Refused",error:"Error",unregistered:"Error","mail-not-sent":"Error",revoked:"Error"},type:{"one-way":"Can View (coming soon)","two-way":"Can Change"},"create-cozy":"Create my cozy"},Albums:{album_item_description:"%{smart_count} photo |||| %{smart_count} photos",album_item_shared_ro:"Shared (read only)",album_item_shared_rw:"Shared (read/write)",load_more:"Load more albums",add_photos:{title:"Add to album",success:"Album %{name} has been updated with %{smart_count} photo. |||| Album %{name} has been updated with %{smart_count} photos.",error:{generic:"An error occurred when updating the album, please try again.",reference:"Some photos has not been added to the album. Please check and try again.",response:{Forbidden:"Application does not have permission to update albums."}}},share:{cta:"Share",title:"Share with others",details:{title:"Sharing details",createdAt:"On %{date}",ro:"Read only",rw:"Read/write"},sharedByMe:"Shared",sharedWithMe:"Shared with me",shareByLink:{subtitle:"By public link",desc:"Anyone with the provided link can see and download your photos.",fetchFailed:"Woops! It seems your connectivity is limited, try again later when it gets better.",creating:"Creating your link...",copy:"Copy link",copied:"Link has been copied to clipboard",failed:"Unable to copy to clipboard"},shareByEmail:{title:"By email",subtitle:"By email",email:"email",emailPlaceholder:"Enter the email address or name of the recipient",send:"Send",genericSuccess:"You sent an invite to %{count} contacts.",success:"You sent an invite to %{email}.",comingsoon:"Coming soon! You will be able to share documents and photos in a single click with your family, your friends, and even your coworkers. Don't worry, we'll let you know when it's ready!"},unshare:{title:"Remove from album",success:"You removed this shared album from %{email}."},sharingLink:{title:"Link to share",copy:"Copy",copied:"Copied"},whoHasAccess:{title:"Who has access"},protectedShare:{title:"Coming soon!",desc:"Share anything by email with your family and friends!"},close:"Close",gettingLink:"Getting your link...",error:{generic:"An error occurred when creating the album share link, please try again.",revoke:"An error occurred when revoking the album share link, please try again."}},create:{panel_form:{label:"Add a name to your new album",placeholder:"Untitled album",cancel:"Cancel",submit:"Create new album",update:"Add photos to album"},inline_form:{placeholder:"New album name",create_label:"Create a new album",create_button:"Create"},success:"Album %{name} has been created with %{smart_count} photo. |||| Album %{name} has been created with %{smart_count} photos.",error:{generic:"An error occurred when creating the album, please try again.",already_exists:"The album %{name} already exists, please pick another one.",name_missing:"You have to give a name to your album."}},fetchAlbums:{error:{index_missing:"An albums index must be provided to fetch albums."}},remove_photos:{success:"The photo has been removed from album %{album_name}",error:{generic:"An error occured while removing the photo, please try again."}},remove_album:{success:"Album %{name} was deleted.",error:{generic:"An error occured while removing the album, please try again."}},quit_album:{success:"Album %{name} was deleted.",error:{generic:"An error occured while leaving the album, please try again."}}},Viewer:{close:"Close",noviewer:{title:"The viewer doesn't know how to read this type of file yet.",download:"Download this file",openWith:"Open with..."},actions:{download:"Download"},loading:{error:"This file could not be loaded. Do you have a working internet connection right now?",retry:"Retry"}},destroyconfirmation:{title:"Permanently delete this album?",cancel:"Cancel",delete:"Delete permanently",forbidden:"You won't be able to access this album or selection anymore.",eye:"Your photos won't be deleted.",link:"If you have shared it, people won't be able to access it."},quitconfirmation:{title:"Permanently leave and delete this shared album?",cancel:"Cancel",quit:"Leave & delete",forbidden:"You won't be able to access this album or selection anymore."},timeline:{DeleteConfirm:{title:"Delete this element? |||| Delete these elements?",trash:"It will be moved to the Trash. |||| They will be moved to the Trash.",restore:"You can still restore it whenever you want. |||| You can still restore them whenever you want.",shared:"If you have shared it, people won't be able to access it. |||| If you have shared them, people won't be able to access them.",related:"Some of the photos within the selection are related to an album. They will be removed from it if you proceed to trash them.",cancel:"Cancel",delete:"Remove"}},UploadQueue:{path_photos:"Photos",path_upload:"Uploaded from Cozy Photos",header:"Uploading %{smart_count} photo to Cozy Photos |||| Uploading %{smart_count} photos to Cozy Photos",header_mobile:"%{done} of %{total} uploading…",header_done:"Uploaded %{done} out of %{total} successfully",close:"close",item:{pending:"Pending"},alert:{success:"%{smart_count} photo uploaded with success. |||| %{smart_count} photos uploaded with success.",success_conflicts:"%{smart_count} photo uploaded with %{conflictNumber} conflict(s). |||| %{smart_count} photos uploaded with %{conflictNumber} conflict(s).",errors:"Errors occurred during the photos upload."}}}},"2U19":function(e,t,n){"use strict";var r=n("o0o1"),o=n.n(r),a=n("fvjX"),i=n("mz5Q"),c=n.n(i),u=n("TSYQ"),l=n.n(u),s=n("/MKj"),f=n("XOpu"),p=n("Ieni"),d=n("Q5R/"),m=n.n(d);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var O=function(e,t){return t?m.a["item-type-folder"]:m.a["item-type-"+(Object(p.a)(m.a,"item-type-")(e.type,e.name)||"files")]},_=Object(f.c)()(function(e){return c.a.createElement("span",{className:m.a["item-pending"]},e.t("UploadQueue.item.pending"))}),E=Object(f.c)()(function(e){var t,n=e.file,r=e.status,o=e.isDirectory,a=function(e){var t=e.lastIndexOf(".")-1>>>0;return{extension:e.slice(t+1),filename:e.slice(0,t+1)}}(n.name),i=a.filename,u=a.extension;return c.a.createElement("div",{className:l()(m.a["upload-queue-item"],(t={},g(t,m.a["upload-queue-item--done"],"loaded"===r),g(t,m.a["upload-queue-item--error"],"failed"===r||"conflict"===r||"network"===r),t))},c.a.createElement("div",{className:l()(m.a["item-cell"],m.a["item-file"],O(n,o))},c.a.createElement("div",null,i,u&&c.a.createElement("span",{className:m.a["item-ext"]},u))),c.a.createElement("div",{className:m.a["item-status"]},"pending"===r?c.a.createElement(_,null):c.a.createElement("div",{className:m.a["item-".concat(r)]})))}),k=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=y(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==h(o)&&"function"!=typeof o?v(r):o,g(v(n),"state",{collapsed:!1}),g(v(n),"toggleCollapsed",function(){n.setState(function(e){return{collapsed:!e.collapsed}})}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,i["Component"]),n=t,(r=[{key:"render",value:function(){var e,t=this.props,n=t.t,r=t.queue,o=t.doneCount,a=t.successCount,i=t.purgeQueue,u=this.state.collapsed;return c.a.createElement("div",{"data-test-id":"upload-queue",className:l()(m.a["upload-queue"],(e={},g(e,m.a["upload-queue--visible"],0!==r.length),g(e,m.a["upload-queue--collapsed"],u),e))},c.a.createElement("h4",{className:m.a["upload-queue-header"],onDoubleClick:this.toggleCollapsed},o<r.length&&c.a.createElement("div",{className:m.a["upload-queue-header-inner"]},c.a.createElement("span",{className:m.a["u-hide--mob"]},n("UploadQueue.header",{smart_count:r.length})),c.a.createElement("span",{className:m.a["u-hide--desk"]},n("UploadQueue.header_mobile",{done:o,total:r.length}))),o>=r.length&&c.a.createElement("div",{"data-test-id":"upload-queue-success",className:m.a["upload-queue-header-inner"]},c.a.createElement("span",null,n("UploadQueue.header_done",{done:a,total:r.length})),c.a.createElement("button",{className:l()(m.a["btn-close"]),onClick:i},n("UploadQueue.close")))),c.a.createElement("progress",{className:m.a["upload-queue-progress"],value:o,max:r.length}),c.a.createElement("div",{className:m.a["upload-queue-content"]},c.a.createElement("div",{className:m.a["upload-queue-list"]},r.map(function(e,t){return c.a.createElement(E,{key:"key_queue_".concat(t),file:e.file,isDirectory:e.isDirectory,status:e.status})}))))}}])&&b(n.prototype,r),o&&b(n,o),t}();Object(f.c)()(Object(s.connect)(function(e){return{queue:H(e),doneCount:Q(e).length,successCount:W(e).length}},function(e){return{purgeQueue:function(){return e(I())}}})(k));function S(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function x(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){S(a,r,o,i,c,"next",e)}function c(e){S(a,r,o,i,c,"throw",e)}i(void 0)})}}function j(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",function(){return L}),n.d(t,"f",function(){return I}),n.d(t,"e",function(){return H}),n.d(t,"c",function(){return Q}),n.d(t,"d",function(){return W});var P=function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){C(e,t,n[t])})}return e}({},e,{status:"pending"})},A=function(e){switch(e.type){case"UPLOAD_FILE":return"loading";case"RECEIVE_UPLOAD_SUCCESS":return"loaded";case"RECEIVE_UPLOAD_ERROR":return e.status}},N=(t.b=Object(a.combineReducers)({queue:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_TO_UPLOAD_QUEUE":return[].concat(j(e.filter(function(e){return"loaded"!==e.status})),j(t.files.map(function(e){return P(e)})));case"PURGE_UPLOAD_QUEUE":return[];case"UPLOAD_FILE":case"RECEIVE_UPLOAD_SUCCESS":case"RECEIVE_UPLOAD_ERROR":return e.map(function(e){return e.file.name!==t.file.name?e:function(e,t){return Object.assign({},e,{status:A(t)})}(e,t)});default:return e}}}),function e(t,n,r){return function(){var a=x(o.a.mark(function a(i,c,u){var l,s,f,p,d,m,h,b;return o.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(l=u.client){o.next=3;break}throw new Error("Upload module needs a cozy-client instance to work. This instance should be made available by using the extraArgument function of redux-thunk");case 3:if(s=H(c()).find(function(e){return"pending"===e.status})){o.next=6;break}return o.abrupt("return",i(F(n)));case 6:if(f=s.file,p=s.entry,d=s.isDirectory,o.prev=7,i({type:"UPLOAD_FILE",file:f}),!p||!d){o.next=16;break}return o.next=12,z(l,p,r);case 12:m=o.sent,t(m),o.next=20;break;case 16:return o.next=18,D(l,f,r);case 18:h=o.sent,t(h);case 20:i({type:"RECEIVE_UPLOAD_SUCCESS",file:f}),o.next=29;break;case 23:o.prev=23,o.t0=o.catch(7),console.warn(o.t0),b={409:"conflict",413:"quota"}[o.t0.status]||/Failed to fetch$/.exec(o.t0.toString())&&"network"||"failed",i({type:"RECEIVE_UPLOAD_ERROR",file:f,status:b});case 29:i(e(t,n,r));case 30:case"end":return o.stop()}},a,null,[[7,23]])}));return function(e,t,n){return a.apply(this,arguments)}}()}),T=function(e){return new Promise(function(t){return e.file(t)})},z=function(){var e=x(o.a.mark(function e(t,n,r){var a,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(t,n.name,r);case 2:return a=e.sent,i=n.createReader(),e.abrupt("return",new Promise(function(e){var n=function(){var n=x(o.a.mark(function n(r){var i,c;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:i=0;case 1:if(!(i<r.length)){n.next=20;break}if(!(c=r[i]).isFile){n.next=14;break}return n.t0=D,n.t1=t,n.next=8,T(c);case 8:return n.t2=n.sent,n.t3=a.id,n.next=12,(0,n.t0)(n.t1,n.t2,n.t3);case 12:n.next=17;break;case 14:if(!c.isDirectory){n.next=17;break}return n.next=17,z(t,c,a.id);case 17:i+=1,n.next=1;break;case 20:e(a);case 21:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}();i.readEntries(n)}));case 5:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),R=function(){var e=x(o.a.mark(function e(t,n,r){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("io.cozy.files").createDirectory({name:n,dirId:r});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),D=function(){var e=x(o.a.mark(function e(t,n,r){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("io.cozy.files").createFile(n,{dirId:r});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),L=function(e,t,n,r){return function(){var a=x(o.a.mark(function a(i){return o.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:i({type:"ADD_TO_UPLOAD_QUEUE",files:G(e)}),i(N(n,r,t));case 2:case"end":return o.stop()}},a)}));return function(e){return a.apply(this,arguments)}}()},I=function(){return{type:"PURGE_UPLOAD_QUEUE"}},F=function(e){return function(t,n){var r=H(n()),o=V(r),a=q(r),i=U(r),c=Y(r),u=B(r);return e(o,a,i,c,u)}},M=function(e,t){return e.filter(function(e){return e.status===t})},U=function(e){return M(e,"conflict")},B=function(e){return M(e,"failed")},q=function(e){return M(e,"quota")},Y=function(e){return M(e,"network")},V=function(e){return M(e,"loaded")},H=function(e){return e.upload.queue},Q=function(e){return H(e).filter(function(e){return"pending"!==e.status})},W=function(e){return V(H(e))},G=function(e){for(var t=[],n=0;n<e.length;n+=1){var r=e[n];if(null!=r.webkitGetAsEntry&&r.webkitGetAsEntry()){var o=r.webkitGetAsEntry();t.push({file:r.getAsFile(),isDirectory:!0===o.isDirectory,entry:o})}else t.push({file:r,isDirectory:!1,entry:null})}return t}},"2lpW":function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r=n("o0o1"),o=n.n(r),a=n("mz5Q"),i=n.n(a),c=n("SH7X"),u=n("MJrX"),l=n("TtgU");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function f(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function p(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}var d=function(e){return e.find("io.cozy.files").where({class:"image",trashed:!1}).select(["dir_id","name","size","updated_at","metadata"]).sortBy({"metadata.datetime":"desc"})},m=function(e){return{uploadPhoto:function(){var t,n=(t=o.a.mark(function t(n,r){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.mutate({mutationType:"UPLOAD_PHOTO",execute:function(){return e.collection("io.cozy.files").createFile(n,{dirId:r})}}));case 1:case"end":return t.stop()}},t)}),function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(e){p(a,r,o,i,c,"next",e)}function c(e){p(a,r,o,i,c,"throw",e)}i(void 0)})});return function(e,t){return n.apply(this,arguments)}}(),deletePhoto:function(t){return e.destroy(t)}}},h=function(e){var t={};return e.forEach(function(e){var n=(e.metadata&&e.metadata.datetime?e.metadata.datetime:Date.now()).slice(0,7)+"-01T00:00";t.hasOwnProperty(n)||(t[n]=[]),t[n].push(e)}),Object.keys(t).sort(function(e,t){return new Date(e).getTime()-new Date(t).getTime()}).reverse().map(function(e){return{month:e,photos:t[e]}})};t.b=function(e){return i.a.createElement(c.Query,{query:d,as:"timeline",mutations:m},function(t,n){var r=t.data,o=f(t,["data"]);return i.a.createElement(u.a,s({lists:r?h(r):[],data:r},n,o,e))})};var b=function(e){var t=e.selection,n=f(e,["selection"]);return i.a.createElement(c.Query,{query:d},function(e){var r=e.data,o=f(e,["data"]);return i.a.createElement(l.a,s({lists:r?h(r):[],photosContext:"timeline",onPhotoToggle:t.toggle,onPhotosSelect:t.select,onPhotosUnselect:t.unselect},o,n))})}},"2sk9":function(e,t,n){e.exports={"fil-confirm-text":"fil-confirm-text--3OV-5","icon-trash":"icon-trash--2L617","icon-restore":"icon-restore--qTvX6","icon-shared":"icon-shared--2ytpg","icon-related":"icon-related--3HRWq","icon-eye":"icon-eye--2EIWz","icon-link":"icon-link--2hb-A","icon-forbidden":"icon-forbidden--23UiV",spin:"spin--3SvvM"}},"32XB":function(e,t,n){e.exports={"fil-actionmenu-inner":"fil-actionmenu-inner--3JhFX","fil-actionmenu-recipients":"fil-actionmenu-recipients--28pEX","fil-action":"fil-action--3huaS","fil-actionmenu-overlay":"fil-actionmenu-overlay--1o4R9","fil-mobileactionmenu":"fil-mobileactionmenu--2J9Kc","fil-mobileactionmenu-header":"fil-mobileactionmenu-header--j3KI4","fil-mobileactionmenu-file":"fil-mobileactionmenu-file--1hHRc","fil-mobileactionmenu-file-name":"fil-mobileactionmenu-file-name--3VXSo","fil-mobileactionmenu-file-ext":"fil-mobileactionmenu-file-ext--2sio1","fil-action-phone-download":"fil-action-phone-download--3zG6S","fil-action-openWith":"fil-action-openWith--NJ1ah","fil-action-download":"fil-action-download--378G6","fil-action-destroy":"fil-action-destroy--1FAXj","fil-action-trash":"fil-action-trash--268pI","fil-action-restore":"fil-action-restore--36vfQ","fil-action-rename":"fil-action-rename--1hqjC","fil-action-share":"fil-action-share--1BpnI","fil-action-moveto":"fil-action-moveto--o2Fw2"}},"37ak":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"b",function(){return a}),n.d(t,"c",function(){return c});var a=function(){return{type:"HIDE_NEW_FOLDER_INPUT"}},i={isTypingNewFolderName:!1};t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;switch((arguments.length>1?arguments[1]:void 0).type){case"SHOW_NEW_FOLDER_INPUT":return r({},e,{isTypingNewFolderName:!0});case"HIDE_NEW_FOLDER_INPUT":return r({},e,{isTypingNewFolderName:!1});default:return e}};var c=function(e){return e.filelist.isTypingNewFolderName}},"3Jea":function(e,t,n){e.exports={"shared-status":"shared-status--2MD96","shared-status-label":"shared-status-label--3Pk0H",spin:"spin--3YGV1"}},"510Z":function(e,t,n){"use strict";var r=n("o0o1"),o=n.n(r),a=n("mz5Q"),i=n.n(a),c=n("17x9"),u=n.n(c);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function f(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){s(a,r,o,i,c,"next",e)}function c(e){s(a,r,o,i,c,"throw",e)}i(void 0)})}}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b="PENDING",y=function(e){function t(){var e,n,r,o,a,i,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var u=arguments.length,s=new Array(u),f=0;f<u;f++)s[f]=arguments[f];return r=this,n=!(o=(e=d(t)).call.apply(e,[this].concat(s)))||"object"!==l(o)&&"function"!=typeof o?m(r):o,a=m(n),c={status:b,src:null},(i="state")in a?Object.defineProperty(a,i,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[i]=c,n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,i.a.Component),n=t,(r=[{key:"componentDidMount",value:function(){this.loadNextSrc()}},{key:"componentWillUnmount",value:function(){this.img&&(this.img.onload=this.img.onerror=null,this.img.src="",clearTimeout(this.timeout))}},{key:"getFileId",value:function(e){return e.id||e._id}},{key:"loadNextSrc",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.state.status;t===b?this.loadLink():"LOADING_LINK"===t?this.loadFallback():"LOADING_FALLBACK"===t&&(console.warn("failed loading thumbnail",e),this.setState({status:"FAILED"}),this.props.onError(e))}},{key:"checkImageSource",value:function(e){var t=this,n=function(){clearTimeout(t.timeout),t.img.onload=t.img.onerror=null,t.img.src="",t.img=null};return new Promise(function(n,r){t.img=new Image,t.img.onload=n,t.img.onerror=r,t.img.src=e,t.timeout=setTimeout(function(){return r(new Error("Loading image took too long"))},1e4)}).then(n,n)}},{key:"getFileLinks",value:function(){var e=f(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.links){e.next=4;break}return e.abrupt("return",t.links);case 4:return e.next=6,cozy.client.files.statById(this.getFileId(t),!1);case 6:if((n=e.sent).links){e.next=9;break}throw new Error("Could not fetch file links");case 9:return e.abrupt("return",n.links);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadLink",value:function(){var e=f(o.a.mark(function e(){var t,n,r,a,i,c,u;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({status:"LOADING_LINK"}),t=this.props,n=t.file,r=t.size,a=this.context.client,e.prev=3,e.next=6,this.getFileLinks(n,r);case 6:if(i=e.sent,c=i[r]){e.next=10;break}throw new Error("".concat(r," link is not available"));case 10:return u=a.options.uri+c,e.next=13,this.checkImageSource(u);case 13:this.setState({status:"LOADED",src:u}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),this.loadNextSrc(e.t0);case 19:case"end":return e.stop()}},e,this,[[3,16]])}));return function(){return e.apply(this,arguments)}}()},{key:"loadFallback",value:function(){var e=f(o.a.mark(function e(){var t,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({status:"LOADING_FALLBACK"}),t=this.props.file,e.prev=2,e.next=5,this.getDownloadLink(this.getFileId(t));case 5:return n=e.sent,e.next=8,this.checkImageSource(n);case 8:this.setState({status:"LOADED",src:n}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),this.loadNextSrc(e.t0);case 14:case"end":return e.stop()}},e,this,[[2,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"getDownloadLink",value:function(e){return this.context.client?this.context.client.collection("io.cozy.files").getDownloadLinkById(e):cozy.client.files.getDownloadLinkById(e).then(function(e){return"".concat(cozy.client._url).concat(e)})}},{key:"render",value:function(){var e=this.state.src,t=this.props.render;return!!e&&t(e)}}])&&p(n.prototype,r),a&&p(n,a),t}();y.propTypes={file:u.a.object.isRequired,render:u.a.func.isRequired,size:u.a.oneOf(["small","medium","large"]),onError:u.a.func},y.defaultProps={size:"small",onError:function(){}};var v=y;n.d(t,"a",function(){return v})},"59mS":function(e,t,n){e.exports={spin:"spin--2CdRK"}},"5ZYL":function(e,t,n){e.exports={"pho-loading":"pho-loading--2vILC","pho-empty":"pho-empty--2ISCA"}},"5wWc":function(e,t,n){"use strict";var r=n("mz5Q"),o=n.n(r);t.a=function(e,t){var n=document.body.appendChild(document.createElement("div")),r=function(){t().then(function(){o.a.unmountComponentAtNode(n)})};o.a.render(o.a.cloneElement(e,{confirm:r,abort:function(){o.a.unmountComponentAtNode(n)}}),n)}},"6qED":function(e,t,n){e.exports={"pho-album-list":"pho-album-list--3W0t6","pho-album-list--thumbnails":"pho-album-list--thumbnails--3FASv","pho-album":"pho-album--nBuXk","pho-album-link":"pho-album-link--1J30Z","pho-album-photo-item":"pho-album-photo-item--18xZx","pho-album-title":"pho-album-title--1N0Rf","pho-album-description":"pho-album-description--3z6S7","pho-album-shared":"pho-album-shared--2T6ed","pho-album-list--selectable":"pho-album-list--selectable--1eSpV","pho-album-link--disabled":"pho-album-link--disabled--309dC"}},"7kNS":function(e,t,n){e.exports={"coz-selectionbar":"coz-selectionbar--1aMGl","coz-selectionbar-separator":"coz-selectionbar-separator--L7Xk1","coz-action-extra":"coz-action-extra--2QHts","coz-action-close":"coz-action-close--z5PQp","coz-selectionbar-count":"coz-selectionbar-count--3cWjq","coz-action-moveto":"coz-action-moveto--JpYVL","pho-viewer-wrapper":"pho-viewer-wrapper--25kbA","pho-viewer-wrapper--notfullscreen":"pho-viewer-wrapper--notfullscreen--1CQNQ","pho-viewer-wrapper--light":"pho-viewer-wrapper--light--1g2e0","pho-viewer-controls":"pho-viewer-controls--i7aoe","pho-viewer-controls--expanded":"pho-viewer-controls--expanded--22FcK","pho-viewer-nav":"pho-viewer-nav--rK41V","pho-viewer-toolbar":"pho-viewer-toolbar--35h_f","pho-viewer-canceled":"pho-viewer-canceled--3i6oA","pho-viewer-nav-arrow":"pho-viewer-nav-arrow--1laxJ","pho-viewer-nav--visible":"pho-viewer-nav--visible--6LKoE","pho-viewer-nav--previous":"pho-viewer-nav--previous--1VURK","pho-viewer-nav--next":"pho-viewer-nav--next--EqJ0h","pho-viewer-imageviewer":"pho-viewer-imageviewer--3ExG_","pho-viewer-noviewer":"pho-viewer-noviewer--34ejQ","pho-viewer-audioviewer":"pho-viewer-audioviewer--1i7BC","pho-viewer-videoviewer":"pho-viewer-videoviewer--3WtlI","pho-viewer-pdfviewer":"pho-viewer-pdfviewer--1JaeW","pho-viewer-textviewer":"pho-viewer-textviewer--ZqmRJ","pho-viewer-textviewer-content":"pho-viewer-textviewer-content--61dCk","pho-viewer-filename":"pho-viewer-filename--LPP0o","pho-viewer-pdfviewer-ios":"pho-viewer-pdfviewer-ios--onrI4","pho-viewer-noviewer--bin":"pho-viewer-noviewer--bin--23UQm","pho-viewer-noviewer--code":"pho-viewer-noviewer--code--3YAUP","pho-viewer-noviewer--spreadsheet":"pho-viewer-noviewer--spreadsheet--24y22","pho-viewer-noviewer--slide":"pho-viewer-noviewer--slide--17nNd","pho-viewer-noviewer--text":"pho-viewer-noviewer--text--2FWpV","pho-viewer-noviewer--zip":"pho-viewer-noviewer--zip--NurjQ","pho-viewer-noviewer--pdf":"pho-viewer-noviewer--pdf--2od5u","pho-viewer-noviewer-cta":"pho-viewer-noviewer-cta--1smtO","pho-viewer-noviewer-cta-cross":"pho-viewer-noviewer-cta-cross--1IoEu","pho-viewer-nav-previous":"pho-viewer-nav-previous--DDq8Y","pho-viewer-nav-next":"pho-viewer-nav-next--2Lt8E","pho-viewer-photo":"pho-viewer-photo--10Xsk","coz-selection-bar":"coz-selection-bar--3o0jH","pho-viewer-toolbar--mobilebrowser":"pho-viewer-toolbar--mobilebrowser--38lJN","pho-viewer-toolbar--hidden":"pho-viewer-toolbar--hidden--3VnlN","pho-viewer-toolbar-actions":"pho-viewer-toolbar-actions--1BRVC","pho-viewer-toolbar-close":"pho-viewer-toolbar-close--5j5zF","pho-viewer-toolbar-close-cross":"pho-viewer-toolbar-close-cross--eF6Ka"}},"7oMs":function(e,t,n){"use strict";n.d(t,"d",function(){return i}),n.d(t,"e",function(){return c}),n.d(t,"b",function(){return u}),n.d(t,"f",function(){return l}),n.d(t,"c",function(){return s}),n.d(t,"g",function(){return f});var r=n("fvjX"),o=n("yEaX");function a(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var i=function(e,t){return void 0!==e.selection.selected.find(function(e){return e===t})},c=function(e){return 0!==e.selection.selected.length||e.selection.isSelectionBarOpened},u=function(e){return function(e){return e.selection.selected}(e).map(function(t){return Object(o.c)(e,t)})},l=function(){return{type:"SHOW_SELECTION_BAR"}},s=function(){return{type:"HIDE_SELECTION_BAR"}},f=function(e,t){return{type:t?"UNSELECT_ITEM":"SELECT_ITEM",id:e}};t.a=Object(r.combineReducers)({selected:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(t.meta&&t.meta.cancelSelection)return[];switch(t.type){case"SELECT_ITEM":return[].concat(a(e),[t.id]);case"UNSELECT_ITEM":var n=e.indexOf(t.id);return[].concat(a(e.slice(0,n)),a(e.slice(n+1)));case"HIDE_SELECTION_BAR":return[];default:return e}},isSelectionBarOpened:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(t.meta&&t.meta.cancelSelection)return!1;switch(t.type){case"TOGGLE_SELECTION_BAR":return!e;case"SHOW_SELECTION_BAR":return!0;case"HIDE_SELECTION_BAR":return!1;default:return e}}})},"8IyR":function(e,t,n){e.exports={"fil-content":"fil-content--3-eRD","--working":"_--working--2fAwj"}},A3Xe:function(e,t,n){"use strict";n.d(t,"b",function(){return u}),n.d(t,"c",function(){return l}),n.d(t,"a",function(){return s}),n.d(t,"e",function(){return f}),n.d(t,"d",function(){return p});var r=n("o0o1"),o=n.n(r),a=n("z6Q1");function i(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function c(e){i(a,r,o,c,u,"next",e)}function u(e){i(a,r,o,c,u,"throw",e)}c(void 0)})}}var u="".concat(a.b,"/photos"),l="".concat(a.b,"/photos/upload"),s="".concat(a.b,"/photos/mobile"),f=function(){var e=c(o.a.mark(function e(t,n){var r,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(a.d).findReferencedBy({_type:a.b,_id:n});case 2:return r=e.sent,i=r.included,e.abrupt("return",i.filter(function(e){return!1===/^\/\.cozy_trash/.test(e.attributes.path)}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),p=function(){var e=c(o.a.mark(function e(t,n,r){var i,c,u,l,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t,r);case 2:if(!(i=e.sent).length){e.next=7;break}return e.abrupt("return",i[0]);case 7:return c=t.collection(a.d),e.next=10,c.ensureDirectoryExists(n);case 10:return u=e.sent,e.next=13,c.addReferencesTo({_id:r,_type:a.b},[{_id:u}]);case 13:return e.next=15,c.get(u);case 15:return l=e.sent,s=l.data,e.abrupt("return",s);case 18:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()},AzIT:function(e,t,n){e.exports={"coz-btn-client":"coz-btn-client--1LuMZ","coz-banner-client":"coz-banner-client--xEL17","coz-btn-clientMobile":"coz-btn-clientMobile--3n2yA","coz-banner-text":"coz-banner-text--tBptv",spin:"spin--2_Zjm","close-banner":"close-banner---KAV7"}},Bicm:function(e,t,n){e.exports={"shared-tooltip":"shared-tooltip--RvIBh","shared-tooltip-list":"shared-tooltip-list--VnQfr"}},"C/eS":function(e,t,n){e.exports={"pho-panel-form":"pho-panel-form--1S6en","coz-form":"coz-form--cCo_s","coz-form-group":"coz-form-group--1I069","coz-form-desc":"coz-form-desc--3FnDz","coz-form-label":"coz-form-label--385WH","coz-form-label--error":"coz-form-label--error--1Kr_k","coz-form-errors":"coz-form-errors--1RCYk",error:"error--3qEb3","pho-panel":"pho-panel--vFzlq","pho-panel-header":"pho-panel-header--2aCpb","pho-panel-footer":"pho-panel-footer--2Ynjt","pho-panel-controls":"pho-panel-controls--1UDSQ","pho-panel-content":"pho-panel-content--2OXQJ","pho-panel-wrap":"pho-panel-wrap--1OkG3",spin:"spin--t2Bmx"}},C9yo:function(e,t,n){0},D575:function(e,t,n){e.exports={"coz-modal-section":"coz-modal-section--1g5-9","coz-create-album":"coz-create-album--1VWC2","coz-select-album":"coz-select-album--20TzS",spin:"spin--3Sc3l"}},DbnX:function(e,t,n){"use strict";var r=n("4BeY"),o=n.n(r),a=n("IaFt"),i=n.n(a),c=new o.a({id:"icon-checkbox_9e41a33868f3dad7314de1b6a47b358f",use:"icon-checkbox_9e41a33868f3dad7314de1b6a47b358f-usage",viewBox:"0 0 16 16",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-checkbox_9e41a33868f3dad7314de1b6a47b358f">\n  <path fill="#32363f" fill-rule="evenodd" d="M64,129.99406 C64,128.892771 64.8945138,128 65.9940603,128 L78.0059397,128 C79.1072288,128 80,128.894514 80,129.99406 L80,142.00594 C80,143.107229 79.1054862,144 78.0059397,144 L65.9940603,144 C64.8927712,144 64,143.105486 64,142.00594 L64,129.99406 Z M67.7071068,137.292893 C67.3165825,136.902369 66.6834175,136.902369 66.2928932,137.292893 C65.9023689,137.683418 65.9023689,138.316582 66.2928932,138.707107 L68.2928932,140.707107 C68.6834175,141.097631 69.3165825,141.097631 69.7071068,140.707107 L77.7071068,132.707107 C78.0976311,132.316582 78.0976311,131.683418 77.7071068,131.292893 C77.3165825,130.902369 76.6834175,130.902369 76.2928932,131.292893 L69,138.585786 L67.7071068,137.292893 Z" transform="translate(-64 -128)" />\n</symbol>'});i.a.add(c);t.a=c},Gofk:function(e,t,n){var r={"./en":"2OO4","./en.json":"2OO4"};function o(e){var t=a(e);return n(t)}function a(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=a,e.exports=o,o.id="Gofk"},"I2Z/":function(e,t,n){e.exports={"shared-badge":"shared-badge--2cmgU","--small":"_--small--thdoQ","shared-badge-icon":"shared-badge-icon--V-RtM","--xsmall":"_--xsmall--3hL0z","--by-me":"_--by-me--3gc-L","--with-me":"_--with-me--32UlG",spin:"spin--2woLM"}},I9wM:function(e,t){e.exports=cozy},IFEr:function(e,t,n){"use strict";n.d(t,"g",function(){return c}),n.d(t,"f",function(){return u}),n.d(t,"c",function(){return l}),n.d(t,"e",function(){return s}),n.d(t,"a",function(){return f}),n.d(t,"b",function(){return p}),n.d(t,"d",function(){return d});var r=n("o0o1"),o=n.n(r),a=n("ZHai");function i(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}var c=function(e){var t=Object(a.c)();t&&t.push(["trackEvent","interaction","desktop-prompt",e])},u=function(){return window.navigator&&-1===window.navigator.appVersion.indexOf("Win")&&-1===window.navigator.appVersion.indexOf("Mac")},l=function(){return window.navigator.userAgent&&window.navigator.userAgent.indexOf("Android")>=0},s=function(){return window.navigator.userAgent&&/iPad|iPhone|iPod/.test(window.navigator.userAgent)},f="desktop_banner",p="noviewer_desktop_cta",d=function(){var e,t=(e=o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,cozy.client.fetchJSON("GET","/settings/clients");case 2:return t=e.sent,e.abrupt("return",t.some(function(e){return"github.com/cozy-labs/cozy-desktop"===e.attributes.software_id}));case 4:case"end":return e.stop()}},e)}),function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function c(e){i(a,r,o,c,u,"next",e)}function u(e){i(a,r,o,c,u,"throw",e)}c(void 0)})});return function(){return t.apply(this,arguments)}}()},Ieni:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n("zB2q"),o=n.n(r);function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var i={word:"text",text:"text",zip:"zip",pdf:"pdf",spreadsheet:"sheet",excel:"sheet",sheet:"sheet",presentation:"slide",powerpoint:"slide"},c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return function(n,r){var c=a(("application/octet-stream"===n?function(e){return o.a.lookup(e)||"application/octet-stream"}(r.toLowerCase()):n).split("/"),2),u=c[0],l=c[1];if(e[t+u])return u;if("application"===u){var s=l.match(Object.keys(i).join("|"));return s?i[s[0]]:void 0}}}},JZSQ:function(e,t,n){"use strict";n.d(t,"a",function(){return p}),n.d(t,"d",function(){return h}),n.d(t,"f",function(){return b}),n.d(t,"b",function(){return y}),n.d(t,"e",function(){return v});var r=n("o0o1"),o=n.n(r),a=n("Q2ax"),i=n("yEaX"),c=(n("QwUF"),n("Kn6A"));function u(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){u(a,r,o,i,c,"next",e)}function c(e){u(a,r,o,i,c,"throw",e)}i(void 0)})}}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){f(e,t,n[t])})}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p="RENAME_SUCCESS",d={file:null,name:null};t.c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"START_RENAMING":return s({},e,{file:t.file,name:t.file.name});case"UPDATE_FILE_NAME":return s({},e,{name:t.name});case p:case"ABORT_RENAMING":return d;default:return e}};var m=function(e){return e.rename.file},h=function(e){return e.rename.name},b=function(e){return{type:"UPDATE_FILE_NAME",name:e}},y=function(){return{type:"ABORT_RENAMING"}},v=function(){return function(){var e=l(o.a.mark(function e(t,n){var r,u,l,s,f,d;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n(),u=Object(i.h)(r),l=m(r),s=h(r),!(f=u.find(function(e){return e.name===s}))){e.next=13;break}if(f.id!==l.id){e.next=11;break}return t(y()),e.abrupt("return");case 11:throw a.a.error("alert.folder_name",{folderName:name}),new Error("alert.folder_name");case 13:return e.prev=13,e.next=16,cozy.client.files.updateAttributesById(l.id,{name:s});case 16:d=e.sent,t((o=Object(c.a)(d),{type:p,file:o})),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(13),console.warn(e.t0);case 23:case"end":return e.stop()}var o},e,null,[[13,20]])}));return function(t,n){return e.apply(this,arguments)}}()}},KHOr:function(e,t,n){"use strict";var r=n("o0o1"),o=n.n(r),a=n("fvjX"),i=n("Q2ax"),c=n("mz5Q"),u=n.n(c),l=n("TSYQ"),s=n.n(l),f=n("/MKj"),p=n("XOpu"),d=n("lEMr"),m=n.n(d);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var O=Object(p.c)()(function(e){return u.a.createElement("span",{className:m.a["item-pending"]},e.t("UploadQueue.item.pending"))}),_=Object(p.c)()(function(e){var t,n=e.file,r=e.status,o=function(e){var t=e.lastIndexOf(".")-1>>>0;return{extension:e.slice(t+1),filename:e.slice(0,t+1)}}(n),a=o.filename,i=o.extension;return u.a.createElement("div",{className:s()(m.a["upload-queue-item"],(t={},g(t,m.a["upload-queue-item--done"],"loaded"===r),g(t,m.a["upload-queue-item--error"],"failed"===r||"conflict"===r),t))},u.a.createElement("div",{className:s()(m.a["item-cell"],m.a["item-file"],m.a["item-image"])},u.a.createElement("div",null,a,i&&u.a.createElement("span",{className:m.a["item-ext"]},i))),u.a.createElement("div",{className:m.a["item-status"]},"pending"===r?u.a.createElement(O,null):u.a.createElement("div",{className:m.a["item-".concat(r)]})))}),E=Object(p.c)()(function(e){var t=e.t,n=e.total,r=e.done;return u.a.createElement("div",{className:m.a["upload-queue-header-inner"]},u.a.createElement("span",{className:"coz-desktop"},t("UploadQueue.header",{smart_count:n})),u.a.createElement("span",{className:m.a["u-hide--desk"]},t("UploadQueue.header_mobile",{done:r,total:n})))}),k=Object(p.c)()(function(e){var t=e.t,n=e.total,r=e.successful,o=e.onClose;return u.a.createElement("div",{"data-test-id":"upload-queue-success",className:m.a["upload-queue-header-inner"]},u.a.createElement("span",null,t("UploadQueue.header_done",{done:r,total:n})),u.a.createElement("button",{className:s()(m.a["btn-close"]),onClick:o},t("UploadQueue.close")))}),S=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=y(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==h(o)&&"function"!=typeof o?v(r):o,g(v(n),"state",{collapsed:!1}),g(v(n),"toggleCollapsed",function(){n.setState(function(e){return{collapsed:!e.collapsed}})}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,c["Component"]),n=t,(r=[{key:"render",value:function(){var e,t=this.props,n=t.queue,r=t.doneCount,o=t.successCount,a=t.purgeQueue,i=this.state.collapsed;return u.a.createElement("div",{"data-test-id":"upload-queue",className:s()(m.a["upload-queue"],(e={},g(e,m.a["upload-queue--visible"],0!==n.length),g(e,m.a["upload-queue--collapsed"],i),e))},u.a.createElement("h4",{className:m.a["upload-queue-header"],onDoubleClick:this.toggleCollapsed},r<n.length?u.a.createElement(E,{total:n.length,done:r}):u.a.createElement(k,{total:n.length,successful:o,onClose:a})),u.a.createElement("progress",{className:m.a["upload-queue-progress"],value:r,max:n.length}),u.a.createElement("div",{className:m.a["upload-queue-content"]},u.a.createElement("div",{className:m.a["upload-queue-list"]},n.map(function(e,t){return u.a.createElement(_,{file:e.file.name,status:e.status,key:"file_".concat(t)})}))))}}])&&b(n.prototype,r),o&&b(n,o),t}(),x=Object(p.c)()(Object(f.connect)(function(e){return{queue:U(e),doneCount:B(e).length,successCount:q(e).length}},function(e){return{purgeQueue:function(){return e(R())}}})(S));function j(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function C(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){j(a,r,o,i,c,"next",e)}function c(e){j(a,r,o,i,c,"throw",e)}i(void 0)})}}function P(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.d(t,"a",function(){return A}),n.d(t,"c",function(){return z}),n.d(t,"h",function(){return R}),n.d(t,"g",function(){return U}),n.d(t,"e",function(){return B}),n.d(t,"f",function(){return q}),n.d(t,"b",function(){return x});var A="ADD_TO_UPLOAD_QUEUE",N=function(e){switch(e.type){case"UPLOAD_FILE":return"loading";case"RECEIVE_UPLOAD_SUCCESS":return"loaded";case"RECEIVE_UPLOAD_ERROR":return e.status}},T=(t.d=Object(a.combineReducers)({queue:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case A:return[].concat(P(e),P(t.files.map(function(e){return{file:e,status:"pending"}})));case"PURGE_UPLOAD_QUEUE":return[];case"UPLOAD_FILE":case"RECEIVE_UPLOAD_SUCCESS":case"RECEIVE_UPLOAD_ERROR":return e.map(function(e){return e.file.name!==t.file.name?e:function(e,t){return Object.assign({},e,{status:N(t)})}(e,t)});default:return e}}}),function e(t){return function(){var n=C(o.a.mark(function n(r,a){var i,c;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(i=U(a()).find(function(e){return"pending"===e.status})){n.next=3;break}return n.abrupt("return",r(D()));case 3:return c=i.file,n.prev=4,r({type:"UPLOAD_FILE",file:c}),n.next=8,t(c);case 8:r({type:"RECEIVE_UPLOAD_SUCCESS",file:c}),n.next=15;break;case 11:n.prev=11,n.t0=n.catch(4),console.log(n.t0),r({type:"RECEIVE_UPLOAD_ERROR",file:c,status:409===n.t0.status?"conflict":"failed"});case 15:r(e(t));case 16:case"end":return n.stop()}},n,null,[[4,11]])}));return function(e,t){return n.apply(this,arguments)}}()}),z=function(e,t){return function(){var n=C(o.a.mark(function n(r){return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:r({type:A,files:e}),r(T(t));case 2:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()},R=function(){return{type:"PURGE_UPLOAD_QUEUE"}},D=function(){return function(e,t){var n=U(t()),r=I(n),o=F(n),a=M(n);r.length||o.length?r.length&&!o.length?i.a.info("UploadQueue.alert.success_conflicts",{smart_count:a.length,conflictNumber:r.length}):i.a.error("UploadQueue.alert.errors"):i.a.success("UploadQueue.alert.success",{smart_count:a.length})}},L=function(e,t){return e.filter(function(e){return e.status===t})},I=function(e){return L(e,"conflict")},F=function(e){return L(e,"failed")},M=function(e){return L(e,"loaded")},U=function(e){return e.upload.queue},B=function(e){return U(e).filter(function(e){return"pending"!==e.status})},q=function(e){return M(U(e))}},KOJc:function(e,t,n){"use strict";var r=n("mz5Q"),o=n.n(r),a=n("XOpu"),i=n("+FsC"),c=n("4BeY"),u=n.n(c),l=n("IaFt"),s=n.n(l),f=new u.a({id:"icon-type-folder_f49493c812ab389aaac1e61434f7995f",use:"icon-type-folder_f49493c812ab389aaac1e61434f7995f-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="icon-type-folder_f49493c812ab389aaac1e61434f7995f">\n  <g fill="none" fill-rule="evenodd" transform="translate(0 2)">\n    <rect width="32" height="26" y="2" fill="#B2D3FF" rx="2" />\n    <path fill="#197BFF" d="M0,0.990777969 C0,0.443586406 0.449948758,0 1.00684547,0 L12.9931545,0 C13.5492199,0 14.3125,0.3125 14.7107565,0.71075654 L15.2892435,1.28924346 C15.6817835,1.68178346 16.4446309,2 17.0008717,2 L30.0059397,2 C31.1072288,2 32,2.89470506 32,4 L32,4 L17.0008717,4 C16.4481055,4 15.6875,4.3125 15.2892435,4.71075654 L14.7107565,5.28924346 C14.3182165,5.68178346 13.5500512,6 12.9931545,6 L1.00684547,6 C0.450780073,6 0,5.54902482 0,5.00922203 L0,0.990777969 Z" />\n  </g>\n</symbol>'}),p=(s.a.add(f),f),d=new u.a({id:"icon-main-app_5a0af3714e77328d0c04b0d83712f645",use:"icon-main-app_5a0af3714e77328d0c04b0d83712f645-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="icon-main-app_5a0af3714e77328d0c04b0d83712f645">\n  <g fill="none" fill-rule="evenodd" transform="translate(0 3)">\n    <rect width="32" height="26" fill="#8EE39B" rx="2" />\n    <path fill="#1EC737" d="M0,20 L6.29028051,13.7097195 C6.68224776,13.3177522 7.31387329,13.3138733 7.70591205,13.7059121 L11,17 L19.2937851,8.7062149 C19.6838168,8.31618318 20.320971,8.32097101 20.7058543,8.70585426 L32,20 L32,24.0020869 C32,25.1055038 31.1107383,26 29.9982567,26 L2.00174332,26 C0.89621101,26 0,25.1017394 0,24.0020869 L0,20 Z" />\n    <circle cx="8" cy="7" r="3" fill="#FFFFFF" />\n    <path stroke="#8EE39B" d="M11,16 L5.5,21.5 L11,16 Z" stroke-linecap="round" stroke-linejoin="round" />\n  </g>\n</symbol>'}),m=(s.a.add(d),d),h=new u.a({id:"icon-trash-big_48355d429631705f7ab5001494a0529c",use:"icon-trash-big_48355d429631705f7ab5001494a0529c-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="icon-trash-big_48355d429631705f7ab5001494a0529c">\n  <g fill="none" fill-rule="evenodd" transform="translate(2)">\n    <path fill="#D1D5DB" d="M2,8 L26,8 L26,28.009947 C26,30.2135924 24.2157067,32 22.009947,32 L5.99005301,32 C3.78640758,32 2,30.2157067 2,28.009947 L2,8 Z" />\n    <path fill="#A3ACB8" d="M7,2 L1.99124431,2 C0.899897516,2 0,2.8954305 0,4 L0,6 L28,6 L28,4 C28,2.88772964 27.1084896,2 26.0087557,2 L21,2 L20.4438648,0.887729645 C20.1990795,0.398159027 19.5511774,0 18.9975267,0 L9.00247329,0 C8.45576096,0 7.80127495,0.3974501 7.55613518,0.887729645 L7,2 Z" />\n  </g>\n</symbol>'}),b=(s.a.add(h),h);function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}n.d(t,"a",function(){return g}),n.d(t,"b",function(){return O}),n.d(t,"c",function(){return _});var v={drive:p,photos:m,trash:b},w=Object(a.c)()(function(e){var t=e.t,n=e.type,r=e.canUpload,a=e.localeKey;return o.a.createElement(i.f,{"data-test-id":"empty-folder",icon:v[n],title:t(a?"empty.".concat(a,"_title"):"empty.title"),text:a&&t("empty.".concat(a,"_text"))||r&&t("empty.text")})}),g=function(e){return o.a.createElement(w,y({type:"drive"},e))},O=function(e){return o.a.createElement(w,y({type:"photos"},e))},_=function(e){return o.a.createElement(w,y({type:"trash",localeKey:"trash"},e))}},KVWx:function(e,t,n){e.exports={"fil-topbar":"fil-topbar--2XJot","hidden-mobile":"hidden-mobile--171JQ","fil-path-backdrop":"fil-path-backdrop--2HADh","fil-path-title":"fil-path-title--3H8Ph","fil-path-link":"fil-path-link--15Jew","fil-path-separator":"fil-path-separator--3inNH","fil-path-previous":"fil-path-previous--259U0","fil-path-down":"fil-path-down--1ckv2","fil-path-current-name":"fil-path-current-name--2SD2e","fil-path-current":"fil-path-current--1UBXf",deployed:"deployed--2RCVz",inlined:"inlined--RyWPf","fil-path-link-name":"fil-path-link-name--1t04B",mobile:"mobile--3-x59",spin:"spin--27Qvk"}},Kn6A:function(e,t,n){"use strict";n.d(t,"b",function(){return h}),n.d(t,"a",function(){return b});var r=n("o0o1"),o=n.n(r),a=n("Z7XG"),i=n("bMkt");function c(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){p(e,t,n[t])})}return e}function l(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){l(a,r,o,i,c,"next",e)}function c(e){l(a,r,o,i,c,"throw",e)}i(void 0)})}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function e(t){var n=this,r=t.byName,i=t.byUpdatedAt,l=t.bySize,d=t.recent;f(this,e),p(this,"normalizeFileFromPouchDB",function(e){return u({},e,{id:e._id,_type:"io.cozy.files"})}),p(this,"getFolder",function(){var e=s(o.a.mark(function e(t){var r,a,i,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=cozy.client.offline.getDatabase("io.cozy.files"),e.next=3,r.get(t);case 3:if(a=e.sent,e.t0=!!a.dir_id,!e.t0){e.next=9;break}return e.next=8,r.get(a.dir_id);case 8:e.t0=e.sent;case 9:return i=e.t0,e.next=12,n.getSortedFolder(t,"name","asc");case 12:return c=e.sent,e.abrupt("return",u({},n.normalizeFileFromPouchDB(a),{contents:{data:c,meta:{}},parent:!!i&&n.normalizeFileFromPouchDB(i)}));case 14:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),p(this,"getFolderContents",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.a;return n.getSortedFolder(e,"name","asc",t,r)}),p(this,"getSortedFolder",function(){var e=s(o.a.mark(function e(t,r){var i,u,l,s,f,p,d,m=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=m.length>2&&void 0!==m[2]?m[2]:"asc",u=m.length>3&&void 0!==m[3]?m[3]:0,l=m.length>4&&void 0!==m[4]?m[4]:a.a,s=[],!(0===u)){e.next=11;break}return f="name"===r?i:"asc",e.next=9,n.query({folderId:t,type:"directory",sortAttribute:"name",sortOrder:f,skip:0,limit:null});case 9:p=e.sent,s=p.filter(function(e){return e._id!==a.c});case 11:return e.next=13,n.query({folderId:t,type:"file",sortAttribute:r,sortOrder:i,skip:u,limit:l});case 13:return d=e.sent,e.abrupt("return",[].concat(c(s),c(d)));case 15:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),p(this,"query",function(){var e=s(o.a.mark(function e(t){var r,a,i,c,u,l,s,f,d;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.folderId,a=t.type,i=t.sortAttribute,c=t.sortOrder,u=t.skip,l=t.limit,s=cozy.client.offline.getDatabase("io.cozy.files"),(f=n.indexes[i])||console.warn("No suitable index found for atribute ".concat(i,". This might be slow.")),e.next=6,s.find({selector:p({dir_id:r,type:a},i,{$gt:null}),use_index:f,sort:[{dir_id:c},{type:c},p({},i,c)],skip:u,limit:l});case 6:return d=e.sent,e.abrupt("return",d.docs.map(n.normalizeFileFromPouchDB));case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),p(this,"getRecentFiles",s(o.a.mark(function e(){var t,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=cozy.client.offline.getDatabase("io.cozy.files"),e.next=3,t.query(n.indexes.recent,{limit:a.a,include_docs:!0,descending:!0});case 3:return r=e.sent,e.abrupt("return",r.rows.map(function(e){return u({},e.doc,{id:e.id,_type:"io.cozy.files"})}));case 5:case"end":return e.stop()}},e)}))),p(this,"getFilesInBatch",function(e){return cozy.client.offline.getDatabase("io.cozy.files").allDocs({include_docs:!0,keys:e})}),this.indexes={name:r,updated_at:i,size:l,recent:d}},m=new function e(){var t=this;f(this,e),p(this,"getFolder",(d=s(o.a.mark(function e(t){var n,r,i,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,cozy.client.files.statById(t,!1,{limit:a.a});case 2:if(n=e.sent,r=n.attributes.dir_id,e.t0=!!r,!e.t0){e.next=9;break}return e.next=8,cozy.client.files.statById(r,!1).catch(function(e){if(403!==e.status)throw e;console.warn("User don't have access to parent folder")});case 8:e.t0=e.sent;case 9:return i=e.t0,c=n.relations("contents").filter(function(e){return void 0!==e}).map(function(e){return b(e)})||[],e.abrupt("return",u({},b(n),{contents:{data:c,meta:{count:n.relationships.contents.meta.count}},parent:!!i&&b(i)}));case 12:case"end":return e.stop()}},e)})),function(e){return d.apply(this,arguments)})),p(this,"getFolderContents",(l=s(o.a.mark(function e(t){var n,r,i,c,u=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:0,r=u.length>2&&void 0!==u[2]?u[2]:a.a,e.next=4,cozy.client.files.statById(t,!1,{skip:n,limit:r});case 4:return i=e.sent,c=i.relations("contents").filter(function(e){return void 0!==e})||[],e.abrupt("return",c.map(function(e){return b(e)}));case 7:case"end":return e.stop()}},e)})),function(e){return l.apply(this,arguments)})),p(this,"getSortedFolder",(i=s(o.a.mark(function e(n,r){var i,u,l,s,f,p,d,m=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=m.length>2&&void 0!==m[2]?m[2]:"asc",u=m.length>3&&void 0!==m[3]?m[3]:0,l=m.length>4&&void 0!==m[4]?m[4]:a.a,s=[],0!==u){e.next=11;break}return f="name"===r?i:"asc",e.next=9,t.query({folderId:n,type:"directory",sortAttribute:r,sortOrder:f,skip:0,limit:null});case 9:p=e.sent,s=p.filter(function(e){return e._id!==a.c});case 11:return e.next=13,t.query({folderId:n,type:"file",sortAttribute:r,sortOrder:i,skip:u,limit:l});case 13:return d=e.sent,e.abrupt("return",[].concat(c(s),c(d)));case 15:case"end":return e.stop()}},e)})),function(e,t){return i.apply(this,arguments)})),p(this,"query",(r=s(o.a.mark(function e(n){var r,a,i,c,u,l,s,f;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.folderId,a=n.type,i=n.sortAttribute,c=n.sortOrder,u=n.skip,l=n.limit,e.next=3,t.getIndex(i,["dir_id","type",i]);case 3:return s=e.sent,e.next=6,cozy.client.files.query(s,{selector:p({dir_id:r,type:a},i,{$gt:null}),sort:[{dir_id:c},{type:c},p({},i,c)],skip:u,limit:l,wholeResponse:!0});case 6:return f=e.sent,e.abrupt("return",f.data.map(function(e){return b(e)}));case 8:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})),p(this,"getIndex",(n=s(o.a.mark(function e(n,r){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.indexes[n]){e.next=4;break}return e.abrupt("return",t.indexes[n]);case 4:return e.next=6,cozy.client.data.defineIndex("io.cozy.files",r);case 6:return a=e.sent,t.indexes[n]=a,e.abrupt("return",a);case 9:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)})),p(this,"getRecentFiles",s(o.a.mark(function e(){var n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getIndex("recent",["updated_at","trashed"]);case 2:return n=e.sent,e.next=5,cozy.client.files.query(n,{selector:{updated_at:{$gt:null},trashed:!1},sort:[{updated_at:"desc"},{trashed:"desc"}],limit:a.a,wholeResponse:!0});case 5:return r=e.sent,e.abrupt("return",r.data.map(function(e){return u({},e,{_id:e.id,_type:e.type},e.attributes)}));case 7:case"end":return e.stop()}},e)}))),p(this,"getFilesInBatch",function(e){return cozy.client.fetchJSON("POST","/data/io.cozy.files/_all_docs?include_docs=true",{keys:e})}),this.indexes={};var n;var r;var i;var l;var d},h=function(e){return Object(i.f)(e)?new d(Object(i.b)(e)):m},b=function(e){var t=e.id||e._id;return u({},e.attributes,{id:t,_id:t,_type:"io.cozy.files",links:e.links,relationships:e.relationships})}},MJrX:function(e,t,n){"use strict";var r=n("o0o1"),o=n.n(r),a=n("mz5Q"),i=n.n(a),c=n("XOpu"),u=n("0yyf"),l=n.n(u),s=n("e2oC"),f=n("eKCf"),p=n("t0Aa"),d=n.n(p),m=n("17x9"),h=n.n(m),b=n("TSYQ"),y=n.n(b),v=n("+FsC"),w={parent:{position:"relative",overflow:"hidden"},input:{position:"absolute",top:0,left:0,opacity:0,width:"100%",height:"100%",zIndex:1}},g=Object(c.c)()(function(e){var t=e.label,n=e.inMenu,r=void 0!==n&&n,o=e.disabled,a=e.onUpload,c=e.className,u=void 0===c?"":c;return i.a.createElement("label",{role:"button",disabled:o,className:"".concat(u," ").concat(r?"":d.a["c-btn"]),style:w.parent},i.a.createElement("span",null,!r&&i.a.createElement(v.g,{icon:"upload"}),i.a.createElement("span",null,t),i.a.createElement("input",{"data-test-id":"upload-btn",type:"file",accept:"image/*",multiple:!0,disabled:o,style:w.input,onChange:function(e){var t=Array.from(e.target.files);a(t)}})))}),O=n("SvPG"),_=n("DbnX"),E=function(e){var t=e.t,n=e.disabled,r=e.uploadPhotos,o=e.selectItems;return i.a.createElement(v.h,{disabled:n,position:"right",className:d.a["pho-toolbar-menu"],component:i.a.createElement(O.b,null)},i.a.createElement(v.j,{icon:i.a.createElement(v.g,{icon:"upload"}),className:d.a["u-hide--desk"]},i.a.createElement(g,{onUpload:r,disabled:n,label:t("Toolbar.menu.photo_upload"),inMenu:!0,className:y()(d.a["u-hide--tablet"],d.a["pho-action-upload"])})),i.a.createElement("hr",{className:d.a["u-hide--desk"]}),i.a.createElement(v.j,{onSelect:o,icon:i.a.createElement(v.g,{icon:_.a})},t("Toolbar.menu.select_items")))};E.propTypes={disabled:h.a.bool,uploadPhotos:h.a.func.isRequired,selectItems:h.a.func.isRequired,t:h.a.func.isRequired};var k=function(e){var t=e.t,n=e.disabled,r=void 0!==n&&n,o=e.uploadPhotos,a=e.selectItems;return i.a.createElement("div",{className:d.a["pho-toolbar"],role:"toolbar"},i.a.createElement(g,{className:d.a["u-hide--mob"],onUpload:o,disabled:r,label:t("Toolbar.photo_upload")}),i.a.createElement(E,{t:t,disabled:r,uploadPhotos:o,selectItems:a}))};k.propTypes={disabled:h.a.bool,uploadPhotos:h.a.func.isRequired,selectItems:h.a.func.isRequired,t:h.a.func.isRequired};var S=k,x=n("2sk9"),j=n.n(x),C=n("WrkV"),P=function(e){var t=e.t,n=e.count,r=e.confirm,o=e.abort,a=["trash","restore","shared"];!0===e.related&&a.push("related");var c=a.map(function(e){return i.a.createElement("p",{className:y()(j.a["fil-confirm-text"],j.a["icon-".concat(e)]),key:"key_delet_".concat(e)},t("timeline.DeleteConfirm.".concat(e),n))});return i.a.createElement(C.c,{title:t("timeline.DeleteConfirm.title",n),description:c,secondaryType:"secondary",secondaryText:t("timeline.DeleteConfirm.cancel"),secondaryAction:o,primaryType:"danger",primaryText:t("timeline.DeleteConfirm.delete"),primaryAction:r})},A=n("5wWc"),N=n("TtgU"),T=n("KHOr"),z=n("SRpc"),R=n("q/Uw"),D=n("A3Xe");function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){q(e,t,n[t])})}return e}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function V(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Y(a,r,o,i,c,"next",e)}function c(e){Y(a,r,o,i,c,"throw",e)}i(void 0)})}}var H=function(){var e=V(o.a.mark(function e(t,n){var r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(D.e)(t,D.c);case 2:if(!((r=e.sent).length>0)){e.next=7;break}return e.abrupt("return",r[0]._id);case 7:return e.next=9,Object(D.d)(t,"/".concat(n("UploadQueue.path_photos")),D.b);case 9:return e.next=11,Object(D.d)(t,"/".concat(n("UploadQueue.path_photos"),"/").concat(n("UploadQueue.path_upload")),D.c);case 11:return a=e.sent,e.abrupt("return",a._id);case 13:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),Q=function(e){function t(){var e,n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,u=new Array(c),l=0;l<c;l++)u[l]=arguments[l];return r=this,a=(e=M(t)).call.apply(e,[this].concat(u)),n=!a||"object"!==L(a)&&"function"!=typeof a?U(r):a,q(U(n),"state",{showAddAlbumModal:!1}),q(U(n),"showAddAlbumModal",function(){n.setState(function(e){return I({},e,{showAddAlbumModal:!0})})}),q(U(n),"hideAddAlbumModal",function(){n.setState(function(e){return I({},e,{showAddAlbumModal:!1})})}),q(U(n),"uploadPhotos",function(){var e=V(o.a.mark(function e(t){var r,a,i,c,u;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props.uploadPhoto,a=n.context,i=a.client,c=a.t,e.next=4,H(i,c);case 4:u=e.sent,n.dispatch(Object(T.c)(t,function(e){return r(e,u)}));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),q(U(n),"downloadPhotos",function(e){n.context.client.collection("io.cozy.files").downloadArchive(e.map(function(e){return e._id}),"selected")}),q(U(n),"deletePhotos",function(e,t){return Object(A.a)(i.a.createElement(P,{t:n.context.t,count:e.length,related:Object(z.g)(e)}),function(){return Promise.all(e.map(function(e){return n.props.deletePhoto(e)})).then(t)})}),n}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(t,a["Component"]),n=t,(r=[{key:"dispatch",value:function(e){return this.context.store.dispatch(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,r=t.lists,o=t.fetchStatus,a=t.hasMore,c=t.fetchMore;return i.a.createElement(R.a,{actions:function(t){return{"album-add":e.showAddAlbumModal,download:e.downloadPhotos,delete:function(n){return e.deletePhotos(n,t.clear)}}}},function(t,u,p){return i.a.createElement("div",{"data-test-id":"timeline-pho-content-wrapper",className:l.a["pho-content-wrapper"]},i.a.createElement(f.a,{viewName:"photos"},i.a.createElement(S,{disabled:u,uploadPhotos:e.uploadPhotos,selectItems:p.show,t:n})),i.a.createElement(s.a,null,e.state.showAddAlbumModal&&i.a.createElement(z.b,{onDismiss:e.hideAddAlbumModal,onSuccess:p.clear,photos:t}),i.a.createElement(N.a,{lists:r,selected:t,photosContext:"timeline",showSelection:u,onPhotoToggle:p.toggle,onPhotosSelect:p.select,onPhotosUnselect:p.unselect,fetchStatus:o,hasMore:a,fetchMore:c})),e.renderViewer(e.props.children))})}},{key:"renderViewer",value:function(e){var t=this;return e?i.a.Children.map(e,function(e){return i.a.cloneElement(e,{photos:t.props.data||[]})}):null}}])&&F(n.prototype,r),c&&F(n,c),t}();t.a=Object(c.c)()(Q)},"MM/P":function(e,t,n){e.exports={"fil-confirm-text":"fil-confirm-text--1mg03","icon-trash":"icon-trash--2KM7n","icon-restore":"icon-restore--pj-pW","icon-shared":"icon-shared--2V24-","icon-referenced":"icon-referenced--sXXbJ","icon-forbidden":"icon-forbidden--mnnYN","fil-confirm-recipients":"fil-confirm-recipients--ktcey",spin:"spin--oXa2w"}},Mlvp:function(e,t,n){e.exports={"coz-menu-inner":"coz-menu-inner--1HCUw","coz-menu":"coz-menu--2DvlI","coz-menu-inner--opened":"coz-menu-inner--opened--1fdzR","coz-menu-item":"coz-menu-item--2MxiQ","cozy-menu-overlay":"cozy-menu-overlay--3Khoc"}},NqoY:function(e,t,n){"use strict";var r=n("z6Q1"),o=n("SH7X");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,u(t).apply(this,arguments))}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,o["HasMany"]),n=t,a=[{key:"query",value:function(e,t,n){if(!e.relationships||!e.relationships.referenced_by||!e.relationships.referenced_by.data)return null;var r=e.relationships.referenced_by.data.filter(function(e){return e.type===n.doctype}).map(function(e){return e.id});return new o.QueryDefinition({doctype:n.doctype,ids:r})}}],(r=[{key:"data",get:function(){var e=this,t=this.target.relationships.referenced_by.data;return t?t.map(function(t){return e.get(t.type,t.id)}).filter(Boolean):[]}}])&&i(n.prototype,r),a&&i(n,a),t}();t.a={albums:{doctype:r.a,attributes:{name:{type:"string"}},relationships:{photos:{type:"has-many",doctype:r.d}}},files:{doctype:r.d,relationships:{albums:{type:s,doctype:r.a}}},contacts:{doctype:r.c}}},OZnT:function(e,t){e.exports="./img/app-icon.f49493c812ab389aaac1e61434f7995f.svg"},OsbH:function(e,t,n){"use strict";var r=n("o0o1"),o=n.n(r),a=n("mz5Q"),i=n.n(a),c=n("/tz4"),u=n.n(c),l=n("SH7X"),s=n("ZHai"),f=n("mwIZ"),p=n.n(f);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function b(e){var t=function(e,t){if("object"!==d(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===d(t)?t:String(t)}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){v(e,t,n[t])})}return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=function(e){var t=e.instanceUri,n=e.sharings,r=void 0===n?[]:n,o=e.permissions,a=void 0===o?[]:o,i=e.apps,c=void 0===i?[]:i;return{type:"RECEIVE_SHARINGS",data:{sharings:r.filter(function(e){return!te(e)&&!ne(e,t)}),permissions:a,apps:c}}},g=function(e,t){return{type:"ADD_SHARING",data:e,path:t}},O=function(e){return{type:"UPDATE_SHARING",sharing:e}},_=function(e,t,n){return{type:"REVOKE_RECIPIENT",sharing:y({},e,{attributes:y({},e.attributes,{members:e.attributes.members.map(function(e,n){return n===t?y({},e,{status:"revoked"}):e})})}),path:n}},E=function(e){return{type:"REVOKE_SELF",sharing:e}},k=function(e){return{type:"ADD_SHARING_LINK",data:e}},S=function(e){return{type:"REVOKE_SHARING_LINK",permissions:e}},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(t){return t.instance&&t.instance.toString().toLowerCase()===e.toLowerCase()}},j={sharings:[],permissions:[]},C=function(e,t,n){var r,o=e[t],a=h(e,[t].map(b)),i=n(o||j);return 0===(r=i).sharings.length&&0===r.permissions.length?a:y({},a,v({},t,i))},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return J(t).reduce(function(e,n){return C(e,n,function(e){return y({},e,{sharings:[].concat(m(e.sharings),[t.id])})})},e)},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return J(t).reduce(function(e,n){return C(e,n,function(e){return y({},e,{sharings:e.sharings.filter(function(e){return e!==t.id})})})},e)},N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return J(t).reduce(function(e,n){return C(e,n,function(e){return y({},e,{permissions:[].concat(m(e.permissions),[t.id])})})},e)},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_SHARINGS":var n=t.data.sharings.reduce(function(e,t){return P(e,t)},e);return t.data.permissions.reduce(function(e,t){return N(e,t)},n);case"ADD_SHARING":return P(e,t.data);case"REVOKE_RECIPIENT":return te(t.sharing)?A(e,t.sharing):e;case"ADD_SHARING_LINK":return N(e,t.data);case"REVOKE_SELF":return A(e,t.sharing);case"REVOKE_SHARING_LINK":return t.permissions.reduce(function(e,t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return J(t).reduce(function(e,n){return C(e,n,function(e){return y({},e,{permissions:e.permissions.filter(function(e){return e!==t.id})})})},e)}(e,t)},e);default:return e}},z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_SHARINGS":return t.data.permissions;case"ADD_SHARING_LINK":return[].concat(m(e),[t.data]);case"REVOKE_SHARING_LINK":var n=t.permissions.map(function(e){return e.id});return e.filter(function(e){return-1===n.indexOf(e.id)});default:return e}},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_SHARINGS":return t.data.apps;default:return e}},D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_SHARINGS":return t.data.sharings;case"ADD_SHARING":return[].concat(m(e),[t.data]);case"UPDATE_SHARING":case"REVOKE_RECIPIENT":return e.map(function(e){return e.id!==t.sharing.id?e:t.sharing});case"REVOKE_SELF":return e.filter(function(e){return e.id!==t.sharing.id});default:return e}},L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_PATHS":return t.paths;case"ADD_SHARING":return[].concat(m(e),[t.path]);case"REVOKE_RECIPIENT":return te(t.sharing)?e.filter(function(e){return e!==t.path}):e;default:return e}},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{byDocId:T(e.byDocId,t),sharings:D(e.sharings,t),permissions:z(e.permissions,t),apps:R(e.apps,t),sharedPaths:L(e.sharedPaths,t)}},F=function(e,t){return!e.byDocId[t]||0===e.byDocId[t].sharings.length||!0===W(e,e.byDocId[t].sharings[0]).attributes.owner},M=function(e,t,n){var r=H(e,t),o=r.attributes.members.find(x(n));return!0===r.attributes.open_sharing&&o&&!o.read_only},U=function(e,t){return B(e,t).find(function(e){return"owner"===e.status})},B=function(e,t){var n=Q(e,t).map(function(e){var n=re(e,t);return e.attributes.members.map(function(t,r){return y({},t,{type:t.read_only?"one-way":n,sharingId:e.id,index:r})})}).reduce(function(e,t){return e.concat(t)},[]).filter(function(e){return"revoked"!==e.status});return n[0]&&"owner"===n[0].status?[n[0]].concat(m(n.filter(function(e){return"owner"!==e.status}))):n},q=function(e,t,n){var r=G(e,t);if(0===r.length)return null;var o=r[0],a=p()(o,"attributes.shortcodes.email")||p()(o,"attributes.codes.email");return a?oe(e,n,a):null},Y=function(e,t){return H(e,t)},V=function(e,t,n){var r=Y(e,t),o=re(r,t);if(r.attributes.owner)return o;var a=r.attributes.members.find(x(n));return a&&a.read_only?"one-way":o},H=function(e,t){return Q(e,t)[0]||null},Q=function(e,t){return e.byDocId[t]?e.byDocId[t].sharings.map(function(t){return W(e,t)}):[]},W=function(e,t){return e.sharings.find(function(e){return e.id===t})},G=function(e,t){return e.byDocId[t]?e.byDocId[t].permissions.map(function(t){return K(e,t)}):[]},K=function(e,t){return e.permissions.find(function(e){return e.id===t})},X=function(e,t){return e.sharedPaths.some(function(e){return 0===t.path.indexOf("".concat(e,"/"))})},Z=function(e,t){return e.sharedPaths.some(function(e){return 0===e.indexOf("".concat(t.path,"/"))})},J=function(e){return"io.cozy.sharings"===e.type?$(e):ee(e)},$=function(e){return e.attributes.rules.map(function(e){return e.values}).reduce(function(e,t){return e.concat(t)},[])},ee=function(e){return Object.keys(e.attributes.permissions).map(function(t){return e.attributes.permissions[t].values}).reduce(function(e,t){return[].concat(m(e),m(t))},[])},te=function(e){return e.attributes.owner&&1===e.attributes.members.filter(function(e){return"revoked"!==e.status}).length},ne=function(e,t){var n=e.attributes.members.find(x(t));return!e.attributes.owner&&n&&"revoked"===n.status},re=function(e,t){if(!e)return null;var n=e.attributes.rules.find(function(e){return-1!==e.values.indexOf(t)});return"sync"===n.update&&"sync"===n.remove?"two-way":"one-way"},oe=function(e,t,n){var r=ae(e,t);return"".concat(r,"public?sharecode=").concat(n)},ae=function(e,t){var n=function(e){return e.apps}(e);switch(t){case"Files":case"Document":return ie(n,"drive");case"Albums":return ie(n,"photos");default:throw new Error("Sharing link: don't know which app to use for doctype ".concat(t))}},ie=function(e,t){var n=e.find(function(e){return e.attributes.slug===t&&"ready"===e.attributes.state});if(!n)throw new Error("Sharing link: app ".concat(t," not installed"));return n.links.related},ce=n("TSYQ"),ue=n.n(ce),le=n("+FsC"),se=n("I2Z/"),fe=n.n(se);function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var de=function(e){var t=e.byMe,n=e.className,r=e.small,o=e.xsmall;return i.a.createElement("div",{className:ue()(fe.a["shared-badge"],n,pe({},fe.a["--small"],r),pe({},fe.a["--xsmall"],o),fe.a[t?"--by-me":"--with-me"])},i.a.createElement(le.g,{icon:"share",color:"white",className:fe.a["shared-badge-icon"]}))},me=n("Te91"),he=n.n(me);function be(){return(be=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ye(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var ve=function(e){var t=e.label,n=e.onClick,r=e.className,o=ye(e,["label","onClick","className"]);return i.a.createElement(le.d,be({"data-test-id":"share-by-me-button",className:ue()(he.a["coz-btn-shared"],r),onClick:function(){return n()},icon:"share",label:t},o))},we=function(e){var t=e.label,n=e.onClick,r=e.className,o=ye(e,["label","onClick","className"]);return i.a.createElement(le.d,be({className:ue()(he.a["coz-btn-sharedWithMe"],r),onClick:function(){return n()},icon:"share",label:t},o))},ge=function(e){var t=e.label,n=e.onClick,r=e.className,o=ye(e,["label","onClick","className"]);return i.a.createElement(le.d,be({"data-test-id":"share-button",theme:"secondary",className:r,onClick:function(){return n()},icon:"share",label:t},o))},Oe=n("jrFr"),_e=n.n(Oe),Ee=n("17x9"),ke=n.n(Ee),Se=n("WrkV"),xe=n("WWur"),je=n.n(xe),Ce=n("C1U5"),Pe=n("Q2ax");function Ae(e){return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Fe(e,t,n[t])})}return e}function Te(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function ze(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Te(a,r,o,i,c,"next",e)}function c(e){Te(a,r,o,i,c,"throw",e)}i(void 0)})}}function Re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Me=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=De(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==Ae(o)&&"function"!=typeof o?Le(r):o,Fe(Le(n),"state",{loading:!1}),Fe(Le(n),"toggleShareLink",function(e){e?n.createShareLink():n.deleteShareLink()}),Fe(Le(n),"copyLinkToClipboard",function(){je()(n.props.link)?Pe.a.success("".concat(n.props.documentType,".share.shareByLink.copied")):Pe.a.error("".concat(n.props.documentType,".share.shareByLink.failed"))}),n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ie(e,t)}(t,i.a.Component),n=t,(r=[{key:"createShareLink",value:function(){var e=ze(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setState(function(e){return Ne({},e,{loading:!0})}),e.next=4,this.props.onEnable(this.props.document);case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),Pe.a.error("".concat(this.props.documentType,".share.error.generic")),console.log(e.t0);case 10:return e.prev=10,this.setState(function(e){return Ne({},e,{loading:!1})}),e.finish(10);case 13:case"end":return e.stop()}},e,this,[[0,6,10,13]])}));return function(){return e.apply(this,arguments)}}()},{key:"deleteShareLink",value:function(){var e=ze(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setState(function(e){return Ne({},e,{loading:!0})}),e.next=4,this.props.onDisable(this.props.document);case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),Pe.a.error("".concat(this.props.documentType,".share.error.revoke")),console.log(e.t0);case 10:return e.prev=10,this.setState(function(e){return Ne({},e,{loading:!1})}),e.finish(10);case 13:case"end":return e.stop()}},e,this,[[0,6,10,13]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.context.t,t=this.state.loading,n=this.props,r=n.checked,o=n.documentType;return i.a.createElement("div",null,i.a.createElement("div",{"data-test-id":"share-by-link",className:ue()(_e.a["share-bylink-header"],"u-mt-1","u-mb-1")},i.a.createElement(le.n,null,e("".concat(o,".share.shareByLink.subtitle"))),t&&i.a.createElement(le.m,null),t&&i.a.createElement("span",{className:_e.a["share-bylink-header-creating"]},e("".concat(o,".share.shareByLink.creating"))),r&&i.a.createElement("span",{className:_e.a["share-bylink-header-dot"]}),r&&i.a.createElement("button",{"data-test-url":this.props.link,className:_e.a["share-bylink-header-copybtn"],onClick:this.copyLinkToClipboard},e("".concat(o,".share.shareByLink.copy"))),i.a.createElement(Ce.a,{id:"share-toggle",name:"share",checked:r,disabled:t,onToggle:this.toggleShareLink})),i.a.createElement("div",{className:_e.a["share-bylink-desc"]},e("".concat(o,".share.shareByLink.desc"))))}}])&&Re(n.prototype,r),a&&Re(n,a),t}(),Ue=n("/MKj"),Be=n("dxQs"),qe=n("1h/R"),Ye=n.n(qe),Ve=n("fWVu"),He=n.n(Ve),Qe=n("32XB"),We=n.n(Qe);function Ge(e){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xe(e){return(Xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ze(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Je(e,t){return(Je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var et=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=Xe(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==Ge(o)&&"function"!=typeof o?Ze(r):o,$e(Ze(n),"state",{active:!1}),$e(Ze(n),"toggle",function(){n.setState({active:!n.state.active})}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Je(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this,t=this.props,n=t.breakpoints.isMobile,r=t.children,o=t.text,a=t.buttonClassName,c=t.name;return n?i.a.createElement("div",null,i.a.createElement(le.i,{onClick:this.toggle,text:o,buttonClassName:a}),this.state.active&&i.a.createElement(le.a,{onClose:function(){return e.toggle()}},i.a.createElement(le.j,{className:We.a["fil-mobileactionmenu"]},i.a.createElement(Yt,{name:c,size:"small"})),r)):i.a.createElement(le.h,this.props)}}])&&Ke(n.prototype,r),o&&Ke(n,o),t}(),tt=Object(le.q)()(et),nt=n("OnOE"),rt=n.n(nt),ot=n("Bicm"),at=n.n(ot);function it(e){return(it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ut(e,t){return!t||"object"!==it(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function lt(e){return(lt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function st(e,t){return(st=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ft(){return(ft=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var pt=function(e){return i.a.createElement(rt.a,ft({place:"bottom",effect:"solid",className:at.a["shared-tooltip"]},e),e.children)},dt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ut(this,lt(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&st(e,t)}(t,i.a.Component),n=t,(r=[{key:"render",value:function(){var e=this.context.t,t=this.props,n=t.recipientNames,r=t.cutoff,o=void 0===r?4:r;return i.a.createElement("ul",{className:at.a["shared-tooltip-list"]},n.slice(0,o).map(function(e){return i.a.createElement("li",{key:"key_name_".concat(e)},e)}),n.length>o&&i.a.createElement("li",null,e("Share.members.others",{smart_count:n.slice(o).length})))}}])&&ct(n.prototype,r),o&&ct(n,o),t}();dt.propTypes={recipientNames:ke.a.arrayOf(ke.a.string),cutoff:ke.a.number},dt.defaultProps={recipientNames:[],cutoff:4};var mt=n("1BUi"),ht=n.n(mt),bt=function(){var e={base:["304FFE","2979FF","00B0FF","00DCE9","00D5B8","00C853","E70505","FF5700","FF7900","FFA300","B3C51D","64DD17","FF2828","F819AA","AA00FF","6200EA","7190AB","51658D"]},t=function(e){var t,n,r,o;for(t=0,o=Math.pow(2,32),n=0,r=e.length;n<r;n++)t=(31*t+e.charCodeAt(n))%o;return t};return{getHash:t,getColor:function(n,r){var o;return"#"+(o=e[r]||e.base)[t(n)%o.length]}}};function yt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var vt=function(e){var t=e.text,n=e.size,r=e.textId,o=t.charAt(0),a={"background-color":bt().getColor(r)};return i.a.createElement("div",{className:ue()(ht.a["recipient-avatar"],yt({},ht.a["recipient-avatar--small"],"small"===n)),style:a,"data-tip":r,"data-for":"recipient-avatar-".concat(t)},i.a.createElement("span",null,o),i.a.createElement(pt,{id:"recipient-avatar-".concat(t)}))};vt.propTypes={text:ke.a.string,size:ke.a.string,textId:ke.a.string},vt.defaultProps={text:"",size:"small-plus",textId:""};var wt=function(e){var t=e.size,n=e.extraRecipients,r=void 0===n?[]:n;return i.a.createElement("div",{className:ue()(ht.a["recipient-avatar"],yt({},ht.a["recipient-avatar--small"],"small"===t)),"data-tip":!0,"data-for":"extra-recipients-avatar"},i.a.createElement("span",{className:ht.a["recipient-avatar-plusx"]},"+",Math.min(r.length,99)),i.a.createElement(pt,{id:"extra-recipients-avatar"},i.a.createElement(dt,{recipientNames:r})))};wt.propTypes={extraRecipients:ke.a.arrayOf(ke.a.string),size:ke.a.string},wt.defaultProps={extraRecipients:[],size:"medium"};var gt=n("4BeY"),Ot=n.n(gt),_t=n("IaFt"),Et=n.n(_t),kt=new Ot.a({id:"icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6",use:"icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6-usage",viewBox:"0 0 16 16",content:'<symbol viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6">\n    <defs>\n        <path d="M3.00247329,2 C2.45576096,2 2,1.55228475 2,1 C2,0.443864822 2.44882258,0 3.00247329,0 L12.9975267,0 C13.544239,0 14,0.44771525 14,1 C14,1.55613518 13.5511774,2 12.9975267,2 L13,2 L13,3 C13,3.55613518 12.6840146,4.31598541 12.2942268,4.70577316 L9,8 L12.2942268,11.2942268 C12.6840146,11.6840146 13,12.4438648 13,13 L13,14 L12.9975267,14 C13.5511774,14 14,14.4438648 14,15 C14,15.5522847 13.544239,16 12.9975267,16 L3.00247329,16 C2.44882258,16 2,15.5561352 2,15 C2,14.4477153 2.45576096,14 3.00247329,14 L3,14 L3,13 C3,12.4477153 3.31277239,11.6872276 3.70577316,11.2942268 L7,8 L3.70577316,4.70577316 C3.31277239,4.31277239 3,3.55228475 3,3 L3,2 L3.00247329,2 Z M4.5,3 C4.5,3.55228475 4.83559471,4.28765261 5.25944787,4.65095532 L8,7 L10.7405521,4.65095532 C11.1599836,4.29144262 11.5,3.54681396 11.5,3 L4.5,3 Z" id="icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_path-1" />\n    </defs>\n    <g id="icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_🍦-icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_icons/16/hourglass">\n            <mask id="icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_mask-2" fill="white">\n                <use xlink:href="#icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_path-1" />\n            </mask>\n            <use id="icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_Mask" fill="#95999d" fill-opacity="0.5" xlink:href="#icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_path-1" />\n        </g>\n    </g>\n</symbol>'}),St=(Et.a.add(kt),kt),xt=new Ot.a({id:"icon-eye-16_32a783455d403df2cdd48aa32afb9d27",use:"icon-eye-16_32a783455d403df2cdd48aa32afb9d27-usage",viewBox:"0 0 16 16",content:'<symbol viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="icon-eye-16_32a783455d403df2cdd48aa32afb9d27">\n    <defs>\n        <path d="M0,8 C0,8 2,2 8,2 C14,2 16,8 16,8 C16,8 14,14 8,14 C2,14 0,8 0,8 Z M8,12 C10.2091391,12 12,10.2091391 12,8 C12,5.79086089 10.2091391,4 8,4 C5.79086089,4 4,5.79086089 4,8 C4,10.2091391 5.79086089,12 8,12 Z M8,10 C6.89543045,10 6,9.10456955 6,8 C6,6.89543045 6.89543045,6 8,6 C9.10456955,6 10,6.89543045 10,8 C10,9.10456955 9.10456955,10 8,10 Z" id="icon-eye-16_32a783455d403df2cdd48aa32afb9d27_path-1" />\n    </defs>\n    <g id="icon-eye-16_32a783455d403df2cdd48aa32afb9d27_icons/16/eye" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <mask id="icon-eye-16_32a783455d403df2cdd48aa32afb9d27_mask-2" fill="white">\n            <use xlink:href="#icon-eye-16_32a783455d403df2cdd48aa32afb9d27_path-1" />\n        </mask>\n        <use id="icon-eye-16_32a783455d403df2cdd48aa32afb9d27_Mask" fill="#95999d" fill-opacity="0.5" xlink:href="#icon-eye-16_32a783455d403df2cdd48aa32afb9d27_path-1" />\n    </g>\n</symbol>'}),jt=(Et.a.add(xt),xt),Ct=new Ot.a({id:"icon-pen-write-16_2d81809ca299a1197d20de636609807e",use:"icon-pen-write-16_2d81809ca299a1197d20de636609807e-usage",viewBox:"0 0 16 16",content:'<symbol viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="icon-pen-write-16_2d81809ca299a1197d20de636609807e">\n    <defs>\n        <path d="M9.5,3.50347728 L12.5,6.50347728 L3.03771973,16.0034773 L0,16.0034773 L0,13.0288679 L9.5,3.50347728 Z M14.9121541,0.915631358 L15.0878459,1.0913232 C15.8637772,1.86725444 15.8697383,3.14159072 15.0922712,3.92874355 L14.0307617,5.00347728 L11,2.00347728 L12.0892639,0.914213423 C12.8691444,0.13433284 14.1322429,0.135720196 14.9121541,0.915631358 Z M7,14.0034773 L12.9970707,14.0034773 C13.5509732,14.0034773 14,14.4473421 14,15.0034773 C14,15.555762 13.5536886,16.0034773 13.0024554,16.0034773 L5,16.0034773 L7,14.0034773 Z" id="icon-pen-write-16_2d81809ca299a1197d20de636609807e_path-1" />\n    </defs>\n    <g id="icon-pen-write-16_2d81809ca299a1197d20de636609807e_icons/16/pen-write" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <mask id="icon-pen-write-16_2d81809ca299a1197d20de636609807e_mask-2" fill="white">\n            <use xlink:href="#icon-pen-write-16_2d81809ca299a1197d20de636609807e_path-1" />\n        </mask>\n        <use id="icon-pen-write-16_2d81809ca299a1197d20de636609807e_Mask" fill="#95999d" fill-opacity="0.5" xlink:href="#icon-pen-write-16_2d81809ca299a1197d20de636609807e_path-1" />\n    </g>\n</symbol>'}),Pt=(Et.a.add(Ct),Ct),At=new Ot.a({id:"icon-trash-red_c64051db4812a1c5d58fc48b31781cbc",use:"icon-trash-red_c64051db4812a1c5d58fc48b31781cbc-usage",viewBox:"0 0 16 16",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-trash-red_c64051db4812a1c5d58fc48b31781cbc">\n  <g fill="#F52D2D" fill-rule="evenodd" transform="translate(-96 -32)">\n    <path d="M100.5,33 L98.0068455,33 C97.4499488,33 97,33.4477153 97,34 L97,35 L111,35 L111,34 C111,33.4438648 110.54922,33 109.993155,33 L107.5,33 L107,32 L101,32 L100.5,33 Z M98,36 L110,36 L110,45.9914698 C110,47.1007504 109.09805,48 107.99147,48 L100.00853,48 C98.8992496,48 98,47.0980496 98,45.9914698 L98,36 Z" />\n    <path d="M100.5,33 L98.0068455,33 C97.4499488,33 97,33.4477153 97,34 L97,35 L111,35 L111,34 C111,33.4438648 110.54922,33 109.993155,33 L107.5,33 L107,32 L101,32 L100.5,33 Z M98,36 L110,36 L110,45.9914698 C110,47.1007504 109.09805,48 107.99147,48 L100.00853,48 C98.8992496,48 98,47.0980496 98,45.9914698 L98,36 Z" />\n  </g>\n</symbol>'}),Nt=(Et.a.add(At),At);function Tt(){return(Tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function zt(e){return(zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rt(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function Dt(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Rt(a,r,o,i,c,"next",e)}function c(e){Rt(a,r,o,i,c,"throw",e)}i(void 0)})}}function Lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function It(e){return(It=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ft(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mt(e,t){return(Mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ut(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Bt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var qt=function(e){var t=e.name,n=e.url,r=void 0===n?"-":n;return i.a.createElement("div",{className:ue()(ht.a["recipient-idents"],"u-ml-1")},i.a.createElement("div",{className:ht.a["recipient-user"]},t),i.a.createElement("div",{className:ht.a["recipient-url"]},r))},Yt=function(e){var t=e.url,n=e.size,r=Ut(e,["url","size"]);return i.a.createElement("div",{className:ht.a.avatar},i.a.createElement(vt,{text:Gt(Dr(r)),size:n,textId:Dr(r)}),i.a.createElement(qt,{name:Dr(r),url:t}))},Vt=function(e){function t(){var e,n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,c=new Array(i),u=0;u<i;u++)c[u]=arguments[u];return r=this,a=(e=It(t)).call.apply(e,[this].concat(c)),n=!a||"object"!==zt(a)&&"function"!=typeof a?Ft(r):a,Bt(Ft(n),"state",{revoking:!1}),Bt(Ft(n),"onRevoke",Dt(o.a.mark(function e(){var t,r,a,i,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props,r=t.onRevoke,a=t.document,i=t.sharingId,c=t.index,n.setState({revoking:!0}),e.next=4,r(a,i,c);case 4:n.setState({revoking:!1});case 5:case"end":return e.stop()}},e)}))),Bt(Ft(n),"getStatusIcon",function(e){switch(e){case"one-way":return jt;case"two-way":return Pt;default:return St}}),n}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mt(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.isOwner,n=e.status,r=e.instance,o=e.type,a=e.documentType,c=e.name,u=this.context,l=u.t,s=u.client,f=this.state.revoking,p=void 0!==r&&r===s.options.uri&&!t,d=!f&&"owner"!==n&&(p||t);return i.a.createElement("div",{className:ue()(ht.a["recipient-status"],"u-ml-1")},f&&i.a.createElement(le.m,null),!d&&i.a.createElement("span",{className:ht.a["recipient-owner"]},l("Share.status.".concat(n))),d&&i.a.createElement(tt,{text:l("ready"===n&&o?"Share.type.".concat(o):"Share.status.".concat(n)),className:ht.a["recipient-menu"],buttonClassName:ht.a["recipient-menu-btn"],position:"right",popover:!0,itemsStyle:{maxWidth:"280px"},name:c},i.a.createElement(le.j,{icon:i.a.createElement(le.g,{icon:this.getStatusIcon(n)})},l("ready"===n&&o?"Share.type.".concat(o):"Share.status.".concat(n))),i.a.createElement("hr",null),i.a.createElement(le.j,{onSelect:this.onRevoke,onClick:this.onRevoke,icon:i.a.createElement(le.g,{icon:Nt})},i.a.createElement("div",{className:ht.a["action-unshare"]},l("".concat(a,t?".share.revoke.title":".share.revokeSelf.title"))),i.a.createElement("p",{className:ht.a["action-unshare-desc"]},l("".concat(a,t?".share.revoke.desc":".share.revokeSelf.desc"))))))}}])&&Lt(n.prototype,r),c&&Lt(n,c),t}(),Ht=Object(le.q)()(Vt),Qt=function(e,t){var n=t.t,r=t.client,o=e.instance,a=e.isOwner,c=e.status,u=Ut(e,["instance","isOwner","status"]),l=a&&"owner"===c||o===r.options.uri,s=Dr(u);return i.a.createElement("div",{className:ue()(ht.a.recipient,"u-mt-1")},i.a.createElement(vt,{text:Gt(s),size:"small-plus",textId:s}),i.a.createElement("div",{className:ht.a["recipient-ident-status"]},i.a.createElement(qt,{name:l?n("Share.recipients.you"):s,url:o}),i.a.createElement(Ht,Tt({},e,{name:s}))))},Wt=function(e){var t=e.contact,n=Lr(t),r=Ir(t);return i.a.createElement("div",{className:ht.a.recipient},i.a.createElement(vt,{text:Gt(n),size:"small",textId:n}),i.a.createElement(qt,{name:n,url:r}))},Gt=function(e){return e.charAt(0).toUpperCase()},Kt=new Ot.a({id:"icon-cross-bold_768adbba35f30227bde1acbc224e1604",use:"icon-cross-bold_768adbba35f30227bde1acbc224e1604-usage",viewBox:"0 0 16 16",content:'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 16 16" id="icon-cross-bold_768adbba35f30227bde1acbc224e1604">\n  <defs>\n    <path d="M8 6.586l5.293-5.293a1 1 0 0 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 1 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 1 1 1.414-1.414L8 6.586z" id="icon-cross-bold_768adbba35f30227bde1acbc224e1604_a" />\n  </defs>\n  <use fill="#32363F" fill-rule="nonzero" xlink:href="#icon-cross-bold_768adbba35f30227bde1acbc224e1604_a" />\n</symbol>'}),Xt=(Et.a.add(Kt),Kt);function Zt(){return(Zt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Jt(e){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $t(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){on(e,t,n[t])})}return e}function en(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tn(e){return(tn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rn(e,t){return(rn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function on(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var an=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=tn(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==Jt(o)&&"function"!=typeof o?nn(r):o,on(nn(n),"state",{inputValue:"",suggestions:[]}),on(nn(n),"onSuggestionsFetchRequested",function(e){var t=e.value;n.setState(function(e){return $t({},e,{suggestions:n.computeSuggestions(t)})})}),on(nn(n),"onSuggestionsClearRequested",function(){n.setState(function(e){return $t({},e,{suggestions:[]})})}),on(nn(n),"onChange",function(e,t){var r=t.newValue,o=t.method;"object"!==Jt(r)?n.setState(function(e){return $t({},e,{inputValue:r})}):"click"!==o&&"enter"!==o||n.onPick(r)}),on(nn(n),"onKeyPress",function(e){(("Enter"===e.key||13===e.keyCode)&&""!==n.state.inputValue||("Space"===e.key||32===e.keyCode)&&/^.+@.+/.test(n.state.inputValue))&&n.onPick({email:n.state.inputValue})}),on(nn(n),"onFocus",function(){n.props.onFocus()}),on(nn(n),"onBlur",function(e,t){var r=t.highlightedSuggestion;r?(n.props.onPick(r),n.setState(function(e){return $t({},e,{inputValue:""})})):""!==n.state.inputValue&&n.state.inputValue.match(/\S+@\S+/)&&(n.props.onPick({email:n.state.inputValue}),n.setState(function(e){return $t({},e,{inputValue:""})}))}),on(nn(n),"onPick",function(e){n.props.onPick(e),n.setState(function(e){return $t({},e,{inputValue:""})}),setTimeout(function(){return n.input.focus()},1)}),on(nn(n),"onRemove",function(e){n.props.onRemove(e),setTimeout(function(){return n.input.focus()},1)}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rn(e,t)}(t,a["Component"]),n=t,(r=[{key:"computeSuggestions",value:function(e){var t=e.trim().toLowerCase();return 0===t.length?[]:this.props.contacts.filter(function(e){return function(e,t){if(!t.email)return!1;var n=new RegExp(e);return Array.isArray(t.email)?t.email.some(function(e){return n.test(e.address)}):n.test(t.email)}(t,e)||function(e,t){if(!t.cozy||!t.url)return!1;var n=new RegExp(e);return t.cozy&&Array.isArray(t.cozy)?t.cozy.some(function(e){return n.test(e.url)}):n.test(t.url)}(t,e)})}},{key:"renderInput",value:function(e){var t=this;return i.a.createElement("div",{className:He.a.recipientsContainer},this.props.recipients.map(function(e,n){var r=e.id?Lr(e):e.email;return i.a.createElement("div",{className:He.a.recipientChip,key:"key_recipient_".concat(r+n)},i.a.createElement("span",null,r),i.a.createElement("button",{className:He.a.removeRecipient,onClick:function(){return t.onRemove(e)}},i.a.createElement(le.g,{icon:Xt,width:"16",height:"16"})))}),i.a.createElement("input",Zt({},e,{onKeyPress:this.onKeyPress})))}},{key:"render",value:function(){var e=this,t=this.state,n=t.inputValue,r=t.suggestions,o=this.props.placeholder;return i.a.createElement(Ye.a,{ref:function(t){e.input=t?t.input:null},theme:He.a,suggestions:r.slice(0,20),getSuggestionValue:function(e){return e},onSuggestionsFetchRequested:this.onSuggestionsFetchRequested,onSuggestionsClearRequested:this.onSuggestionsClearRequested,renderSuggestion:function(e){return i.a.createElement(Wt,{contact:e})},renderInputComponent:function(t){return e.renderInput(t)},highlightFirstSuggestion:!0,inputProps:{onFocus:this.onFocus,onChange:this.onChange,onBlur:this.onBlur,value:n,type:"email",placeholder:o}})}}])&&en(n.prototype,r),o&&en(n,o),t}(),cn=n("q3u0"),un=n("cSBT"),ln=n("yEaX"),sn=n("QDdI"),fn=n("Z7XG");function pn(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function dn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){pn(a,r,o,i,c,"next",e)}function c(e){pn(a,r,o,i,c,"throw",e)}i(void 0)})}}var mn=function(){var e=dn(o.a.mark(function e(t,n,r,a,i,c){var u;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,hn(t,c);case 3:if(u=e.sent,n){e.next=12;break}return e.next=7,vn();case 7:return console.log("End of first replication, warming up indexes"),e.next=10,bn(u);case 10:console.log("indexes ready"),r();case 12:yn({afterReplication:function(e){e.docs_written>0&&bn(u)}}),cozy.client.settings.updateLastSync(),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),"Client has been revoked"===e.t0.message||"code=400, message=Invalid JWT token"===e.t0.error?(console.warn("The device is not connected to your server anymore"),i()):"ETIMEDOUT"===e.t0.message?console.log("replication timed out"):console.warn(e.t0);case 19:case"end":return e.stop()}},e,null,[[0,16]])}));return function(t,n,r,o,a,i){return e.apply(this,arguments)}}(),hn=function(){var e=dn(o.a.mark(function e(t,n){var r,a,i,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=cozy.client.offline.getDatabase("io.cozy.files"),e.next=3,r.viewCleanup();case 3:if(a=function(){var e=dn(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.createIndex({index:{fields:t}});case 2:return n=e.sent,e.abrupt("return",n.id);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),(i=t||{}).byName){e.next=10;break}return e.next=8,a(["dir_id","type","name"]);case 8:i.byName=e.sent,n(i);case 10:if(i.byUpdatedAt){e.next=15;break}return e.next=13,a(["dir_id","type","updated_at"]);case 13:i.byUpdatedAt=e.sent,n(i);case 15:if(i.bySize){e.next=20;break}return e.next=18,a(["dir_id","type","size"]);case 18:i.bySize=e.sent,n(i);case 20:if(i.recent){e.next=33;break}return c={_id:"_design/my_index",views:{recent_files:{map:function(e){e.trashed||"directory"===e.type||emit(e.updated_at)}.toString()}}},e.prev=22,e.next=25,r.put(c);case 25:e.next=31;break;case 27:if(e.prev=27,e.t0=e.catch(22),"conflict"===e.t0.name){e.next=31;break}throw e.t0;case 31:i.recent="my_index/recent_files",n(i);case 33:return e.abrupt("return",i);case 34:case"end":return e.stop()}},e,null,[[22,27]])}));return function(t,n){return e.apply(this,arguments)}}(),bn=function(){var e=dn(o.a.mark(function e(t){var n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(e,t){return r.find({selector:(n={dir_id:fn.b,type:"directory"},o=t,a={$gte:null},o in n?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a,n),use_index:e,limit:0});var n,o,a},r=cozy.client.offline.getDatabase("io.cozy.files"),e.next=4,r.query("my_index/recent_files",{limit:0});case 4:if(!t.byName){e.next=7;break}return e.next=7,n(t.byName,"name");case 7:if(!t.byUpdatedAt){e.next=10;break}return e.next=10,n(t.byUpdatedAt,"updated_at");case 10:if(!t.bySize){e.next=13;break}return e.next=13,n(t.bySize,"size");case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),yn=function(e){var t=e.afterReplication;return new Promise(function(e,n){var r={onError:function(e){console.warn(e),n(e)},onComplete:function(n){e(),t(n)}};cozy.client.offline.startRepeatedReplication("io.cozy.files",15,r)})},vn=function(){return new Promise(function(e,t){var n={onError:t,onComplete:e};cozy.client.offline.replicateFromCozy("io.cozy.files",n)})};function wn(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function gn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){wn(a,r,o,i,c,"next",e)}function c(e){wn(a,r,o,i,c,"throw",e)}i(void 0)})}}var On=function(){var e=gn(o.a.mark(function e(t){var n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=cozy.client.offline.getDatabase(t),e.next=3,n.info();case 3:if(r=e.sent,!("idb"!==r.adapter)){e.next=18;break}return e.prev=6,e.next=9,cozy.client.offline.migrateDatabase(t);case 9:return e.abrupt("return",!0);case 12:return e.prev=12,e.t0=e.catch(6),console.warn(e.t0),e.abrupt("return",!1);case 16:e.next=19;break;case 18:return e.abrupt("return",!1);case 19:case"end":return e.stop()}},e,null,[[6,12]])}));return function(t){return e.apply(this,arguments)}}(),_n=function(){var e=gn(o.a.mark(function e(t,n){var r,a,i,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=cozy.client.offline.getDatabase(t),e.next=3,r.getIndexes();case 3:return a=e.sent,i=a.indexes,c=n.filter(function(e){return!i.find(function(t){return t.ddoc===e})}),e.abrupt("return",c.length>0);case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),En=n("bMkt");function kn(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}var Sn=function(){return function(){var e,t=(e=o.a.mark(function e(t,n){var r,a,i,c,u,l,s,f,p;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.info("Starting replication..."),r=Object(En.c)(n()),a=Object(En.b)(n()),i=function(){t(Object(ln.j)(Object(ln.f)(n())))},c=function(){Object(cn.e)(),t(Object(sn.c)())},u=function(){t(Object(En.d)(!0))},l=function(e){t(Object(En.e)(e))},e.next=9,On("io.cozy.files");case 9:if(s=e.sent,e.t0=a&&Object.values(a).length>0,!e.t0){e.next=15;break}return e.next=14,_n("io.cozy.files",[a.byName,a.bySize,a.byUpdatedAt]);case 14:e.t0=e.sent;case 15:if(f=e.t0,!s&&!f){e.next=23;break}return l({}),e.next=20,hn({},l);case 20:return p=e.sent,e.next=23,bn(p);case 23:mn(a,r,u,i,c,l);case 24:case"end":return e.stop()}},e)}),function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){kn(a,r,o,i,c,"next",e)}function c(e){kn(a,r,o,i,c,"throw",e)}i(void 0)})});return function(e,n){return t.apply(this,arguments)}}()};function xn(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}var jn=function(e,t){return function(n){n(Object(sn.d)(e)),n(Object(sn.e)(t)),n(Object(un.e)(!0)),n(Sn())}},Cn=function(e){return function(){var t,n=(t=o.a.mark(function t(n){var r,a,i,c;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.options.uri,t.next=3,e.renewAuthorization(r);case 3:a=t.sent,i=a.infos,c=a.token,Object(cn.f)(r,i,c),Object(cn.g)(c),n(Object(un.f)(r)),n(jn(i,c));case 10:case"end":return t.stop()}},t)}),function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(e){xn(a,r,o,i,c,"next",e)}function c(e){xn(a,r,o,i,c,"throw",e)}i(void 0)})});return function(e){return n.apply(this,arguments)}}()},Pn=n("nECF"),An=n.n(Pn);function Nn(e){return(Nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Tn(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function zn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Tn(a,r,o,i,c,"next",e)}function c(e){Tn(a,r,o,i,c,"throw",e)}i(void 0)})}}function Rn(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Dn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ln(e){return(Ln=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function In(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fn(e,t){return(Fn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Un(e,t,n[t])})}return e}function Un(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Bn=function(e){return i.a.createElement("div",null,i.a.createElement("label",{className:_e.a["coz-form-label"],htmlFor:"email"},e.label),i.a.createElement(an,{contacts:e.contacts,recipients:e.recipients,onFocus:e.onFocus,onPick:e.onPick,onRemove:e.onRemove,placeholder:e.placeholder}))};Bn.propTypes={label:ke.a.string,contacts:ke.a.array,recipients:ke.a.array,onFocus:ke.a.func.isRequired,onPick:ke.a.func.isRequired,onRemove:ke.a.func.isRequired,placeholder:ke.a.string},Bn.defaultProps={label:"To:",contacts:[],recipients:[]};var qn=function(e,t){var n=e.onClose,r=e.onAccept,o=t.t;return i.a.createElement("div",{className:_e.a["permission-required-popin"]},i.a.createElement(le.d,{theme:"close",className:_e.a["permission-required-popin-close"],onClick:n,extension:"narrow",iconOnly:!0,label:o("SelectionBar.close")},i.a.createElement(le.g,{icon:"cross",width:"14",height:"14",color:"coolGrey"})),i.a.createElement("h4",null,o("Share.contacts.permissionRequired.title")),i.a.createElement("p",null,o("Share.contacts.permissionRequired.desc")),i.a.createElement(le.d,{className:_e.a["permission-required-popin-accept"],label:o("Share.contacts.permissionRequired.action"),onClick:r}))};qn.propTypes={onClose:ke.a.func.isRequired,onAccept:ke.a.func.isRequired};var Yn=function(e){return i.a.createElement(Be.a.DropdownIndicator,e,i.a.createElement(le.g,{icon:"bottom",color:An.a.coolGrey}))},Vn=function(e){return i.a.createElement(Be.a.Option,e,i.a.createElement("div",{className:ue()(_e.a["select-option"],Un({},_e.a["select-option--selected"],e.isSelected))},i.a.createElement("div",{className:_e.a["select-option-label"]},e.label),i.a.createElement("div",{className:_e.a["select-option-desc"]},e.data.desc)))},Hn={option:function(e,t){return Mn({},e,{color:"black",backgroundColor:t.isFocused?An.a.paleGrey:null,padding:0,borderBottom:0===t.options.findIndex(function(e){return e.value===t.value})?"1px solid ".concat(An.a.silver):null})},menu:function(e){return Mn({},e,{width:"204%"})}},Qn=function(e){var t=e.options,n=e.onChange;return i.a.createElement("div",{className:_e.a["select-wrapper"]},i.a.createElement(Be.b,{name:"select",classNamePrefix:"needsclick react-select",components:{DropdownIndicator:Yn,Option:Vn},styles:Hn,defaultValue:t[0],isSearchable:!1,onChange:function(e){n(e.value)},options:t}))};Qn.propTypes={onChange:ke.a.func,options:ke.a.array.isRequired},Qn.defaultProps={onChange:console.log,value:""};var Wn=function(e){return i.a.createElement(le.d,{onClick:function(){e.onSubmit()},busy:e.loading,label:e.label,disabled:e.disabled})};Wn.propTypes={onSubmit:ke.a.func.isRequired,label:ke.a.string,loading:ke.a.bool,disabled:ke.a.bool},Wn.defaultProps={label:"Submit",loading:!1};var Gn=function(e){function t(){var e,n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,c=new Array(i),u=0;u<i;u++)c[u]=arguments[u];return r=this,a=(e=Ln(t)).call.apply(e,[this].concat(c)),n=!a||"object"!==Nn(a)&&"function"!=typeof a?In(r):a,Un(In(n),"sharingTypes",[{value:"two-way",label:n.context.t("Share.type.two-way"),desc:n.context.t("Share.type.desc.two-way"),disabled:!1},{value:"one-way",label:n.context.t("Share.type.one-way"),desc:n.context.t("Share.type.desc.one-way"),disabled:!1}]),Un(In(n),"initialState",{recipients:[],sharingType:"two-way",loading:!1,showPermissionPopin:!1,hasPopinBeenShowed:!1}),Un(In(n),"state",Mn({},n.initialState)),Un(In(n),"reset",function(){n.setState(Mn({},n.initialState))}),Un(In(n),"onInputFocus",function(){!0!==n.props.needsContactsPermission||n.state.hasPopinBeenShowed||n.setState(function(e){return Mn({},e,{showPermissionPopin:!0})})}),Un(In(n),"onChange",function(e){n.setState(function(t){return Mn({},t,{sharingType:e})})}),Un(In(n),"onSubmit",function(){n.sendSharingLink()}),Un(In(n),"sanitizeRecipient",function(e){var t=e.email.match(/\s(.+@.+)\s/g);return e.email=t.length?t[0].trim().replace(/\s.+/g,"").replace(/^[\W]|[\W]$/g,""):e.email,e}),Un(In(n),"onRecipientPick",function(e){n.state.recipients.find(function(t){return t===e})||n.setState(function(t){return Mn({},t,{recipients:[].concat(Rn(t.recipients),[e])})})}),Un(In(n),"onRecipientRemove",function(e){var t=n.state.recipients.findIndex(function(t){return t===e});n.setState(function(e){return Mn({},e,{recipients:[].concat(Rn(e.recipients.slice(0,t)),Rn(e.recipients.slice(t+1)))})})}),Un(In(n),"share",function(){var e=n.props,t=e.document,r=e.documentType,o=e.sharingDesc,a=e.onShare,i=e.createContact,c=n.state,u=c.recipients,l=c.sharingType;0!==u.length&&(n.setState(function(e){return Mn({},e,{loading:!0})}),Promise.all(u.map(function(e){return e.id?e:i("io.cozy.contacts",{email:[{address:e.email,primary:!0}]}).then(function(e){return e.data})})).then(function(e){return a(t,e,l,o)}).then(function(){1===u.length?Pe.a.success("".concat(r,".share.shareByEmail.success"),{email:u[0].id?Lr(u[0]):u[0].email}):Pe.a.success("".concat(r,".share.shareByEmail.genericSuccess"),{count:u.length}),n.reset()}).catch(function(e){throw Pe.a.error("Error.generic"),n.reset(),e}))}),Un(In(n),"closePermissionPopin",function(){n.setState(function(e){return Mn({},e,{showPermissionPopin:!1,hasPopinBeenShowed:!0})})}),Un(In(n),"onPermissionRequire",zn(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.props.renewAuthorization(n.context.client);case 3:n.closePermissionPopin(),Pe.a.success("Share.contacts.permissionRequired.success"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),Pe.a.error("Error.generic");case 10:case"end":return e.stop()}},e,null,[[0,7]])}))),n}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fn(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this,t=this.context.t,n=this.props,r=n.contacts,o=n.documentType,a=this.state,c=a.recipients,u=a.showPermissionPopin;return i.a.createElement("div",{className:_e.a["coz-form-group"]},i.a.createElement("div",{className:_e.a["coz-form"]},i.a.createElement(Bn,{label:t("".concat(o,".share.shareByEmail.email")),placeholder:0===c.length?t("".concat(o,".share.shareByEmail.emailPlaceholder")):"",onFocus:this.onInputFocus,onPick:function(t){return e.onRecipientPick(t)},onRemove:function(t){return e.onRecipientRemove(t)},contacts:r,recipients:c})),u&&i.a.createElement(qn,{onClose:this.closePermissionPopin,onAccept:this.onPermissionRequire}),i.a.createElement("div",{className:_e.a["share-type-control"]},i.a.createElement(Qn,{options:this.sharingTypes,onChange:this.onChange}),i.a.createElement(Wn,{label:t("".concat(o,".share.shareByEmail.send")),onSubmit:this.share,loading:this.state.loading,disabled:0===c.length})))}}])&&Dn(n.prototype,r),c&&Dn(n,c),t}();Gn.propTypes={contacts:ke.a.array,document:ke.a.object.isRequired,documentType:ke.a.string.isRequired,sharingDesc:ke.a.string.isRequired,onShare:ke.a.func.isRequired,createContact:ke.a.func.isRequired,needsContactsPermission:ke.a.bool,renewAuthorization:ke.a.func.isRequired},Gn.defaultProps={contacts:[]};var Kn=Object(Ue.connect)(null,function(e){return{renewAuthorization:function(t){return e(Cn(t))}}})(Gn);function Xn(e){return(Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zn(){return(Zn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Jn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $n(e,t){return!t||"object"!==Xn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function er(e){return(er=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tr(e,t){return(tr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var nr=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),$n(this,er(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tr(e,t)}(t,a["PureComponent"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.isOwner,n=void 0!==t&&t,r=e.recipients,o=e.document,a=e.documentType,c=e.onRevoke,u=e.className,l=this.context.t;return i.a.createElement("div",{className:u},r.length>1&&i.a.createElement(le.n,null,l("".concat(a,".share.whoHasAccess.title"),{smart_count:r.length})),r.map(function(e,t){return i.a.createElement(Qt,Zn({},e,{key:"key_r_".concat(t),isOwner:n,document:o,documentType:a,onRevoke:c}))}))}}])&&Jn(n.prototype,r),o&&Jn(n,o),t}();function rr(e){return(rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function or(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ar(e,t){return!t||"object"!==rr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ir(e){return(ir=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function cr(e,t){return(cr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n("T1qB");var ur=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ar(this,ir(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cr(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.context.t,t=this.props,n=t.document,r=t.isOwner,o=t.sharingDesc,a=t.contacts,c=t.createContact,u=t.link,l=t.recipients,s=t.documentType,f=void 0===s?"Document":s,p=t.needsContactsPermission,d=t.hasSharedParent,m=t.hasSharedChild,h=t.onClose,b=t.onShare,y=t.onRevoke,v=t.onShareByLink,w=t.onRevokeLink;return i.a.createElement(Se.c,{title:e("".concat(f,".share.title")),dismissAction:h,into:"body",size:"small",spacing:"small",mobileFullscreen:!0},(d||m)&&i.a.createElement("div",{className:_e.a["share-byemail-onlybylink"]},e("".concat(f,".share.shareByEmail.onlyByLink"),{type:e("".concat(f,".share.shareByEmail.type.").concat("directory"===n.type?"folder":"file"))})," ",i.a.createElement("strong",null,e("".concat(f,".share.shareByEmail.").concat(d?"hasSharedParent":"hasSharedChild")))),i.a.createElement(Se.a,{className:ue()(_e.a["share-modal-content"],_e.a["share-moral-override-bottom"])},"Albums"!==f&&!d&&!m&&i.a.createElement(Kn,{document:n,documentType:f,sharingDesc:o,contacts:a,createContact:c,onShare:b,needsContactsPermission:p}),i.a.createElement("div",{className:_e.a["share-modal-separator"]}),i.a.createElement("div",{className:_e.a["share-modal-secondary"]},i.a.createElement("div",{className:ue()(_e.a["share-modal-margins"],"u-pb-1")},i.a.createElement(Me,{document:n,documentType:f,checked:null!==u,link:u,onEnable:v,onDisable:w}),"Albums"!==f&&i.a.createElement(nr,{className:"u-mt-1",isOwner:r,recipients:l,document:n,documentType:f,onRevoke:y})))))}}])&&or(n.prototype,r),o&&or(n,o),t}();function lr(e){return(lr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fr(e,t){return!t||"object"!==lr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function pr(e){return(pr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dr(e,t){return(dr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}ur.propTypes={document:ke.a.object.isRequired,isOwner:ke.a.bool,sharingDesc:ke.a.string,contacts:ke.a.array.isRequired,createContact:ke.a.func.isRequired,recipients:ke.a.array.isRequired,link:ke.a.string,documentType:ke.a.string,needsContactsPermission:ke.a.bool,hasSharedParent:ke.a.bool,hasSharedChild:ke.a.bool,onClose:ke.a.func.isRequired,onShare:ke.a.func.isRequired,onRevoke:ke.a.func.isRequired,onShareByLink:ke.a.func.isRequired,onRevokeLink:ke.a.func.isRequired};var mr=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),fr(this,pr(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dr(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.context,t=e.t,n=e.f,r=this.props,o=r.onClose,a=r.sharingType,c=r.owner,u=r.recipients,l=r.document,s=r.documentType,f=void 0===s?"Document":s,p=r.onRevoke;return i.a.createElement(Se.c,{title:t("".concat(f,".share.details.title")),secondaryAction:o,className:_e.a["share-modal"],into:"body",size:"small",mobileFullscreen:!0},i.a.createElement(Se.a,{className:_e.a["share-modal-content"]},i.a.createElement("div",{className:_e.a["share-details"]},i.a.createElement(Yt,{name:t("".concat(f,".share.sharedBy"),{name:Dr(c)}),url:c.instance}),i.a.createElement("div",{className:_e.a["share-details-created"]},t("".concat(f,".share.details.createdAt"),{date:n(l.created_at||null,"Do MMMM YYYY")})),i.a.createElement("div",{className:_e.a["share-details-perm"]},t("".concat(f,".share.details.").concat("one-way"===a?"ro":"rw"))),i.a.createElement("div",{className:_e.a["share-details-perm-desc"]},t("".concat(f,".share.details.desc.").concat("one-way"===a?"ro":"rw")))),i.a.createElement("hr",{className:_e.a.divider}),i.a.createElement(nr,{title:t("Share.recipients.accessCount",{count:u.length}),recipients:u,document:l,documentType:f,onRevoke:p})))}}])&&sr(n.prototype,r),o&&sr(n,o),t}();var hr=n("B7OX"),br=n("3Jea"),yr=n.n(br),vr=new Ot.a({id:"icon-link_784d8d07b6c9bf8edf4207327b6add94",use:"icon-link_784d8d07b6c9bf8edf4207327b6add94-usage",viewBox:"0 0 16 16",content:'<symbol viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="icon-link_784d8d07b6c9bf8edf4207327b6add94">\n    <defs>\n        <path d="M8.87940867,3.87953579 C8.48888438,4.27006009 7.8557194,4.27006009 7.46519511,3.87953579 C7.07467081,3.4890115 7.07467081,2.85584652 7.46519511,2.46532223 L9.05304103,0.877476309 C10.2226142,-0.292096843 12.1218341,-0.292252339 13.289659,0.875572597 L14.4691583,2.05507187 C15.6394269,3.22534048 15.6355011,5.12344332 14.4628542,6.29609024 L10.9986358,9.7603087 C9.4643126,11.2946319 6.92867661,11.3430173 5.46519511,9.87953579 C5.07467081,9.4890115 5.07467081,8.85584652 5.46519511,8.46532223 C5.8557194,8.07479794 6.48888438,8.07479794 6.87940867,8.46532223 C7.54950929,9.13542285 8.81932532,9.11119201 9.5844222,8.34609513 L13.0486407,4.88187668 C13.4415455,4.48897179 13.4428522,3.85719292 13.0549447,3.46928543 L11.8754455,2.28978616 C11.488721,1.90306165 10.855831,1.90311347 10.4672546,2.29168987 L8.87940867,3.87953579 Z M6.46519511,11.4653222 C6.8557194,11.0747979 7.48888438,11.0747979 7.87940867,11.4653222 C8.26993296,11.8558465 8.26993296,12.4890115 7.87940867,12.8795358 L6.29156275,14.4673817 C5.12198959,15.6369549 3.22276968,15.6371104 2.05494474,14.4692854 L0.875445471,13.2897862 C-0.294823143,12.1195175 -0.290897366,10.2214147 0.881749556,9.04876778 L4.34596801,5.58454933 C5.88029117,4.05022616 8.41592716,4.00184073 9.87940867,5.46532223 C10.269933,5.85584652 10.269933,6.4890115 9.87940867,6.87953579 C9.48888438,7.27006009 8.8557194,7.27006009 8.46519511,6.87953579 C7.79509448,6.20943517 6.52527845,6.23366601 5.76018157,6.99876289 L2.29596312,10.4629813 C1.90305823,10.8558862 1.90175154,11.4876651 2.28965903,11.8755726 L3.4691583,13.0550719 C3.85588281,13.4417964 4.48877278,13.4417446 4.87734918,13.0531682 L6.46519511,11.4653222 Z" id="icon-link_784d8d07b6c9bf8edf4207327b6add94_path-1" />\n    </defs>\n    <g id="icon-link_784d8d07b6c9bf8edf4207327b6add94_🍦-icons" stroke="none" stroke-width="1" fill-rule="evenodd">\n        <g id="icon-link_784d8d07b6c9bf8edf4207327b6add94_icons/16/link">\n            <mask id="icon-link_784d8d07b6c9bf8edf4207327b6add94_mask-2">\n                <use xlink:href="#icon-link_784d8d07b6c9bf8edf4207327b6add94_path-1" />\n            </mask>\n            <use id="icon-link_784d8d07b6c9bf8edf4207327b6add94_Mask" fill-rule="nonzero" xlink:href="#icon-link_784d8d07b6c9bf8edf4207327b6add94_path-1" />\n        </g>\n    </g>\n</symbol>'}),wr=(Et.a.add(vr),vr),gr=function(e,t){var n=e.className,r=e.docId,o=e.recipients,a=e.link,c=t.t;return i.a.createElement("span",{className:ue()(n,yr.a["shared-status"])},o.length>1&&i.a.createElement("a",{"data-tip":!0,"data-for":"members".concat(r),className:yr.a["shared-status-label"]},c("Share.members.count",{count:o.length})),o.length>1&&i.a.createElement(pt,{id:"members".concat(r)},i.a.createElement(dt,{recipientNames:o.map(function(e){return Dr(e)})})),a&&i.a.createElement(hr.a,{icon:wr}))};function Or(){return(Or=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function _r(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Er(e){return(Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kr(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Sr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function xr(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function jr(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){xr(a,r,o,i,c,"next",e)}function c(e){xr(a,r,o,i,c,"throw",e)}i(void 0)})}}function Cr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){zr(e,t,n[t])})}return e}function Pr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ar(e){return(Ar=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Nr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Tr(e,t){return(Tr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function zr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"g",function(){return Dr}),n.d(t,"i",function(){return Lr}),n.d(t,"h",function(){return Ir}),n.d(t,"f",function(){return Br}),n.d(t,"d",function(){return qr}),n.d(t,"e",function(){return Yr}),n.d(t,"c",function(){return Vr}),n.d(t,"a",function(){return Hr}),n.d(t,"b",function(){return Gr});var Rr=function(e){return function(t){return t[e]&&0!==t[e].length?t[e].find(function(e){return e.primary})||t[e][0]:""}},Dr=function(e){var t=e.name,n=e.public_name,r=e.email;return t||n||r},Lr=function(e){return Array.isArray(e.email)?Rr("email")(e).address:e.email},Ir=function(e){return Array.isArray(e.cozy)?Rr("cozy")(e).url:e.url},Fr=function(e){return function(e,t){var n=Object(s.c)();n&&n.push(["trackEvent",Mr(e)?"Drive":"Photos",t,"".concat(t).concat(Mr(e)?"File":"Album")])}(e,"shareByLink")},Mr=function(e){return"io.cozy.files"===e._type},Ur=u()(),Br=function(e){function t(e,n){var r,a,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,i=Ar(t).call(this,e,n),r=!i||"object"!==Er(i)&&"function"!=typeof i?Nr(a):i,zr(Nr(r),"dispatch",function(e){return r.setState(function(t){return Cr({},t,I(t,e))})}),zr(Nr(r),"getFilesPaths",function(){var e=jr(o.a.mark(function e(t){var n,a,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map(function(e){return e.dir_id}).filter(function(e,t,n){return n.indexOf(e)===t}),e.next=3,r.context.client.collection(r.props.doctype).all({keys:n});case 3:return a=e.sent,i=t.map(function(e){var t=a.data.find(function(t){return t.id===e.dir_id}).path;return"/"===t?"/".concat(e.name):"".concat(t,"/").concat(e.name)}),e.abrupt("return",i);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),zr(Nr(r),"share",function(){var e=jr(o.a.mark(function e(t,n,a,i){var c,u;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(c=H(r.state,t.id))){e.next=3;break}return e.abrupt("return",r.addRecipients(c,n,a));case 3:return e.next=5,r.context.client.collection("io.cozy.sharings").share(t,n,a,i,"/preview");case 5:if(u=e.sent,e.t0=r,e.t1=g,e.t2=u.data,e.t3=t.path,e.t3){e.next=14;break}return e.next=13,r.getFilesPaths([t]);case 13:e.t3=e.sent;case 14:return e.t4=e.t3,e.t5=(0,e.t1)(e.t2,e.t4),e.t0.dispatch.call(e.t0,e.t5),e.abrupt("return",u.data);case 18:case"end":return e.stop()}},e)}));return function(t,n,r,o){return e.apply(this,arguments)}}()),zr(Nr(r),"addRecipients",function(){var e=jr(o.a.mark(function e(t,n,a){var i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.context.client.collection("io.cozy.sharings").addRecipients(t,n,a);case 2:i=e.sent,r.dispatch(O(i.data));case 4:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()),zr(Nr(r),"revoke",function(){var e=jr(o.a.mark(function e(t,n,a){var i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=W(r.state,n),e.next=3,r.context.client.collection("io.cozy.sharings").revokeRecipient(i,a);case 3:if(e.t0=r,e.t1=_,e.t2=i,e.t3=a,e.t4=t.path,e.t4){e.next=12;break}return e.next=11,r.getFilesPaths([t]);case 11:e.t4=e.sent;case 12:e.t5=e.t4,e.t6=(0,e.t1)(e.t2,e.t3,e.t5),e.t0.dispatch.call(e.t0,e.t6);case 15:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()),zr(Nr(r),"revokeSelf",function(){var e=jr(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Y(r.state,t.id),e.next=3,r.context.client.collection("io.cozy.sharings").revokeSelf(n);case 3:r.dispatch(E(n));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),zr(Nr(r),"shareByLink",function(){var e=jr(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Fr(t),e.next=3,r.context.client.collection("io.cozy.permissions").createSharingLink(t);case 3:return n=e.sent,r.dispatch(k(n.data)),e.abrupt("return",n);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),zr(Nr(r),"revokeSharingLink",function(){var e=jr(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=G(r.state,t.id),e.next=3,Promise.all(n.map(function(e){return r.context.client.collection("io.cozy.permissions").destroy(e)}));case 3:r.dispatch(S(n));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());var c=r.context.client.options.uri,u=e.documentType||"Document";return r.state={byDocId:{},sharings:[],permissions:[],sharedFolderPaths:[],documentType:u,isOwner:function(e){return F(r.state,e)},canReshare:function(e){return M(r.state,e,c)},getOwner:function(e){return U(r.state,e)},getSharingType:function(e){return V(r.state,e,c)},getRecipients:function(e){return B(r.state,e)},getSharingLink:function(e){return q(r.state,e,u)},hasSharedParent:function(e){return X(r.state,e)},hasSharedChild:function(e){return Z(r.state,e)},share:r.share,revoke:r.revoke,revokeSelf:r.revokeSelf,shareByLink:r.shareByLink,revokeSharingLink:r.revokeSharingLink},r}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tr(e,t)}(t,a["Component"]),n=t,(r=[{key:"componentDidMount",value:function(){var e=jr(o.a.mark(function e(){var t,n,r,a,i,c,u,l,s,f,p;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.context.client,n=this.props.doctype,e.next=4,Promise.all([t.collection("io.cozy.sharings").findByDoctype(n),t.collection("io.cozy.permissions").findLinksByDoctype(n),t.collection("io.cozy.permissions").findApps()]);case 4:if(r=e.sent,a=Sr(r,3),i=a[0],c=a[1],u=a[2],this.dispatch(w({instanceUri:t.options.uri,sharings:i.data,permissions:c.data,apps:u.data})),"io.cozy.files"===n){e.next=12;break}return e.abrupt("return");case 12:return l=i.data.map(function(e){return $(e)}).reduce(function(e,t){return e.concat(t)},[]),e.next=15,t.collection(n).all({keys:l});case 15:return s=e.sent,f=s.data.filter(function(e){return"directory"===e.type}).map(function(e){return e.path}),e.next=19,this.getFilesPaths(s.data.filter(function(e){return"directory"!==e.type}));case 19:p=e.sent,this.dispatch({type:"RECEIVE_PATHS",paths:[].concat(kr(f),kr(p))});case 21:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return i.a.createElement(Ur.Provider,{value:Cr({},this.state)},this.props.children)}}])&&Pr(n.prototype,r),c&&Pr(n,c),t}(),qr=function(e){var t=e.children;return i.a.createElement(Ur.Consumer,null,function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{sharings:[]}).sharings;return t({sharedDocuments:e.map(function(e){return e.attributes.rules[0].values[0]})})})},Yr=function(e){var t=e.docId,n=e.className;return i.a.createElement(Ur.Consumer,null,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.byDocId,o=e.getRecipients,a=e.getSharingLink;return r&&r[t]?i.a.createElement(gr,{className:n,recipients:o(t),docId:t,link:null!==a(t)}):i.a.createElement("span",{className:n},"—")})},Vr=function(e){var t=e.docId,n=_r(e,["docId"]);return i.a.createElement(Ur.Consumer,null,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.byDocId,o=e.isOwner;return r&&r[t]?i.a.createElement(de,Or({byMe:o(t)},n)):null})},Hr=function(e,t){var n=t.t,r=e.docId,o=_r(e,["docId"]);return i.a.createElement(Ur.Consumer,null,function(e){var t=e.byDocId,a=e.documentType,c=e.isOwner;return t[r]?c(r)?i.a.createElement(ve,Or({label:n("".concat(a,".share.sharedByMe"))},o)):i.a.createElement(we,Or({label:n("".concat(a,".share.sharedWithMe"))},o)):i.a.createElement(ge,Or({label:n("".concat(a,".share.cta"))},o))})},Qr=function(e){var t=e.document,n=_r(e,["document"]);return i.a.createElement(Ur.Consumer,null,function(e){var r=e.documentType,o=e.isOwner,a=e.getRecipients,c=e.getSharingLink,u=e.share,s=e.revoke,f=e.shareByLink,p=e.revokeSharingLink,d=e.hasSharedParent,m=e.hasSharedChild;return i.a.createElement(l.Query,{query:function(e){return e.all("io.cozy.contacts")}},function(e,l){var h=e.data,b=e.fetchStatus,y=e.lastError,v=l.createDocument;return i.a.createElement(ur,Or({document:t,documentType:r,contacts:h,createContact:v,recipients:a(t.id),link:c(t.id),isOwner:o(t.id),needsContactsPermission:"failed"===b&&403===y.status,hasSharedParent:d(t),hasSharedChild:m(t),onShare:u,onRevoke:s,onShareByLink:f,onRevokeLink:p},n))})})},Wr=function(e){var t=e.document,n=_r(e,["document"]);return i.a.createElement(Ur.Consumer,null,function(e){var r=e.documentType,o=e.getOwner,a=e.getSharingType,c=e.getRecipients,u=e.revokeSelf;return i.a.createElement(mr,Or({document:t,documentType:r,owner:o(t.id),sharingType:a(t.id),recipients:c(t.id),onRevoke:u},n))})},Gr=function(e){var t=e.document,n=_r(e,["document"]);return i.a.createElement(Ur.Consumer,null,function(e){var r=e.byDocId,o=e.isOwner,a=e.canReshare;return!r[t.id]||o(t.id)||a(t.id)?i.a.createElement(Qr,Or({document:t},n)):i.a.createElement(Wr,Or({document:t},n))})}},"Ow0/":function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"d",function(){return o}),n.d(t,"b",function(){return a}),n.d(t,"a",function(){return i});var r="registry://drive",o="Cozy Drive",a="1224102389",i="market://details?id=io.cozy.drive.mobile"},"Q5R/":function(e,t,n){e.exports={"upload-queue":"upload-queue--3bKZ8","upload-queue-item":"upload-queue-item--12cMu","item-loading":"item-loading--3FbFe","item-canceled":"item-canceled--3bCrY","item-failed":"item-failed--3Y9vK","item-conflict":"item-conflict--NBeLA","item-network":"item-network--SCnkc","item-loaded":"item-loaded--1KetB",spin:"spin--1JzSZ","upload-queue--visible":"upload-queue--visible--v4xZr","upload-queue-header":"upload-queue-header--FOzzt","upload-queue-header-inner":"upload-queue-header-inner--3EoLE","btn-close":"btn-close--1Pngc","upload-queue-progress":"upload-queue-progress--4yPCZ","upload-queue-content":"upload-queue-content--1p3kn","upload-queue--collapsed":"upload-queue--collapsed--2xa0I","upload-queue-list":"upload-queue-list--2vmTJ","upload-queue-item--error":"upload-queue-item--error--2Zajh","upload-queue-item--done":"upload-queue-item--done--1VrfD","item-cell":"item-cell--1bBPU","item-file":"item-file--fFD25","item-type-audio":"item-type-audio--3Ur4P","item-type-bin":"item-type-bin--2RmX6","item-type-code":"item-type-code--l8SJY","item-type-files":"item-type-files--3znqv","item-type-folder":"item-type-folder--3CNeE","item-type-image":"item-type-image--1YiVh","item-type-pdf":"item-type-pdf--31vKm","item-type-slide":"item-type-slide--2bdnC","item-type-sheet":"item-type-sheet--2txJP","item-type-text":"item-type-text--13I0V","item-type-video":"item-type-video--1WhHP","item-type-zip":"item-type-zip--PeYd4","item-ext":"item-ext--2QO0X","item-status":"item-status--3wjiT","item-pending":"item-pending--1hu5q"}},QDdI:function(e,t,n){"use strict";n("o0o1"),n("q3u0"),n("1eh9");var r=function(e){return{type:"SET_CLIENT",client:e}},o=function(e){return{type:"SET_TOKEN",token:e}},a=function(){return{type:"REVOKE"}};function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u={authorized:!1,revoked:!1,client:null,token:null,onboarding:{code:null,state:null,cozy_url:null}},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CLIENT":return i({},e,{authorized:!0,revoked:!1,client:t.client});case"SET_TOKEN":return i({},e,{token:t.token});case"REVOKE":return i({},e,{revoked:!0});case"UNREVOKE":return i({},e,{revoked:!1});case"SET_ONBOARDING":return i({},e,{onboarding:{code:t.code,state:t.state,cozy_url:t.cozy_url}});default:return e}};n("cSBT");n.d(t,"a",function(){return"UNLINK"}),n.d(t,"d",function(){return r}),n.d(t,"e",function(){return o}),n.d(t,"c",function(){return a}),n.d(t,"b",function(){return l})},QmKc:function(e,t,n){e.exports={"fil-content-table":"fil-content-table--1HRVh","fil-content-head":"fil-content-head--3qU4k","fil-content-mobile-head":"fil-content-mobile-head--stPDy","fil-content-body":"fil-content-body--2o5N_","fil-content-row-head":"fil-content-row-head--2BxvZ","fil-content-row":"fil-content-row--3tUJY","fil-content-row-selected":"fil-content-row-selected--2YE0h","fil-content-cell":"fil-content-cell--HBfF4","fil-content-header":"fil-content-header--2G5CB","fil-content-mobile-header":"fil-content-mobile-header--3J9WD","fil-content-file-select":"fil-content-file-select--3xRxR","fil-content-row--center":"fil-content-row--center--38ZfS","fil-content-row-actioned":"fil-content-row-actioned--1ZmSl","fil-content-row-disabled":"fil-content-row-disabled--zwfeB","fil-content-ext":"fil-content-ext--3vi7B","fil-sort-menu":"fil-sort-menu--3vJKf","fil-sort-menu-item":"fil-sort-menu-item--3wQ6G","fil-sort-menu-item-selected":"fil-sort-menu-item-selected---yp6_","fil-content-header-sortableasc":"fil-content-header-sortableasc--3njaT","fil-content-header-sortabledesc":"fil-content-header-sortabledesc--n_RWE","fil-content-header-sortasc":"fil-content-header-sortasc--1wGfS","fil-content-header-sortdesc":"fil-content-header-sortdesc--HO-Uf","fil-content-file":"fil-content-file--2cyZM","fil-content-file-openable":"fil-content-file-openable--2I7DZ","fil-content-shared":"fil-content-shared--nroRM","fil-content-date":"fil-content-date--269HK","fil-content-size":"fil-content-size--3keGT","fil-content-status":"fil-content-status--1etSl","fil-content-header-status":"fil-content-header-status--2dAhY","fil-content-offline":"fil-content-offline--LQivN","fil-content-file-action":"fil-content-file-action--V70XH","fil-content-header-action":"fil-content-header-action--3l7K_","fil-content-body--selectable":"fil-content-body--selectable--10Pwu","fil-file-audio":"fil-file-audio--2ynKs","fil-file-bin":"fil-file-bin--2msQD","fil-file-code":"fil-file-code--1GWWe","fil-file-files":"fil-file-files--2BfF8","fil-file-folder":"fil-file-folder--2YJk4","fil-file-image":"fil-file-image--3PprQ","fil-file-pdf":"fil-file-pdf--3sspi","fil-file-slide":"fil-file-slide--1uDqC","fil-file-sheet":"fil-file-sheet--YTjFN","fil-file-text":"fil-file-text--2S1hV","fil-file-video":"fil-file-video--s18b6","fil-file-zip":"fil-file-zip--1_4jU","fil-file":"fil-file--1wFvs","fil-file-preview":"fil-file-preview--OgBOf","fil-file-filename":"fil-file-filename--17PQJ","fil-file-filename-wrapper":"fil-file-filename-wrapper--2l4sx","fil-file-filename-and-ext":"fil-file-filename-and-ext--3XCEN","fil-file-filename-spinner":"fil-file-filename-spinner--1h6S0","fil-file-path":"fil-file-path--1SRH0","fil-file-infos":"fil-file-infos--2LE_d","fil-content-file-placeholder":"fil-content-file-placeholder--wth58",placeHolderShimmer:"placeHolderShimmer--AXJs0","fil-content-table-selection":"fil-content-table-selection--YjKJI","fil-content-sharestatus":"fil-content-sharestatus--_2V0-"}},QwUF:function(e,t,n){"use strict";var r=n("o0o1"),o=n.n(r),a=n("Kn6A"),i=n("/beP"),c=n("mz5Q"),u=n.n(c),l=(n("snfs"),n("1aVK"),n("qxHO")),s=n("ommj"),f=n("2U19"),p=n("Yo2A"),d=n("Q2ax"),m=n("WrkV"),h=n("XOpu"),b=Object(h.c)()(function(e){var t=e.t,n=e.onClose;return u.a.createElement(m.c,{title:t("quotaalert.title"),description:u.a.createElement("p",null,t("quotaalert.desc")),primaryText:t("quotaalert.confirm"),primaryAction:n,secondaryAction:n})});n("Z7XG");function y(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function v(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){y(a,r,o,i,c,"next",e)}function c(e){y(a,r,o,i,c,"throw",e)}i(void 0)})}}n.d(t,"l",function(){return w}),n.d(t,"n",function(){return g}),n.d(t,"m",function(){return O}),n.d(t,"p",function(){return _}),n.d(t,"r",function(){return E}),n.d(t,"q",function(){return k}),n.d(t,"e",function(){return S}),n.d(t,"g",function(){return x}),n.d(t,"f",function(){return j}),n.d(t,"h",function(){return C}),n.d(t,"j",function(){return P}),n.d(t,"i",function(){return A}),n.d(t,"d",function(){return N}),n.d(t,"b",function(){return T}),n.d(t,"s",function(){return z}),n.d(t,"a",function(){return R}),n.d(t,"t",function(){return D}),n.d(t,"c",function(){return L}),n.d(t,"k",function(){return I}),n.d(t,"v",function(){return F}),n.d(t,"w",function(){return M}),n.d(t,"x",function(){return U}),n.d(t,"u",function(){return q});var w="OPEN_FOLDER",g="OPEN_FOLDER_SUCCESS",O="OPEN_FOLDER_FAILURE",_="SORT_FOLDER",E="SORT_FOLDER_SUCCESS",k="SORT_FOLDER_FAILURE",S="FETCH_RECENT",x="FETCH_RECENT_SUCCESS",j="FETCH_RECENT_FAILURE",C="FETCH_SHARINGS",P="FETCH_SHARINGS_SUCCESS",A="FETCH_SHARINGS_FAILURE",N="FETCH_MORE_FILES_SUCCESS",T="CREATE_FOLDER_SUCCESS",z="TRASH_FILES_SUCCESS",R="ADD_FILE",D="UPDATE_FILE",L="DELETE_FILE",I={cancelSelection:!0,hideActionMenu:!0},F=function(e){return function(){var t=v(o.a.mark(function t(n,r){var i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n({type:w,folderId:e,meta:{cancelSelection:!0}}),t.prev=1,t.next=4,Object(a.b)(r()).getFolder(e);case 4:return i=t.sent,t.abrupt("return",n({type:g,folder:i,fileCount:i.contents.meta.count||0,files:i.contents.data}));case 8:return t.prev=8,t.t0=t.catch(1),Object(l.b)(t.t0,{context:O}),t.abrupt("return",n({type:O,error:t.t0}));case 12:case"end":return t.stop()}},t,null,[[1,8]])}));return function(e,n){return t.apply(this,arguments)}}()},M=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc";return function(){var r=v(o.a.mark(function r(i,c){var u;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i({type:_,folderId:e,sortAttribute:t,sortOrder:n,meta:{cancelSelection:!0}}),r.prev=1,r.next=4,Object(a.b)(c()).getSortedFolder(e,t,n);case 4:return u=r.sent,r.abrupt("return",i({type:E,files:u}));case 8:return r.prev=8,r.t0=r.catch(1),Object(l.b)(r.t0,{context:k}),r.abrupt("return",i({type:k,error:r.t0}));case 12:case"end":return r.stop()}},r,null,[[1,8]])}));return function(e,t){return r.apply(this,arguments)}}()},U=function(e,t){return function(n){n(Object(f.a)(e,t,function(){return null},function(e,t,r,o,a){return n(B(e,t,r,o,a))}))}},B=function(e,t,n,r,o){return function(a){t.length>0?a(Object(p.d)(u.a.createElement(b,null))):n.length>0?d.a.info("upload.alert.success_conflicts",{smart_count:e.length,conflictNumber:n.length}):r.length>0?d.a.info("upload.alert.network"):o.length>0?d.a.info("upload.alert.errors"):d.a.success("upload.alert.success",{smart_count:e.length})}},q=function(e){return function(){var t=v(o.a.mark(function t(n,r){var c,u,l,f;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(c=r().view.files.find(function(t){return Object(s.b)(t)&&t.name===e}),u=r().view.fileCount,!c){t.next=6;break}throw d.a.error("alert.folder_name",{folderName:e}),n({type:"CREATE_FOLDER_FAILURE_DUPLICATE",folderName:e}),new Error("alert.folder_name");case 6:return n({type:"CREATE_FOLDER",name:e}),t.prev=7,t.next=10,cozy.client.files.createDirectory({name:e,dirID:r().view.displayedFolder.id});case 10:l=t.sent,f=Object(i.f)(r()),n({type:T,folder:Object(a.a)(l),currentFileCount:u,currentSort:f}),t.next=19;break;case 15:throw t.prev=15,t.t0=t.catch(7),t.t0.response&&409===t.t0.response.status?(d.a.error("alert.folder_name",{folderName:e}),n({type:"CREATE_FOLDER_FAILURE_DUPLICATE",folderName:e})):(d.a.error("alert.folder_generic"),n({type:"CREATE_FOLDER_FAILURE_GENERIC"})),t.t0;case 19:case"end":return t.stop()}},t,null,[[7,15]])}));return function(e,n){return t.apply(this,arguments)}}()}},RPnM:function(e,t,n){"use strict";var r=n("kKu1"),o=n.n(r),a=n("mz5Q"),i=n.n(a),c=n("+FsC");function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(){return i.a.createElement("div",{className:o.a["pho-list-spinner"]})},m=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=s(this,f(t).call(this,e))).state={fetching:!1},n}var n,r,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,a["Component"]),n=t,(r=[{key:"handleClick",value:function(){var e=this;this.setState({fetching:!0}),this.props.onClick().then(function(){return e.setState({fetching:!1})})}},{key:"render",value:function(){var e=this,t=this.props,n=t.label,r=t.width,a=void 0===r?"100%":r,u=this.state.fetching;return i.a.createElement("div",{style:{width:a},className:o.a["pho-list-morebutton"]},u&&i.a.createElement(c.d,{disabled:!0,theme:"secondary",label:i.a.createElement(d,{nomargin:!0})}),!u&&i.a.createElement(c.d,{theme:"secondary",onClick:function(){return e.handleClick()},label:n}))}}])&&l(n.prototype,r),u&&l(n,u),t}();t.a=m},SRpc:function(e,t,n){"use strict";var r=n("o0o1"),o=n.n(r),a=n("mz5Q"),i=n.n(a),c=n("dtw8"),u=n("SH7X"),l=n("OsbH"),s=n("0yyf"),f=n.n(s),p=n("XOpu"),d=n("TSYQ"),m=n.n(d),h=n("+FsC"),b=n("SvPG"),y=n("t0Aa"),v=n.n(y),w=Object(c.f)(function(e){var t=e.t,n=e.router;return i.a.createElement("div",{"data-test-id":"pho-toolbar-albums",className:v.a["pho-toolbar"],role:"toolbar"},i.a.createElement("div",{className:v.a["u-hide--mob"]},i.a.createElement(h.e,{"data-test-id":"album-add",theme:"secondary",href:"#/albums/new",icon:"album-add",label:t("Toolbar.album_new")})),i.a.createElement(h.h,{className:m()(v.a["pho-toolbar-menu"],v.a["u-hide--desk"]),component:i.a.createElement(b.b,null),position:"right"},i.a.createElement(h.j,{onSelect:function(){return n.push("/albums/new")},icon:i.a.createElement(h.g,{icon:"album-add"})},t("Toolbar.album_new"))))}),g=n("6qED"),O=n.n(g),_=n("e2oC"),E=n("KOJc"),k=n("RPnM"),S=n("510Z");function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N=Object(c.f)(function(e){var t=e.router,n=e.album,r=e.image,o=e.title,a=e.desc,u=t.location.pathname;return i.a.createElement(c.a,{to:"".concat(u,"/").concat(n._id),className:O.a["pho-album-link"]},r,o,a)}),T=function(e){var t=e.album,n=e.image,r=e.title,o=e.desc,a=e.onClick;return e.disabled?i.a.createElement("div",{className:m()(O.a["pho-album-link"],O.a["pho-album-link--disabled"])},n,i.a.createElement("div",null,r,o)):i.a.createElement("div",{onClick:function(){return a(t)},className:O.a["pho-album-link"]},n,i.a.createElement("div",null,r,o))},z=Object(p.c)()(function(e){var t=e.t,n=e.photoCount,r=e.shared,o=void 0===r?{}:r;return i.a.createElement("h4",{className:O.a["pho-album-description"]},t("Albums.album_item_description",{smart_count:n}),(o.byMe||o.withMe)&&" - ".concat(t("Albums.album_item_shared_".concat("one-way"===o.sharingType?"ro":"rw"))))}),R=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),C(this,P(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.t,n=e.album,r=e.shared,o=void 0===r?{}:r,a=e.onClick,c=e.thumbnail,u=o.readOnly,l=n.photos.data[0]||null,s=l?i.a.createElement(S.a,{file:l,size:"small",render:function(e){return i.a.createElement("img",{src:e,className:O.a["pho-album-photo-item"],alt:"".concat(n.name," album cover")})}}):i.a.createElement("div",{className:O.a["pho-album-photo-item"]}),f=i.a.createElement(z,{t:t,album:n,shared:o,thumbnail:c,photoCount:n.photos.count}),p=i.a.createElement("h2",{className:O.a["pho-album-title"]},n.name);return i.a.createElement("div",{"data-test-id":"pho-album","data-test-name":n.name,className:O.a["pho-album"]},a?i.a.createElement(T,{album:n,image:s,title:p,desc:f,onClick:a,disabled:u}):i.a.createElement(N,{album:n,image:s,title:p,desc:f}))}}])&&j(n.prototype,r),o&&j(n,o),t}(),D=function(e,t){return new Date(t.created_at||null)-new Date(e.created_at||null)},L=Object(p.c)()(function(e){var t=e.data,n=e.hasMore,r=e.fetchMore,o=e.t;return 0===t.length?i.a.createElement(E.b,{localeKey:"albums"}):i.a.createElement(_.a,null,i.a.createElement("div",{className:O.a["pho-album-list"]},t.sort(D).map(function(e){return i.a.createElement(R,{album:e,key:e.id})}),n&&i.a.createElement(k.a,{label:o("Albums.load_more"),onClick:r})))}),I=n("ZFPb"),F=n("SvWF"),M=n("eKCf");function U(e){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function q(e,t){return!t||"object"!==U(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var H=function(e){var t=e.list;switch(t.fetchStatus){case"pending":case"loading":return i.a.createElement(I.a,{loadingType:"albums_fetching"});case"failed":return i.a.createElement(F.a,{errorType:"albums"});default:return i.a.createElement(L,t)}},Q=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),q(this,Y(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&V(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props.t;return this.props.children?this.props.children:this.props.albums?i.a.createElement("div",{"data-test-id":"album-pho-content-wrapper",className:f.a["pho-content-wrapper"]},i.a.createElement(M.a,{viewName:"albums"},i.a.createElement(w,{t:e})),i.a.createElement(H,{list:this.props.albums})):null}}])&&B(n.prototype,r),o&&B(n,o),t}(),W=Object(p.c)()(Q),G=n("/MKj"),K=n("17x9"),X=n.n(K),Z=n("Yo2A"),J=n("Q2ax"),$=n("56YH"),ee=n.n($),te=n("DbnX");function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function oe(e,t){return!t||"object"!==ne(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ae(e){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ce=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),oe(this,ae(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ie(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.t,n=e.router,r=e.album,o=e.sharedWithMe,a=e.readOnly,c=e.disabled,u=void 0!==c&&c,s=e.downloadAlbum,f=e.deleteAlbum,p=e.selectItems,d=e.onRename,m=e.breakpoints.isMobile,y=e.shareAlbum;return i.a.createElement("div",{"data-test-id":"pho-toolbar-album",className:v.a["pho-toolbar"],role:"toolbar"},!m&&i.a.createElement(l.a,{disabled:u,label:t("Albums.share.cta"),onClick:function(){return y(r)}}),i.a.createElement(h.h,{"data-test-id":"more-btn-album",disabled:u,className:v.a["pho-toolbar-menu"],component:i.a.createElement(b.b,null),position:"right"},!o&&i.a.createElement(h.j,{className:v.a["u-hide--desk"],icon:i.a.createElement(h.g,{icon:"share"}),onSelect:function(){return y(r)}},t("Albums.share.cta")),i.a.createElement(h.j,{"data-test-id":"menu-download-album",onSelect:s,icon:i.a.createElement(h.g,{icon:"download"})},t("Toolbar.menu.download_album")),i.a.createElement(h.j,{"data-test-id":"menu-rename-album",icon:i.a.createElement(h.g,{icon:"rename"}),onSelect:d},t("Toolbar.menu.rename_album")),!a&&i.a.createElement(h.j,{"data-test-id":"menu-add-photos-to-album",icon:i.a.createElement(h.g,{icon:"album-add"}),onSelect:function(){return n.push("".concat(n.location.pathname,"/edit"))}},t("Toolbar.menu.add_photos")),i.a.createElement("hr",{className:v.a["u-hide--desk"]}),i.a.createElement(h.j,{className:v.a["u-hide--desk"],icon:i.a.createElement(h.g,{icon:te.a}),onSelect:p},t("Toolbar.menu.select_items")),i.a.createElement("hr",null),!o&&i.a.createElement(h.j,{"data-test-id":"menu-delete-album",className:v.a["pho-action-delete"],icon:i.a.createElement(h.g,{icon:"delete"}),onSelect:f},t("Toolbar.menu.album_delete"))))}}])&&re(n.prototype,r),o&&re(n,o),t}(),ue=Object(h.q)()(ce),le=n("TtgU"),se=n("2sk9"),fe=n.n(se),pe=n("WrkV"),de=function(e){var t=e.t,n=e.confirm,r=e.abort,o=["forbidden","eye","link"].map(function(e){return i.a.createElement("p",{className:m()(fe.a["fil-confirm-text"],fe.a["icon-".concat(e)]),key:e},t("destroyconfirmation.".concat(e)))});return i.a.createElement(pe.c,{title:t("destroyconfirmation.title"),description:o,secondaryType:"secondary",secondaryText:t("destroyconfirmation.cancel"),secondaryAction:r,primaryType:"danger",primaryText:t("destroyconfirmation.delete"),primaryAction:n})},me=function(e){var t=e.t,n=e.confirm,r=e.abort,o=["forbidden"].map(function(e){return i.a.createElement("p",{key:"key_quit_".concat(e),className:m()(fe.a["fil-confirm-text"],fe.a["icon-".concat(e)])},t("quitconfirmation.".concat(e)))});return i.a.createElement(pe.c,{title:t("quitconfirmation.title"),description:o,secondaryType:"secondary",secondaryText:t("quitconfirmation.cancel"),secondaryAction:r,primaryType:"danger",primaryText:t("quitconfirmation.quit"),primaryAction:n})},he=n("5wWc"),be=n("q/Uw");function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ve(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function we(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){ve(a,r,o,i,c,"next",e)}function c(e){ve(a,r,o,i,c,"throw",e)}i(void 0)})}}function ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Se(e,t,n[t])})}return e}function Oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _e(e){return(_e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ee(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ke(e,t){return(ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var xe=function(e){function t(){var e,n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,u=new Array(c),l=0;l<c;l++)u[l]=arguments[l];return r=this,a=(e=_e(t)).call.apply(e,[this].concat(u)),n=!a||"object"!==ye(a)&&"function"!=typeof a?Ee(r):a,Se(Ee(n),"state",{editing:!1,showAddAlbumModal:!1}),Se(Ee(n),"showAddAlbumModal",function(){n.setState(function(e){return ge({},e,{showAddAlbumModal:!0})})}),Se(Ee(n),"hideAddAlbumModal",function(){n.setState(function(e){return ge({},e,{showAddAlbumModal:!1})})}),Se(Ee(n),"editAlbumName",function(){n.setState(function(e){return ge({},e,{editing:!0})})}),Se(Ee(n),"renameAlbum",function(e){if(""!==e.trim())if(e!==n.props.album.name){var t=ge({},n.props.album,{name:e});n.props.updateAlbum(t).then(function(){n.setState({editing:!1})}).catch(function(){J.a.error("Error.generic")})}else n.setState({editing:!1});else J.a.error("Error.album_rename_abort")}),Se(Ee(n),"downloadAlbum",we(o.a.mark(function e(){var t,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props.album,e.next=3,n.context.client.getStackClient().collection("io.cozy.files").findReferencedBy({_type:"io.cozy.photos.albums",_id:t.id},{limit:99999});case 3:r=e.sent,n.context.client.collection("io.cozy.files").downloadArchive(r.data.map(function(e){return e._id}),t.name);case 5:case"end":return e.stop()}},e)}))),Se(Ee(n),"downloadPhotos",function(e){n.context.client.collection("io.cozy.files").downloadArchive(e.map(function(e){return e._id}),"selected")}),Se(Ee(n),"deleteAlbum",function(){var e=n.props,t=e.t,r=e.router,o=e.album,a=e.deleteAlbum;return Object(he.a)(i.a.createElement(de,{t:t,albumName:o.name}),function(){return a(o).then(function(){r.replace("albums"),J.a.success("Albums.remove_album.success",{name:o.name})}).catch(function(){return J.a.error("Albums.remove_album.error.generic")})})}),Se(Ee(n),"leaveAlbum",function(){var e=n.props,t=e.t,r=e.router,o=e.album,a=e.deleteAlbum,c=e.leaveAlbum;return Object(he.a)(i.a.createElement(me,{t:t,albumName:o.name}),function(){return c(o).then(function(){return a(o)}).then(function(){r.replace("albums"),J.a.success("Albums.quit_album.success",{name:o.name})}).catch(function(){return J.a.error("Albums.quit_album.error.generic")})})}),n}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ke(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this;if(!this.props.album||!this.props.photos)return null;var t=this.props,n=t.t,r=t.router,o=t.album,a=t.shareAlbum,c=t.photos,u=t.hasMore,l=t.fetchMore,s=this.state.editing,p={};return i.a.createElement(be.a,{actions:function(t){return{"album-add":e.showAddAlbumModal,download:e.downloadPhotos,"album-remove":function(n){return e.props.removePhotos(o,n,t.clear)}}}},function(t,d,m){return i.a.createElement("div",{"data-test-id":"album-pho-content-wrapper",className:f.a["pho-content-wrapper"]},o.name&&o.photos.data&&i.a.createElement(M.a,{viewName:"albumContent",albumName:o.name,editing:s,onEdit:e.renameAlbum},i.a.createElement(ue,{t:n,router:r,album:o,sharedWithMe:p.withMe,sharedByMe:p.byMe,readOnly:p.readOnly,onRename:e.editAlbumName,downloadAlbum:e.downloadAlbum,deleteAlbum:e.deleteAlbum,leaveAlbum:e.leaveAlbum,shareAlbum:a})),e.state.showAddAlbumModal&&i.a.createElement(gt,{onDismiss:e.hideAddAlbumModal,onSuccess:m.clear,photos:t}),c&&i.a.createElement(le.a,{lists:[{photos:c}],selected:t,photosContext:"timeline",showSelection:d,onPhotoToggle:m.toggle,onPhotosSelect:m.select,onPhotosUnselect:m.unselect,fetchStatus:c.fetchStatus,hasMore:u,fetchMore:l}),e.renderViewer(e.props.children),i.a.createElement(Z.a,null))})}},{key:"renderViewer",value:function(e){var t=this;return e?i.a.Children.map(e,function(e){return i.a.cloneElement(e,{photos:t.props.photos})}):null}},{key:"componentDidUnmount",value:function(){this.props.selection.clear()}}])&&Oe(n.prototype,r),c&&Oe(n,c),t}();xe.propTypes={hasMore:X.a.bool.isRequired,fetchMore:X.a.func.isRequired,album:X.a.object.isRequired,shareAlbum:X.a.func,photos:X.a.array.isRequired,t:X.a.func.isRequired,router:X.a.object.isRequired};var je=ee()(Object(G.connect)(null,function(e){return{shareAlbum:function(t){return e(Object(Z.d)(i.a.createElement(l.b,{document:t,sharingDesc:t.name})))}}}),c.f,Object(p.c)())(xe),Ce=n("2lpW"),Pe=n("C/eS"),Ae=n.n(Pe);function Ne(e){return(Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ze(e){return(ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function De(e,t){return(De=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ie=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=ze(t).call(this,e),n=!o||"object"!==Ne(o)&&"function"!=typeof o?Re(r):o,Le(Re(n),"onNameChange",function(e){n.setState({name:e.target.value})}),Le(Re(n),"onCancel",function(){n.props.router.goBack()}),Le(Re(n),"onCreate",function(e){var t=n.state.name;n.props.createAlbum(t,e).then(function(e){return n.props.router.push("/albums/".concat(e.id))}).catch(function(){n.input.focus(),n.input.select()})}),Le(Re(n),"onUpdate",function(e){var t=n.props.album;n.props.addPhotos(t,e).then(function(){return n.props.router.push("/albums/".concat(t.id))})}),n.state={name:e.t("Albums.create.panel_form.placeholder")},n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&De(e,t)}(t,a["Component"]),n=t,(r=[{key:"componentDidMount",value:function(){this.props.album||(this.input.focus(),this.input.select())}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,r=t.album,o=this.state.name,a=!r;return i.a.createElement(be.a,null,function(t,c,u){return i.a.createElement("div",{className:Ae.a["pho-panel"]},i.a.createElement("div",{className:Ae.a["pho-panel-form"]},i.a.createElement("header",{className:Ae.a["pho-panel-header"]},i.a.createElement("div",{className:Ae.a["pho-panel-wrap"]},a&&i.a.createElement("div",null,i.a.createElement("label",{className:Ae.a["coz-form-label"]},n("Albums.create.panel_form.label")),i.a.createElement("input",{"data-test-id":"input-album-name",type:"text",ref:function(t){e.input=t},value:o,onChange:e.onNameChange})),!a&&i.a.createElement("h3",{"data-test-id":"pho-picker-album-name"},r.name))),i.a.createElement("div",{className:Ae.a["pho-panel-content"]},i.a.createElement("div",{"data-test-id":"picker-panel",className:Ae.a["pho-panel-wrap"]},i.a.createElement(Ce.a,{selected:t,showSelection:!0,selection:u}))),i.a.createElement("footer",{className:Ae.a["pho-panel-footer"]},i.a.createElement("div",{className:Ae.a["pho-panel-wrap"]},i.a.createElement("div",{className:Ae.a["pho-panel-controls"]},i.a.createElement(h.d,{theme:"secondary",onClick:e.onCancel,label:n("Albums.create.panel_form.cancel")}),i.a.createElement(h.d,{"data-test-id":"validate-album",onClick:function(){return a?e.onCreate(t):e.onUpdate(t)},label:n(a?"Albums.create.panel_form.submit":"Albums.create.panel_form.update")}))))))})}}])&&Te(n.prototype,r),o&&Te(n,o),t}(),Fe=Object(p.c)()(Object(c.f)(Ie)),Me=n("D575"),Ue=n.n(Me),Be=n("luXY"),qe=n.n(Be);function Ye(e){return(Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function He(e,t){return!t||"object"!==Ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qe(e){return(Qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function We(e,t){return(We=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ge=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=He(this,Qe(t).call(this))).state={name:"",isSubmitDisabled:!0,isBusy:!1,hasError:!1},e}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&We(e,t)}(t,a["Component"]),n=t,(r=[{key:"reset",value:function(){this.setState({name:"",isSubmitDisabled:!0,isBusy:!1,hasError:!1})}},{key:"onSubmit",value:function(e,t){var n=this;return e.preventDefault(),this.setState({isBusy:!0}),t(this.state.name).then(function(){return n.reset()},function(){return n.setState({hasError:!0,isBusy:!1})})}},{key:"onNameChange",value:function(e){var t=e.target.value;this.setState({name:t,isSubmitDisabled:!t.trim().length,hasError:!1})}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,r=t.onSubmitNewAlbum;return i.a.createElement("form",{className:qe.a["pho-create-album-form"],onSubmit:function(t){return e.onSubmit(t,r)}},i.a.createElement("label",{className:qe.a["coz-create-album-label"]},n("Albums.create.inline_form.create_label")),i.a.createElement("div",{className:qe.a["coz-inline-form"]},i.a.createElement("input",{className:m()(qe.a["coz-input-text"],this.state.hasError&&qe.a.error),type:"text",name:"album-name",onInput:function(t){return e.onNameChange(t)},disabled:this.state.isBusy,placeholder:n("Albums.create.inline_form.placeholder"),value:this.state.name}),i.a.createElement(h.d,{className:qe.a["create-button"],disabled:this.state.isSubmitDisabled||this.state.isBusy,"aria-busy":this.state.isBusy,label:n("Albums.create.inline_form.create_button")})))}}])&&Ve(n.prototype,r),o&&Ve(n,o),t}(),Ke=Object(p.c)()(Ge),Xe=void 0;function Ze(){return(Ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var Je=function(e){return 0===e.albums.data.length?i.a.createElement(E.b,{localeKey:"albums"}):i.a.createElement("div",{className:m()(O.a["pho-album-list"],O.a["pho-album-list--thumbnails"],O.a["pho-album-list--selectable"])},e.albums.data.map(function(t){return i.a.createElement(R,{album:t,key:t.id,thumbnail:!0,onServerError:e.onServerError,onClick:e.onSubmitSelectedAlbum})}))},$e=Object(F.b)(function(e){return e.error},"albums",function(e){return i.a.createElement("div",null,i.a.createElement(Je,e))}),et=function(e){if(!e.albums)return null;var t="failed"===e.albums.fetchStatus;return i.a.createElement($e,Ze({error:t,onServerError:function(){return Xe.handleError(t)}},e))};function tt(e){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function rt(e,t){return!t||"object"!==tt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ot(e){return(ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function at(e,t){return(at=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var it=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),rt(this,ot(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&at(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.t,n=e.photos,r=e.data,o=e.fetchStatus,a=e.createAlbum,c=e.addPhotos,u=e.onDismiss,l=e.onSuccess,s=void 0===l?function(){}:l,f="pending"===o||"loading"===o;return i.a.createElement(pe.c,{title:t("Albums.add_photos.title"),secondaryAction:u},i.a.createElement(pe.b,{className:Ue.a["coz-modal-section"]},i.a.createElement("div",{className:m()(Ue.a["coz-create-album"])},i.a.createElement(Ke,{onSubmitNewAlbum:function(e){return a(e,n).then(u).then(s)}})),f?i.a.createElement(I.a,{loadingType:"albums_fetching"}):r&&r.length>0?i.a.createElement("div",{className:m()(Ue.a["coz-select-album"])},i.a.createElement(et,{albums:{data:r,fetchStatus:o},onSubmitSelectedAlbum:function(e){return c(e,n).then(u).then(s)}})):null))}}])&&nt(n.prototype,r),o&&nt(n,o),t}(),ct=Object(p.c)()(it),ut=n("z6Q1");function lt(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function st(){return(st=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ft(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function pt(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function dt(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){pt(a,r,o,i,c,"next",e)}function c(e){pt(a,r,o,i,c,"throw",e)}i(void 0)})}}n.d(t,"a",function(){return ht}),n.d(t,"d",function(){return wt}),n.d(t,"f",function(){return Et}),n.d(t,"c",function(){return Ot}),n.d(t,"b",function(){return gt}),n.d(t,"g",function(){return kt});var mt=function(e){return e.find(ut.a,{created_at:{$gt:null}}).where({auto:{$exists:!1}}).indexFields(["created_at"]).include(["photos"]).sortBy([{created_at:"desc"}])},ht=function(e,t){return e.get(ut.a,t.router.params.albumId).include(["photos"])},bt=function(){var e=dt(o.a.mark(function e(t,n){var r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.photos.data.length,e.next=4,t.photos.addById(n.map(function(e){return e._id}));case 4:a=t.photos.data.length,r+n.length!==a?h.b.info("Alerter.photos.already_added_photo"):h.b.success("Albums.add_photos.success",{name:t.name,smart_count:n.length}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),h.b.error("Albums.add_photos.error.reference");case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t,n){return e.apply(this,arguments)}}(),yt=function(e){return{updateAlbum:function(){var t=dt(o.a.mark(function t(n){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.collection(ut.a).checkUniquenessOf("name",n.name);case 2:if(!0===t.sent){t.next=8;break}return h.b.error("Albums.create.error.already_exists",{name:name}),t.abrupt("return");case 8:return t.abrupt("return",e.save(n));case 9:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),deleteAlbum:function(t){return e.destroy(t)},addPhotos:bt,removePhotos:function(){var e=dt(o.a.mark(function e(t,n,r){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.photos.removeById(n.map(function(e){return e._id}));case 3:h.b.success("Albums.remove_photos.success",{album_name:t.name}),r(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),h.b.error("Albums.remove_photos.error.generic");case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t,n,r){return e.apply(this,arguments)}}()}},vt=function(e){return{addPhotos:bt,createAlbum:function(){var t=dt(o.a.mark(function t(n,r){var a,i,c,u=arguments;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=u.length>2&&void 0!==u[2]?u[2]:new Date,t.prev=1,n){t.next=5;break}return h.b.error("Albums.create.error.name_missing"),t.abrupt("return");case 5:return i={_type:ut.a,name:n,created_at:a},t.next=8,e.collection(ut.a).checkUniquenessOf("name",i.name);case 8:if(!0===t.sent){t.next=12;break}return h.b.error("Albums.create.error.already_exists",{name:n}),t.abrupt("return");case 12:return t.next=14,e.create(ut.a,i,{photos:r},{updateQueries:{albums:function(e,t){return[t.data].concat(ft(e))}}});case 14:return c=t.sent,h.b.success("Albums.create.success",{name:i.name,smart_count:r.length}),t.abrupt("return",c.data);case 19:t.prev=19,t.t0=t.catch(1),console.log({error:t.t0}),h.b.error("Albums.create.error.generic");case 23:case"end":return t.stop()}},t,null,[[1,19]])}));return function(e,n){return t.apply(this,arguments)}}()}},wt=function(e){return i.a.createElement(l.f,{doctype:ut.a,documentType:"Albums"},i.a.createElement(u.Query,{query:mt},function(t){return i.a.createElement(W,st({albums:t},e))}))},gt=function(e){return i.a.createElement(u.Query,{query:mt,as:"albums",mutations:vt},function(t,n){var r=n.createAlbum,o=n.addPhotos;return i.a.createElement(ct,st({},t,{createAlbum:r,addPhotos:o},e))})},Ot=Object(c.f)(function(e){return i.a.createElement(u.Query,st({query:ht},e,{mutations:yt}),(t={children:e.children},n=t.children,function(e,t){var r=e.data,o=e.fetchStatus,a=t.updateAlbum,c=t.deleteAlbum,u=t.removePhotos;return r&&"loaded"===o?i.a.createElement(je,{album:r,photos:r.photos.data,updateAlbum:a,deleteAlbum:c,removePhotos:u,hasMore:r.photos.hasMore,fetchMore:r.photos.fetchMore.bind(r.photos)},n):i.a.createElement(I.a,{size:"xxlarge",loadingType:"photos_fetching",middle:!0})}));var t,n}),_t=Object(u.withMutations)(vt)(Fe),Et=Object(c.f)(function(e){var t=e.params,n=lt(e,["params"]);return t.albumId?i.a.createElement(u.Query,st({query:ht,mutations:vt},n),function(e,t){var n=e.data,r=t.addPhotos;return i.a.createElement(Fe,{album:n,addPhotos:r})}):i.a.createElement(_t,null)}),kt=function(e){if(!e)return!1;var t=!0,n=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var i=o.value;if(i.relationships&&i.relationships.referenced_by&&i.relationships.referenced_by.data&&i.relationships.referenced_by.data.length>0){var c=i.relationships.referenced_by.data,u=!0,l=!1,s=void 0;try{for(var f,p=c[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){if(f.value.type===ut.a)return!0}}catch(e){l=!0,s=e}finally{try{u||null==p.return||p.return()}finally{if(l)throw s}}}}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}return!1}},SvPG:function(e,t,n){"use strict";var r=n("mz5Q"),o=n.n(r),a=n("XOpu"),i=n("+FsC"),c=n("swni"),u=n.n(c),l=Object(a.c)()(function(e){var t=e.t,n=e.disabled,r=e.onClick;return o.a.createElement(i.d,{className:u.a["dri-btn--more"],theme:"secondary",disabled:n,onClick:r,extension:"narrow",icon:"dots",iconOnly:!0,label:t("Toolbar.more")})}),s=n("17x9"),f=n.n(s),p=function(e){var t=e.from,n=e.embedInCozyBar,r=void 0!==n&&n,a=e.t;return o.a.createElement(i.e,{subtle:!0,label:a("Share.create-cozy"),icon:"cozy-negative",className:r?u.a["bar-homelink"]:"",href:d(t)})};p.propTypes={from:f.a.string,embedInCozyBar:f.a.bool,t:f.a.func.isRequired},p.defaultProps={from:""};var d=function(e){return"https://manager.cozycloud.cc/cozy/create".concat(e?"?pk_campaign=".concat(encodeURIComponent(e)):"")},m=p;n.d(t,"b",function(){return l}),n.d(t,"a",function(){return m})},SvWF:function(e,t,n){"use strict";var r=n("mz5Q"),o=n.n(r),a=n("XOpu"),i=n("+FsC"),c=n("4BeY"),u=n.n(c),l=n("IaFt"),s=n.n(l),f=new u.a({id:"icon-image-broken_a4fd70a7dc9c96a1d21491390660382c",use:"icon-image-broken_a4fd70a7dc9c96a1d21491390660382c-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="icon-image-broken_a4fd70a7dc9c96a1d21491390660382c">\n  <g fill="none" fill-rule="evenodd" transform="translate(0 2)">\n    <rect width="32" height="28" fill="#FDD5D5" rx="2" />\n    <path fill="#F52D2D" d="M24,20 L13,15 L19.2902805,8.70971949 C19.6822478,8.31775224 20.3203148,8.32031476 20.7062149,8.7062149 L29,17 L24,20 Z" />\n    <path fill="#F52D2D" d="M0,22 L6.29028051,15.7097195 C6.68224776,15.3177522 7.31387329,15.3138733 7.70591205,15.7059121 L11,19 L15.0233154,14.9766846 L24,19 L27.2486572,17.2486572 L32,22 L32,26.0020869 C32,27.1055038 31.1107383,28 29.9982567,28 L2.00174332,28 C0.89621101,28 0,27.1017394 0,26.0020869 L0,22 Z" />\n    <circle cx="8" cy="7" r="3" fill="#FFFFFF" />\n    <path stroke="#FDD5D5" d="M11,18.3000031 L5.5,23.8000031 L11,18.3000031 Z" stroke-linecap="round" stroke-linejoin="round" />\n    <polyline stroke="#FFFFFF" stroke-width="2" points="0 17 8 13 24 20 32 16" stroke-linecap="round" stroke-linejoin="round" />\n  </g>\n</symbol>'}),p=(s.a.add(f),f);n.d(t,"b",function(){return m});var d=Object(a.c)()(function(e){var t=e.t,n=e.errorType;return o.a.createElement(i.f,{title:t("Error.".concat(n,"_title")),icon:p},o.a.createElement(i.d,{onClick:function(){return window.location.reload()},label:t("Error.refresh")}))}),m=function(e,t,n){return function(r){return e(r)?o.a.createElement(d,{errorType:t}):o.a.createElement(n,r)}};t.a=d},Te91:function(e,t,n){e.exports={"coz-btn-shared":"coz-btn-shared--27aW9","coz-btn-sharedWithMe":"coz-btn-sharedWithMe--1CdsF"}},TtgU:function(e,t,n){"use strict";var r=n("kKu1"),o=n.n(r),a=n("mz5Q"),i=n.n(a),c=n("CMvH"),u=n("XOpu"),l=n("sIaW"),s=n.n(l),f=n("TSYQ"),p=n.n(f),d=n("dtw8"),m=n("510Z");var h=Object(d.f)(function(e){var t,n,r,a=e.photo,c=e.box,u=e.selected,l=void 0!==u&&u,s=e.onToggle,f=e.router,h=function(e){var t={};return e&&(e.width&&(t.width="".concat(e.width,"px")),e.height&&(t.height="".concat(e.height,"px")),e.top&&(t.top="".concat(e.top,"px")),e.left&&(t.left="".concat(e.left,"px"))),t}(c);return i.a.createElement("div",{style:h,"data-test-item":"pho-photo-item",className:p()(o.a["pho-photo"],(t={},n=o.a["pho-photo--selected"],r=l,n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t))},i.a.createElement("div",null,i.a.createElement("span",{className:o.a["pho-photo-select"],"data-input":"checkbox",onClick:function(e){e.stopImmediatePropagation(),s(a,l)}},i.a.createElement("input",{type:"checkbox",checked:l}),i.a.createElement("label",null)),i.a.createElement(d.a,{to:{pathname:"".concat(f.location.pathname,"/").concat(a.id),query:f.location.query}},i.a.createElement(m.a,{file:a,size:"small",render:function(e){return i.a.createElement("img",{src:e,className:o.a["pho-photo-item"],style:h})}}))))});function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var O={width:1,height:1},_=function(e){return 180+(e||1800)/30},E=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),v(this,w(t).apply(this,arguments))}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,a["Component"]),n=t,(r=[{key:"isPhotoSelected",value:function(e,t){return-1!==t.map(function(e){return e._id}).indexOf(e._id)}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,r=t.key,a=t.title,c=t.photos,u=t.selected,l=t.showSelection,f=t.onPhotoToggle,d=t.onPhotosSelect,m=t.onPhotosUnselect,b=t.containerWidth;if(!b)return null;var y=b>=768?{spacing:16,padding:32}:{spacing:8,padding:0},v=s()(c.map(function(e){var t=e.metadata||e.attributes.metadata;return t&&t.width&&t.height?function(e){return e.orientation&&e.orientation>4?{width:e.height,height:e.width}:e}(t):O}),{containerWidth:b,targetRowHeight:_(b),boxSpacing:{horizontal:y.spacing,vertical:y.spacing},containerPadding:{top:0,right:y.padding,bottom:0,left:y.padding}}),w=u.map(function(e){return e._id}),g=c.every(function(e){return-1!==w.indexOf(e._id)}),E=v.boxes[0].top,k=v.boxes.findIndex(function(e){return e.top!==E}),S=-1===k?v.boxes[v.boxes.length-1]:v.boxes[k-1],x=b-S.left-S.width-y.padding;return i.a.createElement("div",{"data-test-id":"photo-section",className:p()(o.a["pho-section"],l&&o.a["pho-section--has-selection"]),key:r,style:"width:".concat(b,"px;")},i.a.createElement("div",{className:o.a["pho-section-header"]},i.a.createElement("h3",null,a),l&&c.length>1&&g&&i.a.createElement("a",{style:{marginRight:"".concat(x,"px")},onClick:function(){return m(c)}},n("Board.unselect_all")),l&&c.length>1&&!g&&i.a.createElement("a",{style:{marginRight:"".concat(x,"px")},onClick:function(){return d(c)}},n("Board.select_all"))),i.a.createElement("div",{className:o.a["pho-photo-wrapper"],style:"width:".concat(b,"px; height:").concat(v.containerHeight,"px;")},c.map(function(t,n){return i.a.createElement(h,{photo:t,box:v.boxes[n],key:t.id,selected:e.isPhotoSelected(t,u),onToggle:f})})))}}])&&y(n.prototype,r),c&&y(n,c),t}(),k=Object(u.c)()(E),S=n("KOJc"),x=n("ZFPb"),j=n("SvWF"),C=n("RPnM");function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var R=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),N(this,T(t).apply(this,arguments))}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.t,n=e.f,r=e.lists,a=e.selected,c=e.photosContext,u=e.showSelection,l=e.onPhotoToggle,s=e.onPhotosSelect,f=e.onPhotosUnselect,p=e.fetchStatus,d=e.hasMore,m=e.fetchMore,h=e.measureRef,b=e.contentRect.entry.width,y="pending"===p||"loading"===p;return"failed"===p?i.a.createElement(j.a,{errorType:"".concat(c,"_photos")}):y?i.a.createElement(x.a,{loadingType:"photos_fetching"}):y||0!==r.length&&0!==r[0].photos.length?i.a.createElement("div",{className:u?o.a["pho-list-selection"]:"",ref:h},r.map(function(e){return i.a.createElement(k,{key:e.key||e.month,title:e.title||(e.month?n(e.month,"MMMM YYYY"):""),photos:e.photos,selected:a,showSelection:u,onPhotoToggle:l,onPhotosSelect:s,onPhotosUnselect:f,containerWidth:b})}),d&&i.a.createElement(C.a,{label:t("Board.load_more"),width:b,onClick:m})):i.a.createElement(S.b,{localeKey:"".concat(c,"_photos")})}}])&&A(n.prototype,r),c&&A(n,c),t}();t.a=Object(u.c)()(Object(c.a)()(R))},UQWb:function(e,t,n){"use strict";n.r(t);var r=n("o0o1"),o=n.n(r),a=n("fvjX"),i=n("1mXj"),c=(n("5yeP"),n("ZHai")),u=n("sINF"),l=n("QwUF"),s="interaction",f="upload",p=function(){return function(e){return function(t){switch(t.type){case l.PRE_UPLOAD_FILE:t.trackEvent={category:s,action:f,name:"file",value:t.count}}return e(t)}}},d=n("yEaX"),m=n("7oMs"),h=n("37ak"),b=n("JZSQ"),y=n("2U19"),v=n("iTW1"),w=n("Yo2A"),g=n("cSBT"),O=n("DzJC"),_=n.n(O),E=n("q3u0"),k=n("qxHO"),S=n("snfs");function x(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function j(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){x(a,r,o,i,c,"next",e)}function c(e){x(a,r,o,i,c,"throw",e)}i(void 0)})}}var C=function(){return Object(S.isMobileApp)()&&void 0!==window.cordova.plugins&&void 0!==window.cordova.plugins.listLibraryItems},P=function(){var e=j(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(C()){e.next=2;break}return e.abrupt("return",Promise.resolve(!1));case 2:return e.abrupt("return",new Promise(function(e){window.cordova.plugins.listLibraryItems.isAuthorized(function(){return e(!0)},function(){return e(!1)})}));case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),A=function(){var e=j(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(C()){e.next=2;break}return e.abrupt("return",Promise.resolve(!1));case 2:return e.abrupt("return",new Promise(function(e){window.cordova.plugins.listLibraryItems.requestReadAuthorization(function(){return e(!0)},function(t){t.startsWith("Permission")||(console.warn(t),Object(k.b)("requestAuthorization error:",t)),e(!1)})}));case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),N=function(){var e=j(o.a.mark(function e(t){var n,r,a,i,c,u,l,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uri,r=t.file,a=t.method,i=void 0===a?"POST":a,c=t.id,u=void 0===c?void 0:c,e.next=3,Object(E.c)();case 3:return l=e.sent,s={id:u,serverUrl:n,libraryId:r.id,mimeType:r.mimeType,filePath:r.filePath,httpMethod:i,headers:{Authorization:"Bearer "+l,"Content-Type":r.mimeType}},e.abrupt("return",s);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),T=function(e,t,n){return new Promise(function(r,o){window.cordova.plugins.listLibraryItems.uploadItem(e,function(e){e.errors?o(e.errors):void 0!==e.progress?t(e.progress):e.thumbnail?n(e.thumbnail):r(e)},o)})},z=function(){var e=j(o.a.mark(function e(t,n,r,a){var i,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!C()){e.next=6;break}return i=Object(E.a)()+"/files/"+encodeURIComponent(t._id),e.next=4,N({uri:i,file:n,method:"PUT"});case 4:return c=e.sent,e.abrupt("return",T(c,r,a));case 6:return e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}},e)}));return function(t,n,r,o){return e.apply(this,arguments)}}(),R=function(){var e=j(o.a.mark(function e(t,n,r,a){var i,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!C()){e.next=6;break}return i=Object(E.a)()+"/files/"+encodeURIComponent(t)+"?Name="+encodeURIComponent(n.fileName)+"&Type=file&Tags=library&Executable=false",e.next=4,N({id:t,file:n,uri:i});case 4:return c=e.sent,e.abrupt("return",T(c,r,a));case 6:return e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}},e)}));return function(t,n,r,o){return e.apply(this,arguments)}}(),D=function(){var e=j(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!C()){e.next=3;break}return e.abrupt("return",new Promise(function(e){window.cordova.plugins.listLibraryItems.listItems(!0,!0,!1,function(t){return e(t.library)},function(n){console.warn(n),e(t)})}));case 3:return e.abrupt("return",Promise.resolve(t));case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),L=n("wh6s"),I=function(){if(void 0===L.a){var e=Object(E.b)();Object(L.b)(e,function(e){return n("tqYW")("./".concat(e))})}return L.a.t.bind(L.a)},F=(window.Connection&&window.Connection.UNKNOWN,window.Connection&&window.Connection.ETHERNET,window.Connection?window.Connection.WIFI:"wifi"),M=(window.Connection&&window.Connection.CELL_2G,window.Connection&&window.Connection.CELL_3G,window.Connection&&window.Connection.CELL_4G,window.Connection&&window.Connection.CELL,window.Connection&&window.Connection.NONE,function(){return void 0!==window.navigator.connection&&void 0!==window.Connection}),U=function(){return(M()?navigator.connection.type:F)===F},B=n("aNx5"),q=n("oAJy"),Y=n.n(q);function V(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function H(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){V(a,r,o,i,c,"next",e)}function c(e){V(a,r,o,i,c,"throw",e)}i(void 0)})}}var Q=function(){var e=H(o.a.mark(function e(t,n){var r,a,i,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(e){n({type:B.b,progress:e})},a=function(){},e.next=4,Y.a.getItem("CORRUPTED_FILES");case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0=!1;case 7:if(!1!==e.t0){e.next=14;break}return e.next=11,cozy.client.fetchJSON("GET","/files/fsck");case 11:return i=e.sent,e.next=14,Y.a.setItem("CORRUPTED_FILES",i);case 14:return e.next=16,Y.a.getItem("CORRUPTED_FILES");case 16:c=e.sent;try{c.reduce(function(){var e=H(o.a.mark(function e(n,i){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.file_doc&&i.file_doc.name&&t.map(function(){var e=H(o.a.mark(function e(t){var u;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.fileName!==i.file_doc.name){e.next=13;break}return e.prev=1,e.next=4,z(i.file_doc,t,_()(r,500),a);case 4:return u=c.reduce(function(e,t){return t.file_doc._id!==i.file_doc._id&&e.push(i),e},[]),e.next=7,Y.a.setItem("CORRUPTED_FILES",u);case 7:return e.abrupt("return",n.push(t.id));case 10:e.prev=10,e.t0=e.catch(1),console.log("error on CORRUPTED FILES",e.t0);case 13:case"end":return e.stop()}},e,null,[[1,10]])}));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",n);case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),[])}catch(e){console.log("error globale",e)}case 18:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),W=n("A3Xe");function G(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function K(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){G(a,r,o,i,c,"next",e)}function c(e){G(a,r,o,i,c,"throw",e)}i(void 0)})}}var X=function(e,t,n){return{type:B.a,media:e,messageData:{current:t,total:n}}},Z=function(){var e=K(o.a.mark(function e(t){var n,r,a,i,c,u,l,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(W.e)(t,W.a);case 2:if(!((n=e.sent).length>=1)){e.next=7;break}return e.abrupt("return",n[0]);case 7:return r=I(),a=r("mobile.settings.media_backup.media_folder"),i=r("mobile.settings.media_backup.backup_folder"),c=r("mobile.settings.media_backup.legacy_backup_folder"),e.next=13,Object(W.d)(t,"/".concat(a),W.b);case 13:return e.prev=13,e.next=16,t.collection("io.cozy.files").statByPath("/".concat(a,"/").concat(c,"/plop"));case 16:return u=e.sent,l=u.data,e.next=20,Object(W.d)(t,"/".concat(a,"/").concat(c),W.a);case 20:return e.abrupt("return",l);case 23:if(e.prev=23,e.t0=e.catch(13),404!==e.t0.status){e.next=32;break}return e.next=28,Object(W.d)(t,"/".concat(a,"/").concat(i),W.a);case 28:return s=e.sent,e.abrupt("return",s);case 32:throw e.t0;case 33:case"end":return e.stop()}},e,null,[[13,23]])}));return function(t){return e.apply(this,arguments)}}(),J=function(e,t){var n=!t().mobile.settings.wifiOnly;return(e||t().mobile.settings.backupImages)&&(U()||n)},$=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(){var t=K(o.a.mark(function t(n,r,a){var i,c,u,l,s,f,p,d,m,h,b,y,v,w,O,_,E;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.client,n({type:B.g}),t.next=4,P();case 4:if(t.sent){t.next=13;break}return c=e,t.next=8,ne(c);case 8:if(u=t.sent,e&&!u&&(e=!1),!r().mobile.settings.backupImages||u){t.next=13;break}return t.next=13,n(Object(g.d)(!1));case 13:if(!J(e,r)){t.next=68;break}return t.prev=14,t.next=17,D();case 17:return l=t.sent,s=r().mobile.mediaBackup.uploaded,//! TODO : RM after a while. Deal with photos here
t.next=21,Q(l,n);case 21:if(f=l.filter(function(e){return!s.includes(e.id)}),!((p=f.length)>0)){t.next=59;break}return t.next=26,Z(i);case 26:d=t.sent,m=d._id,h=d.attributes.path,b=0,y=!0,v=!1,w=void 0,t.prev=33,O=f[Symbol.iterator]();case 35:if(y=(_=O.next()).done){t.next=45;break}if(E=_.value,!r().mobile.mediaBackup.cancelMediaBackup&&!r().mobile.mediaBackup.diskQuotaReached&&J(e,r)){t.next=39;break}return t.abrupt("break",45);case 39:return n(X(E,b++,p)),t.next=42,n(te(h,m,E));case 42:y=!0,t.next=35;break;case 45:t.next=51;break;case 47:t.prev=47,t.t0=t.catch(33),v=!0,w=t.t0;case 51:t.prev=51,t.prev=52,y||null==O.return||O.return();case 54:if(t.prev=54,!v){t.next=57;break}throw w;case 57:return t.finish(54);case 58:return t.finish(51);case 59:cozy.client.settings.updateLastSync(),t.next=66;break;case 62:t.prev=62,t.t1=t.catch(14),n({type:B.c}),t.t1.message.match(/Failed to fetch/)||Object(k.b)("Unexpected error during the files backup (".concat(t.t1.message,")"));case 66:t.next=69;break;case 68:n({type:B.c});case 69:n({type:B.e});case 70:case"end":return t.stop()}},t,null,[[14,62],[33,47,51,59],[52,,54,58]])}));return function(e,n,r){return t.apply(this,arguments)}}()},ee=function(e){var t=e.id;return{type:B.h,id:t}},te=function(e,t,n){return function(){var r=K(o.a.mark(function r(a){var i,c,u,l;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,cozy.client.files.statByPath(e+"/"+n.fileName);case 3:return a(ee(n)),r.abrupt("return");case 7:r.prev=7,r.t0=r.catch(0);case 9:return 1,1e3,6e4,3e5,i=setTimeout(function(){console.info(JSON.stringify(n)),Object(k.b)("Backup duration exceeded ".concat(3e5," milliseconds"))},3e5),r.prev=14,c=function(e){a({type:B.b,progress:e})},u=function(){},r.next=19,R(t,n,_()(c,500),u);case 19:clearTimeout(i),a(ee(n)),r.next=26;break;case 23:r.prev=23,r.t1=r.catch(14),r.t1.code&&413===parseInt(r.t1.code)?(clearTimeout(i),a({type:B.f})):(console.warn("startMediaBackup upload item error"),console.warn(JSON.stringify(r.t1)),console.info(JSON.stringify(n)),l=r.t1.message?r.t1.message:JSON.stringify(r.t1),Object(k.b)("Backup error: "+l,null,["backup error"]));case 26:case"end":return r.stop()}},r,null,[[0,7],[14,23]])}));return function(e){return r.apply(this,arguments)}}()},ne=function(){var e=K(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=4;break}return e.next=3,A();case 3:t=e.sent;case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),re=n("QDdI"),oe=n("bMkt");function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ie=function(e){var t={ui:w.b,view:d.b,filelist:h.a,upload:y.b,selection:m.a,rename:b.c,availableOffline:v.a},n=(Object(a.combineReducers)({authorization:re.b,settings:g.a,replication:oe.a,mediaBackup:B.i}),Object(a.combineReducers)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ae(e,t,n[t])})}return e}({},t,{cozy:e.reducer()})));return function(e,t){return t.type===re.a&&(e=void 0),n(e,t)}},ce=n("1eh9"),ue=function(){return{level:{prevState:!1,nextState:!1}}},le=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=[u.default.withExtraArgument({client:e,t:t})];Object(c.e)()&&Object(c.c)()&&(r.push(p),r.push(Object(c.b)())),r.push(Object(i.createLogger)(ue()));var o=a.compose,l=ie(e),s=Object(a.createStore)(l,n,o(a.applyMiddleware.apply(void 0,r)));return e.setStore(s),s};function se(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function fe(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){se(a,r,o,i,c,"next",e)}function c(e){se(a,r,o,i,c,"throw",e)}i(void 0)})}}n.d(t,"updateStatusBackgroundService",function(){return pe}),n.d(t,"startBackgroundService",function(){return de}),n.d(t,"disableBackgroundService",function(){return he});var pe=function(e){e?me():he()},de=function(){ke()?je():ve()?Oe():be()},me=function(){ke()?Se():ve()?we():be()},he=function(){var e=fe(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!ke()){e.next=4;break}xe(),e.next=10;break;case 4:if(!ve()){e.next=9;break}return e.next=7,ge();case 7:e.next=10;break;case 9:be();case 10:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),be=function(){var e="Background Service is not compatible with your platform.";console.warn(e),Object(S.isMobileApp)()&&(console.log(Object(S.getPlatform)()),Object(S.isIOSApp)()?console.log(window.BackgroundFetch):Object(S.isAndroidApp)()&&console.log(window.JSBackgroundService)),Object(k.b)(e)},ye=function(){return new Promise(function(e){console.log("BackgroundFetch initiated"),Object(ce.a)().then(function(e){var t=e.mobile.settings.serverUrl;Object(k.a)();var n=Object(E.d)(t);return le(n,I(),e).dispatch($())}).then(e).catch(e)})},ve=function(){return Object(S.isAndroidApp)()&&void 0!==window.JSBackgroundService},we=function(){var e=fe(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee();case 2:e.sent||(36e5,window.JSBackgroundService.setRepeating(36e5,function(e){e&&(console.warn(e),Object(k.b)("enableAndroidBackgroundService error"))}));case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),ge=function(){var e=fe(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee();case 2:e.sent&&window.JSBackgroundService.cancelRepeating(function(e){e&&(console.warn(e),Object(k.b)("disableAndroidBackgroundService error"))});case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),Oe=function(){ye().then(function(){_e()})},_e=function(){window.service.workDone()},Ee=function(){return new Promise(function(e){window.JSBackgroundService.isRepeating(function(t,n){t&&(console.warn(t),Object(k.b)("isEnableAndroidBackgroundService error"),e(!1)),e(n)})})},ke=function(){return Object(S.isIOSApp)()&&void 0!==window.BackgroundFetch},Se=function(){window.BackgroundFetch.configure(je,function(e){console.log("BackgroundFetch failed",e)},{stopOnTerminate:!1})},xe=function(){window.BackgroundFetch.stop()},je=function(){ye().then(function(){Ce()})},Ce=function(){window.BackgroundFetch.finish()}},VZRP:function(e,t,n){e.exports={"pho-content-title":"pho-content-title--3Yt9z",error:"error--2qbV5","pho-content-header":"pho-content-header--1M4IS","--hide-bar":"_--hide-bar--lrytb","pho-content-album-previous":"pho-content-album-previous--3BqBh",spin:"spin--1ZeSG"}},W9Ej:function(e,t,n){e.exports={"fil-dropzone-active":"fil-dropzone-active--6mOTt","fil-dropzone-teaser":"fil-dropzone-teaser--HOFff","fil-dropzone-teaser-claudy":"fil-dropzone-teaser-claudy--NElRC",pulse:"pulse--sS0GG","fil-dropzone-teaser-content":"fil-dropzone-teaser-content--3YqGo","fil-dropzone-teaser-folder":"fil-dropzone-teaser-folder--2aWVM"}},XxWZ:function(e,t,n){e.exports={"fil-topbar":"fil-topbar--1eJFH","hidden-mobile":"hidden-mobile--x6udF",spin:"spin--KIZH2"}},Yo2A:function(e,t,n){"use strict";var r=n("fvjX"),o=n("mz5Q"),a=n.n(o),i=n("/MKj");function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{show:!1,component:null},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SHOW_MODAL":return{show:!0,component:t.component};case"HIDE_MODAL":return{show:!1,component:null};default:return e}},l=function(e){return{type:"SHOW_MODAL",component:e,meta:{hideActionMenu:!0}}},s=Object(i.connect)(function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}({},e.ui.modal)})(function(e){var t=e.show,n=e.component,r=e.dispatch;return t?a.a.cloneElement(n,{onClose:function(e){return r(function(){return{type:"HIDE_MODAL",meta:arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}}}(e))}}):null});function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=f(arguments.length>1?arguments[1]:void 0,2),n=t[0],r=t[1],o=void 0===r||r;return e[n]=o,e},d=function(){return window.location.search.substring(1).split("&").map(function(e){return e.split("=")}).reduce(p,{})};n.d(t,"a",function(){return s}),n.d(t,"d",function(){return l}),n.d(t,"c",function(){return d});t.b=Object(r.combineReducers)({modal:u})},Z7XG:function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return a});var r="io.cozy.files.root-dir",o="io.cozy.files.trash-dir",a=100},ZFPb:function(e,t,n){"use strict";var r=n("mz5Q"),o=n.n(r),a=n("TSYQ"),i=n.n(a),c=n("XOpu"),u=n("+FsC"),l=n("5ZYL"),s=n.n(l);t.a=Object(c.c)()(function(e){var t=e.size,n=void 0===t?"xxlarge":t,r=e.loadingType,a=e.color,c=e.noMargin,l=void 0!==c&&c,f=e.middle,p=void 0===f||f;return o.a.createElement("div",{"data-test-id":"loading",className:i()(s.a["pho-loading"])},o.a.createElement(u.m,{size:n,loadingType:r,color:a,noMargin:l,middle:p}))})},aNx5:function(e,t,n){"use strict";function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"g",function(){return i}),n.d(t,"e",function(){return c}),n.d(t,"c",function(){return u}),n.d(t,"h",function(){return l}),n.d(t,"d",function(){return s}),n.d(t,"f",function(){return f}),n.d(t,"a",function(){return p}),n.d(t,"b",function(){return d}),n.d(t,"l",function(){return h}),n.d(t,"n",function(){return b}),n.d(t,"k",function(){return y}),n.d(t,"m",function(){return v}),n.d(t,"j",function(){return w});var i="MEDIA_UPLOAD_START",c="MEDIA_UPLOAD_END",u="MEDIA_UPLOAD_ABORT",l="MEDIA_UPLOAD_SUCCESS",s="MEDIA_UPLOAD_CANCEL",f="MEDIA_UPLOAD_QUOTA",p="CURRENT_UPLOAD",d="CURRENT_UPLOAD_PROGRESS",m={running:!1,uploading:!1,cancelMediaBackup:!1,abortedMediaBackup:!1,diskQuotaReached:!1,uploaded:[],currentUpload:void 0};t.i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i:return o({},e,{running:!0,cancelMediaBackup:!1,abortedMediaBackup:!1,diskQuotaReached:!1});case s:return o({},e,{cancelMediaBackup:!0});case u:return o({},e,{abortedMediaBackup:!0});case f:return o({},e,{diskQuotaReached:!0});case c:return o({},e,{running:!1,uploading:!1,cancelMediaBackup:!0,currentUpload:void 0});case l:return o({},e,{uploaded:[].concat(r(e.uploaded),[t.id])});case p:return o({},e,{uploading:!0,currentUpload:{media:t.media,message:t.message,messageData:t.messageData}});case d:return o({},e,{currentUpload:o({},e.currentUpload,{messageData:o({},e.currentUpload?e.currentUpload.messageData:{},{progress:t.progress})})});default:return e}};var h=function(e){return e.mobile.mediaBackup.running&&!e.mobile.mediaBackup.uploading},b=function(e){return e.mobile.mediaBackup.uploading},y=function(e){return e.mobile.mediaBackup.abortedMediaBackup},v=function(e){return e.mobile.mediaBackup.diskQuotaReached},w=function(e){return e.mobile.mediaBackup.currentUpload&&!e.mobile.mediaBackup.diskQuotaReached?{current:e.mobile.mediaBackup.currentUpload.messageData.current,total:e.mobile.mediaBackup.currentUpload.messageData.total,progress:e.mobile.mediaBackup.currentUpload.messageData.progress}:{}}},bMkt:function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"c",function(){return c}),n.d(t,"f",function(){return u}),n.d(t,"d",function(){return l}),n.d(t,"e",function(){return s});n("cSBT");function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a={firstReplication:!1,indexes:null};t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_FIRST_REPLICATION":return r({},e,{firstReplication:t.firstReplication});case"SET_POUCH_INDEXES":return r({},e,{indexes:t.indexes});default:return e}};var i=function(e){return e.mobile&&e.mobile.replication&&e.mobile.replication.indexes},c=function(e){return e.mobile&&e.mobile.replication&&e.mobile.replication.firstReplication},u=function(e){return!1},l=function(e){return{type:"SET_FIRST_REPLICATION",firstReplication:e}},s=function(e){return{type:"SET_POUCH_INDEXES",indexes:e}}},bisv:function(e,t,n){e.exports={"coz-upload-status-wrapper":"coz-upload-status-wrapper--e0aoJ","coz-upload-status":"coz-upload-status--1ytxW","coz-upload-progress":"coz-upload-progress--1GhMB","coz-upload-progress--global":"coz-upload-progress--global--IpVlf","coz-upload-progress--individual":"coz-upload-progress--individual--2JzLZ","infinite-progress":"infinite-progress--3n0vL",squashstretch:"squashstretch--3uNZn","infinite-progress--global":"infinite-progress--global--1-9Xu","coz-progress-pic":"coz-progress-pic--3fCMW","coz-upload-status-content":"coz-upload-status-content--2ZdG3","coz-upload-status-link":"coz-upload-status-link--3SJQJ","coz-upload-status--success":"coz-upload-status--success--1lTE6","coz-upload-status--waiting":"coz-upload-status--waiting--1Ae6F","coz-upload-status--error":"coz-upload-status--error--3_GOe"}},cSBT:function(e,t,n){"use strict";n("ZHai"),n("Ow0/");function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a={serverUrl:"",offline:!1,analytics:!1,backupImages:!1,wifiOnly:!0},i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case s:return r({},e,{serverUrl:t.url});case h:return r({},e,{offline:t.offline});case m:return r({},e,{analytics:t.analytics});case f:return r({},e,{backupImages:t.backupImages});case p:return r({},e,{backupContacts:t.backupContacts});case d:return r({},e,{wifiOnly:t.wifiOnly});default:return e}},c=function(e,t){if(e.mobile&&e.mobile.settings&&void 0!==e.mobile.settings[t])return e.mobile.settings[t];console.warn("Not found mobile setting ".concat(t))},u=function(e){return c(e,"serverUrl")},l=function(e){return c(e,"backupImages")},s="SET_URL",f="BACKUP_IMAGES",p="BACKUP_CONTACTS",d="WIFI_ONLY",m="SET_ANALYTICS",h="SET_OFFLINE",b=function(e){return{type:s,url:e}},y=function(e){return{type:h,offline:e}},v=function(e){return{type:f,backupImages:e}};n.d(t,"f",function(){return b}),n.d(t,"e",function(){return y}),n.d(t,"d",function(){return v}),n.d(t,"a",function(){return i}),n.d(t,"b",function(){return u}),n.d(t,"c",function(){return l})},cwrA:function(e,t,n){"use strict";var r=n("mz5Q"),o=n.n(r),a=n("dtw8"),i=n("TSYQ"),c=n.n(i),u=n("yLV6"),l=n.n(u),s=n("17x9"),f=n.n(s),p=n("XOpu"),d=n("VPDz"),m=n("7kNS"),h=n.n(m);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _=3e3,E=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=v(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==b(o)&&"function"!=typeof o?w(r):o,O(w(n),"state",{hidden:!1,gestures:null}),O(w(n),"showControls",function(){n.setState({hidden:!1}),n.hideAfterDelay(),document.removeEventListener("mousemove",n.showControls),document.addEventListener("mousemove",n.hideAfterDelay)}),O(w(n),"hideControls",function(){n.setState({hidden:!0}),document.removeEventListener("mousemove",n.hideAfterDelay),document.addEventListener("mousemove",n.showControls)}),O(w(n),"onTap",function(){n.state.hidden?n.showControls():n.hideAfterDelay()}),O(w(n),"hideAfterDelay",function(){clearTimeout(n.hideTimeout),n.hideTimeout=setTimeout(function(){n.hideControls()},_)}),O(w(n),"onSwipe",function(e){e.direction===l.a.DIRECTION_LEFT?n.props.onNext():e.direction===l.a.DIRECTION_RIGHT&&n.props.onPrevious()}),n}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,r["Component"]),n=t,(a=[{key:"componentDidMount",value:function(){this.hideAfterDelay();var e=new l.a(o.a.findDOMNode(this.wrapped));e.on("swipe",this.onSwipe),e.on("tap",this.onTap),this.setState({gestures:e})}},{key:"componentWillUnmount",value:function(){this.state.gestures&&this.state.gestures.destroy()}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.t,a=n.currentFile,i=n.onClose,u=n.hasPrevious,l=n.hasNext,s=n.onPrevious,f=n.onNext,p=n.isMobile,m=n.expanded,b=n.controls,y=n.children,v=n.isMobileApp,w=this.state.hidden,g=this.context.client,_="pdf"===a.class;return o.a.createElement("div",{"data-test-id":"pho-viewer-controls",className:c()(h.a["pho-viewer-controls"],O({},h.a["pho-viewer-controls--expanded"],m)),ref:function(e){t.wrapped=e}},b&&o.a.createElement("div",{className:c()(h.a["pho-viewer-toolbar"],(e={},O(e,h.a["pho-viewer-toolbar--hidden"],w),O(e,h.a["pho-viewer-toolbar--mobilebrowser"],!v&&p),e)),role:"viewer-toolbar",onMouseEnter:this.showControls,onMouseLeave:this.hideControls},o.a.createElement("div",{className:c()(h.a["coz-selectionbar"],h.a["pho-viewer-toolbar-actions"])},!_&&!p&&o.a.createElement(d.a,{theme:"secondary",onClick:function(){g.collection("io.cozy.files").download(a)},icon:"download",label:r("Viewer.actions.download"),subtle:!0})),i&&o.a.createElement("div",{className:h.a["pho-viewer-toolbar-close"],onClick:i,title:r("Viewer.close")},o.a.createElement(d.a,{theme:"secondary",icon:"cross",color:"white",label:r("Viewer.close"),iconOnly:!0,extension:"narrow"}))),b&&!p&&u&&o.a.createElement("div",{role:"button",className:c()(h.a["pho-viewer-nav"],h.a["pho-viewer-nav--previous"],O({},h.a["pho-viewer-nav--visible"],!w)),onClick:s,onMouseEnter:this.showControls,onMouseLeave:this.hideControls},o.a.createElement("div",{className:h.a["pho-viewer-nav-arrow"]})),this.renderChildren(y),b&&!p&&l&&o.a.createElement("div",{role:"button",className:c()(h.a["pho-viewer-nav"],h.a["pho-viewer-nav--next"],O({},h.a["pho-viewer-nav--visible"],!w)),onClick:f,onMouseEnter:this.showControls,onMouseLeave:this.hideControls},o.a.createElement("div",{className:h.a["pho-viewer-nav-arrow"]})))}},{key:"renderChildren",value:function(e){return e?o.a.cloneElement(e[0],{gestures:this.state.gestures,gesturesRef:this.wrapped,onSwipe:this.onSwipe}):null}}])&&y(n.prototype,a),i&&y(n,i),t}();E.propTypes={currentFile:f.a.object.isRequired,onClose:f.a.func.isRequired,hasPrevious:f.a.bool.isRequired,hasNext:f.a.bool.isRequired,onPrevious:f.a.func.isRequired,onNext:f.a.func.isRequired,isMobile:f.a.bool.isRequired,expanded:f.a.bool.isRequired,controls:f.a.bool.isRequired,isMobileApp:f.a.bool.isRequired};var k=Object(p.c)()(E),S=n("zGKU"),x=n("510Z"),j=Object(p.c)()(function(e){var t=e.t,n=e.onReload;return o.a.createElement("div",{className:h.a["pho-viewer-canceled"]},o.a.createElement("h2",null,t("Viewer.loading.error")),o.a.createElement(d.a,{onClick:n,label:t("Viewer.loading.retry")}))});function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){R(e,t,n[t])})}return e}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D=function(e,t,n){return Math.max(e,Math.min(n,t))},L=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=N(t).call(this,e),n=!o||"object"!==C(o)&&"function"!=typeof o?T(r):o,R(T(n),"reload",function(){n.setState(function(e){return P({},e,{loading:!0,canceled:!1})})}),R(T(n),"onImageError",function(){n.setState(function(e){return P({},e,{loading:!1,canceled:!0})})}),R(T(n),"onImageLoad",function(){n.setState(function(e){return P({},e,{loading:!1})})}),R(T(n),"onSwipe",function(e){n.state.scale>1||(n.gestures.off("pan"),n.gestures.off("panend"),n.props.onSwipe(e))}),n.state={loading:!0,canceled:!1,scale:1,offsetX:0,offsetY:0,initialOffset:{x:0,y:0},initialScale:0,momentum:{x:0,y:0}},n}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,r["Component"]),n=t,(a=[{key:"componentWillReceiveProps",value:function(e){e.file&&this.props.file&&e.file.id!==this.props.file.id&&(this.tearDownGestures(),this.setState({loading:!0,canceled:!1,scale:1,offsetX:0,offsetY:0}))}},{key:"componentDidMount",value:function(){this.props.gestures&&this.initGestures()}},{key:"componentDidUpdate",value:function(e,t){var n=t.loading&&!this.state.loading&&!this.state.canceled;e.gestures||this.initGestures(),n&&this.setupGestures()}},{key:"componentWillUnmount",value:function(){this.tearDownGestures()}},{key:"tearDownGestures",value:function(){this.gestures.off("swipe"),this.gestures.on("swipe",this.props.onSwipe),this.gestures.off("panstart"),this.gestures.off("pinchstart"),this.gestures.off("pinchend"),this.gestures.off("pan"),this.gestures.off("pinch"),this.gestures.off("panend")}},{key:"initGestures",value:function(){this.gestures=this.props.gestures,this.viewer=this.props.gesturesRef}},{key:"setupGestures",value:function(){var e=this;this.gestures.off("swipe"),this.gestures.on("swipe",this.onSwipe),this.gestures.get("pinch").set({enable:!0}),this.gestures.get("pan").set({direction:l.a.DIRECTION_ALL}),this.gestures.on("panstart",this.prepareForGesture.bind(this)),this.gestures.on("pinchstart",this.prepareForGesture.bind(this)),this.gestures.on("pinchend",this.prepareForGesture.bind(this)),this.gestures.on("pan",function(t){e.setState(function(n){var r=e.computeMaxOffset();return{offsetX:D(-r.x,n.initialOffset.x+t.deltaX/n.scale,r.x),offsetY:D(-r.y,n.initialOffset.y+t.deltaY/n.scale,r.y)}})}),this.gestures.on("pinch",function(t){t.isFinal||e.setState(function(n){var r=D(1/n.initialScale,t.scale,6/n.initialScale),o=e.viewer.getBoundingClientRect(),a=(o.right-o.left)/2,i=(o.bottom-o.top)/2,c=(a-t.center.x)/n.scale,u=(i-t.center.y)/n.scale,l=u*r,s={x:c*r-c+n.initialOffset.x,y:l-u+n.initialOffset.y},f=e.computeMaxOffset();return{scale:n.initialScale*r,offsetX:D(-f.x,s.x,f.x),offsetY:D(-f.y,s.y,f.y)}})}),this.gestures.on("panend",function(t){e.setState({momentum:{x:10*t.velocityX,y:10*t.velocityY}},e.applyMomentum.bind(e))})}},{key:"render",value:function(){var e=this;if(this.state.canceled)return o.a.createElement(j,{onReload:this.reload});var t=this.props.file,n=this.state,r=n.scale,a=n.offsetX,i=n.offsetY,c={transform:"scale(".concat(r,") translate(").concat(a,"px, ").concat(i,"px)")};return o.a.createElement("div",{className:h.a["pho-viewer-imageviewer"]},this.state.loading&&o.a.createElement(S.a,{size:"xxlarge",middle:!0,noMargin:!0,color:"white"}),t&&o.a.createElement(x.a,{file:t,size:"large",ref:function(t){e.photo=o.a.findDOMNode(t)},onError:this.onImageError,key:t.id,render:function(n){return o.a.createElement("img",{style:c,alt:t.name,src:n,onLoad:e.onImageLoad})}}))}},{key:"prepareForGesture",value:function(){this.setState(function(e){return{initialScale:e.scale,initialOffset:{x:e.offsetX,y:e.offsetY},momentum:{x:0,y:0}}})}},{key:"applyMomentum",value:function(){var e=this;this.setState(function(t){var n=e.computeMaxOffset();return{offsetX:D(-n.x,t.offsetX+t.momentum.x,n.x),offsetY:D(-n.y,t.offsetY+t.momentum.y,n.y),momentum:{x:.9*t.momentum.x,y:.9*t.momentum.y}}},function(){(Math.abs(e.state.momentum.x)>.1||Math.abs(e.state.momentum.y)>.1)&&requestAnimationFrame(e.applyMomentum.bind(e))})}},{key:"computeMaxOffset",value:function(){if(this.viewer&&this.photo){var e=this.viewer.getBoundingClientRect(),t=this.photo.getBoundingClientRect();return{x:Math.max(t.width/2-e.width/2,0)/this.state.scale,y:Math.max(t.height/2-e.height/2,0)/this.state.scale}}return{x:0,y:0}}}])&&A(n.prototype,a),i&&A(n,i),t}();function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){V(e,t,n[t])})}return e}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H="LOADING",Q=function(e){return function(t){function n(){var e,t,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=B(n)).call.apply(e,[this].concat(i)),t=!o||"object"!==I(o)&&"function"!=typeof o?q(r):o,V(q(t),"state",{status:H,downloadUrl:null}),V(q(t),"reset",function(){t.setState({status:H,downloadUrl:null})}),t}var a,i,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(n,r.Component),a=n,(i=[{key:"componentWillMount",value:function(){this.loadDownloadUrl()}},{key:"componentWillReceiveProps",value:function(e){e.file.id!==this.props.file.id&&this.reset()}},{key:"componentDidUpdate",value:function(){this.state.status!==H||this.timeout||this.loadDownloadUrl()}},{key:"loadDownloadUrl",value:function(){var e=this;this.timeout=setTimeout(function(){return e.setState(function(e){return M({},e,{status:"FAILED"})})},6e3),this.getDownloadLink(this.props.file).then(function(t){e.clearTimeout(),e.setState({downloadUrl:t,status:"LOADED"})}).catch(function(){e.clearTimeout(),e.setState(function(e){return M({},e,{status:"FAILED"})})})}},{key:"getDownloadLink",value:function(e){return this.context.client?this.context.client.collection("io.cozy.files").getDownloadLinkById(e._id):cozy.client.files.getDownloadLinkById(e._id).then(function(e){return"".concat(cozy.client._url).concat(e)})}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){clearTimeout(this.timeout),this.timeout=null})},{key:"render",value:function(){return this.state.status===H?o.a.createElement(S.a,{size:"xxlarge",middle:!0,noMargin:!0,color:"white"}):"FAILED"===this.state.status?o.a.createElement(j,{onReload:this.reset}):o.a.createElement(e,F({},this.props,{url:this.state.downloadUrl}))}}])&&U(a.prototype,i),c&&U(a,c),n}()},W=Q(function(e){var t=e.file,n=e.url;return o.a.createElement("div",{className:h.a["pho-viewer-audioviewer"]},o.a.createElement("p",{className:h.a["pho-viewer-filename"]},t.name),o.a.createElement("audio",{src:n,controls:"controls"}))}),G=Q(function(e){var t=e.file,n=e.url;return o.a.createElement("div",{className:h.a["pho-viewer-videoviewer"]},o.a.createElement("video",{src:n,controls:"controls"}),o.a.createElement("p",{className:h.a["pho-viewer-filename"]},t.name))}),K=n("o0o1"),X=n.n(K),Z=n("/MKj"),J=n("Q2ax"),$=n("qxHO"),ee=n("snfs"),te=n("B7OX"),ne=n("oAJy"),re=n.n(ne),oe=n("IFEr");function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ue(e){return(ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var pe=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=ue(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==ae(o)&&"function"!=typeof o?le(r):o,fe(le(n),"state",{mustShow:!1}),fe(le(n),"markAsSeen",function(){re.a.setItem(oe.b,!0),n.setState({mustShow:!1})}),n}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}(t,r["Component"]),n=t,(a=[{key:"componentDidMount",value:function(){var e,t=(e=X.a.mark(function e(){return X.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re.a.getItem(oe.b);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=!1;case 5:if(e.t0){e.next=17;break}return e.prev=7,e.next=10,Object(oe.d)();case 10:!e.sent&&this.setState({mustShow:!0}),e.next=17;break;case 14:e.prev=14,e.t1=e.catch(7),this.setState({mustShow:!1});case 17:case"end":return e.stop()}},e,this,[[7,14]])}),function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){ie(a,r,o,i,c,"next",e)}function c(e){ie(a,r,o,i,c,"throw",e)}i(void 0)})});return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){if(!this.state.mustShow)return null;var e=this.props.t;return o.a.createElement("div",{className:h.a["pho-viewer-noviewer-cta"]},o.a.createElement(te.a,{className:h.a["pho-viewer-noviewer-cta-cross"],color:"white",icon:"cross",onClick:this.markAsSeen}),o.a.createElement("h3",null,e("Viewer.noviewer.cta.saveTime")),o.a.createElement("ul",null,o.a.createElement("li",null,o.a.createElement("a",{target:"_blank",href:e(Object(oe.f)()?"Nav.link-client":"Nav.link-client-desktop")},e("Viewer.noviewer.cta.installDesktop"))),o.a.createElement("li",null,e("Viewer.noviewer.cta.accessFiles"))))}}])&&ce(n.prototype,a),i&&ce(n,i),t}(),de=n("iTW1");function me(e){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){xe(e,t,n[t])})}return e}function be(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function ye(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){be(a,r,o,i,c,"next",e)}function c(e){be(a,r,o,i,c,"throw",e)}i(void 0)})}}function ve(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ge(e,t,n){return t&&we(e.prototype,t),n&&we(e,n),e}function Oe(e,t){return!t||"object"!==me(t)&&"function"!=typeof t?Ee(e):t}function _e(e){return(_e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ee(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ke(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Se(e,t)}function Se(e,t){return(Se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var je=function(e){function t(){var e,n;ve(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return xe(Ee(n=Oe(this,(e=_e(t)).call.apply(e,[this].concat(o)))),"state",{loading:!1}),xe(Ee(n),"onClick",ye(X.a.mark(function e(){var t,r,o;return X.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props,r=t.onClick,o=t.onError,n.setState(function(e){return he({},e,{loading:!0})}),e.prev=2,e.next=5,r();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),o(e.t0);case 10:n.setState(function(e){return he({},e,{loading:!1})});case 11:case"end":return e.stop()}},e,null,[[2,7]])}))),n}return ke(t,o.a.Component),ge(t,[{key:"render",value:function(){var e=this.props,t=e.label,n=e.className;return o.a.createElement(d.a,{busy:this.state.loading,className:n,onClick:this.onClick,label:t})}}]),t}(),Ce=Object(Z.connect)(null,function(e,t){return{openLocalFileCopy:function(){return e(Object(de.d)(t.file))}}})(function(e){var t=e.t,n=e.openLocalFileCopy,r=e.onError;return o.a.createElement(je,{className:h.a["pho-viewer-noviewer-download"],onClick:n,onError:r,label:t("Viewer.noviewer.openWith")})}),Pe=function(e){var t=e.t,n=e.url;return o.a.createElement(d.a,{className:h.a["pho-viewer-noviewer-download"],onClick:function(){return window.open(n,"_system")},label:t("Viewer.noviewer.openWith")})},Ae=function(e,t){var n=e.t,r=e.file,a=t.client;return o.a.createElement(d.a,{className:h.a["pho-viewer-noviewer-download"],onClick:function(){return a.collection("io.cozy.files").download(r)},label:n("Viewer.noviewer.download")})},Ne=function(e){var t=e.file,n=e.fallbackUrl,r=e.t,a=e.onError;return Object(ee.isMobileApp)()?o.a.createElement(Ce,{t:r,file:t,onError:a}):n?o.a.createElement(Pe,{t:r,url:n}):o.a.createElement(Ae,{t:r,file:t})},Te=function(e){function t(){var e,n;ve(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return xe(Ee(n=Oe(this,(e=_e(t)).call.apply(e,[this].concat(o)))),"state",{error:null}),n}return ke(t,o.a.Component),ge(t,[{key:"render",value:function(){var e=this.props,t=e.t,n=e.file,r=e.fallbackUrl,a=void 0!==r&&r;return o.a.createElement("div",{className:c()(h.a["pho-viewer-noviewer"],h.a["pho-viewer-noviewer--".concat(n.class)])},o.a.createElement("p",{className:h.a["pho-viewer-filename"]},n.name),o.a.createElement(Ne,{file:n,fallbackUrl:a,t:t,onError:function(e){/^Activity not found/.test(e.message)?J.a.error("Viewer.error.noapp",e):(Object($.b)(e),J.a.error("Viewer.error.generic",e))}}),o.a.createElement(pe,{t:t}))}}]),t}(),ze=Object(p.c)()(Te);var Re=Q(function(e){var t,n,r,a=e.file,i=e.url;return o.a.createElement("div",{className:c()(h.a["pho-viewer-pdfviewer"],(t={},n=h.a["pho-viewer-pdfviewer-ios"],r=Object(ee.isIOS)(),n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t))},o.a.createElement("object",{data:i,type:"application/pdf",className:"vui-fileviewer-pdf-native"},o.a.createElement(ze,{file:a,fallbackUrl:i})))}),De=n("1aVK");function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function Fe(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Ie(a,r,o,i,c,"next",e)}function c(e){Ie(a,r,o,i,c,"throw",e)}i(void 0)})}}function Me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Be(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qe(e,t){return(qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ve={email:{enabled:!0},print:{enabled:!0},openWith:{enabled:!1},bookmarks:{enabled:!0},search:{enabled:!1},autoClose:{onPause:!1}},He=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=Ue(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==Le(o)&&"function"!=typeof o?Be(r):o,Ye(Be(n),"state",{opening:!0,error:null}),Ye(Be(n),"onOpen",function(){n.setState({opening:!1})}),Ye(Be(n),"onClose",function(){n.props.onClose()}),Ye(Be(n),"onError",function(e){console.warn(e),n.setState({error:e})}),Ye(Be(n),"componentWillMount",Fe(X.a.mark(function e(){var t;return X.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.props.getLocalFileCopyUrl(n.props.file);case 3:t=e.sent,n.openPdfInExternalViewer(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n.onError(e.t0);case 10:case"end":return e.stop()}},e,null,[[0,7]])}))),Ye(Be(n),"openPdfInExternalViewer",function(e){var t=n.props.t;cordova.plugins.SitewaertsDocumentViewer.viewDocument(e,"application/pdf",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Ye(e,t,n[t])})}return e}({},Ve,{documentView:{closeLabel:t("Viewer.close")},navigationView:{closeLabel:t("Viewer.close")},title:n.props.file.name}),n.onOpen,n.onClose,function(){return n.openPdfWithSystem(e)},n.onError)}),Ye(Be(n),"openPdfWithSystem",function(){var e=Fe(X.a.mark(function e(t){return X.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,document.addEventListener("resume",n.onSystemPdfViewerExit,!1),e.next=4,Object(De.d)(t,"application/pdf");case 4:n.onOpen(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n.onError(e.t0);case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}()),Ye(Be(n),"onSystemPdfViewerExit",function(){document.removeEventListener("resume",n.onSystemPdfViewerExit),n.onClose()}),n}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qe(e,t)}(t,r["Component"]),n=t,(a=[{key:"componentWillUnmount",value:function(){document.removeEventListener("resume",this.onSystemPdfViewerExit)}},{key:"render",value:function(){var e=this.props.file,t=this.state,n=t.opening,r=t.error;return n&&!r?o.a.createElement(S.a,{size:"xxlarge",middle:!0,noMargin:!0,color:"white"}):r?o.a.createElement(ze,{file:e}):o.a.createElement("div",{className:c()(h.a["pho-viewer-noviewer"],h.a["pho-viewer-noviewer--".concat(e.class)])},o.a.createElement("p",{className:h.a["pho-viewer-filename"]},e.name))}}])&&Me(n.prototype,a),i&&Me(n,i),t}(),Qe=Object(p.c)()(Object(Z.connect)(null,function(e){return{getLocalFileCopyUrl:function(t){return e(Object(de.b)(t))}}})(He)),We=n("IujW"),Ge=n.n(We);function Ke(e){return(Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xe(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function Ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Je(e){return(Je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function et(e,t){return(et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var tt=function(e){var t=e.text;return o.a.createElement(Ge.a,{className:c()(h.a["pho-viewer-textviewer-content"],"u-p-1"),source:t})},nt=function(e){var t=e.text;return o.a.createElement("pre",{className:c()(h.a["pho-viewer-textviewer-content"],"u-mh-auto","u-mv-2")},t)},rt=function(){return o.a.createElement("div",{className:h.a["pho-viewer-textviewer"]},o.a.createElement(S.a,{size:"xxlarge",middle:!0,noMargin:!0,color:"white"}))},ot=Q(function(e){function t(){var e,n,r,o,a,i,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var u=arguments.length,l=new Array(u),s=0;s<u;s++)l[s]=arguments[s];return r=this,n=!(o=(e=Je(t)).call.apply(e,[this].concat(l)))||"object"!==Ke(o)&&"function"!=typeof o?$e(r):o,a=$e(n),c={text:"",isMarkdown:!1,loading:!0,error:null},(i="state")in a?Object.defineProperty(a,i,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[i]=c,n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&et(e,t)}(t,o.a.Component),n=t,(r=[{key:"componentDidMount",value:function(){this.loadFile()}},{key:"loadFile",value:function(){var e,t=(e=X.a.mark(function e(){var t,n,r,o,a,i,c,u;return X.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,n=t.url,r=t.file,e.prev=1,o=new URL(n),a=this.context.client.getClient(),e.next=6,a.fetch("GET",o.pathname);case 6:return i=e.sent,e.next=9,i.text();case 9:c=e.sent,u="text/markdown"===r.mime||/.md$/.test(r.name),this.setState({text:c,isMarkdown:u,loading:!1}),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.warn(e.t0),this.setState({loading:!1,error:e.t0});case 18:case"end":return e.stop()}},e,this,[[1,14]])}),function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Xe(a,r,o,i,c,"next",e)}function c(e){Xe(a,r,o,i,c,"throw",e)}i(void 0)})});return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.error,r=e.text,a=e.isMarkdown,i=this.props,u=i.url,l=i.file;return t?o.a.createElement(rt,null):n?o.a.createElement(ze,{file:l,fallbackUrl:u}):o.a.createElement("div",{className:h.a["pho-viewer-textviewer"]},o.a.createElement("h2",{className:c()(h.a["pho-viewer-filename"],"u-mt-2","u-mb-1")},l.name),a?o.a.createElement(tt,{text:r}):o.a.createElement(nt,{text:r}))}}])&&Ze(n.prototype,r),a&&Ze(n,a),t}());function at(e){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function it(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ct(e){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ut(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lt(e,t){return(lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ft=37,pt=39,dt=27,mt=function(e){var t,n=e.style,r=e.className,a=e.children,i=e.fullscreen,u=e.dark;return o.a.createElement("div",{style:n,"data-test-id":"pho-viewer-wrapper",className:c()(h.a["pho-viewer-wrapper"],r,(t={},st(t,h.a["pho-viewer-wrapper--notfullscreen"],!i),st(t,h.a["pho-viewer-wrapper--light"],!u),t)),role:"viewer"},a)},ht=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=ct(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==at(o)&&"function"!=typeof o?ut(r):o,st(ut(n),"onKeyUp",function(e){e.keyCode===ft?n.onPrevious():e.keyCode===pt?n.onNext():e.keyCode===dt&&n.onClose()}),st(ut(n),"onNext",function(){var e=n.props,t=e.files,r=e.currentIndex;if(r!==t.length-1){var o=r+1,a=t[o];n.onChange(a,o)}}),st(ut(n),"onPrevious",function(){var e=n.props,t=e.files,r=e.currentIndex;if(0!==r){var o=r-1,a=t[o];n.onChange(a,o)}}),st(ut(n),"onClose",function(){n.props.onClose&&n.props.onClose()}),n}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lt(e,t)}(t,r["Component"]),n=t,(a=[{key:"componentDidMount",value:function(){document.addEventListener("keyup",this.onKeyUp,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.onKeyUp,!1)}},{key:"onChange",value:function(e,t){this.props.onChange&&this.props.onChange(e,t)}},{key:"render",value:function(){var e=this.props,t=e.files,n=e.style,r=e.className,a=e.currentIndex,i=e.onClose,c=e.fullscreen,u=void 0===c||c,l=e.dark,s=void 0===l||l,f=e.controls,p=void 0===f||f,d=t[a],m=a>0,h=a<t.length-1,b=d&&"image"===d.class;return o.a.createElement(mt,{style:n,className:r,fullscreen:u,dark:s},o.a.createElement(k,{currentFile:d,onClose:i,hasPrevious:m,hasNext:h,onPrevious:this.onPrevious,onNext:this.onNext,isMobile:Object(ee.isMobile)(),expanded:b,controls:p,isMobileApp:Object(ee.isMobileApp)()},this.renderViewer(d)))}},{key:"renderViewer",value:function(e){if(!e)return null;var t=this.props.onClose,n=this.getViewerComponentName(e);return o.a.createElement(n,{file:e,onClose:t})}},{key:"getViewerComponentName",value:function(e){switch(e.class){case"image":return L;case"audio":return W;case"video":return Object(ee.isMobile)()?ze:G;case"pdf":return Object(ee.isMobileApp)()?Qe:Re;case"text":return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e?/^text\//.test(e):/\.(txt|md)$/.test(t)}(e.mime,e.name)?ot:ze;default:return ze}}}])&&it(n.prototype,a),i&&it(n,i),t}();function bt(e){return(bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yt(){return(yt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function wt(e,t){return!t||"object"!==bt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function gt(e){return(gt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ot(e,t){return(Ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _t=function(e){var t=e.location.pathname;return t.substring(0,t.lastIndexOf("/"))},Et=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),wt(this,gt(t).apply(this,arguments))}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ot(e,t)}(t,r["Component"]),n=t,(a=[{key:"render",value:function(){var e=this.props,t=e.photos,n=e.params,r=e.router,a=t.findIndex(function(e){return e.id===n.photoId});return o.a.createElement(ht,yt({files:t,currentIndex:a,onChange:function(e){return r.push({pathname:"".concat(_t(r),"/").concat(e.id),query:r.location.query})},onClose:function(){return r.push({pathname:_t(r),query:r.location.query})}},this.props))}}])&&vt(n.prototype,a),i&&vt(n,i),t}();t.a=Object(a.f)(Et)},eKCf:function(e,t,n){"use strict";var r=n("VZRP"),o=n.n(r),a=n("mz5Q"),i=n.n(a),c=n("XOpu"),u=n("+FsC"),l=n("dtw8"),s=n("17x9"),f=n.n(s),p=n("56YH"),d=n.n(p);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),e}function v(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?g(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=cozy.bar,S=k.BarCenter,x=k.BarRight,j=k.BarLeft,C=13,P=27,A=function(e){function t(e){var n;return h(this,t),E(g(n=v(this,w(t).call(this,e))),"handleBlur",function(e){!n.ignoreBlurEvent&&n.props.onEdit&&n.props.onEdit(""!==e.target.value.trim()?e.target.value:n.props.albumName)}),E(g(n),"handleKeyDown",function(e){e.keyCode===C&&n.props.onEdit?(n.ignoreBlurEvent=!0,n.props.onEdit(e.target.value)):e.keyCode===P&&n.props.onEdit&&(n.ignoreBlurEvent=!0,n.props.onEdit(n.props.albumName))}),n.ignoreBlurEvent=!1,n.inputElement=null,n}return O(t,a["Component"]),y(t,[{key:"componentDidMount",value:function(){null!==this.inputElement&&(this.inputElement.focus(),this.inputElement.select())}},{key:"render",value:function(){var e=this,t=this.props.albumName;return i.a.createElement("input",{type:"text",value:t,onKeyDown:this.handleKeyDown,onBlur:this.handleBlur,ref:function(t){e.inputElement=t}})}}]),t}();A.propTypes={albumName:f.a.string,onEdit:f.a.func.isRequired};var N=function(e){var t=e.children;return i.a.createElement("h2",{"data-test-id":"pho-content-title",className:o.a["pho-content-title"]},t)},T=function(e){var t=e.onClick;return i.a.createElement("div",{role:"button","data-test-id":"pho-content-album-previous",className:o.a["pho-content-album-previous"],onClick:t})};T.propTypes={onClick:f.a.func.isRequired};var z=function(e){function t(){return h(this,t),v(this,w(t).apply(this,arguments))}return O(t,a["Component"]),y(t,[{key:"componentDidMount",value:function(){var e=this.props.router.location.pathname;this.parentUrl=e.substring(0,e.lastIndexOf("/"))}},{key:"renderTitle",value:function(){var e=this.props,t=e.t,n=e.viewName,r=e.albumName,o=void 0===r?"":r,a=e.onEdit,c=e.editing;return"albumContent"===n?void 0!==c&&c?i.a.createElement(A,{albumName:o,onEdit:a}):o:t("Nav.".concat(n))}},{key:"render",value:function(){var e=this,t=this.props,n=t.children,r=t.viewName,a=t.breakpoints.isMobile,c=t.router,u="albumContent"===r,l=i.a.createElement(N,null,this.renderTitle()),s=a?i.a.createElement(S,null,l):l,f=a?i.a.createElement(x,null,n):n,p=i.a.createElement(T,{onClick:function(){return c.push(e.parentUrl)}}),d=a?i.a.createElement(j,null,p):p;return i.a.createElement("div",{className:o.a["pho-content-header"]},u&&d,s,f)}}]),t}();z.propTypes={viewName:f.a.string.isRequired,albumName:f.a.string,t:f.a.func.isRequired,editing:f.a.bool,onEdit:f.a.func,breakpoints:f.a.object.isRequired,router:f.a.object.isRequired,children:f.a.node},z.defaultProps={editing:!1,onEdit:function(){}},t.a=d()(l.f,Object(u.q)(),Object(c.c)())(z)},"f/Nf":function(e,t,n){"use strict";var r=n("o0o1"),o=n.n(r),a=n("AzIT"),i=n.n(a),c=n("XOpu"),u=n("mz5Q"),l=n.n(u),s=n("IFEr"),f=n("+FsC"),p=n("oAJy"),d=n.n(p);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){O(e,t,n[t])})}return e}function b(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,n=!(o=(e=v(t)).call.apply(e,[this].concat(i)))||"object"!==m(o)&&"function"!=typeof o?w(r):o,O(w(n),"state",{mustShow:!1}),n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,u["Component"]),n=t,(r=[{key:"componentWillMount",value:function(){var e,t=(e=o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.getItem(s.a);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=!1;case 5:if(e.t0){e.next=11;break}return e.next=9,Object(s.d)();case 9:!e.sent&&this.setState(function(e){return h({},e,{mustShow:!0})});case 11:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){b(a,r,o,i,c,"next",e)}function c(e){b(a,r,o,i,c,"throw",e)}i(void 0)})});return function(){return t.apply(this,arguments)}}()},{key:"markAsSeen",value:function(e){d.a.setItem(s.a,!0),this.setState(function(e){return h({},e,{mustShow:!1})}),Object(s.g)(e)}},{key:"render",value:function(){var e=this,t=this.props.t;if(!this.state.mustShow)return null;var n=Object(s.e)()?"Nav.link-client-ios":Object(s.c)()?"Nav.link-client-android":"Nav.link-client",r=Object(s.f)()?"Nav.link-client":"Nav.link-client-desktop";return l.a.createElement("div",{className:i.a["coz-banner-client"]},l.a.createElement(f.e,{href:t(n),target:"_blank",className:i.a["coz-btn-clientMobile"],onClick:function(){e.markAsSeen("banner")},label:t("Nav.btn-client-mobile")}),l.a.createElement("p",{className:i.a["coz-banner-text"]},l.a.createElement("span",null,t("Nav.banner-txt-client")),l.a.createElement(f.e,{href:t(r),target:"_blank",theme:"alpha",onClick:function(){e.markAsSeen("banner")},label:t("Nav.banner-btn-client")})),l.a.createElement(f.d,{theme:"close",extension:"narrow",className:i.a["close-banner"],onClick:function(){e.markAsSeen("close")},icon:l.a.createElement(f.g,{icon:"cross",width:"24",height:"24"}),iconOnly:!0,label:t("SelectionBar.close")}))}}])&&y(n.prototype,r),a&&y(n,a),t}();t.a=Object(c.c)()(_)},fWVu:function(e,t,n){e.exports={container:"container--3-RCo",suggestionsContainer:"suggestionsContainer--3lRrx",suggestionsContainerOpen:"suggestionsContainerOpen--3Y523",input:"input--2DlOl",suggestionsList:"suggestionsList--35tTI",suggestion:"suggestion--iMlMu",suggestionHighlighted:"suggestionHighlighted--3v0My",recipientsContainer:"recipientsContainer--1GWdl",recipientChip:"recipientChip--1HV-h",removeRecipient:"removeRecipient--2dtVM"}},iTW1:function(e,t,n){"use strict";n.d(t,"c",function(){return l}),n.d(t,"b",function(){return s}),n.d(t,"d",function(){return f});var r=n("o0o1"),o=n.n(r),a=n("1aVK");n("snfs"),n("Q2ax");function i(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function c(e){i(a,r,o,c,u,"next",e)}function u(e){i(a,r,o,c,u,"throw",e)}c(void 0)})}}function u(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case"MAKE_AVAILABLE_OFFLINE":return[].concat(u(e),[t.id]);case"UNDO_MAKE_AVAILABLE_OFFLINE":var n=e.indexOf(t.id);return[].concat(u(e.slice(0,n)),u(e.slice(n+1)));default:return e}};var l=function(e,t){var n=e.availableOffline;return Array.isArray(n)&&-1!==n.indexOf(t)},s=function(e){return function(){var t=c(o.a.mark(function t(n,r){var i,c,u,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!l(r(),e.id)){t.next=5;break}return t.next=3,Object(a.c)(e);case 3:return i=t.sent,t.abrupt("return",i.nativeURL);case 5:return t.next=7,cozy.client.files.downloadById(e.id);case 7:return c=t.sent,t.next=10,c.blob();case 10:return u=t.sent,t.next=13,Object(a.h)(u,e.name);case 13:return s=t.sent,t.abrupt("return",s.nativeURL);case 15:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()},f=function(e){return function(){var t=c(o.a.mark(function t(n,r){var i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!l(r(),e.id)){t.next=2;break}return t.abrupt("return",Object(a.e)(e));case 2:return t.next=4,Object(a.a)(e.id,e.name);case 4:return i=t.sent,t.abrupt("return",Object(a.d)(i.nativeURL,e.mime));case 6:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()}},jrFr:function(e,t,n){e.exports={"share-modal-content":"share-modal-content--1SlxN","coz-form":"coz-form--2jtJC","coz-form-group":"coz-form-group--1bFva","coz-form-desc":"coz-form-desc--JrEED","coz-form-label":"coz-form-label--3Zm6p","coz-form-label--error":"coz-form-label--error--2KzmX","coz-form-errors":"coz-form-errors--1nNWc","coz-form-controls":"coz-form-controls--1RJGg","coz-form-controls--full":"coz-form-controls--full--2-y4G","coz-form-controls--dispatch":"coz-form-controls--dispatch--2TjNA",error:"error--3q85L","permission-required-popin":"permission-required-popin--3ZT7U",divider:"divider--3ACWO","share-bylink-header":"share-bylink-header--2919D","share-bylink-header-dot":"share-bylink-header-dot--1TAFX","share-bylink-header-creating":"share-bylink-header-creating--2F2Df","share-bylink-header-copybtn":"share-bylink-header-copybtn--397lg","share-bylink-desc":"share-bylink-desc--2lsfE","share-byemail-onlybylink":"share-byemail-onlybylink--3A-9J","share-moral-override-bottom":"share-moral-override-bottom--1I3dU","share-modal-secondary":"share-modal-secondary--3Y04a","share-modal-margins":"share-modal-margins--yhQBn","share-modal-separator":"share-modal-separator--JJuRH","share-type-control":"share-type-control--3IS3y","select-wrapper":"select-wrapper--3vfxZ","select-option":"select-option--O5o86","select-option--selected":"select-option--selected--1gEx9","select-option-label":"select-option-label--314tl","select-option-desc":"select-option-desc--1JNRs","input-dual":"input-dual--1iSDa","btn-copy":"btn-copy--1_EQX","permission-required-popin-close":"permission-required-popin-close--wbc77","permission-required-popin-accept":"permission-required-popin-accept--3gyRJ","share-details-created":"share-details-created--3qeE6","share-details-perm":"share-details-perm--1bWoi","share-details-perm-desc":"share-details-perm-desc--2uJr3",spin:"spin--260Kl"}},kKu1:function(e,t,n){e.exports={"pho-list-morebutton":"pho-list-morebutton--1HHd8","pho-list-spinner":"pho-list-spinner--2dv9a",spin:"spin--3HNuy","pho-section":"pho-section--aOGQ8","pho-photo-wrapper":"pho-photo-wrapper--34Af_","pho-section-header":"pho-section-header--3xCwP","pho-photo":"pho-photo--1RccV","pho-photo-item":"pho-photo-item--1uvPt","pho-photo-select":"pho-photo-select--2_YlY","pho-photo--selected":"pho-photo--selected--3CHFZ","pho-section--has-selection":"pho-section--has-selection--2A-rj"}},koyB:function(e){e.exports={Nav:{item_drive:"Drive",item_recent:"Recent",item_sharings:"Sharings",item_shared:"Shared by me",item_activity:"Activity",item_trash:"Trash",item_settings:"Settings",item_collect:"Administrative","btn-client":"Get Cozy Drive for desktop","btn-client-web":"Get Cozy","btn-client-mobile":"Get Cozy Drive on your mobile!","banner-txt-client":"Get Cozy Drive for Desktop and synchronise your files safely to make them accessible at all times.","banner-btn-client":"Download","link-client":"https://cozy.io/en/download/","link-client-desktop":"https://nuts.cozycloud.cc/download/channel/stable/","link-client-android":"https://play.google.com/store/apps/details?id=io.cozy.drive.mobile","link-client-ios":"https://itunes.apple.com/us/app/cozy-drive/id1224102389?mt=8","link-client-web":"https://cozy.io/try-it"},breadcrumb:{title_drive:"Drive",title_recent:"Recent",title_sharings:"Sharings",title_shared:"Shared by me",title_activity:"Activity",title_trash:"Trash"},Toolbar:{more:"More"},toolbar:{item_upload:"Upload",menu_upload:"Upload files",item_more:"More",menu_new_folder:"New folder",menu_select:"Select items",menu_download_folder:"Download folder",menu_download_file:"Download this file",menu_open_cozy:"Open in my Cozy",empty_trash:"Empty trash",share:"Share",trash:"Remove",leave:"Leave shared folder & delete it"},Share:{status:{owner:"Owner",pending:"Pending",ready:"Accepted",refused:"Refused",error:"Error",unregistered:"Error","mail-not-sent":"Pending",revoked:"Error"},type:{"one-way":"Can View","two-way":"Can Change",desc:{"one-way":"Contacts can view, download, and add the content to their Cozy. If they add the content to their Cozy, they will get updates you make to the content, but they won't be able to update it.","two-way":"Contacts can update, delete and add the content to their Cozy. Updates on the content will be seen on other Cozies."}},"locked-type-file":"Coming soon: you will be able to change permissions you grant on the file.","locked-type-folder":"Coming soon: you will be able to change permissions you grant on the folder.",recipients:{you:"You",accessCount:"%{count} people have access"},"create-cozy":"Create my cozy",members:{count:"%{count} members",others:"and 1 other… |||| and %{smart_count} others…",otherContacts:"other contact |||| other contacts"},contacts:{permissionRequired:{title:"Save your contacts in your Cozy?",desc:"Authorize the application to access to your Cozy's contacts: you'll be able to select them next time.",action:"Authorize access",success:"The application has access to your contacts"}}},Sharings:{unavailable:{title:"Switch online!",message:"An internet connection is needed to display the list of your last sharings."}},Files:{share:{cta:"Share",title:"Share",details:{title:"Sharing details",createdAt:"On %{date}",ro:"Can read",rw:"Can change",desc:{ro:"You can view, download, and add this content to your Cozy. You will get updates by the owner, but you won't be able to update this content yourself.",rw:"You can view, update, delete and add this content to your Cozy. Updates you make will be seen on other Cozies."}},sharedByMe:"Shared by me",sharedWithMe:"Shared with me",sharedBy:"Shared by %{name}",shareByLink:{subtitle:"By public link",desc:"Anyone with the provided link can see and download your files.",creating:"Creating your link...",copy:"Copy link",copied:"Link has been copied to clipboard",failed:"Unable to copy to clipboard"},shareByEmail:{subtitle:"By email",email:"To:",emailPlaceholder:"Enter the email address or name of the recipient",send:"Send",genericSuccess:"You sent an invite to %{count} contacts.",success:"You sent an invite to %{email}.",comingsoon:"Coming soon! You will be able to share documents and photos in a single click with your family, your friends, and even your coworkers. Don't worry, we'll let you know when it's ready!",onlyByLink:"This %{type} can only be shared by link, because",type:{file:"file",folder:"folder"},hasSharedParent:"it has a shared parent",hasSharedChild:"it contains a shared element"},revoke:{title:"Remove from sharing",desc:"This contact will keep a copy but the changes won't be synchrnoized anymore.",success:"You removed this shared file from %{email}."},revokeSelf:{title:"Remove me from sharing",desc:"You keep the content but it won't be updated between your Cozy anymore.",success:"You were removed from this sharing."},sharingLink:{title:"Link to share",copy:"Copy",copied:"Copied"},whoHasAccess:{title:"1 person has access |||| %{smart_count} people have access"},protectedShare:{title:"Coming soon!",desc:"Share anything by email with your family and friends!"},close:"Close",gettingLink:"Getting your link...",error:{generic:"An error occurred when creating the file share link, please try again.",revoke:"Woops, an error occurred. Please contact us so we can fix this issue as soon as possible."},specialCase:{base:"This %{type} cannot be shared but with a link as it",isInSharedFolder:"is in a shared folder",hasSharedFolder:"contains a shared folder"}},"viewer-fallback":"If the file has started downloading, you can close this.",dropzone:{teaser:"Drop files to upload them to:",noFolderSupport:"Folder drag&drop is currently not supported by your browser. Please upload your files manually."}},table:{head_name:"Name",head_update:"Last update",head_size:"Size",head_status:"Status",row_update_format:"MMM D, YYYY",row_update_format_full:"MMMM D, YYYY",row_read_only:"Share (Read only)",row_read_write:"Share (Read & Write)",row_size_symbols:{B:"B",KB:"KB",MB:"MB",GB:"GB",TB:"TB",PB:"PB",EB:"EB",ZB:"ZB",YB:"YB"},load_more:"Load More",mobile:{head_name_asc:"A-Z",head_name_desc:"Z-A",head_updated_at_asc:"Oldest first",head_updated_at_desc:"Most recent first",head_size_asc:"Lightest first",head_size_desc:"Heavier first"}},SelectionBar:{selected_count:"item selected |||| items selected",share:"Share",download:"Download",trash:"Remove",destroy:"Delete permanently",rename:"Rename",restore:"Restore",close:"Close",openWith:"Open with",moveto:"Move to…","phone-download":"Make available offline"},deleteconfirmation:{title:"Delete this element? |||| Delete these elements?",trash:"It will be moved to the Trash. |||| They will be moved to the Trash.",restore:"You can still restore it whenever you want. |||| You can still restore them whenever you want.",shared:"The following contacts whom you shared it with will keep a copy but your changes won't be synchronized anymore. |||| The following contacts whom you shared them with will keep a copy but your changes won't be synchronized anymore",referenced:"Some of the files within the selection are related to a photo album. They will be removed from it if you proceed to trash them.",cancel:"Cancel",delete:"Remove"},emptytrashconfirmation:{title:"Permanently delete?",forbidden:"You won't be able to access these files anymore.",restore:"You won't be able to restore these files if you didn't make a backup.",cancel:"Cancel",delete:"Delete all"},destroyconfirmation:{title:"Permanently delete?",forbidden:"You won't be able to access this file anymore. |||| You won't be able to access these files anymore.",restore:"You won't be able to restore this file if you didn't make a backup. |||| You won't be able to restore these files if you didn't make a backup.",cancel:"Cancel",delete:"Delete permanently"},quotaalert:{title:"Your disk space is full :(",desc:" Please remove files and empty your trash before uploading files again.",confirm:"OK"},loading:{message:"Loading"},empty:{title:"You don’t have any files in this folder.",text:'Click the "upload" button to add files to this folder.',trash_title:"You don’t have any deleted files.",trash_text:"Move files you don't need anymore to the Trash and permanently delete items to free up storage page."},error:{open_folder:"Something went wrong when opening the folder.",button:{reload:"Refresh now"},download_file:{offline:"You should be connected to download this file",missing:"This file is missing"}},Error:{public_unshared_title:"Sorry, this link is no longer available.",public_unshared_text:"This link has expired, or it was removed by its owner. Let him or her know that you missed it!"},alert:{could_not_open_file:"The file could not be opened",try_again:"An error has occurred, please try again in a moment.",restore_file_success:"The selection has been successfully restored.",trash_file_success:"The selection has been moved to the Trash.",destroy_file_success:"The selection has been deleted permanently.",empty_trash_progress:"Your trash is being emptied. This might take a few moments.",empty_trash_success:"The trash has been emptied.",folder_name:"The element %{folderName} already exists, please choose a new name.",folder_generic:"An error occurred, please try again.",folder_abort:"You need to add a name to your new folder if you would like to save it. Your information has not been saved.",offline:"This feature is not available offline.",preparing:"Preparing your files…"},mobile:{onboarding:{welcome:{title:"Cozy Drive",desc:"Create a Cozy or sign in to access Cozy Drive",button:"Sign in",no_account_link:"I don't have a Cozy",create_my_cozy:"Create my Cozy"},server_selection:{title:"Sign in",lostpwd:"[I forgot the address of my Cozy](https://manager.cozycloud.cc/cozy/reminder)",label:"Address of my Cozy",cozy_address_placeholder:"claude",cozy_custom_address_placeholder:"claude.mydomain.com",domain_cozy:".mycozy.cloud",domain_custom:"other",button:"Next",wrong_address_with_email:"You typed an email address. To connect on your cozy you must type its url, something like https://camillenimbus.mycozy.cloud",wrong_address_v2:"You have just entered the address of old Cozy version. This application is only compatible with the latest version. [Please refer to our site for more information.](https://blog.cozycloud.cc/post/2016/11/21/On-the-road-to-Cozy-version-3?lang=en)",wrong_address:"This address doesn’t seem to be a cozy. Please check the address you provide.",wrong_address_cosy:'Woops, the address is not correct. Try with "cozy" with a "z"!'},files:{title:"Access your drive",description:"In order to save your Cozy Drive on your device, the application must access your files."},photos:{title:"Backup your photos and videos",description:"Automatically backup the photos taken with your phone to your Cozy, so you never lose them."},contacts:{title:"Sync your contacts",description:"Save your phone's contact on your Cozy — this will facilitate sharing files with them."},step:{button:"Enable now",skip:"Later",next:"Next"},analytics:{title:"Help us improve Cozy",description:"The application will automatically provide data (mainly errors) to Cozy Cloud. It will allow us to resolve problems faster."}},settings:{title:"Settings",about:{title:"About",app_version:"App Version",account:"Account"},unlink:{title:"Reset this application",description:"By clicking Reset, you will be able to start your application over, and will only lose the data saved on your smartphone.",button:"Reset",confirmation:{title:"Reset this application?",description:"By logging out of your Cozy, you will erase all data synchronized locally by your mobile application.",cancel:"Cancel",unlink:"Reset"}},media_backup:{media_folder:"Photos",backup_folder:"Backed up from my mobile",legacy_backup_folder:"Backuped from my mobile",title:"Media Backup",images:{title:"Backup images",label:"Backup your images automatically to your Cozy not to ever lose them and share them easily."},launch:"Launch Backup",stop:"Stop Backup",wifi:{title:"Backup on WIFI only",label:"If the option is enabled, your device will only backup photos when it's on WIFI in order to save your package."},media_upload:"%{smart_count} remaining picture |||| %{smart_count} remaining pictures",media_uptodate:"Media backup is up-to-date",preparing:"Searching for media to backup...",no_wifi:"Please connect to a WIFI",quota:"Storage limit nearly reached",quota_contact:"Manage your storage space"},support:{title:"Support",analytics:{title:"Help us improve Cozy",label:"The application will automatically provide data (mainly errors) to Cozy Cloud. It will allow us to resolve problems faster."},feedback:{title:"Help improve Cozy Drive",description:"Send your feedback to help us improve Cozy Drive. Click on the button below, explain the problem or make a suggestion and send it. You're done!",button:"leave feedback"},logs:{title:"Help us to understand your problem",description:"Send the application log to help us improve its quality and stability.",button:"Send my logs",success:"Thanks, we will investigate your problem and contact you soon.",error:"A problem happened, logs couldn't be sent, please try again."}},contacts:{title:"Contacts",subtitle:"Import contacts",text:"Import the contacts from your device to your Cozy to easily share content with them."}},error:{open_with:{offline:"You should be connected to open this file",noapp:"No application can open this file"},make_available_offline:{offline:"You should be connected to open this file",noapp:"No application can open this file"}},revoked:{title:"Access revoked",description:"It appears you revoked this device from your Cozy. If you didn't, please let us know at contact@cozycloud.cc. All your local data related to your Cozy will be removed.",loginagain:"Log in again",logout:"Log out"},rating:{enjoy:{title:"Enjoying Cozy Drive?",yes:"Yes!",no:"Not really"},rate:{title:"Would you mind rating it?",yes:"Let's do that!",no:"No, thanks",later:"Maybe later"},feedback:{title:"Would you mind giving us some feedback?",yes:"Send",no:"No, thanks"},email:{subject:"Feedback on Cozy Drive",placeholder:"Hello, I think Cozy Drive would be better if…"},alert:{rated:"Thank you! You're ⭐️⭐️⭐️⭐️⭐️",declined:"Awesome. You will love the upcoming features. Stay Cozy!",later:"No problem, we'll ask again later.",feedback:"Thank you for the feedback. We'll definitely work on it!"}},first_sync:{title:"You are about to start your first photos back up 🎉",tips:"Tips",tip_bed:"Open Cozy Drive before you go to bed or when you don't use your phone.",tip_wifi:"Enable Wi-Fi to preserve your data.",tip_lock:"Disable your lock screen.",result:"In the morning, all your photos will be stored in a safe and secure location.",button:"Got it!"},notifications:{backup_paused:"Your photos backup is paused. Keep the application open and prevent the screen from going to sleep to complete the backup."}},upload:{alert:{success:"%{smart_count} file uploaded with success. |||| %{smart_count} files uploaded with success.",success_conflicts:"%{smart_count} file uploaded with %{conflictNumber} conflict(s). |||| %{smart_count} files uploaded with %{conflictNumber} conflict(s).",errors:"Errors occurred during the file upload.",network:"You are currenly offline. Please try again once you're connected."}},intents:{alert:{error:"Unable to automatically upload the file, please upload it manually with the upload menu."},picker:{select:"Select",cancel:"Cancel",new_folder:"New folder",instructions:"Select a target"}},UploadQueue:{header:"Uploading %{smart_count} photo to Cozy Drive |||| Uploading %{smart_count} photos to Cozy Drive",header_mobile:"Uploading %{done} of %{total}",header_done:"Uploaded %{done} out of %{total} successfully",close:"close",item:{pending:"Pending"}},Viewer:{close:"Close",noviewer:{download:"Download this file",openWith:"Open with...",cta:{saveTime:"Save some time!",installDesktop:"Install the synchronization tool for your computer",accessFiles:"Access your files directly on your computer"}},actions:{download:"Download"},loading:{error:"This file could not be loaded. Do you have a working internet connection right now?",retry:"Retry"},error:{noapp:"No application found to handle this file.",generic:"An error occurred when opening this file, please try again.",noNetwork:"You're currently offline."}},Move:{to:"Move to:",action:"Move",cancel:"Cancel",title:"%{smart_count} element |||| %{smart_count} elements",success:"%{subject} has been moved to %{target}. |||| %{smart_count} elements have been moved to %{target}.",error:"Something went wrong while moving this element, please try again later. |||| Something went wrong while moving these elements, please try again later.",cancelled:"%{subject} has been moved back to it's original location. |||| %{smart_count} elements have been moved back to their original location.",cancelled_error:"Sorry, there was an error while moving the element back. |||| Sorry, there was an error while moving these elements back."},FileOpenerExternal:{fileNotFoundError:"Error: file not found"},TOS:{updated:{title:"GDPR comes into reality !",detail:"In the context of the General Data Protection Regulation, [our Terms of Service have been updated](%{link}) and will apply to all our Cozy users on May 25, 2018.",cta:"Accept TOS and continue",disconnect:"Refuse and disconnect",error:"Something went wrong, please try again later"}}}},lEMr:function(e,t,n){e.exports={"upload-queue":"upload-queue--2RXFj","upload-queue-item":"upload-queue-item--2oTRx","item-loading":"item-loading--3zXS_","item-canceled":"item-canceled--25dz7","item-failed":"item-failed--2gSpf","item-conflict":"item-conflict--3W-P5","item-loaded":"item-loaded--R-Ktt",spin:"spin--3291m","upload-queue--visible":"upload-queue--visible--frmGj","upload-queue-header":"upload-queue-header--Vz871","upload-queue-header-inner":"upload-queue-header-inner--1AQpy","btn-close":"btn-close--32K_q","upload-queue-progress":"upload-queue-progress--2O2Rw","upload-queue-content":"upload-queue-content--UNBUz","upload-queue--collapsed":"upload-queue--collapsed--nIVVP","upload-queue-list":"upload-queue-list--2dzTR","upload-queue-item--error":"upload-queue-item--error--3UNkr","upload-queue-item--done":"upload-queue-item--done--23Ps1","item-cell":"item-cell--1mZJx","item-file":"item-file--24emt","item-ext":"item-ext--3vgYK","item-image":"item-image--wp0ZG","item-status":"item-status--2Azg6","item-pending":"item-pending--wp4pw"}},luXY:function(e,t,n){e.exports={"pho-create-album-form":"pho-create-album-form--xgUhP",error:"error--2VcpR","coz-create-album-label":"coz-create-album-label--2zpY4","coz-inline-form":"coz-inline-form--3COco","coz-input-text":"coz-input-text--ZuuYG","create-button":"create-button--1cJgR",spin:"spin--1T4Vk"}},mdCN:function(e,t,n){e.exports={"fil-file-name-input":"fil-file-name-input--2jfPV",error:"error--2QCXU",spin:"spin--3eqnH"}},nY3O:function(e,t,n){var r={"./_lib/build_formatting_tokens_reg_exp/index":"kOWh","./ar/build_distance_in_words_locale/index":"XxX6","./ar/build_format_locale/index":"alis","./ar/index":"EDRf","./bg/build_distance_in_words_locale/index":"7K3h","./bg/build_format_locale/index":"RrdL","./bg/index":"isx8","./ca/build_distance_in_words_locale/index":"wqqj","./ca/build_format_locale/index":"qcV0","./ca/index":"Vwa+","./cs/build_distance_in_words_locale/index":"ZKDM","./cs/build_format_locale/index":"ipyF","./cs/index":"dvhP","./da/build_distance_in_words_locale/index":"2Mgc","./da/build_format_locale/index":"Gned","./da/index":"7ur/","./de/build_distance_in_words_locale/index":"5IWf","./de/build_format_locale/index":"THCn","./de/index":"bgw5","./el/build_distance_in_words_locale/index":"o/GB","./el/build_format_locale/index":"8T9h","./el/index":"dH0v","./en/build_distance_in_words_locale/index":"LZbM","./en/build_format_locale/index":"6DAA","./en/index":"Us+F","./eo/build_distance_in_words_locale/index":"qrnn","./eo/build_format_locale/index":"Bl15","./eo/index":"UB7v","./es/build_distance_in_words_locale/index":"GEfZ","./es/build_format_locale/index":"O+zC","./es/index":"/S0t","./fi/build_distance_in_words_locale/index":"VHtQ","./fi/build_format_locale/index":"Oydx","./fi/index":"ndVD","./fil/build_distance_in_words_locale/index":"uq4p","./fil/build_format_locale/index":"d7hw","./fil/index":"pNfm","./fr/build_distance_in_words_locale/index":"IzMR","./fr/build_format_locale/index":"I3Zg","./fr/index":"LKA2","./hr/build_distance_in_words_locale/index":"DPvn","./hr/build_format_locale/index":"puw3","./hr/index":"L9Jq","./hu/build_distance_in_words_locale/index":"w2RQ","./hu/build_format_locale/index":"/0iD","./hu/index":"Nm+E","./id/build_distance_in_words_locale/index":"JbvB","./id/build_format_locale/index":"0wlw","./id/index":"A6C3","./is/build_distance_in_words_locale/index":"qzMC","./is/build_format_locale/index":"S3yD","./is/index":"N4bE","./it/build_distance_in_words_locale/index":"MDEp","./it/build_format_locale/index":"aUJd","./it/index":"hmb4","./ja/build_distance_in_words_locale/index":"nNvt","./ja/build_format_locale/index":"buui","./ja/index":"uAXs","./ko/build_distance_in_words_locale/index":"oEw+","./ko/build_format_locale/index":"9SQf","./ko/index":"iW8+","./mk/build_distance_in_words_locale/index":"nmwZ","./mk/build_format_locale/index":"htxJ","./mk/index":"GzBU","./nb/build_distance_in_words_locale/index":"SL1f","./nb/build_format_locale/index":"CJ5F","./nb/index":"73vv","./nl/build_distance_in_words_locale/index":"Uyu0","./nl/build_format_locale/index":"doCD","./nl/index":"hCQt","./pl/build_distance_in_words_locale/index":"FUBD","./pl/build_format_locale/index":"nOYf","./pl/index":"B6yL","./pt/build_distance_in_words_locale/index":"aTPA","./pt/build_format_locale/index":"TTT0","./pt/index":"gdks","./ro/build_distance_in_words_locale/index":"gI+A","./ro/build_format_locale/index":"njjO","./ro/index":"r2yp","./ru/build_distance_in_words_locale/index":"KmPx","./ru/build_format_locale/index":"UUBw","./ru/index":"nz/o","./sk/build_distance_in_words_locale/index":"q2Bs","./sk/build_format_locale/index":"9sxn","./sk/index":"Wqan","./sl/build_distance_in_words_locale/index":"mlv2","./sl/build_format_locale/index":"vHkZ","./sl/index":"KYSo","./sv/build_distance_in_words_locale/index":"UNBN","./sv/build_format_locale/index":"zTNB","./sv/index":"hxgj","./th/build_distance_in_words_locale/index":"XAGa","./th/build_format_locale/index":"We2s","./th/index":"Pk+z","./tr/build_distance_in_words_locale/index":"aFZF","./tr/build_format_locale/index":"jh7A","./tr/index":"3ZWG","./zh_cn/build_distance_in_words_locale/index":"KdB7","./zh_cn/build_format_locale/index":"l4EP","./zh_cn/index":"8tMq","./zh_tw/build_distance_in_words_locale/index":"vyyr","./zh_tw/build_format_locale/index":"uYH7","./zh_tw/index":"QPlQ"};function o(e){var t=a(e);return n(t)}function a(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=a,e.exports=o,o.id="nY3O"},oGE2:function(e,t,n){"use strict";n.r(t);n("59mS");var r=n("mz5Q"),o=n.n(r),a=n("fvjX"),i=n("sINF"),c=n("1mXj"),u=n("dtw8"),l=n("SH7X"),s=n.n(l),f=n("XOpu"),p=n("KHOr"),d=n("Yo2A"),m={upload:p.d,ui:d.b},h=n("0yyf"),b=n.n(h),y=n("e2oC"),v=n("c903"),w=n("VL0Z"),g=n("o0o1"),O=n.n(g),_=n("AzIT"),E=n.n(_),k=n("oAJy"),S=n.n(k),x=n("IFEr");function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){R(e,t,n[t])})}return e}function P(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,n=!(o=(e=N(t)).call.apply(e,[this].concat(i)))||"object"!==j(o)&&"function"!=typeof o?T(r):o,R(T(n),"state",{mustShow:!1}),n}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,r["Component"]),n=t,(a=[{key:"componentWillMount",value:function(){var e,t=(e=O.a.mark(function e(){return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.getItem(x.a);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=!1;case 5:if(!e.t0){e.next=11;break}return e.next=9,Object(x.d)();case 9:!e.sent&&this.setState(function(e){return C({},e,{mustShow:!0})});case 11:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){P(a,r,o,i,c,"next",e)}function c(e){P(a,r,o,i,c,"throw",e)}i(void 0)})});return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props.t;return this.state.mustShow?o.a.createElement("a",{href:e(Object(x.f)()?"Nav.link-client":"Nav.link-client-desktop"),target:"_blank",className:E.a["coz-btn-client"],onClick:function(){Object(x.g)("button")}},o.a.createElement("span",null,e("Nav.btn-client"))):null}}])&&A(n.prototype,a),i&&A(n,i),t}(),L=Object(f.c)()(D),I=n("f/Nf"),F=n("Q2ax"),M=n("H+Xc"),U=Object(w.e)(u.a),B=Object(f.c)()(function(e){var t=e.t,n=e.children;return o.a.createElement(y.b,null,o.a.createElement(v.a,{className:b.a["pho-sidebar"]},o.a.createElement(w.d,null,o.a.createElement(w.b,null,o.a.createElement(U,{to:"/photos"},o.a.createElement(w.a,{icon:"image"}),o.a.createElement(w.c,null,t("Nav.photos")))),o.a.createElement(w.b,{"data-test-id":"nav-to-albums"},o.a.createElement(U,{to:"/albums"},o.a.createElement(w.a,{icon:"album"}),o.a.createElement(w.c,null,t("Nav.albums"))))),o.a.createElement(L,null)),o.a.createElement(F.a,{t:t}),o.a.createElement(p.b,null),o.a.createElement(y.c,{className:b.a["pho-content"]},o.a.createElement(I.a,null),n),o.a.createElement(M.IconSprite,null))}),q=n("2lpW"),Y=n("MJrX"),V=n("TtgU"),H=n("NAv5"),Q=function(e,t){return e(t,"HH")},W=function(e,t){return e(t,"DD MMMM")+G(e,t)},G=function(e,t){return Object(H.isThisYear)(t)?"":e(t," YYYY")};function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function X(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function J(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var $=function(e){return e.find("io.cozy.files").where({class:"image",trashed:!1}).select(["dir_id","name","size","updated_at","metadata"]).sortBy({"metadata.datetime":"desc"}).include(["albums"])},ee=function(e){return{uploadPhoto:function(t,n){return e.upload(t,n,{updateQueries:Z({},"timeline",function(e,t){return[t.data].concat(J(e))})})},deletePhoto:function(t){return e.destroy(t,{updateQueries:Z({},"timeline",function(e,t){return e.filter(function(e){return e._id!==t.data.id})})})}}},te=function(e,t,n,r){if(n.album&&(t>0&&Object(H.differenceInCalendarDays)(e[t-1],e[t])<1||t<e.length-1&&Object(H.differenceInCalendarDays)(e[t],e[t+1])<1)){var o=new Date(n.album.period.start),a=new Date(n.album.period.end);console.log("title : ",n.title),console.log("start period : ",o);var i=n.title+" ⠂"+Q(r,o)+"h";return Object(H.differenceInHours)(a,o)>0&&(i+="-"+Q(r,a)+"h"),console.log("title hours : ",i),i}return n.title},ne=function(e,t){var n={},r=[];e.forEach(function(e){var o=(e.albums?e.albums.data:[]).find(function(e){return e.auto});if(o){var a=o.name;if(!n.hasOwnProperty(a)){var i=function(e,t){if(e.period){var n=new Date(e.period.start),r=new Date(e.period.end);return Object(H.differenceInCalendarMonths)(r,n)>0?W(t,n)+" - "+W(t,r):Object(H.differenceInCalendarDays)(r,n)>0?function(e,t){return e(t,"DD")}(t,n)+"-"+W(t,r):W(t,n)}return W(t,new Date(e.name))}(o,t);n[a]={photos:[],title:i,album:o}}n[a].photos.push(e)}else r.push(e)}),r.forEach(function(e){var r=e.metadata&&e.metadata.datetime?e.metadata.datetime:e.created_at,o=function(e,t){return Object.keys(e).find(function(n){if(e[n].album){var r=new Date(e[n].album.period.start),o=new Date(e[n].album.period.end);return t>=r&&t<=o||0===Object(H.differenceInCalendarDays)(t,o)}return 0===Object(H.differenceInCalendarDays)(t,new Date(n))})}(n,new Date(r));if(o)n[o].photos.push(e);else{var a=new Date(r),i=t(a,"YYYY-MM-DD");n[i]={key:a,title:W(t,a),photos:[e]}}});var o=Object.keys(n);return console.log("sections : ",Object.keys(n).length),o.sort(function(e,t){return new Date(t).getTime()-new Date(e).getTime()}),o.map(function(e,r){return{title:te(o,r,n[e],t),photos:n[e].photos}})},re=Object(f.c)()(function(e){return o.a.createElement(l.Query,{query:$,as:"timeline",mutations:ee},function(t,n){var r=t.data,a=X(t,["data"]);return o.a.createElement(Y.a,K({lists:r?ne(r,e.f):[],data:r},n,a,e))})});Object(f.c)()(function(e){var t=e.selection,n=X(e,["selection"]);return o.a.createElement(l.Query,{query:$},function(e){var r=e.data,a=X(e,["data"]);return o.a.createElement(V.a,K({lists:r?ne(r,n.f):[],photosContext:"timeline",onPhotoToggle:t.toggle,onPhotosSelect:t.select,onPhotosUnselect:t.unselect},a,n))})});var oe=n("SRpc"),ae=n("cwrA"),ie=o.a.createElement(u.c,{component:B},o.a.createElement(u.c,{path:"photos",component:q.b},o.a.createElement(u.c,{path:":photoId",component:ae.a})),o.a.createElement(u.c,{path:"albums",component:oe.d},o.a.createElement(u.c,{path:"new",component:oe.f}),o.a.createElement(u.c,{path:":albumId",component:oe.c},o.a.createElement(u.c,{path:"edit",component:oe.f}),o.a.createElement(u.c,{path:":photoId",component:ae.a}))),o.a.createElement(u.c,{path:"clusters",component:re},o.a.createElement(u.c,{path:":photoId",component:ae.a})),o.a.createElement(u.b,{from:"/*",to:"photos"})),ce=n("ZHai"),ue="interaction",le="upload",se="creation",fe=function(){return function(e){return function(t){return t.type===p.a?t.trackEvent={category:ue,action:le,name:"photo",value:t.files.length}:t.type===l.CREATE_DOCUMENT&&t.document&&t.document.type&&t.document.type===oe.DOCTYPE&&(t.trackEvent={category:ue,action:se,name:"album",value:1}),e(t)}}},pe=n("qxHO"),de=n("NqoY");function me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n("C9yo");var he=Object(c.createLogger)();document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("[role=application]"),t=e.dataset,c=document.documentElement.getAttribute("lang")||"en",p=window.location?window.location.protocol:"https:",d="".concat(p,"//").concat(t.cozyDomain),h=new s.a({uri:d,token:t.cozyToken,schema:de.a});cozy.client.init({cozyURL:d,token:t.cozyToken}),cozy.bar.init({appName:t.cozyAppName,appEditor:t.cozyAppEditor,iconPath:t.cozyIconPath,lang:t.cozyLocale,replaceTitleOnMobile:!0}),Object(pe.a)(),Object(pe.d)(d);var b=u.e,y=[i.default,he];if(Object(ce.e)()&&Object(ce.c)()){var v=Object(ce.c)();b=v.connectToHistory(u.e),v.track(u.e.getCurrentLocation()),y.push(fe),y.push(Object(ce.b)())}var w=a.compose,g=Object(a.createStore)(Object(a.combineReducers)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){me(e,t,n[t])})}return e}({},m,{cozy:h.reducer()})),w(a.applyMiddleware.apply(void 0,y)));Object(r.render)(o.a.createElement(f.b,{lang:c,dictRequire:function(e){return n("Gofk")("./".concat(e))}},o.a.createElement(l.CozyProvider,{store:g,client:h},o.a.createElement(u.d,{history:b,routes:ie}))),e)})},ommj:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return a});var r="io.cozy.photos.albums",o=function(e){return e&&"directory"===e.type},a=function(e){if(e.relationships&&e.relationships.referenced_by&&e.relationships.referenced_by.data&&e.relationships.referenced_by.data.length>0){var t=e.relationships.referenced_by.data,n=!0,o=!1,a=void 0;try{for(var i,c=t[Symbol.iterator]();!(n=(i=c.next()).done);n=!0){if(i.value.type===r)return!0}}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}}return!1}},"q/Uw":function(e,t,n){"use strict";n.d(t,"a",function(){return E});var r=n("mz5Q"),o=n.n(r),a=n("/tz4"),i=n.n(a),c=n("FrD0");function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var h=i()([]),b=function(){return{type:"SHOW_SELECTION_BAR"}},y=function(){return{type:"HIDE_SELECTION_BAR"}},v=function(e,t){return{type:t?"UNSELECT_ITEM":"SELECT_ITEM",item:e}},w=function(e){return{type:"ADD_TO_SELECTION",items:e}},g=function(e){return{type:"REMOVE_FROM_SELECTION",items:e}},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(t.meta&&t.meta.cancelSelection)return[];switch(t.type){case"SELECT_ITEM":return[].concat(m(e),[t.item]);case"UNSELECT_ITEM":return e.filter(function(e){return e._id!==t.item.id});case"ADD_TO_SELECTION":var n=e.map(function(e){return e._id}),r=t.items.filter(function(e){return-1===n.indexOf(e._id)});return[].concat(m(e),m(r));case"REMOVE_FROM_SELECTION":var o=t.items.map(function(e){return e._id});return e.filter(function(e){return-1===o.indexOf(e._id)});case"HIDE_SELECTION_BAR":return[];default:return e}},_=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(t.meta&&t.meta.cancelSelection)return!1;switch(t.type){case"TOGGLE_SELECTION_BAR":return!e;case"SHOW_SELECTION_BAR":return!0;case"HIDE_SELECTION_BAR":return!1;default:return e}},E=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=s(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==u(o)&&"function"!=typeof o?f(r):o,d(f(n),"state",{selected:O(void 0,{}),opened:_(void 0,{})}),d(f(n),"toggle",function(e,t){return n.dispatch(v(e,t))}),d(f(n),"select",function(e){return n.dispatch(w(e))}),d(f(n),"unselect",function(e){return n.dispatch(g(e))}),d(f(n),"clear",function(){return n.dispatch(y())}),d(f(n),"show",function(){return n.dispatch(b())}),n}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,r["Component"]),n=t,(a=[{key:"dispatch",value:function(e){this.setState(function(t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){d(e,t,n[t])})}return e}({},t,{selected:O(t.selected,e),opened:_(t.opened,e)})})}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.actions,r=void 0===n?{}:n,a=this.state,i=a.selected,u=a.opened,l=0!==i.length||u,s={toggle:this.toggle,select:this.select,unselect:this.unselect,clear:this.clear,show:this.show},f="function"==typeof r?r(s):r,p={};Object.keys(f).map(function(e){p[e]="function"==typeof f[e]?{action:f[e]}:f[e]});var d=Object.keys(p).length>0;return o.a.createElement(h.Provider,{value:i},o.a.createElement("div",null,l&&d&&o.a.createElement(c.a,{selected:i,hideSelectionBar:this.clear,actions:p}),t(i,l,s)))}}])&&l(n.prototype,a),i&&l(n,i),t}();h.Consumer},q3u0:function(e,t,n){"use strict";n.d(t,"b",function(){return b}),n.d(t,"d",function(){return v}),n.d(t,"g",function(){return w}),n.d(t,"f",function(){return g}),n.d(t,"e",function(){return O}),n.d(t,"c",function(){return _}),n.d(t,"a",function(){return E});var r=n("o0o1"),o=n.n(r),a=n("I9wM"),i=n("SH7X"),c=n.n(i),u=n("Ow0/"),l=n("UQWb"),s=n("z6Q1"),f=n("snfs");function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){d(e,t,n[t])})}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function h(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){m(a,r,o,i,c,"next",e)}function c(e){m(a,r,o,i,c,"throw",e)}i(void 0)})}}var b=function(){return navigator&&navigator.language?navigator.language.slice(0,2):"en"},y=["io.cozy.files","io.cozy.apps:GET","io.cozy.settings:GET","io.cozy.contacts","io.cozy.jobs:POST:sendmail:worker"],v=function(e){return new c.a({uri:e,scope:y,oauth:{redirectURI:Object(f.isMobileApp)()?"cozydrive://auth":"http://localhost",softwareID:u.c,clientName:"".concat(u.d," (").concat(Object(f.getDeviceName)(),")"),softwareVersion:"1.15.3",clientKind:"mobile",clientURI:"https://github.com/cozy/cozy-drive/",logoURI:"https://github.com/cozy/cozy-drive/raw/master/targets/drive/vendor/assets/oauth-app-icon.png",policyURI:"https://files.cozycloud.cc/cgu.pdf"},offline:{doctypes:[s.d]},schema:s.e})},w=function(e){return cozy.bar.updateAccessToken(e)},g=function(e,t,n){cozy.client.init({cozyURL:e,oauth:{storage:new a.LocalStorage,clientParams:p({},t,{scopes:n.scope})},offline:{doctypes:["io.cozy.files"]}});var r=new cozy.client.auth.AccessToken(n);cozy.client.saveCredentials(t,r)};function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t&&cozy.client.auth.unregisterClient&&cozy.client.auth.unregisterClient(t),document.getElementById("coz-bar")&&document.getElementById("coz-bar").remove(),cozy.client.offline.destroyAllDatabase&&cozy.client.offline.destroyAllDatabase(),e.getStackClient().resetClient(),cozy.client._storage&&cozy.client._storage.clear(),Object(l.disableBackgroundService)()}var _=function(){var e=h(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,cozy.client.authorize();case 2:return t=e.sent,e.abrupt("return",t.token.accessToken);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),E=function(){return cozy.client._url}},qxHO:function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return s}),n.d(t,"d",function(){return f}),n.d(t,"c",function(){return p});var r=n("NlKi"),o=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i="undefined"==typeof __SENTRY_URL__?"":__SENTRY_URL__,c=function(e,t){return e.replace(/^file:\/\//,"app://").replace(t,"")},u=function(e){var t=/^.*\/[^.]+(\.app|CodePush|.*(?=\/))/;e.culprit&&(e.culprit=c(e.culprit,t));var n=e.stacktrace||e.exception&&e.exception.values&&e.exception.values[0]&&e.exception.values[0].stacktrace;return n&&(n.frames=n.frames.map(function(e){return"[native code]"!==e.filename?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}({},e,{filename:c(e.filename,t)}):e})),e},l=function(){o.a.config(i,{shouldSendCallback:!0,environment:"production",release:"1.15.3",allowSecretKey:!0,dataCallback:u}).install()},s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(r){o.a.captureException(e,{extra:t,fingerprint:n}),console.warn("Raven is recording exception"),console.error(e),r()})},f=function(e){o.a.setTagsContext({instance:e})},p=function(e,t){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";return new Promise(function(r){o.a.setUserContext={url:t},o.a.captureMessage("[".concat(t,"] ").concat(e),{level:n}),r()})}(e,t,"info")}},"rH+U":function(e,t,n){e.exports={"feedback-form":"feedback-form--1Hjg3","coz-form":"coz-form--2IkEt","coz-form-group":"coz-form-group--17IGD","coz-form-desc":"coz-form-desc--341sI","coz-form-label":"coz-form-label--KKSGZ","coz-form-label--error":"coz-form-label--error--1l6MZ","coz-form-errors":"coz-form-errors--3vkOv",settings:"settings--1nsnv",settings__title:"settings__title--_YWG5",settings__category:"settings__category--3XPW7",settings__button:"settings__button--2WzVM","settings__subcategory-title":"settings__subcategory-title--2fiRw",settings__subcategory:"settings__subcategory--5_HUH",settings__subcategory__label:"settings__subcategory__label--3ylh3",settings__subcategory__item:"settings__subcategory__item--3s2tq","feedback-text":"feedback-text--2mWKg","button-block":"button-block--2fdxt",spin:"spin--3lPHL"}},swni:function(e,t,n){e.exports={"u-visuallyhidden":"u-visuallyhidden--1L4hk","dri-btn--more":"dri-btn--more--MNdqs","bar-homelink":"bar-homelink--2j0WN"}},t0Aa:function(e,t,n){e.exports={"c-btn":"c-btn--1VDiR","c-btn--regular":"c-btn--regular--1AoRN","c-btn--secondary":"c-btn--secondary--3znY5","c-btn--danger-outline":"c-btn--danger-outline--mVde8",spin:"spin--GHUiz","u-hide--mob":"u-hide--mob--1U-px","u-hide--tablet":"u-hide--tablet--2T9Ct","u-hide--desk":"u-hide--desk--2FZ80","c-btn--danger":"c-btn--danger--2NNcc","pho-toolbar":"pho-toolbar--28WqL","pho-action-delete":"pho-action-delete--3RnOf","pho-action-upload":"pho-action-upload--1QgoA"}},tqYW:function(e,t,n){var r={"./en":"koyB","./en.json":"koyB"};function o(e){var t=a(e);return n(t)}function a(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=a,e.exports=o,o.id="tqYW"},yEaX:function(e,t,n){"use strict";var r=n("/beP");n.d(t,"b",function(){return r.a}),n.d(t,"i",function(){return r.h}),n.d(t,"h",function(){return r.g}),n.d(t,"c",function(){return r.b}),n.d(t,"f",function(){return r.e}),n.d(t,"d",function(){return r.c}),n.d(t,"e",function(){return r.d}),n.d(t,"g",function(){return r.f});var o=n("QwUF");n.d(t,"j",function(){return o.v}),n.d(t,"k",function(){return o.w}),n.d(t,"l",function(){return o.x}),n.d(t,"a",function(){return o.u})},"z+SL":function(e,t,n){e.exports={"c-btn":"c-btn--ISXve","c-btn--regular":"c-btn--regular--I3FbV","c-btn--secondary":"c-btn--secondary--2y7BI","c-btn--danger-outline":"c-btn--danger-outline--25atN",spin:"spin--3HLqY","u-hide--mob":"u-hide--mob--hFrui","u-hide--desk":"u-hide--desk--2bQfY","c-btn--danger":"c-btn--danger--3MJU1","toolbar-inside-bar":"toolbar-inside-bar--2LtK2","fil-toolbar-files":"fil-toolbar-files--2hub6","fil-toolbar-trash":"fil-toolbar-trash--2Oocj","fil-toolbar-menu":"fil-toolbar-menu--2bZiG","fil-action-upload":"fil-action-upload--3NQWQ","fil-action-newfolder":"fil-action-newfolder--1rxzI","fil-action-download":"fil-action-download--mH9ej","fil-action-select":"fil-action-select--2Z1Ou","fil-action-delete":"fil-action-delete--Tfrxm","fil-action-share":"fil-action-share--31VAK","fil-toolbar-menu-recipients":"fil-toolbar-menu-recipients--lP49T","fil-toolbar-inner-menu":"fil-toolbar-inner-menu--i7sN9","fil-public-download":"fil-public-download--1tNWK","fil-toolbar-menu--public":"fil-toolbar-menu--public--1QdFo"}},z6Q1:function(e,t,n){"use strict";n.d(t,"d",function(){return r}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return a}),n.d(t,"b",function(){return i}),n.d(t,"e",function(){return c});var r="io.cozy.files",o="io.cozy.contacts",a="io.cozy.photos.albums",i="io.cozy.apps",c={files:{doctype:r},contacts:{doctype:o}}}});