!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=956)}([function(t,e,n){const{filterLevel:r,filterSecrets:o}=n(903),i=n(407),{LOG_LEVEL:a}=process.env;let u=a||"debug";const s=n(904),c=[r,o],f=function(){for(const t of c)if(!1===t.apply(null,arguments))return!0;return!1};function l(t,e,n,r){f(u,t,e,n,r)||console.log(s(t,e,n,r))}l.addFilter=function(t){return c.push(t)},l.setLevel=function(t){u=t};["debug","info","warn","error","ok","critical"].forEach(t=>{l[t]=function(e,n,r){return l(t,e,n,r)}}),t.exports=l,l.setNoRetry=t=>(t?t.no_retry=!0:t={no_retry:!0},t.no_retry),l.Secret=i,l.namespace=function(t){return function(e,n,r,o=t){l(e,n,r,o)}}},function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,n){"use strict";e.__esModule=!0;var r,o=n(317),i=(r=o)&&r.__esModule?r:{default:r};e.default=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}()},function(t,e){var n=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=n)},function(t,e,n){"use strict";e.__esModule=!0;var r,o=n(581),i=(r=o)&&r.__esModule?r:{default:r};e.default=i.default||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}},function(t,e,n){var r=n(10),o=n(3),i=n(30),a=n(34),u=n(44),s=function(t,e,n){var c,f,l,p=t&s.F,d=t&s.G,h=t&s.S,v=t&s.P,y=t&s.B,g=t&s.W,m=d?o:o[e]||(o[e]={}),b=m.prototype,x=d?r:h?r[e]:(r[e]||{}).prototype;for(c in d&&(n=e),n)(f=!p&&x&&void 0!==x[c])&&u(m,c)||(l=f?x[c]:n[c],m[c]=d&&"function"!=typeof x[c]?n[c]:y&&f?i(l,r):g&&x[c]==l?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(l):v&&"function"==typeof l?i(Function.call,l):l,v&&((m.virtual||(m.virtual={}))[c]=l,t&s.R&&b&&!b[c]&&a(b,c,l)))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,t.exports=s},function(t,e,n){t.exports=n(585)},function(t,e,n){"use strict";e.__esModule=!0;var r,o=n(61),i=(r=o)&&r.__esModule?r:{default:r};e.default=function(t){return function(){var e=t.apply(this,arguments);return new i.default(function(t,n){return function r(o,a){try{var u=e[o](a),s=u.value}catch(t){return void n(t)}if(!u.done)return i.default.resolve(s).then(function(t){r("next",t)},function(t){r("throw",t)});t(s)}("next")})}}},function(t,e,n){t.exports={default:n(589),__esModule:!0}},function(t,e){var n=Array.isArray;t.exports=n},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e,n){var r=n(179)("wks"),o=n(118),i=n(10).Symbol,a="function"==typeof i;(t.exports=function(t){return r[t]||(r[t]=a&&i[t]||(a?i:o)("Symbol."+t))}).store=r},function(t,e,n){"use strict";e.__esModule=!0;var r,o=n(63),i=(r=o)&&r.__esModule?r:{default:r};e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,i.default)(e))&&"function"!=typeof e?t:e}},function(t,e,n){"use strict";e.__esModule=!0;var r=a(n(600)),o=a(n(604)),i=a(n(63));function a(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,i.default)(e)));t.prototype=(0,o.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(r.default?(0,r.default)(t,e):t.__proto__=e)}},function(t,e){var n=Array.isArray;t.exports=n},function(t,e,n){t.exports=!n(43)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e,n){const r=n(423),o=n(497),i=n(502),a=n(507),u=n(525),s=n(291),c=n(290),f=n(526),l=n(115),p=n(172),d=n(86),{parallelMap:h}=n(540),v=n(80).default,y=n(0).namespace("Document"),g=n(919),m="Database does not exist.";function b(t,e){if(0===Object.keys(t).length)return!0;for(let n in t)if(t[n]!==e[n])return!0;return!1}const x={},w=["shortLabel"];function _(t){return t.startsWith("\\")?t.slice(1):t}const k=t=>a(t,u),O=t=>Object.assign({},t,{_deleted:!0});t.exports=class{static registerClient(t){if(this.cozyClient)throw console.warn("Document already has been registered, this is not possible to re-register as the client is shared globally between all classes. This is to prevent concurrency bugs."),new Error("Document cannot be re-registered to a client.");this.cozyClient=t}static usesCozyClient(){return this.cozyClient instanceof v}static getIndex(t,e){if(this.usesCozyClient())throw new Error("This method is not implemented yet with CozyClient");return this.getIndexViaOldClient(t,e)}static getIndexViaOldClient(t,e){const n=`${t}:${e.slice().join(",")}`;return x[n]||(x[n]=this.cozyClient.data.defineIndex(t,e).then(t=>(x[n]=t,t))),Promise.resolve(x[n])}static addCozyMetadata(t){return t.cozyMetadata||(t.cozyMetadata={}),t.cozyMetadata.updatedAt=new Date,!t.cozyMetadata.createdByApp&&this.createdByApp&&(t.cozyMetadata.createdByApp=this.createdByApp),this.createdByApp&&function(t,e){t.updatedByApps||(t.updatedByApps=[]);const n=new Date;for(const r of t.updatedByApps)if(r.slug===e)return void(r.date=n);t.updatedByApps.push({slug:e,date:n})}(t.cozyMetadata,this.createdByApp),t}static async get(t){if(!this.usesCozyClient())throw new Error("This method is not implemented with cozy-client-js");if(!this.doctype)throw new Error("doctype is not defined");return(await this.cozyClient.collection(this.doctype).get(t)).data}static async createOrUpdate(t){return this.usesCozyClient()?this.createOrUpdateViaNewClient(t):this.createOrUpdateViaOldClient(t)}static async createOrUpdateViaNewClient(t){const e=s(this.idAttributes.map(e=>[e,d(t,_(e))]));let n=[];const a=k(e);if(i(a)===this.idAttributes.length&&(n=await this.queryAll(e)),0===n.length)return this.create(this.addCozyMetadata(t));if(1===n.length){const e=r(t,w);if(!this.checkAttributes||b(o(n[0],this.checkAttributes),o(e,this.checkAttributes))){delete e.dateImport;const t=this.addCozyMetadata({...n[0],...e});return this.cozyClient.save(t)}return y("debug",`[createOrUpdate] Didn't update ${n[0]._id} because its \`checkedAttributes\` (${this.checkAttributes}) didn't change.`),n[0]}throw new Error("Create or update with selectors that returns more than 1 result\n"+JSON.stringify(e)+"\n"+JSON.stringify(n))}static async createOrUpdateViaOldClient(t){const e=s(this.idAttributes.map(e=>[e,d(t,_(e))]));let n=[];const a=k(e);if(i(a)===this.idAttributes.length){const t=await this.getIndex(this.doctype,this.idAttributes);n=await this.cozyClient.data.query(t,{selector:e})}if(0===n.length)return this.cozyClient.data.create(this.doctype,this.addCozyMetadata(t));if(1===n.length){const e=n[0]._id,i=r(t,w);return!this.checkAttributes||b(o(n[0],this.checkAttributes),o(i,this.checkAttributes))?(delete i.dateImport,this.cozyClient.data.updateAttributes(this.doctype,e,this.addCozyMetadata(i))):(y("debug",`[bulkSave] Didn't update ${n[0]._id} because its \`checkedAttributes\` (${this.checkAttributes}) didn't change.`),n[0])}throw new Error("Create or update with selectors that returns more than 1 result\n"+JSON.stringify(e)+"\n"+JSON.stringify(n))}static create(t){return this.usesCozyClient()?this.createViaNewClient(t):this.createViaOldClient(t)}static createViaNewClient(t){return this.cozyClient.create(this.doctype,t)}static createViaOldClient(t){return this.cozyClient.data.create(this.doctype,t)}static bulkSave(t,e,n){return h(t,t=>(n&&n(t),this.createOrUpdate(t)),e=e||30)}static query(t,e){if(this.usesCozyClient())throw new Error("This method is not implemented yet with CozyClient");return this.queryViaOldClient(t,e)}static queryViaOldClient(t,e){return this.cozyClient.data.query(t,e)}static async fetchAll(){const t=this.usesCozyClient()?this.cozyClient.stackClient:this.cozyClient;try{return(await t.fetchJSON("GET",`/data/${this.doctype}/_all_docs?include_docs=true`)).rows.filter(t=>0!==t.id.indexOf("_design")&&t.doc).map(t=>t.doc)}catch(t){return t&&t.response&&t.response.status&&t.response.status,[]}}static async updateAll(t){const e=this.usesCozyClient()?this.cozyClient.stackClient:this.cozyClient;if(!t||!t.length)return Promise.resolve([]);try{return await e.fetchJSON("POST",`/data/${this.doctype}/_bulk_docs`,{docs:t})}catch(e){if(e.reason&&e.reason.reason&&e.reason.reason==m){const e=await this.create(t[0]),n=await this.updateAll(t.slice(1));return n.unshift({ok:!0,id:e._id,rev:e._rev}),n}throw e}}static async deleteAll(t){return this.updateAll(t.map(O))}static findDuplicates(t){const e=this.idAttributes,n=c(l(t,t=>e.map(e=>d(t,e)).join("#$$$$#")),t=>t.length>1);return f(n,t=>t.slice(1))}static async deleteDuplicates(t){let e=await this.fetchAll();t&&(e=p(e,t));const n=this.findDuplicates(e);return this.deleteAll(n)}static async fetchChanges(t,e={}){const n=this.usesCozyClient()?this.cozyClient.stackClient:this.cozyClient,r={since:t,include_docs:"true"};e.params&&Object.assign(r,e.params);const o=await n.fetchJSON("GET",`/data/${this.doctype}/_changes?${g.stringify(r)}`),i=o.last_seq;let a=o.results.map(t=>t.doc).filter(Boolean);return e.includeDesign||(a=a.filter(t=>0!==t._id.indexOf("_design"))),e.includeDeleted||(a=a.filter(t=>!t._deleted)),{newLastSeq:i,documents:a}}static async queryAll(t,e){return this.usesCozyClient()?this.queryAllViaNewClient(t):this.queryAllViaOldClient(t,e)}static async queryAllViaNewClient(t){if(!t)return this.fetchAll();const e=[],n=this.cozyClient.find(this.doctype).where(t);let r={next:!0};for(;r&&r.next;)r=await this.cozyClient.query(n.offset(e.length)),e.push(...r.data);return e}static async queryAllViaOldClient(t,e){if(!t)return await this.fetchAll();e||(e=await this.cozyClient.data.defineIndex(this.doctype,Object.keys(t)));const n=[];let r={next:!0};for(;r&&r.next;)r=await this.cozyClient.data.query(e,{selector:t,wholeResponse:!0,skip:n.length}),n.push(...r.docs);return n}static async getAll(t){const e=this.usesCozyClient()?this.cozyClient.stackClient:this.cozyClient;let n;try{n=await e.fetchJSON("POST",`/data/${this.doctype}/_all_docs?include_docs=true`,{keys:t})}catch(t){if(t.message.match(/not_found/))return[];throw t}return n.rows.filter(t=>t.doc).map(t=>t.doc)}}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e){t.exports=require("stream")},function(t,e,n){var r=n(24),o=n(295),i=n(174),a=Object.defineProperty;e.f=n(15)?Object.defineProperty:function(t,e,n){if(r(t),e=i(e,!0),r(n),o)try{return a(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e){var n=Array.isArray;t.exports=n},function(t,e,n){var r=n(262),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();t.exports=i},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){var r=n(17);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,e,n){var r=n(322),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();t.exports=i},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,n){var r=n(371),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();t.exports=i},function(t,e,n){const r=n(422),o=n(920),i=n(412),a=n(16),u=n(923),s=n(252),c=n(926),f=n(927),l=n(937),p=n(409),d=n(416),h=n(950),v=n(951),y=n(952);t.exports={Account:r,AdministrativeProcedure:o,Application:i,Document:a,BalanceHistory:u,BankAccount:s,BankingReconciliator:c,BankTransaction:f,BankAccountStats:l,Contact:p,CozyFile:d,CozyFolder:h,Group:v,registerClient:a.registerClient,Permission:y}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,n){var r=n(87);t.exports=function(t,e,n){if(r(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,n){var r=n(19),o=n(88);t.exports=n(15)?function(t,e,n){return r.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var r=n(175),o=n(176);t.exports=function(t){return r(o(t))}},function(t,e,n){t.exports={default:n(558),__esModule:!0}},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}},function(t,e,n){"use strict";e.__esModule=!0;var r,o=n(317),i=(r=o)&&r.__esModule?r:{default:r};e.default=function(t,e,n){return e in t?(0,i.default)(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e){t.exports=require("zlib")},function(t,e,n){var r=n(435),o=n(440);t.exports=function(t,e){var n=o(t,e);return r(n)?n:void 0}},function(t,e,n){var r=n(54),o=n(436),i=n(437),a="[object Null]",u="[object Undefined]",s=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?u:a:s&&s in Object(t)?o(t):i(t)}},function(t,e,n){var r=n(508),o=n(521),i=n(114),a=n(14),u=n(522);t.exports=function(t){return"function"==typeof t?t:null==t?i:"object"==typeof t?a(t)?o(t[0],t[1]):r(t):u(t)}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){"use strict";var r=n(549)(!0);n(182)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=r(e,n),this._i+=t.length,{value:t,done:!1})})},function(t,e,n){var r=n(176);t.exports=function(t){return Object(r(t))}},function(t,e,n){t.exports={default:n(577),__esModule:!0}},function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.QueryDefinition=e.MutationTypes=e.Mutations=e.getDoctypeFromOperation=e.uploadFile=e.removeReferencedBy=e.addReferencedBy=e.removeReferencesTo=e.addReferencesTo=e.deleteDocument=e.updateDocument=e.createDocument=void 0;var r=a(n(4)),o=a(n(1)),i=a(n(2));function a(t){return t&&t.__esModule?t:{default:t}}var u=n(321),s=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.doctype,r=e.id,i=e.ids,a=e.selector,u=e.fields,s=e.indexedFields,c=e.sort,f=e.includes,l=e.referenced,p=e.limit,d=e.skip,h=e.cursor;(0,o.default)(this,t),this.doctype=n,this.id=r,this.ids=i,this.selector=a,this.fields=u,this.indexedFields=s,this.sort=c,this.includes=f,this.referenced=l,this.limit=p,this.skip=d,this.cursor=h}return(0,i.default)(t,[{key:"getById",value:function(e){return new t((0,r.default)({},this.toDefinition(),{id:e}))}},{key:"getByIds",value:function(e){return new t((0,r.default)({},this.toDefinition(),{ids:e}))}},{key:"where",value:function(e){return new t((0,r.default)({},this.toDefinition(),{selector:e}))}},{key:"select",value:function(e){return new t((0,r.default)({},this.toDefinition(),{fields:e}))}},{key:"indexFields",value:function(e){return new t((0,r.default)({},this.toDefinition(),{indexedFields:e}))}},{key:"sortBy",value:function(e){if(u(e))throw new Error('Invalid sort, should be an object (`{ label: "desc"}`), you passed a string.');return new t((0,r.default)({},this.toDefinition(),{sort:e}))}},{key:"include",value:function(e){if(!Array.isArray(e))throw new Error("include() takes an array of relationship names");return new t((0,r.default)({},this.toDefinition(),{includes:e}))}},{key:"limitBy",value:function(e){return new t((0,r.default)({},this.toDefinition(),{limit:e}))}},{key:"UNSAFE_noLimit",value:function(){return new t((0,r.default)({},this.toDefinition(),{limit:null}))}},{key:"offset",value:function(e){return new t((0,r.default)({},this.toDefinition(),{skip:e}))}},{key:"offsetCursor",value:function(e){return new t((0,r.default)({},this.toDefinition(),{cursor:e}))}},{key:"referencedBy",value:function(e){return new t((0,r.default)({},this.toDefinition(),{referenced:e}))}},{key:"toDefinition",value:function(){return{doctype:this.doctype,id:this.id,ids:this.ids,selector:this.selector,fields:this.fields,indexedFields:this.indexedFields,sort:this.sort,includes:this.includes,referenced:this.referenced,limit:this.limit,skip:this.skip,cursor:this.cursor}}}]),t}(),c=e.createDocument=function(t){return{mutationType:g.CREATE_DOCUMENT,document:t}},f=e.updateDocument=function(t){return{mutationType:g.UPDATE_DOCUMENT,document:t}},l=e.deleteDocument=function(t){return{mutationType:g.DELETE_DOCUMENT,document:t}},p=e.addReferencesTo=function(t,e){return{mutationType:g.ADD_REFERENCES_TO,referencedDocuments:e,document:t}},d=e.removeReferencesTo=function(t,e){return{mutationType:g.REMOVE_REFERENCES_TO,referencedDocuments:e,document:t}},h=e.addReferencedBy=function(t,e){return{mutationType:g.ADD_REFERENCED_BY,referencedDocuments:e,document:t}},v=e.removeReferencedBy=function(t,e){return{mutationType:g.REMOVE_REFERENCED_BY,referencedDocuments:e,document:t}},y=e.uploadFile=function(t,e){return{mutationType:g.UPLOAD_FILE,file:t,dirPath:e}},g=(e.getDoctypeFromOperation=function(t){if(!t.mutationType)return t.doctype;var e=t.mutationType;switch(e){case"CREATE_DOCUMENT":case"UPDATE_DOCUMENT":case"DELETE_DOCUMENT":return t.document._type;case"ADD_REFERENCES_TO":case"UPLOAD_FILE":throw new Error("Not implemented");default:throw new Error("Unknown mutationType "+e)}},e.Mutations={createDocument:c,updateDocument:f,deleteDocument:l,addReferencesTo:p,removeReferencesTo:d,addReferencedBy:h,removeReferencedBy:v,uploadFile:y},e.MutationTypes={CREATE_DOCUMENT:"CREATE_DOCUMENT",UPDATE_DOCUMENT:"UPDATE_DOCUMENT",DELETE_DOCUMENT:"DELETE_DOCUMENT",ADD_REFERENCES_TO:"ADD_REFERENCES_TO",REMOVE_REFERENCES_TO:"REMOVE_REFERENCES_TO",ADD_REFERENCED_BY:"ADD_REFERENCED_BY",REMOVE_REFERENCED_BY:"REMOVE_REFERENCED_BY",UPLOAD_FILE:"UPLOAD_FILE"});e.QueryDefinition=s},function(t,e,n){var r=n(64),o=n(607),i=n(608),a="[object Null]",u="[object Undefined]",s=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?u:a:s&&s in Object(t)?o(t):i(t)}},function(t,e,n){var r=n(618),o=n(621);t.exports=function(t,e){var n=o(t,e);return r(n)?n:void 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.normalizeDoctype=void 0;var r=D(n(63)),o=D(n(713)),i=D(n(181)),a=D(n(62)),u=D(n(36)),s=D(n(47)),c=D(n(94)),f=D(n(38)),l=D(n(48)),p=D(n(6)),d=D(n(73)),h=D(n(7)),v=D(n(1)),y=D(n(2)),g=D(n(4)),m=(0,d.default)(["/data/","/",""],["/data/","/",""]),b=(0,d.default)(["/data/","/_find"],["/data/","/_find"]),x=(0,d.default)(["/data/","/_all_docs?include_docs=true"],["/data/","/_all_docs?include_docs=true"]),w=(0,d.default)(["/data/","/","?rev=",""],["/data/","/","?rev=",""]),_=(0,d.default)(["/data/","/_index"],["/data/","/_index"]);e.normalizeDoc=R;var k=n(74),O=D(n(255)),j=D(n(756)),S=D(n(792)),E=D(n(793)),A=D(n(825)),C=D(n(830)),T=n(244),P=D(T),M=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(398));function D(t){return t&&t.__esModule?t:{default:t}}function R(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1],n=t._id||t.id;return(0,g.default)({id:n,_id:n,_type:e},t)}var I=function(){function t(e,n){(0,v.default)(this,t),this.doctype=e,this.stackClient=n,this.indexes={}}var e,n,d,D,I,z,N,L,F,B,U,$;return(0,y.default)(t,[{key:"all",value:($=(0,h.default)(p.default.mark(function t(){var e,n,r,o,i,a,u,s,c,f,l,d=this,h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=h.limit,n=h.skip,r=void 0===n?0:n,o=h.keys,a=(i=!!o||null===e)?"_all_docs":"_normal_docs",u=(0,k.uri)(m,this.doctype,a),s={include_docs:!0,limit:e,skip:r,keys:o},c=M.buildURL(u,s),f=void 0,t.prev=7,t.next=10,this.stackClient.fetchJSON("GET",c);case 10:f=t.sent,t.next=16;break;case 13:return t.prev=13,t.t0=t.catch(7),t.abrupt("return",(0,T.dontThrowNotFoundError)(t.t0));case 16:return l=void 0,l=i?f.rows.filter(function(t){return t&&null!==t.doc&&!t.error&&!(0,A.default)(t.id,"_design")}).map(function(t){return R(t.doc,d.doctype)}):f.rows.map(function(t){return R(t,d.doctype)}),t.abrupt("return",{data:l,meta:{count:i?l.length:f.total_rows},skip:r,next:r+f.rows.length<f.total_rows});case 19:case"end":return t.stop()}},t,this,[[7,13]])})),function(){return $.apply(this,arguments)})},{key:"find",value:(U=(0,h.default)(p.default.mark(function t(e){var n,r,o,i=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.skip,r=void 0===n?0:n,o=void 0,t.prev=2,t.t0=this.stackClient,t.t1=(0,k.uri)(b,this.doctype),t.next=7,this.toMangoOptions(e,a);case 7:return t.t2=t.sent,t.next=10,t.t0.fetchJSON.call(t.t0,"POST",t.t1,t.t2);case 10:o=t.sent,t.next=16;break;case 13:return t.prev=13,t.t3=t.catch(2),t.abrupt("return",(0,T.dontThrowNotFoundError)(t.t3));case 16:return t.abrupt("return",{data:o.docs.map(function(t){return R(t,i.doctype)}),meta:{count:o.next?r+o.docs.length+1:o.docs.length},next:o.next,skip:r});case 17:case"end":return t.stop()}},t,this,[[2,13]])})),function(t){return U.apply(this,arguments)})},{key:"get",value:(B=(0,h.default)(p.default.mark(function t(e){return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",P.default.get(this.stackClient,(0,k.uri)(m,this.doctype,e),{normalize:this.constructor.normalizeDoctype(this.doctype)}));case 1:case"end":return t.stop()}},t,this)})),function(t){return B.apply(this,arguments)})},{key:"getAll",value:(F=(0,h.default)(p.default.mark(function t(e){var n,r,o=this;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=void 0,t.prev=1,t.next=4,this.stackClient.fetchJSON("POST",(0,k.uri)(x,this.doctype),{keys:e});case 4:n=t.sent,t.next=10;break;case 7:return t.prev=7,t.t0=t.catch(1),t.abrupt("return",(0,T.dontThrowNotFoundError)(t.t0));case 10:return r=n.rows.filter(function(t){return t.doc}),t.abrupt("return",{data:r.map(function(t){return R(t.doc,o.doctype)}),meta:{count:r.length}});case 12:case"end":return t.stop()}},t,this,[[1,7]])})),function(t){return F.apply(this,arguments)})},{key:"create",value:(L=(0,h.default)(p.default.mark(function t(e){var n,r,o,i,a=e._id,u=(e._type,(0,l.default)(e,["_id","_type"]));return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=(n=!!a)?"PUT":"POST",o=(0,k.uri)(m,this.doctype,n?a:""),t.next=5,this.stackClient.fetchJSON(r,o,u);case 5:return i=t.sent,t.abrupt("return",{data:R(i.data,this.doctype)});case 7:case"end":return t.stop()}},t,this)})),function(t){return L.apply(this,arguments)})},{key:"update",value:(N=(0,h.default)(p.default.mark(function t(e){var n;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("PUT",(0,k.uri)(m,this.doctype,e._id),e);case 2:return n=t.sent,t.abrupt("return",{data:R(n.data,this.doctype)});case 4:case"end":return t.stop()}},t,this)})),function(t){return N.apply(this,arguments)})},{key:"destroy",value:(z=(0,h.default)(p.default.mark(function t(e){var n,r=e._id,o=e._rev,i=(0,l.default)(e,["_id","_rev"]);return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("DELETE",(0,k.uri)(w,this.doctype,r,o));case 2:return n=t.sent,t.abrupt("return",{data:R((0,g.default)({},i,{_id:r,_rev:n.rev,_deleted:!0}),this.doctype)});case 4:case"end":return t.stop()}},t,this)})),function(t){return z.apply(this,arguments)})},{key:"toMangoOptions",value:(I=(0,h.default)(p.default.mark(function t(e){var n,r,o,i,l,d,h,v,y,g,m,b,x,w,_,k,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=E.sort,r=E.indexedFields,o=E.fields,i=E.skip,l=void 0===i?0:i,d=E.limit,n&&!Array.isArray(n)&&(console.warn('Passing an object to the "sort" is deprecated, please use an array instead.'),n=(0,j.default)(n,function(t,e,n){return t.push((0,f.default)({},n,e))},[])),r=r||this.getIndexFields({sort:n,selector:e}),t.t0=E.indexId,t.t0){t.next=9;break}return t.next=8,this.getIndexId(r);case 8:t.t0=t.sent;case 9:if(h=t.t0,!n){t.next=35;break}if(!((v=(0,O.default)(n.map(function(t){return(0,S.default)((0,c.default)(t))}))).length>1)){t.next=14;break}throw new Error("Mango sort can only use a single order (asc or desc).");case 14:for(y=v.length>0?(0,S.default)(v):"asc",g=function(t){n.find(function(e){return(0,S.default)((0,s.default)(e))===t})||n.push((0,f.default)({},t,y))},m=!0,b=!1,x=void 0,t.prev=19,w=(0,u.default)(r);!(m=(_=w.next()).done);m=!0)k=_.value,g(k);t.next=27;break;case 23:t.prev=23,t.t1=t.catch(19),b=!0,x=t.t1;case 27:t.prev=27,t.prev=28,!m&&w.return&&w.return();case 30:if(t.prev=30,!b){t.next=33;break}throw x;case 33:return t.finish(30);case 34:return t.finish(27);case 35:return t.abrupt("return",{selector:e,use_index:h,fields:o?[].concat((0,a.default)(o),["_id","_type","class"]):void 0,limit:d,skip:l,sort:n});case 36:case"end":return t.stop()}},t,this,[[19,23,27,35],[28,,30,34]])})),function(t){return I.apply(this,arguments)})},{key:"checkUniquenessOf",value:(D=(0,h.default)(p.default.mark(function t(e,n){var r,o;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getUniqueIndexId(e);case 2:return r=t.sent,t.next=5,this.find((0,f.default)({},e,n),{indexId:r,fields:["_id"]});case 5:return o=t.sent,t.abrupt("return",0===o.data.length);case 7:case"end":return t.stop()}},t,this)})),function(t,e){return D.apply(this,arguments)})},{key:"getUniqueIndexId",value:function(t){return this.getIndexId([t],this.doctype+"/"+t)}},{key:"getIndexId",value:(d=(0,h.default)(p.default.mark(function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getIndexNameFromFields(e);return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.indexes[n]){t.next=4;break}return t.next=3,this.createIndex(e);case 3:this.indexes[n]=t.sent;case 4:return t.abrupt("return",this.indexes[n].id);case 5:case"end":return t.stop()}},t,this)})),function(t){return d.apply(this,arguments)})},{key:"createIndex",value:(n=(0,h.default)(p.default.mark(function t(e){var n,r,o,i,a;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={index:{fields:e}},t.next=3,this.stackClient.fetchJSON("POST",(0,k.uri)(_,this.doctype),n);case 3:if(r=t.sent,o={id:r.id,fields:e},"exists"!==r.result){t.next=7;break}return t.abrupt("return",o);case 7:return i=(0,f.default)({},e[0],{$gt:null}),a={indexId:o.id},t.next=11,(0,k.attempt)(this.find(i,a));case 11:if(!t.sent){t.next=13;break}return t.abrupt("return",o);case 13:return t.next=15,(0,k.sleep)(1e3);case 15:return t.next=17,(0,k.attempt)(this.find(i,a));case 17:if(!t.sent){t.next=19;break}return t.abrupt("return",o);case 19:return t.next=21,(0,k.sleep)(500);case 21:return t.abrupt("return",o);case 22:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"getIndexNameFromFields",value:function(t){return"by_"+t.join("_and_")}},{key:"getIndexFields",value:function(t){var e=t.selector,n=t.sort,r=void 0===n?[]:n;return(0,i.default)(new o.default([].concat((0,a.default)(r.map(function(t){return(0,S.default)((0,s.default)(t))})),(0,a.default)((0,s.default)(e)))))}},{key:"fetchChanges",value:(e=(0,h.default)(p.default.mark(function t(){var e,n,o,i,a,u,c,f,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=l.doc_ids&&l.doc_ids.length>0,n="","object"!==(void 0===l?"undefined":(0,r.default)(l))?(n="?include_docs=true&since="+l,console.warn("fetchChanges use couchOptions as Object not a string, since is deprecated, please use fetchChanges({include_docs: true, since: 0}).")):(0,s.default)(l).length>0&&(n="?"+[C.default.stringify((0,E.default)(l,"doc_ids")),e&&void 0===l.filter?"filter=_doc_ids":void 0].filter(Boolean).join("&")),o=e?"POST":"GET",i="/data/"+this.doctype+"/_changes"+n,a=e?{doc_ids:l.doc_ids}:void 0,t.next=8,this.stackClient.fetchJSON(o,i,a);case 8:return u=t.sent,c=u.last_seq,f=u.results.map(function(t){return t.doc}).filter(Boolean),d.includeDesign||(f=f.filter(function(t){return 0!==t._id.indexOf("_design")})),d.includeDeleted||(f=f.filter(function(t){return!t._deleted})),t.abrupt("return",{newLastSeq:c,documents:f});case 14:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})}],[{key:"normalizeDoctype",value:function(t){return this.normalizeDoctypeRawApi(t)}},{key:"normalizeDoctypeJsonApi",value:function(t){return function(e,n){return R(e,t)}}},{key:"normalizeDoctypeRawApi",value:function(t){return function(e,n){return R(n,t)}}}]),t}();e.default=I;e.normalizeDoctype=I.normalizeDoctype},function(t,e,n){var r=n(728),o=n(733);t.exports=function(t,e){var n=o(t,e);return r(n)?n:void 0}},function(t,e,n){var r=n(22).Symbol;t.exports=r},function(t,e,n){var r=n(261),o=n(162);t.exports=function(t){return null!=t&&o(t.length)&&!r(t)}},function(t,e,n){var r=n(14),o=n(170),i=n(485),a=n(275);t.exports=function(t,e){return r(t)?t:o(t,e)?[t]:i(a(t))}},function(t,e,n){var r=n(85),o=1/0;t.exports=function(t){if("string"==typeof t||r(t))return t;var e=t+"";return"0"==e&&1/t==-o?"-0":e}},function(t,e,n){var r=n(297),o=n(180);t.exports=Object.keys||function(t){return r(t,o)}},function(t,e){t.exports={}},function(t,e,n){n(555);for(var r=n(10),o=n(34),i=n(59),a=n(11)("toStringTag"),u="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),s=0;s<u.length;s++){var c=u[s],f=r[c],l=f&&f.prototype;l&&!l[a]&&o(l,a,c),i[c]=i.Array}},function(t,e,n){t.exports={default:n(560),__esModule:!0}},function(t,e,n){"use strict";e.__esModule=!0;var r,o=n(181),i=(r=o)&&r.__esModule?r:{default:r};e.default=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return(0,i.default)(t)}},function(t,e,n){"use strict";e.__esModule=!0;var r=a(n(591)),o=a(n(593)),i="function"==typeof o.default&&"symbol"==typeof r.default?function(t){return typeof t}:function(t){return t&&"function"==typeof o.default&&t.constructor===o.default&&t!==o.default.prototype?"symbol":typeof t};function a(t){return t&&t.__esModule?t:{default:t}}e.default="function"==typeof o.default&&"symbol"===i(r.default)?function(t){return void 0===t?"undefined":i(t)}:function(t){return t&&"function"==typeof o.default&&t.constructor===o.default&&t!==o.default.prototype?"symbol":void 0===t?"undefined":i(t)}},function(t,e,n){var r=n(25).Symbol;t.exports=r},function(t,e,n){var r=n(9),o=n(194),i=n(612),a=n(636);t.exports=function(t,e){return r(t)?t:o(t,e)?[t]:i(a(t))}},function(t,e,n){var r=n(195),o=1/0;t.exports=function(t){if("string"==typeof t||r(t))return t;var e=t+"";return"0"==e&&1/t==-o?"-0":e}},function(t,e,n){var r=n(327);t.exports=function(t,e,n){"__proto__"==e&&r?r(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},function(t,e,n){var r=n(197),o=n(200);t.exports=function(t){return null!=t&&o(t.length)&&!r(t)}},function(t,e,n){var r=n(126);t.exports=function(t,e,n){var o=null==t?void 0:r(t,e);return void 0===o?n:o}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(n(1)),o=i(n(2));function i(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(e,n,o,i){(0,r.default)(this,t);var a=i.dispatch,u=i.get,s=i.query,c=i.mutate,f=i.save;this.target=e,this.name=n,this.doctype=o,this.get=u,this.query=s,this.mutate=c,this.save=f,this.dispatch=a}return(0,o.default)(t,[{key:"raw",get:function(){throw new Error("A relationship must define its raw getter")}},{key:"data",get:function(){throw new Error("A relationship must define its data getter")}}],[{key:"query",value:function(){throw new Error("A custom relationship must define its query() function")}}]),t}();e.default=a},function(t,e,n){var r=n(133),o=n(329),i=n(330);t.exports=function(t,e){return i(o(t,e,r),t+"")}},function(t,e,n){var r=n(199),o=n(67);t.exports=function(t,e,n,i){var a=!n;n||(n={});for(var u=-1,s=e.length;++u<s;){var c=e[u],f=i?i(n[c],t[c],c,n,t):void 0;void 0===f&&(f=t[c]),a?o(n,c,f):r(n,c,f)}return n}},function(t,e,n){"use strict";e.__esModule=!0;var r=i(n(719)),o=i(n(722));function i(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e){return(0,o.default)((0,r.default)(t,{raw:{value:(0,o.default)(e)}}))}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.forceFileDownload=e.slugify=e.sleep=e.attempt=e.uri=void 0;var r,o=n(61),i=(r=o)&&r.__esModule?r:{default:r};e.uri=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var o=[t[0]],i=0;i<n.length;i++)o.push(encodeURIComponent(n[i])+t[i+1]);return o.join("")},e.attempt=function(t){return t.then(function(){return!0}).catch(function(){return!1})},e.sleep=function(t,e){return new i.default(function(n){setTimeout(n,t,e)})},e.slugify=function(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},e.forceFileDownload=function(t,e){var n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}},function(t,e,n){var r=n(76),o=n(729),i=n(730),a="[object Null]",u="[object Undefined]",s=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?u:a:s&&s in Object(t)?o(t):i(t)}},function(t,e,n){var r=n(27).Symbol;t.exports=r},function(t,e,n){var r=n(21),o=n(238),i=n(784),a=n(153);t.exports=function(t,e){return r(t)?t:o(t,e)?[t]:i(a(t))}},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}},function(t,e,n){var r=n(152),o=1/0;t.exports=function(t){if("string"==typeof t||r(t))return t;var e=t+"";return"0"==e&&1/t==-o?"-0":e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.manifest=e.Registry=e.getQueryFromState=e.cancelable=e.dehydrate=e.HasManyTriggers=e.HasManyInPlace=e.HasOneInPlace=e.HasOne=e.HasMany=e.Association=e.getDoctypeFromOperation=e.MutationTypes=e.Mutations=e.QueryDefinition=e.compose=e.StackLink=e.CozyLink=e.default=void 0;var r=n(542);Object.defineProperty(e,"default",{enumerable:!0,get:function(){return h(r).default}});var o=n(192);Object.defineProperty(e,"CozyLink",{enumerable:!0,get:function(){return h(o).default}});var i=n(319);Object.defineProperty(e,"StackLink",{enumerable:!0,get:function(){return h(i).default}});var a=n(890);Object.defineProperty(e,"compose",{enumerable:!0,get:function(){return h(a).default}});var u=n(49);Object.defineProperty(e,"QueryDefinition",{enumerable:!0,get:function(){return u.QueryDefinition}}),Object.defineProperty(e,"Mutations",{enumerable:!0,get:function(){return u.Mutations}}),Object.defineProperty(e,"MutationTypes",{enumerable:!0,get:function(){return u.MutationTypes}}),Object.defineProperty(e,"getDoctypeFromOperation",{enumerable:!0,get:function(){return u.getDoctypeFromOperation}});var s=n(125);Object.defineProperty(e,"Association",{enumerable:!0,get:function(){return s.Association}}),Object.defineProperty(e,"HasMany",{enumerable:!0,get:function(){return s.HasMany}}),Object.defineProperty(e,"HasOne",{enumerable:!0,get:function(){return s.HasOne}}),Object.defineProperty(e,"HasOneInPlace",{enumerable:!0,get:function(){return s.HasOneInPlace}}),Object.defineProperty(e,"HasManyInPlace",{enumerable:!0,get:function(){return s.HasManyInPlace}}),Object.defineProperty(e,"HasManyTriggers",{enumerable:!0,get:function(){return s.HasManyTriggers}});var c=n(367);Object.defineProperty(e,"dehydrate",{enumerable:!0,get:function(){return c.dehydrate}});var f=n(897);Object.defineProperty(e,"cancelable",{enumerable:!0,get:function(){return f.cancelable}});var l=n(100);Object.defineProperty(e,"getQueryFromState",{enumerable:!0,get:function(){return l.getQueryFromState}});var p=n(898);Object.defineProperty(e,"Registry",{enumerable:!0,get:function(){return h(p).default}});var d=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(902));function h(t){return t&&t.__esModule?t:{default:t}}e.manifest=d},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}},function(t,e,n){var r=n(159),o=n(110);t.exports=function(t,e,n,i){var a=!n;n||(n={});for(var u=-1,s=e.length;++u<s;){var c=e[u],f=i?i(n[c],t[c],c,n,t):void 0;void 0===f&&(f=t[c]),a?o(n,c,f):r(n,c,f)}return n}},function(t,e,n){var r=n(265),o=n(267),i=n(55);t.exports=function(t){return i(t)?r(t):o(t)}},function(t,e,n){var r=n(468),o=n(157),i=n(469),a=n(470),u=n(471),s=n(41),c=n(263),f=c(r),l=c(o),p=c(i),d=c(a),h=c(u),v=s;(r&&"[object DataView]"!=v(new r(new ArrayBuffer(1)))||o&&"[object Map]"!=v(new o)||i&&"[object Promise]"!=v(i.resolve())||a&&"[object Set]"!=v(new a)||u&&"[object WeakMap]"!=v(new u))&&(v=function(t){var e=s(t),n="[object Object]"==e?t.constructor:void 0,r=n?c(n):"";if(r)switch(r){case f:return"[object DataView]";case l:return"[object Map]";case p:return"[object Promise]";case d:return"[object Set]";case h:return"[object WeakMap]"}return e}),t.exports=v},function(t,e,n){var r=n(41),o=n(29),i="[object Symbol]";t.exports=function(t){return"symbol"==typeof t||o(t)&&r(t)==i}},function(t,e,n){var r=n(113);t.exports=function(t,e,n){var o=null==t?void 0:r(t,e);return void 0===o?n:o}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e){t.exports=!0},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,n){var r=n(19).f,o=n(44),i=n(11)("toStringTag");t.exports=function(t,e,n){t&&!o(t=n?t:t.prototype,i)&&r(t,i,{configurable:!0,value:e})}},function(t,e,n){var r=n(30),o=n(302),i=n(303),a=n(24),u=n(117),s=n(183),c={},f={};(e=t.exports=function(t,e,n,l,p){var d,h,v,y,g=p?function(){return t}:s(t),m=r(n,l,e?2:1),b=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(i(g)){for(d=u(t.length);d>b;b++)if((y=e?m(a(h=t[b])[0],h[1]):m(t[b]))===c||y===f)return y}else for(v=g.call(t);!(h=v.next()).done;)if((y=o(v,m,h.value,e))===c||y===f)return y}).BREAK=c,e.RETURN=f},function(t,e,n){t.exports={default:n(579),__esModule:!0}},function(t,e){t.exports=function(t,e){return t===e||t!=t&&e!=e}},function(t,e,n){var r=n(647),o=n(667),i=n(133),a=n(9),u=n(668);t.exports=function(t){return"function"==typeof t?t:null==t?i:"object"==typeof t?a(t)?o(t[0],t[1]):r(t):u(t)}},function(t,e,n){var r=n(337),o=n(339),i=n(68);t.exports=function(t){return i(t)?r(t):o(t)}},function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,n){var r=n(664),o=n(198),i=n(665),a=n(341),u=n(342),s=n(50),c=n(325),f=c(r),l=c(o),p=c(i),d=c(a),h=c(u),v=s;(r&&"[object DataView]"!=v(new r(new ArrayBuffer(1)))||o&&"[object Map]"!=v(new o)||i&&"[object Promise]"!=v(i.resolve())||a&&"[object Set]"!=v(new a)||u&&"[object WeakMap]"!=v(new u))&&(v=function(t){var e=s(t),n="[object Object]"==e?t.constructor:void 0,r=n?c(n):"";if(r)switch(r){case f:return"[object DataView]";case l:return"[object Map]";case p:return"[object Promise]";case d:return"[object Set]";case h:return"[object WeakMap]"}return e}),t.exports=v},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.receiveMutationError=e.receiveMutationResult=e.initMutation=e.receiveQueryError=e.receiveQueryResult=e.initQuery=e.getRawQueryFromState=e.getQueryFromState=e.getQueryFromStore=e.getDocumentFromState=e.getCollectionFromState=e.getStateRoot=e.createStore=e.StoreProxy=void 0;var r=h(n(38)),o=h(n(4)),i=h(n(1)),a=h(n(2)),u=n(348);Object.defineProperty(e,"initQuery",{enumerable:!0,get:function(){return u.initQuery}}),Object.defineProperty(e,"receiveQueryResult",{enumerable:!0,get:function(){return u.receiveQueryResult}}),Object.defineProperty(e,"receiveQueryError",{enumerable:!0,get:function(){return u.receiveQueryError}});var s=n(217);Object.defineProperty(e,"initMutation",{enumerable:!0,get:function(){return s.initMutation}}),Object.defineProperty(e,"receiveMutationResult",{enumerable:!0,get:function(){return s.receiveMutationResult}}),Object.defineProperty(e,"receiveMutationError",{enumerable:!0,get:function(){return s.receiveMutationError}});var c=n(957),f=h(n(688)),l=n(354),p=h(l),d=h(u);function h(t){return t&&t.__esModule?t:{default:t}}var v=e.StoreProxy=function(){function t(e){(0,i.default)(this,t),this.state=e}return(0,a.default)(t,[{key:"readDocument",value:function(t,e){return this.state.documents[t][e]}},{key:"writeDocument",value:function(t){this.setState(function(e){return(0,o.default)({},e,{documents:(0,o.default)({},e.documents,(0,r.default)({},t._type,(0,o.default)({},e.documents[t._type],(0,r.default)({},t._id,t))))})})}},{key:"readQuery",value:function(t){return this.state.queries[t]}},{key:"writeQuery",value:function(t,e){this.setState(function(n){return(0,o.default)({},n,{queries:(0,o.default)({},n.queries,(0,r.default)({},t,e))})})}},{key:"touchQuery",value:function(t){this.writeQuery(t,(0,o.default)({},this.readQuery(t),{lastUpdate:Date.now()}))}},{key:"setState",value:function(t){this.state=t(this.state)}},{key:"getState",value:function(){return this.state}}]),t}(),y=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{documents:{},queries:{}},e=arguments[1];if(!(0,u.isQueryAction)(e)&&!(0,s.isMutationAction)(e))return t;if(e.update){var n=new v(t);return e.update(n,e.response),{documents:n.getState().documents,queries:(0,d.default)(n.getState().queries,e,n.getState().documents)}}var r=(0,p.default)(t.documents,e),o=r!==t.documents;return{documents:r,queries:(0,d.default)(t.queries,e,r,o)}};e.default=y;e.createStore=function(){return(0,c.createStore)((0,c.combineReducers)({cozy:y}),(0,c.applyMiddleware)(f.default))};var g=e.getStateRoot=function(t){return t.cozy||{}},m=(e.getCollectionFromState=function(t,e){return(0,l.getCollectionFromSlice)(g(t).documents,e)},e.getDocumentFromState=function(t,e,n){return(0,l.getDocumentFromSlice)(g(t).documents,e,n)},e.getQueryFromStore=function(t,e){return m(t.getState(),e)},e.getQueryFromState=function(t,e){return(0,u.getQueryFromSlice)(g(t).queries,e,g(t).documents)});e.getRawQueryFromState=function(t,e){return(0,u.getQueryFromSlice)(g(t).queries,e)}},function(t,e,n){var r=n(68),o=n(20);t.exports=function(t){return o(t)&&r(t)}},function(t,e,n){var r=n(376),o=n(764),i=n(234);t.exports=function(t){return i(t)?r(t):o(t)}},function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,n){var r=n(240),o=n(389);t.exports=function(t,e,n,i){var a=!n;n||(n={});for(var u=-1,s=e.length;++u<s;){var c=e[u],f=i?i(n[c],t[c],c,n,t):void 0;void 0===f&&(f=t[c]),a?o(n,c,f):r(n,c,f)}return n}},function(t,e,n){var r=n(425),o=n(426),i=n(427),a=n(428),u=n(429);function s(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=a,s.prototype.set=u,t.exports=s},function(t,e,n){var r=n(107);t.exports=function(t,e){for(var n=t.length;n--;)if(r(t[n][0],e))return n;return-1}},function(t,e){t.exports=function(t,e){return t===e||t!=t&&e!=e}},function(t,e,n){var r=n(40)(Object,"create");t.exports=r},function(t,e,n){var r=n(449);t.exports=function(t,e){var n=t.__data__;return r(e)?n["string"==typeof e?"string":"hash"]:n.map}},function(t,e,n){var r=n(264);t.exports=function(t,e,n){"__proto__"==e&&r?r(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},function(t,e){var n=9007199254740991,r=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var o=typeof t;return!!(e=null==e?n:e)&&("number"==o||"symbol"!=o&&r.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,n){var r=n(56),o=n(57);t.exports=function(t,e){for(var n=0,i=(e=r(e,t)).length;null!=t&&n<i;)t=t[o(e[n++])];return n&&n==i?t:void 0}},function(t,e){t.exports=function(t){return t}},function(t,e,n){var r=n(110),o=n(294),i=Object.prototype.hasOwnProperty,a=o(function(t,e,n){i.call(t,n)?t[n].push(e):r(t,n,[e])});t.exports=a},function(t,e,n){t.exports={default:n(543),__esModule:!0}},function(t,e,n){var r=n(177),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,e){var n=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+r).toString(36))}},function(t,e,n){var r=n(24),o=n(299),i=n(180),a=n(178)("IE_PROTO"),u=function(){},s=function(){var t,e=n(173)("iframe"),r=i.length;for(e.style.display="none",n(300).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),s=t.F;r--;)delete s.prototype[i[r]];return s()};t.exports=Object.create||function(t,e){var n;return null!==t?(u.prototype=r(t),n=new u,u.prototype=null,n[a]=t):n=s(),void 0===e?n:o(n,e)}},function(t,e,n){var r=n(89),o=n(11)("toStringTag"),i="Arguments"==r(function(){return arguments}());t.exports=function(t){var e,n,a;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),o))?n:i?r(e):"Object"==(a=r(e))&&"function"==typeof e.callee?"Arguments":a}},function(t,e,n){"use strict";e.__esModule=!0;var r=i(n(553)),o=i(n(36));function i(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e){if(Array.isArray(t))return t;if((0,r.default)(Object(t)))return function(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var u,s=(0,o.default)(t);!(r=(u=s.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(t,e){},function(t,e,n){var r=n(118)("meta"),o=n(17),i=n(44),a=n(19).f,u=0,s=Object.isExtensible||function(){return!0},c=!n(43)(function(){return s(Object.preventExtensions({}))}),f=function(t){a(t,r,{value:{i:"O"+ ++u,w:{}}})},l=t.exports={KEY:r,NEED:!1,fastKey:function(t,e){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!i(t,r)){if(!s(t))return"F";if(!e)return"E";f(t)}return t[r].i},getWeak:function(t,e){if(!i(t,r)){if(!s(t))return!0;if(!e)return!1;f(t)}return t[r].w},onFreeze:function(t){return c&&l.NEED&&s(t)&&!i(t,r)&&f(t),t}}},function(t,e,n){var r=n(5),o=n(3),i=n(43);t.exports=function(t,e){var n=(o.Object||{})[t]||Object[t],a={};a[t]=e(n),r(r.S+r.F*i(function(){n(1)}),"Object",a)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HasManyTriggers=e.HasManyInPlace=e.HasOneInPlace=e.HasOne=e.HasMany=e.HasManyFiles=e.Association=e.create=e.resolveClass=void 0;var r=n(323);Object.defineProperty(e,"resolveClass",{enumerable:!0,get:function(){return r.resolveClass}}),Object.defineProperty(e,"create",{enumerable:!0,get:function(){return r.create}});var o=l(n(361)),i=l(n(139)),a=l(n(346)),u=l(n(347)),s=l(n(360)),c=l(n(711)),f=l(n(70));function l(t){return t&&t.__esModule?t:{default:t}}e.Association=f.default,e.HasManyFiles=o.default,e.HasMany=i.default,e.HasOne=a.default,e.HasOneInPlace=u.default,e.HasManyInPlace=s.default,e.HasManyTriggers=c.default},function(t,e,n){var r=n(65),o=n(66);t.exports=function(t,e){for(var n=0,i=(e=r(e,t)).length;null!=t&&n<i;)t=t[o(e[n++])];return n&&n==i?t:void 0}},function(t,e,n){var r=n(51)(Object,"create");t.exports=r},function(t,e,n){var r=n(626),o=n(627),i=n(628),a=n(629),u=n(630);function s(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=a,s.prototype.set=u,t.exports=s},function(t,e,n){var r=n(95);t.exports=function(t,e){for(var n=t.length;n--;)if(r(t[n][0],e))return n;return-1}},function(t,e,n){var r=n(632);t.exports=function(t,e){var n=t.__data__;return r(e)?n["string"==typeof e?"string":"hash"]:n.map}},function(t,e){var n=9007199254740991,r=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var o=typeof t;return!!(e=null==e?n:e)&&("number"==o||"symbol"!=o&&r.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e,n){var r=n(640),o=n(20),i=Object.prototype,a=i.hasOwnProperty,u=i.propertyIsEnumerable,s=r(function(){return arguments}())?r:function(t){return o(t)&&a.call(t,"callee")&&!u.call(t,"callee")};t.exports=s},function(t,e){t.exports=function(t){return t}},function(t,e,n){var r=n(128),o=n(649),i=n(650),a=n(651),u=n(652),s=n(653);function c(t){var e=this.__data__=new r(t);this.size=e.size}c.prototype.clear=o,c.prototype.delete=i,c.prototype.get=a,c.prototype.has=u,c.prototype.set=s,t.exports=c},function(t,e,n){var r=n(196),o=n(655),i=n(656);function a(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new r;++e<n;)this.add(t[e])}a.prototype.add=a.prototype.push=o,a.prototype.has=i,t.exports=a},function(t,e){t.exports=function(t,e){return t.has(e)}},function(t,e,n){(function(t){var r=n(25),o=n(661),i=e&&!e.nodeType&&e,a=i&&"object"==typeof t&&t&&!t.nodeType&&t,u=a&&a.exports===i?r.Buffer:void 0,s=(u?u.isBuffer:void 0)||o;t.exports=s}).call(this,n(23)(t))},function(t,e,n){var r=n(337),o=n(670),i=n(68);t.exports=function(t){return i(t)?r(t,!0):o(t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=v(n(62)),o=v(n(38)),i=v(n(4)),a=v(n(8)),u=v(n(1)),s=v(n(2)),c=v(n(12)),f=v(n(13)),l=v(n(69)),p=v(n(70)),d=n(49),h=n(100);function v(t){return t&&t.__esModule?t:{default:t}}var y=function(t){function e(){var t,n,r,s;(0,u.default)(this,e);for(var f=arguments.length,l=Array(f),p=0;p<f;p++)l[p]=arguments[p];return n=r=(0,c.default)(this,(t=e.__proto__||(0,a.default)(e)).call.apply(t,[this].concat(l))),r.updateRelationshipData=function(t){return function(e,n){var a=(0,h.getDocumentFromState)(n(),r.target._type,r.target._id);e((0,h.receiveQueryResult)(null,{data:(0,i.default)({},a,{relationships:(0,i.default)({},a.relationships,(0,o.default)({},r.name,t(a.relationships[r.name])))})}))}},s=n,(0,c.default)(r,s)}return(0,f.default)(e,t),(0,s.default)(e,[{key:"fetchMore",value:function(){throw"Not implemented"}},{key:"exists",value:function(t){return this.existsById(t._id)}},{key:"existsById",value:function(t){return void 0!==this.getRelationship().data.find(function(e){var n=e._id;return t===n})}},{key:"addById",value:function(t){var e,n=this;this.target.relationships||(this.target.relationships={}),this.target.relationships[this.name]||(this.target.relationships[this.name]={data:[]});var o=(t=Array.isArray(t)?t:[t]).filter(function(t){return!n.existsById(t)}).map(function(t){return{_id:t,_type:n.doctype}});return(e=this.target.relationships[this.name].data).push.apply(e,(0,r.default)(o)),this.updateMetaCount(),this.save(this.target)}},{key:"removeById",value:function(t){return t=Array.isArray(t)?t:[t],this.target.relationships[this.name].data=this.target.relationships[this.name].data.filter(function(e){var n=e._id;return!t.includes(n)}),this.updateMetaCount(),this.save(this.target)}},{key:"updateMetaCount",value:function(){void 0!==(0,l.default)(this.target.relationships[this.name],"meta.count")&&(this.target.relationships[this.name].meta=(0,i.default)({},this.target.relationships[this.name].meta,{count:this.target.relationships[this.name].data.length}))}},{key:"getRelationship",value:function(){var t=this.target[this.name],e=(0,l.default)(this.target,"relationships."+this.name);return e||(t&&t.length&&console.warn("You're trying to access data on a relationship that appear to not be loaded yet. You may want to use 'include()' on your query"),{data:[],next:!0,meta:{count:0}})}},{key:"updateTargetRelationship",value:function(t,e){var n=t.readDocument(this.target._type,this.target._id);t.writeDocument(this.updateRelationship(n,e))}},{key:"updateRelationship",value:function(t,e){return(0,i.default)({},t,{relationships:(0,i.default)({},t.relationships,(0,o.default)({},this.name,(0,i.default)({},t.relationships[this.name],e(t.relationships[this.name]))))})}},{key:"dehydrate",value:function(t){return(0,i.default)({},t,{relationships:(0,i.default)({},t.relationships,(0,o.default)({},this.name,{data:this.raw}))})}},{key:"raw",get:function(){return this.getRelationship().data}},{key:"data",get:function(){var t=this;return this.getRelationship().data.map(function(e){var n=e._id,r=e._type;return t.get(r,n)})}},{key:"hasMore",get:function(){return this.getRelationship().next}},{key:"count",get:function(){var t=this.getRelationship();return t.meta?t.meta.count:t.data.length}}],[{key:"query",value:function(t,e,n){var r=(0,l.default)(t,"relationships."+n.name+".data",[]).map(function(t){return t._id});return new d.QueryDefinition({doctype:n.doctype,ids:r})}}]),e}(p.default);e.default=y},function(t,e,n){var r=n(67),o=n(349),i=n(96);t.exports=function(t,e){var n={};return e=i(e,3),o(t,function(t,o,i){r(n,o,e(t,o,i))}),n}},function(t,e,n){var r=n(135),o=n(214),i=n(215),a=n(136),u=n(679),s=n(206),c=200;t.exports=function(t,e,n){var f=-1,l=o,p=t.length,d=!0,h=[],v=h;if(n)d=!1,l=i;else if(p>=c){var y=e?null:u(t);if(y)return s(y);d=!1,l=a,v=new r}else v=e?[]:h;t:for(;++f<p;){var g=t[f],m=e?e(g):g;if(g=n||0!==g?g:0,d&&m==m){for(var b=v.length;b--;)if(v[b]===m)continue t;e&&v.push(m),h.push(g)}else l(v,m,n)||(v!==h&&v.push(m),h.push(g))}return h}},function(t,e,n){"use strict";e.__esModule=!0;var r=i(n(8)),o=i(n(689));function i(t){return t&&t.__esModule?t:{default:t}}e.default=function t(e,n,i){null===e&&(e=Function.prototype);var a=(0,o.default)(e,n);if(void 0===a){var u=(0,r.default)(e);return null===u?void 0:t(u,n,i)}if("value"in a)return a.value;var s=a.get;return void 0!==s?s.call(i):void 0}},function(t,e,n){var r=n(221),o=n(748),i=n(749);function a(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new r;++e<n;)this.add(t[e])}a.prototype.add=a.prototype.push=o,a.prototype.has=i,t.exports=a},function(t,e,n){var r=n(53)(Object,"create");t.exports=r},function(t,e,n){var r=n(738),o=n(739),i=n(740),a=n(741),u=n(742);function s(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=a,s.prototype.set=u,t.exports=s},function(t,e,n){var r=n(223);t.exports=function(t,e){for(var n=t.length;n--;)if(r(t[n][0],e))return n;return-1}},function(t,e,n){var r=n(744);t.exports=function(t,e){var n=t.__data__;return r(e)?n["string"==typeof e?"string":"hash"]:n.map}},function(t,e){t.exports=function(t,e){return t.has(e)}},function(t,e,n){(function(t){var r=n(27),o=n(762),i=e&&!e.nodeType&&e,a=i&&"object"==typeof t&&t&&!t.nodeType&&t,u=a&&a.exports===i?r.Buffer:void 0,s=(u?u.isBuffer:void 0)||o;t.exports=s}).call(this,n(23)(t))},function(t,e,n){var r=n(779),o=n(224),i=n(780),a=n(373),u=n(781),s=n(75),c=n(372),f=c(r),l=c(o),p=c(i),d=c(a),h=c(u),v=s;(r&&"[object DataView]"!=v(new r(new ArrayBuffer(1)))||o&&"[object Map]"!=v(new o)||i&&"[object Promise]"!=v(i.resolve())||a&&"[object Set]"!=v(new a)||u&&"[object WeakMap]"!=v(new u))&&(v=function(t){var e=s(t),n="[object Object]"==e?t.constructor:void 0,r=n?c(n):"";if(r)switch(r){case f:return"[object DataView]";case l:return"[object Map]";case p:return"[object Promise]";case d:return"[object Set]";case h:return"[object WeakMap]"}return e}),t.exports=v},function(t,e,n){var r=n(77),o=n(79);t.exports=function(t,e){for(var n=0,i=(e=r(e,t)).length;null!=t&&n<i;)t=t[o(e[n++])];return n&&n==i?t:void 0}},function(t,e,n){var r=n(75),o=n(32),i="[object Symbol]";t.exports=function(t){return"symbol"==typeof t||o(t)&&r(t)==i}},function(t,e,n){var r=n(387);t.exports=function(t){return null==t?"":r(t)}},function(t,e,n){var r=n(377)(Object.getPrototypeOf,Object);t.exports=r},function(t,e){t.exports=require("url")},function(t,e,n){var r=n(105),o=n(430),i=n(431),a=n(432),u=n(433),s=n(434);function c(t){var e=this.__data__=new r(t);this.size=e.size}c.prototype.clear=o,c.prototype.delete=i,c.prototype.get=a,c.prototype.has=u,c.prototype.set=s,t.exports=c},function(t,e,n){var r=n(40)(n(22),"Map");t.exports=r},function(t,e,n){var r=n(441),o=n(448),i=n(450),a=n(451),u=n(452);function s(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=a,s.prototype.set=u,t.exports=s},function(t,e,n){var r=n(110),o=n(107),i=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var a=t[e];i.call(t,e)&&o(a,n)&&(void 0!==n||e in t)||r(t,e,n)}},function(t,e,n){var r=n(456),o=n(29),i=Object.prototype,a=i.hasOwnProperty,u=i.propertyIsEnumerable,s=r(function(){return arguments}())?r:function(t){return o(t)&&a.call(t,"callee")&&!u.call(t,"callee")};t.exports=s},function(t,e,n){(function(t){var r=n(22),o=n(457),i=e&&!e.nodeType&&e,a=i&&"object"==typeof t&&t&&!t.nodeType&&t,u=a&&a.exports===i?r.Buffer:void 0,s=(u?u.isBuffer:void 0)||o;t.exports=s}).call(this,n(23)(t))},function(t,e){var n=9007199254740991;t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}},function(t,e,n){(function(t){var r=n(262),o=e&&!e.nodeType&&e,i=o&&"object"==typeof t&&t&&!t.nodeType&&t,a=i&&i.exports===o&&r.process,u=function(){try{var t=i&&i.require&&i.require("util").types;return t||a&&a.binding&&a.binding("util")}catch(t){}}();t.exports=u}).call(this,n(23)(t))},function(t,e){var n=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||n)}},function(t,e,n){var r=n(466),o=n(270),i=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,u=a?function(t){return null==t?[]:(t=Object(t),r(a(t),function(e){return i.call(t,e)}))}:o;t.exports=u},function(t,e){t.exports=function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}},function(t,e,n){var r=n(268)(Object.getPrototypeOf,Object);t.exports=r},function(t,e,n){var r=n(273),o=n(271),i=n(269);t.exports=function(t){return r(t,i,o)}},function(t,e,n){var r=n(274);t.exports=function(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}},function(t,e,n){var r=n(14),o=n(85),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;t.exports=function(t,e){if(r(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!o(t))||(a.test(t)||!i.test(t)||null!=e&&t in Object(e))}},function(t,e,n){var r=n(166),o=n(492);t.exports=function t(e,n,i,a,u){var s=-1,c=e.length;for(i||(i=o),u||(u=[]);++s<c;){var f=e[s];n>0&&i(f)?n>1?t(f,n-1,i,a,u):r(u,f):a||(u[u.length]=f)}return u}},function(t,e,n){var r=n(171),o=n(534),i=n(538),a=n(539),u=i(function(t,e){if(null==t)return[];var n=e.length;return n>1&&a(t,e[0],e[1])?e=[]:n>2&&a(e[0],e[1],e[2])&&(e=[e[0]]),o(t,r(e,1),[])});t.exports=u},function(t,e,n){var r=n(17),o=n(10).document,i=r(o)&&r(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,e,n){var r=n(17);t.exports=function(t,e){if(!r(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!r(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,e,n){var r=n(89);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e){var n=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},function(t,e,n){var r=n(179)("keys"),o=n(118);t.exports=function(t){return r[t]||(r[t]=o(t))}},function(t,e,n){var r=n(3),o=n(10),i=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(t.exports=function(t,e){return i[t]||(i[t]=void 0!==e?e:{})})("versions",[]).push({version:r.version,mode:n(90)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,n){t.exports={default:n(548),__esModule:!0}},function(t,e,n){"use strict";var r=n(90),o=n(5),i=n(298),a=n(34),u=n(59),s=n(550),c=n(92),f=n(301),l=n(11)("iterator"),p=!([].keys&&"next"in[].keys()),d=function(){return this};t.exports=function(t,e,n,h,v,y,g){s(n,e,h);var m,b,x,w=function(t){if(!p&&t in j)return j[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},_=e+" Iterator",k="values"==v,O=!1,j=t.prototype,S=j[l]||j["@@iterator"]||v&&j[v],E=S||w(v),A=v?k?w("entries"):E:void 0,C="Array"==e&&j.entries||S;if(C&&(x=f(C.call(new t)))!==Object.prototype&&x.next&&(c(x,_,!0),r||"function"==typeof x[l]||a(x,l,d)),k&&S&&"values"!==S.name&&(O=!0,E=function(){return S.call(this)}),r&&!g||!p&&!O&&j[l]||a(j,l,E),u[e]=E,u[_]=d,v)if(m={values:k?E:w("values"),keys:y?E:w("keys"),entries:A},g)for(b in m)b in j||i(j,b,m[b]);else o(o.P+o.F*(p||O),e,m);return m}},function(t,e,n){var r=n(120),o=n(11)("iterator"),i=n(59);t.exports=n(3).getIteratorMethod=function(t){if(null!=t)return t[o]||t["@@iterator"]||i[r(t)]}},function(t,e){t.exports=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t}},function(t,e,n){"use strict";var r=n(87);function o(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r}),this.resolve=r(e),this.reject=r(n)}t.exports.f=function(t){return new o(t)}},function(t,e,n){var r=n(34);t.exports=function(t,e,n){for(var o in e)n&&t[o]?t[o]=e[o]:r(t,o,e[o]);return t}},function(t,e,n){var r=n(17);t.exports=function(t,e){if(!r(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,n){e.f=n(11)},function(t,e,n){var r=n(10),o=n(3),i=n(90),a=n(189),u=n(19).f;t.exports=function(t){var e=o.Symbol||(o.Symbol=i?{}:r.Symbol||{});"_"==t.charAt(0)||t in e||u(e,t,{value:a.f(t)})}},function(t,e,n){var r=n(91),o=n(88),i=n(35),a=n(174),u=n(44),s=n(295),c=Object.getOwnPropertyDescriptor;e.f=n(15)?c:function(t,e){if(t=i(t),e=a(e,!0),s)try{return c(t,e)}catch(t){}if(u(t,e))return o(!r.f.call(t,e),t[e])}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.chain=void 0;var r=u(n(62)),o=u(n(193)),i=u(n(1)),a=u(n(2));function u(t){return t&&t.__esModule?t:{default:t}}var s=function(){function t(e){(0,i.default)(this,t),"function"==typeof e&&(this.request=e)}return(0,a.default)(t,[{key:"request",value:function(t,e,n){throw new Error("request is not implemented")}}]),t}();e.default=s;var c=function(t){return"function"==typeof t?new s(t):t},f=function(t,e){if(e)return e;if(t.execute)return t.execute();throw new Error("No link could handle operation "+(0,o.default)(t))},l=(e.chain=function(t){return[].concat((0,r.default)(t),[f]).map(c).reduce(l)},function(t,e){return new s(function(n,r,o){return t.request(n,r,function(t,n){return e.request(t,n,o)})})})},function(t,e,n){t.exports={default:n(609),__esModule:!0}},function(t,e,n){var r=n(9),o=n(195),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;t.exports=function(t,e){if(r(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!o(t))||(a.test(t)||!i.test(t)||null!=e&&t in Object(e))}},function(t,e,n){var r=n(50),o=n(20),i="[object Symbol]";t.exports=function(t){return"symbol"==typeof t||o(t)&&r(t)==i}},function(t,e,n){var r=n(615),o=n(631),i=n(633),a=n(634),u=n(635);function s(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=a,s.prototype.set=u,t.exports=s},function(t,e,n){var r=n(50),o=n(26),i="[object AsyncFunction]",a="[object Function]",u="[object GeneratorFunction]",s="[object Proxy]";t.exports=function(t){if(!o(t))return!1;var e=r(t);return e==a||e==u||e==i||e==s}},function(t,e,n){var r=n(51)(n(25),"Map");t.exports=r},function(t,e,n){var r=n(67),o=n(95),i=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var a=t[e];i.call(t,e)&&o(a,n)&&(void 0!==n||e in t)||r(t,e,n)}},function(t,e){var n=9007199254740991;t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}},function(t,e,n){var r=n(202),o=n(329),i=n(330);t.exports=function(t){return i(o(t,void 0,r),t+"")}},function(t,e,n){var r=n(203);t.exports=function(t){return(null==t?0:t.length)?r(t,1):[]}},function(t,e,n){var r=n(204),o=n(641);t.exports=function t(e,n,i,a,u){var s=-1,c=e.length;for(i||(i=o),u||(u=[]);++s<c;){var f=e[s];n>0&&i(f)?n>1?t(f,n-1,i,a,u):r(u,f):a||(u[u.length]=f)}return u}},function(t,e){t.exports=function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}},function(t,e,n){var r=n(654),o=n(20);t.exports=function t(e,n,i,a,u){return e===n||(null==e||null==n||!o(e)&&!o(n)?e!=e&&n!=n:r(e,n,i,a,t,u))}},function(t,e){t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}},function(t,e,n){var r=n(335),o=n(336),i=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,u=a?function(t){return null==t?[]:(t=Object(t),r(a(t),function(e){return i.call(t,e)}))}:o;t.exports=u},function(t,e,n){var r=n(662),o=n(98),i=n(209),a=i&&i.isTypedArray,u=a?o(a):r;t.exports=u},function(t,e,n){(function(t){var r=n(322),o=e&&!e.nodeType&&e,i=o&&"object"==typeof t&&t&&!t.nodeType&&t,a=i&&i.exports===o&&r.process,u=function(){try{var t=i&&i.require&&i.require("util").types;return t||a&&a.binding&&a.binding("util")}catch(t){}}();t.exports=u}).call(this,n(23)(t))},function(t,e){var n=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||n)}},function(t,e){t.exports=function(t){return function(e){return null==e?void 0:e[t]}}},function(t,e,n){var r=n(334),o=n(345),i=n(138);t.exports=function(t){return r(t,i,o)}},function(t,e,n){var r=n(340)(Object.getPrototypeOf,Object);t.exports=r},function(t,e,n){var r=n(675);t.exports=function(t,e){return!!(null==t?0:t.length)&&r(t,e,0)>-1}},function(t,e){t.exports=function(t,e,n){for(var r=-1,o=null==t?0:t.length;++r<o;)if(n(e,t[r]))return!0;return!1}},function(t,e,n){var r=n(50),o=n(213),i=n(20),a="[object Object]",u=Function.prototype,s=Object.prototype,c=u.toString,f=s.hasOwnProperty,l=c.call(Object);t.exports=function(t){if(!i(t)||r(t)!=a)return!1;var e=o(t);if(null===e)return!0;var n=f.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&c.call(n)==l}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.receiveMutationError=e.receiveMutationResult=e.initMutation=e.isReceivingMutationResult=e.isMutationAction=void 0;var r,o=n(4),i=(r=o)&&r.__esModule?r:{default:r};var a="INIT_MUTATION",u="RECEIVE_MUTATION_RESULT",s="RECEIVE_MUTATION_ERROR";e.isMutationAction=function(t){return-1!==[a,u,s].indexOf(t.type)},e.isReceivingMutationResult=function(t){return t.type===u},e.initMutation=function(t,e){return{type:a,mutationId:t,definition:e}},e.receiveMutationResult=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return(0,i.default)({type:u,mutationId:t,response:e},n,{definition:r})},e.receiveMutationError=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{type:s,mutationId:t,error:e,definition:n}}},function(t,e){t.exports=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}},function(t,e,n){var r=n(332);t.exports=function(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}},function(t,e,n){var r=n(26),o=Object.create,i=function(){function t(){}return function(e){if(!r(e))return{};if(o)return o(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();t.exports=i},function(t,e,n){var r=n(725),o=n(743),i=n(745),a=n(746),u=n(747);function s(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=a,s.prototype.set=u,t.exports=s},function(t,e,n){var r=n(75),o=n(31),i="[object AsyncFunction]",a="[object Function]",u="[object GeneratorFunction]",s="[object Proxy]";t.exports=function(t){if(!o(t))return!1;var e=r(t);return e==a||e==u||e==i||e==s}},function(t,e){t.exports=function(t,e){return t===e||t!=t&&e!=e}},function(t,e,n){var r=n(53)(n(27),"Map");t.exports=r},function(t,e,n){var r=n(750);t.exports=function(t,e){return!!(null==t?0:t.length)&&r(t,e,0)>-1}},function(t,e){t.exports=function(t,e,n){for(var r=-1,o=null==t?0:t.length;++r<o;)if(n(e,t[r]))return!0;return!1}},function(t,e){t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}},function(t,e,n){var r=n(761),o=n(32),i=Object.prototype,a=i.hasOwnProperty,u=i.propertyIsEnumerable,s=r(function(){return arguments}())?r:function(t){return o(t)&&a.call(t,"callee")&&!u.call(t,"callee")};t.exports=s},function(t,e){var n=9007199254740991,r=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var o=typeof t;return!!(e=null==e?n:e)&&("number"==o||"symbol"!=o&&r.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e,n){var r=n(763),o=n(103),i=n(232),a=i&&i.isTypedArray,u=a?o(a):r;t.exports=u},function(t,e){var n=9007199254740991;t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}},function(t,e,n){(function(t){var r=n(371),o=e&&!e.nodeType&&e,i=o&&"object"==typeof t&&t&&!t.nodeType&&t,a=i&&i.exports===o&&r.process,u=function(){try{var t=i&&i.require&&i.require("util").types;return t||a&&a.binding&&a.binding("util")}catch(t){}}();t.exports=u}).call(this,n(23)(t))},function(t,e){var n=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||n)}},function(t,e,n){var r=n(222),o=n(231);t.exports=function(t){return null!=t&&o(t.length)&&!r(t)}},function(t,e,n){var r=n(145),o=n(768),i=n(769),a=n(770),u=n(771),s=n(772);function c(t){var e=this.__data__=new r(t);this.size=e.size}c.prototype.clear=o,c.prototype.delete=i,c.prototype.get=a,c.prototype.has=u,c.prototype.set=s,t.exports=c},function(t,e){t.exports=function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}},function(t,e,n){var r=n(778),o=n(384),i=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,u=a?function(t){return null==t?[]:(t=Object(t),r(a(t),function(e){return i.call(t,e)}))}:o;t.exports=u},function(t,e,n){var r=n(21),o=n(152),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;t.exports=function(t,e){if(r(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!o(t))||(a.test(t)||!i.test(t)||null!=e&&t in Object(e))}},function(t,e){t.exports=function(t){return t}},function(t,e,n){var r=n(389),o=n(223),i=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var a=t[e];i.call(t,e)&&o(a,n)&&(void 0!==n||e in t)||r(t,e,n)}},function(t,e,n){var r=n(383),o=n(392),i=n(391);t.exports=function(t){return r(t,i,o)}},function(t,e,n){var r=n(381);t.exports=function(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}},function(t,e,n){var r=n(236),o=n(820);t.exports=function t(e,n,i,a,u){var s=-1,c=e.length;for(i||(i=o),u||(u=[]);++s<c;){var f=e[s];n>0&&i(f)?n>1?t(f,n-1,i,a,u):r(u,f):a||(u[u.length]=f)}return u}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Collection=e.dontThrowNotFoundError=void 0;var r=u(n(6)),o=u(n(7)),i=u(n(1)),a=u(n(2));function u(t){return t&&t.__esModule?t:{default:t}}var s=e.dontThrowNotFoundError=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(t.message.match(/not_found/)){var n=Array.isArray(e);return n?{data:e,meta:{count:0},skip:0,next:!1}:{data:e}}throw t},c=e.Collection=function(){function t(){(0,i.default)(this,t)}var e;return(0,a.default)(t,null,[{key:"get",value:(e=(0,o.default)(r.default.mark(function t(e,n,o){var i,a=o.normalize,u=void 0===a?function(t,e){return t}:a,c=o.method,f=void 0===c?"GET":c;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.fetchJSON(f,n);case 3:return i=t.sent,t.abrupt("return",{data:u(i.data,i)});case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",s(t.t0,null));case 10:case"end":return t.stop()}},t,this,[[0,7]])})),function(t,n,r){return e.apply(this,arguments)})}]),t}();e.default=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isDirectory=e.isFile=void 0;var r=D(n(63)),o=D(n(48)),i=D(n(36)),a=D(n(73)),u=D(n(6)),s=D(n(7)),c=D(n(8)),f=D(n(1)),l=D(n(2)),p=D(n(12)),d=D(n(13)),h=D(n(61)),v=D(n(4)),y=(0,a.default)(["/data/","/","/relationships/references"],["/data/","/","/relationships/references"]),g=(0,a.default)(["/files/","/relationships/referenced_by"],["/files/","/relationships/referenced_by"]),m=(0,a.default)(["/files/",""],["/files/",""]),b=(0,a.default)(["/files/trash/",""],["/files/trash/",""]),x=(0,a.default)(["/files/","?Name=","&Type=file&Executable=","&MetadataID=",""],["/files/","?Name=","&Type=file&Executable=","&MetadataID=",""]),w=(0,a.default)(["/files/","?Name=","&Type=file&Executable=",""],["/files/","?Name=","&Type=file&Executable=",""]),_=(0,a.default)(["/files/downloads?Id=",""],["/files/downloads?Id=",""]),k=(0,a.default)(["/files/downloads?Path=",""],["/files/downloads?Path=",""]),O=(0,a.default)(["/files/metadata?Path=",""],["/files/metadata?Path=",""]),j=(0,a.default)(["/files/","?Name=","&Type=directory"],["/files/","?Name=","&Type=directory"]),S=(0,a.default)(["/files/upload/metadata"],["/files/upload/metadata"]),E=D(n(837)),A=D(n(840)),C=n(52),T=D(C),P=n(74),M=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(398));function D(t){return t&&t.__esModule?t:{default:t}}var R=function(t){return(0,v.default)({},(0,C.normalizeDoc)(t,"io.cozy.files"),t.attributes)},I=function(t){return t&&t.trim()},z=function(t){return E.default.getType(t)||"application/octet-stream"},N=(e.isFile=function(t){var e=t._type,n=t.type;return"io.cozy.files"===e||"directory"===n||"file"===n},e.isDirectory=function(t){return"directory"===t.type},function(t,e){return new h.default(function(n){t.forEach(function(t){return t.then(function(t){e(t)&&n(!0)})}),h.default.all(t).then(function(){return n(!1)})})}),L=function(t){function e(t,n){(0,f.default)(this,e);var r=(0,p.default)(this,(e.__proto__||(0,c.default)(e)).call(this,t,n));return r.extractResponseLinkRelated=function(t){var e=t.links&&t.links.related;if(!e)throw new Error("No related link in server response");return r.stackClient.fullpath(e)},r.specialDirectories={},r}var n,a,h,v,E,C,T,D,L,F,B,U,$,q,J,V,G,H,Q,Y;return(0,d.default)(e,t),(0,l.default)(e,[{key:"get",value:function(t){return this.statById(t)}},{key:"find",value:(Y=(0,s.default)(u.default.mark(function t(e){var n,r,o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.skip,r=void 0===n?0:n,t.t0=this.stackClient,t.next=4,this.toMangoOptions(e,i);case 4:return t.t1=t.sent,t.next=7,t.t0.fetchJSON.call(t.t0,"POST","/files/_find",t.t1);case 7:return o=t.sent,t.abrupt("return",{data:o.data.map(function(t){return R(t)}),meta:o.meta,next:o.meta.count>r+o.data.length,skip:r});case 9:case"end":return t.stop()}},t,this)})),function(t){return Y.apply(this,arguments)})},{key:"findReferencedBy",value:(Q=(0,s.default)(u.default.mark(function t(e){var n,r,o,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=a.skip,c=void 0===s?0:s,f=a.limit,l=a.cursor;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={include:"files","page[limit]":f,"page[cursor]":l,sort:"datetime"},r=(0,P.uri)(y,e._type,e._id),o=M.buildURL(r,n),t.next=5,this.stackClient.fetchJSON("GET",o);case 5:return i=t.sent,t.abrupt("return",{data:i.data.map(function(t){return R(t)}),included:i.included?i.included.map(function(t){return R(t)}):[],next:(0,A.default)(i,"links.next"),meta:i.meta,skip:c});case 7:case"end":return t.stop()}},t,this)})),function(t){return Q.apply(this,arguments)})},{key:"addReferencedBy",value:function(t,e){var n=e.map(function(t){return{id:t._id,type:t._type}});return this.stackClient.fetchJSON("POST",(0,P.uri)(g,t._id),{data:n})}},{key:"removeReferencedBy",value:function(t,e){var n=e.map(function(t){return{id:t._id,type:t._type}});return this.stackClient.fetchJSON("DELETE",(0,P.uri)(g,t._id),{data:n})}},{key:"addReferencesTo",value:function(t,e){var n=e.map(function(t){return{id:t._id,type:"io.cozy.files"}});return this.stackClient.fetchJSON("POST",(0,P.uri)(y,t._type,t._id),{data:n})}},{key:"removeReferencesTo",value:function(t,e){var n=e.map(function(t){return{id:t._id,type:"io.cozy.files"}});return this.stackClient.fetchJSON("DELETE",(0,P.uri)(y,t._type,t._id),{data:n})}},{key:"destroy",value:(H=(0,s.default)(u.default.mark(function t(e){var n,r,o,a,s,c,f,l=e._id,p=e.relationships,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=d.ifMatch,v=void 0===h?"":h;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(p&&p.referenced_by&&Array.isArray(p.referenced_by.data))){t.next=27;break}n=!0,r=!1,o=void 0,t.prev=4,a=(0,i.default)(p.referenced_by.data);case 6:if(n=(s=a.next()).done){t.next=13;break}return c=s.value,t.next=10,this.removeReferencesTo({_id:c.id,_type:c.type},[{_id:l}]);case 10:n=!0,t.next=6;break;case 13:t.next=19;break;case 15:t.prev=15,t.t0=t.catch(4),r=!0,o=t.t0;case 19:t.prev=19,t.prev=20,!n&&a.return&&a.return();case 22:if(t.prev=22,!r){t.next=25;break}throw o;case 25:return t.finish(22);case 26:return t.finish(19);case 27:return t.next=29,this.stackClient.fetchJSON("DELETE",(0,P.uri)(m,l),void 0,{headers:{"If-Match":v}});case 29:return f=t.sent,t.abrupt("return",{data:R(f.data)});case 31:case"end":return t.stop()}},t,this,[[4,15,19,27],[20,,22,26]])})),function(t){return H.apply(this,arguments)})},{key:"restore",value:function(t){return this.stackClient.fetchJSON("POST",(0,P.uri)(b,t))}},{key:"deleteFilePermanently",value:(G=(0,s.default)(u.default.mark(function t(e){var n;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("PATCH",(0,P.uri)(m,e),{data:{type:"io.cozy.files",id:e,attributes:{permanent_delete:!0}}});case 2:return n=t.sent,t.abrupt("return",n.data);case 4:case"end":return t.stop()}},t,this)})),function(t){return G.apply(this,arguments)})},{key:"upload",value:(V=(0,s.default)(u.default.mark(function t(e,n){var r;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureDirectoryExists(n);case 2:return r=t.sent,t.abrupt("return",this.createFile(e,{dirId:r}));case 4:case"end":return t.stop()}},t,this)})),function(t,e){return V.apply(this,arguments)})},{key:"createFile",value:(J=(0,s.default)(u.default.mark(function t(e){var n,r,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=a.name,c=a.dirId,f=void 0===c?"":c,l=a.executable,p=a.metadata,d=(0,o.default)(a,["name","dirId","executable","metadata"]);return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s||"string"!=typeof e.name||(s=e.name),"string"==typeof(s=I(s))&&""!==s){t.next=4;break}throw new Error("missing name argument");case 4:if(void 0===l&&(l=!1),n="",!p){t.next=11;break}return t.next=9,this.createFileMetadata(p);case 9:r=t.sent,n=r.data.id;case 11:return i=(0,P.uri)(x,f,s,l,n),t.abrupt("return",this.doUpload(e,i,d));case 13:case"end":return t.stop()}},t,this)})),function(t){return J.apply(this,arguments)})},{key:"updateFile",value:(q=(0,s.default)(u.default.mark(function t(e){var n,r,i,a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=s.executable,f=void 0!==c&&c,l=s.fileId,p=s.metadata,d=(0,o.default)(s,["executable","fileId","metadata"]);return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(l&&"string"==typeof l){t.next=2;break}throw new Error("missing fileId argument");case 2:if("string"==typeof e.name){t.next=4;break}throw new Error("missing name in data argument");case 4:if("string"==typeof(n=I(e.name))&&""!==n){t.next=7;break}throw new Error("missing name argument");case 7:if(r=void 0,i=(0,P.uri)(w,l,n,f),!p){t.next=15;break}return t.next=12,this.createFileMetadata(p);case 12:a=t.sent,r=a.data.id,i=i+"&MetadataID="+r;case 15:return t.abrupt("return",this.doUpload(e,i,d,"PUT"));case 16:case"end":return t.stop()}},t,this)})),function(t){return q.apply(this,arguments)})},{key:"getDownloadLinkById",value:function(t){return this.stackClient.fetchJSON("POST",(0,P.uri)(_,t)).then(this.extractResponseLinkRelated)}},{key:"getDownloadLinkByPath",value:function(t){return this.stackClient.fetchJSON("POST",(0,P.uri)(k,t)).then(this.extractResponseLinkRelated)}},{key:"download",value:($=(0,s.default)(u.default.mark(function t(e){var n;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getDownloadLinkById(e._id);case 2:n=t.sent,(0,P.forceFileDownload)(n+"?Dl=1",e.name);case 4:case"end":return t.stop()}},t,this)})),function(t){return $.apply(this,arguments)})},{key:"downloadArchive",value:(U=(0,s.default)(u.default.mark(function t(e){var n,r,o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"files";return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,P.slugify)(i),t.next=3,this.getArchiveLinkByIds(e,n);case 3:r=t.sent,o=this.stackClient.fullpath(r),(0,P.forceFileDownload)(o,n+".zip");case 6:case"end":return t.stop()}},t,this)})),function(t){return U.apply(this,arguments)})},{key:"getArchiveLinkByIds",value:(B=(0,s.default)(u.default.mark(function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"files";return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("POST","/files/archive",{data:{type:"io.cozy.archives",attributes:{name:r,ids:e}}});case 2:return n=t.sent,t.abrupt("return",n.links.related);case 4:case"end":return t.stop()}},t,this)})),function(t){return B.apply(this,arguments)})},{key:"isChildOf",value:(F=(0,s.default)(u.default.mark(function t(e,n){var o,i,a,s,c,f,l,p,d,h,v=this;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o="object"===(void 0===e?"undefined":(0,r.default)(e))?e:{_id:e},i=o._id,a=o.dirID,s=o.path,c="object"===(void 0===n?"undefined":(0,r.default)(n))?n:{_id:n},f=c._id,i!==f&&a!==f){t.next=4;break}return t.abrupt("return",!0);case 4:if(s){t.next=10;break}return t.next=7,this.statById(i);case 7:l=t.sent,s=l.path,a=l.dirID;case 10:for(p=s,d=[s];""!=p;)y=void 0,y=(u=p).lastIndexOf("/"),""!=(h=u.substring(0,y))&&d.push(h),p=h;return d.reverse(),t.abrupt("return",N(d.map(function(t){return v.statByPath(t)}),function(t){return t.data._id==f}));case 15:case"end":return t.stop()}var u,y},t,this)})),function(t,e){return F.apply(this,arguments)})},{key:"statById",value:(L=(0,s.default)(u.default.mark(function t(e){var n,r,o,i,a,s,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=c.limit,r=c.skip,o={limit:n,skip:void 0===r?0:r},i=(0,P.uri)(m,e),a=M.buildURL(i,o),t.next=6,this.stackClient.fetchJSON("GET",a);case 6:return s=t.sent,t.abrupt("return",{data:R(s.data),included:s.included&&s.included.map(function(t){return R(t)})});case 8:case"end":return t.stop()}},t,this)})),function(t){return L.apply(this,arguments)})},{key:"statByPath",value:(D=(0,s.default)(u.default.mark(function t(e){var n;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("GET",(0,P.uri)(O,e));case 2:return n=t.sent,t.abrupt("return",{data:R(n.data),included:n.included&&n.included.map(function(t){return R(t)})});case 4:case"end":return t.stop()}},t,this)})),function(t){return D.apply(this,arguments)})},{key:"createDirectory",value:(T=(0,s.default)(u.default.mark(function t(){var e,n,r,o,i,a,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.name,n=s.dirId,r=s.lastModifiedDate,o=I(e),"string"==typeof e&&""!==o){t.next=4;break}throw new Error("missing name argument");case 4:return i=r&&("string"==typeof r?new Date(r):r),t.next=7,this.stackClient.fetchJSON("POST",(0,P.uri)(j,n,o),void 0,{headers:{Date:i?i.toGMTString():""}});case 7:return a=t.sent,t.abrupt("return",{data:R(a.data)});case 9:case"end":return t.stop()}},t,this)})),function(){return T.apply(this,arguments)})},{key:"ensureDirectoryExists",value:(C=(0,s.default)(u.default.mark(function t(e){var n;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.specialDirectories[e]){t.next=5;break}return t.next=3,this.createDirectoryByPath(e);case 3:n=t.sent,this.specialDirectories[e]=n.data._id;case 5:return t.abrupt("return",this.specialDirectories[e]);case 6:case"end":return t.stop()}},t,this)})),function(t){return C.apply(this,arguments)})},{key:"getDirectoryOrCreate",value:(E=(0,s.default)(u.default.mark(function t(e,n){var r,o,i,a,s;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n||n.attributes){t.next=2;break}throw new Error("Malformed parent directory");case 2:return r=I(e),o=("io.cozy.files.root-dir"===n._id?"":n.attributes.path)+"/"+r,t.prev=4,t.next=7,this.statByPath(o||"/");case 7:return i=t.sent,t.abrupt("return",i);case 11:if(t.prev=11,t.t0=t.catch(4),a=JSON.parse(t.t0.message),!(s=a.errors)||!s.length||"404"!==s[0].status){t.next=17;break}return t.abrupt("return",this.createDirectory({name:r,dirId:n&&n._id}));case 17:throw s;case 18:case"end":return t.stop()}},t,this,[[4,11]])})),function(t,e){return E.apply(this,arguments)})},{key:"createDirectoryByPath",value:(v=(0,s.default)(u.default.mark(function t(e){var n,r,o,a,s,c,f,l,p;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.split("/").filter(function(t){return""!==t}),t.next=3,this.statById("io.cozy.files.root-dir");case 3:if(r=t.sent,n.length){t.next=6;break}return t.abrupt("return",r);case 6:o=r,a=!0,s=!1,c=void 0,t.prev=10,f=(0,i.default)(n);case 12:if(a=(l=f.next()).done){t.next=20;break}return p=l.value,t.next=16,this.getDirectoryOrCreate(p,o.data);case 16:o=t.sent;case 17:a=!0,t.next=12;break;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(10),s=!0,c=t.t0;case 26:t.prev=26,t.prev=27,!a&&f.return&&f.return();case 29:if(t.prev=29,!s){t.next=32;break}throw c;case 32:return t.finish(29);case 33:return t.finish(26);case 34:return t.abrupt("return",o);case 35:case"end":return t.stop()}},t,this,[[10,22,26,34],[27,,29,33]])})),function(t){return v.apply(this,arguments)})},{key:"updateFileMetadata",value:(h=(0,s.default)(u.default.mark(function t(e,n){var r;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("PATCH",(0,P.uri)(m,e),{data:{type:"io.cozy.files",id:e,attributes:n}});case 2:return r=t.sent,t.abrupt("return",{data:R(r.data)});case 4:case"end":return t.stop()}},t,this)})),function(t,e){return h.apply(this,arguments)})},{key:"createFileMetadata",value:(a=(0,s.default)(u.default.mark(function t(e){var n;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("POST",(0,P.uri)(S),{data:{type:"io.cozy.files.metadata",attributes:e}});case 2:return n=t.sent,t.abrupt("return",{data:n.data});case 4:case"end":return t.stop()}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"doUpload",value:(n=(0,s.default)(u.default.mark(function t(e,n,r){var o,i,a,s,c,f,l,p,d,h,v,y,g,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"POST";return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("missing data argument");case 2:if(e.buffer&&e.buffer instanceof ArrayBuffer&&(e=e.buffer),o="undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer,i="undefined"!=typeof File&&e instanceof File,a="undefined"!=typeof Blob&&e instanceof Blob,s=!0===e.readable&&"function"==typeof e.pipe,c="string"==typeof e,o||i||a||s||c){t.next=10;break}throw new Error("invalid data type");case 10:return l=(f=r||{}).contentType,p=f.contentLength,d=f.checksum,h=f.lastModifiedDate,v=f.ifMatch,l||(o?l="application/octet-stream":i?(l=e.type||z(e.name.toLowerCase())||"application/octet-stream",h||(h=e.lastModifiedDate)):a?l=e.type||"application/octet-stream":s?l="application/octet-stream":"string"==typeof e&&(l="text/plain")),h&&"string"==typeof h&&(h=new Date(h)),y={"Content-Type":l},p&&(y["Content-Length"]=String(p)),d&&(y["Content-MD5"]=d),h&&(y.Date=h.toGMTString()),v&&(y["If-Match"]=v),t.next=20,this.stackClient.fetchJSON(m,n,e,{headers:y});case 20:return g=t.sent,t.abrupt("return",{data:R(g.data)});case 22:case"end":return t.stop()}},t,this)})),function(t,e,r){return n.apply(this,arguments)})}]),e}(T.default);e.default=L},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isMobile=e.isIOS=e.isAndroid=e.isMobileApp=e.isWebApp=e.isAndroidApp=e.isIOSApp=e.getPlatform=void 0;var r=n(247),o=function(){return(0,r.isCordova)()?window.cordova.platformId:"web"};e.getPlatform=o;var i=function(t){return o()===t};e.isIOSApp=function(){return i("ios")};e.isAndroidApp=function(){return i("android")};e.isWebApp=function(){return i("web")};e.isMobileApp=function(){return(0,r.isCordova)()};var a=function(){return window.navigator.userAgent&&window.navigator.userAgent.indexOf("Android")>=0};e.isAndroid=a;var u=function(){return window.navigator.userAgent&&/iPad|iPhone|iPod/.test(window.navigator.userAgent)};e.isIOS=u;e.isMobile=function(){return a()||u()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isCordova=void 0;e.isCordova=function(){return"undefined"!=typeof window&&void 0!==window.cordova}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hasSafariPlugin=e.hasInAppBrowserPlugin=e.hasDevicePlugin=void 0;var r=n(247);e.hasDevicePlugin=function(){return(0,r.isCordova)()&&void 0!==window.device};e.hasInAppBrowserPlugin=function(){return(0,r.isCordova)()&&void 0!==window.cordova.InAppBrowser};e.hasSafariPlugin=function(){return new Promise(function(t){(0,r.isCordova)()&&void 0!==window.SafariViewController?window.SafariViewController.isAvailable(function(e){return t(e)}):t(!1)})}},function(t,e,n){var r=n(220),o=n(250);function i(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=void 0}i.prototype=r(o.prototype),i.prototype.constructor=i,t.exports=i},function(t,e){t.exports=function(){}},function(t,e,n){var r=n(220),o=n(250),i=4294967295;function a(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=i,this.__views__=[]}a.prototype=r(o.prototype),a.prototype.constructor=a,t.exports=a},function(t,e,n){const r=n(115),o=n(86),i=n(16),a=n(924),{getSlugFromInstitutionLabel:u}=n(414);class s extends i{static reconciliate(t,e){return a.matchAccounts(t,e).map(t=>({...t.account,_id:t.match?t.match._id:void 0}))}static findDuplicateAccountsWithNoOperations(t,e){const n=r(e,t=>t.account),o=Object.entries(r(t,t=>t.institutionLabel+" > "+t.label)).map(([,t])=>t).filter(t=>t.length>1),i=[];for(const t of o)for(const e of t){0===(n[e._id]||[]).length&&i.push(e)}return i}static hasIncoherentCreatedByApp(t){const e=u(t.institutionLabel),n=t.cozyMetadata&&t.cozyMetadata.createdByApp;return Boolean(e&&n&&e!==n)}static getUpdatedAt(t){const e=o(t,"metadata.updatedAt");if(e)return e;const n=o(t,"cozyMetadata.updatedAt");return n||null}}s.normalizeAccountNumber=a.normalizeAccountNumber,s.doctype="io.cozy.bank.accounts",s.idAttributes=["_id"],s.version=1,s.checkedAttributes=null,s.vendorIdAttr="vendorId",t.exports=s},function(t,e,n){var r=n(239),o=n(394),i=n(395);t.exports=function(t,e){return i(o(t,e,r),t+"")}},function(t,e,n){var r=n(234),o=n(32);t.exports=function(t){return o(t)&&r(t)}},function(t,e,n){var r=n(370);t.exports=function(t){return t&&t.length?r(t):[]}},function(t,e,n){var r=n(151);t.exports=function(t,e,n){var o=null==t?void 0:r(t,e);return void 0===o?n:o}},function(t,e,n){var r=n(243);t.exports=function(t){return(null==t?0:t.length)?r(t,1):[]}},function(t,e,n){"use strict";(function(t){var r,o=n(417);r="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:t;var i=Object(o.a)(r);e.a=i}).call(this,n(687)(t))},function(t,e){t.exports=require("http")},function(t,e,n){var r=n(955),o=n(243),i=n(253),a=n(254),u=i(function(t,e){return a(t)?r(t,o(e,1,a,!0)):[]});t.exports=u},function(t,e,n){var r=n(41),o=n(33),i="[object AsyncFunction]",a="[object Function]",u="[object GeneratorFunction]",s="[object Proxy]";t.exports=function(t){if(!o(t))return!1;var e=r(t);return e==a||e==u||e==i||e==s}},function(t,e){var n="object"==typeof global&&global&&global.Object===Object&&global;t.exports=n},function(t,e){var n=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return n.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,e,n){var r=n(40),o=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=o},function(t,e,n){var r=n(455),o=n(160),i=n(14),a=n(161),u=n(111),s=n(266),c=Object.prototype.hasOwnProperty;t.exports=function(t,e){var n=i(t),f=!n&&o(t),l=!n&&!f&&a(t),p=!n&&!f&&!l&&s(t),d=n||f||l||p,h=d?r(t.length,String):[],v=h.length;for(var y in t)!e&&!c.call(t,y)||d&&("length"==y||l&&("offset"==y||"parent"==y)||p&&("buffer"==y||"byteLength"==y||"byteOffset"==y)||u(y,v))||h.push(y);return h}},function(t,e,n){var r=n(458),o=n(112),i=n(163),a=i&&i.isTypedArray,u=a?o(a):r;t.exports=u},function(t,e,n){var r=n(164),o=n(459),i=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return o(t);var e=[];for(var n in Object(t))i.call(t,n)&&"constructor"!=n&&e.push(n);return e}},function(t,e){t.exports=function(t,e){return function(n){return t(e(n))}}},function(t,e,n){var r=n(265),o=n(461),i=n(55);t.exports=function(t){return i(t)?r(t,!0):o(t)}},function(t,e){t.exports=function(){return[]}},function(t,e,n){var r=n(166),o=n(167),i=n(165),a=n(270),u=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)r(e,i(t)),t=o(t);return e}:a;t.exports=u},function(t,e,n){var r=n(273),o=n(165),i=n(83);t.exports=function(t){return r(t,i,o)}},function(t,e,n){var r=n(166),o=n(14);t.exports=function(t,e,n){var i=e(t);return o(t)?i:r(i,n(t))}},function(t,e,n){var r=n(22).Uint8Array;t.exports=r},function(t,e,n){var r=n(276);t.exports=function(t){return null==t?"":r(t)}},function(t,e,n){var r=n(54),o=n(81),i=n(14),a=n(85),u=1/0,s=r?r.prototype:void 0,c=s?s.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(i(e))return o(e,t)+"";if(a(e))return c?c.call(e):"";var n=e+"";return"0"==n&&1/e==-u?"-0":n}},function(t,e){t.exports=function(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i}},function(t,e,n){var r=n(279),o=n(280),i=n(281);t.exports=function(t){return i(o(t,void 0,r),t+"")}},function(t,e,n){var r=n(171);t.exports=function(t){return(null==t?0:t.length)?r(t,1):[]}},function(t,e,n){var r=n(493),o=Math.max;t.exports=function(t,e,n){return e=o(void 0===e?t.length-1:e,0),function(){for(var i=arguments,a=-1,u=o(i.length-e,0),s=Array(u);++a<u;)s[a]=i[e+a];a=-1;for(var c=Array(e+1);++a<e;)c[a]=i[a];return c[e]=n(s),r(t,this,c)}}},function(t,e,n){var r=n(494),o=n(496)(r);t.exports=o},function(t,e,n){var r=n(113),o=n(499),i=n(56);t.exports=function(t,e,n){for(var a=-1,u=e.length,s={};++a<u;){var c=e[a],f=r(t,c);n(f,c)&&o(s,i(c,t),f)}return s}},function(t,e,n){var r=n(500),o=n(501);t.exports=function(t,e){return null!=t&&o(t,e,r)}},function(t,e){t.exports=function(t){return function(e){return null==e?void 0:e[t]}}},function(t,e){var n=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");t.exports=function(t){return n.test(t)}},function(t,e,n){var r=n(510),o=n(29);t.exports=function t(e,n,i,a,u){return e===n||(null==e||null==n||!o(e)&&!o(n)?e!=e&&n!=n:r(e,n,i,a,t,u))}},function(t,e,n){var r=n(511),o=n(514),i=n(515),a=1,u=2;t.exports=function(t,e,n,s,c,f){var l=n&a,p=t.length,d=e.length;if(p!=d&&!(l&&d>p))return!1;var h=f.get(t);if(h&&f.get(e))return h==e;var v=-1,y=!0,g=n&u?new r:void 0;for(f.set(t,e),f.set(e,t);++v<p;){var m=t[v],b=e[v];if(s)var x=l?s(b,m,v,e,t,f):s(m,b,v,t,e,f);if(void 0!==x){if(x)continue;y=!1;break}if(g){if(!o(e,function(t,e){if(!i(g,e)&&(m===t||c(m,t,n,s,f)))return g.push(e)})){y=!1;break}}else if(m!==b&&!c(m,b,n,s,f)){y=!1;break}}return f.delete(t),f.delete(e),y}},function(t,e,n){var r=n(33);t.exports=function(t){return t==t&&!r(t)}},function(t,e){t.exports=function(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}},function(t,e,n){var r=n(81),o=n(42),i=n(282),a=n(168);t.exports=function(t,e){if(null==t)return{};var n=r(a(t),function(t){return[t]});return e=o(e),i(t,n,function(t,n){return e(t,n[0])})}},function(t,e){t.exports=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var o=t[e];r[o[0]]=o[1]}return r}},function(t,e,n){var r=n(293),o=n(55);t.exports=function(t,e){var n=-1,i=o(t)?Array(t.length):[];return r(t,function(t,r,o){i[++n]=e(t,r,o)}),i}},function(t,e,n){var r=n(528),o=n(531)(r);t.exports=o},function(t,e,n){var r=n(532),o=n(533),i=n(42),a=n(14);t.exports=function(t,e){return function(n,u){var s=a(n)?r:o,c=e?e():{};return s(n,t,i(u,2),c)}}},function(t,e,n){t.exports=!n(15)&&!n(43)(function(){return 7!=Object.defineProperty(n(173)("div"),"a",{get:function(){return 7}}).a})},function(t,e,n){var r=n(15),o=n(58),i=n(35),a=n(91).f;t.exports=function(t){return function(e){for(var n,u=i(e),s=o(u),c=s.length,f=0,l=[];c>f;)n=s[f++],r&&!a.call(u,n)||l.push(t?[n,u[n]]:u[n]);return l}}},function(t,e,n){var r=n(44),o=n(35),i=n(545)(!1),a=n(178)("IE_PROTO");t.exports=function(t,e){var n,u=o(t),s=0,c=[];for(n in u)n!=a&&r(u,n)&&c.push(n);for(;e.length>s;)r(u,n=e[s++])&&(~i(c,n)||c.push(n));return c}},function(t,e,n){t.exports=n(34)},function(t,e,n){var r=n(19),o=n(24),i=n(58);t.exports=n(15)?Object.defineProperties:function(t,e){o(t);for(var n,a=i(e),u=a.length,s=0;u>s;)r.f(t,n=a[s++],e[n]);return t}},function(t,e,n){var r=n(10).document;t.exports=r&&r.documentElement},function(t,e,n){var r=n(44),o=n(46),i=n(178)("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),r(t,i)?t[i]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?a:null}},function(t,e,n){var r=n(24);t.exports=function(t,e,n,o){try{return o?e(r(n)[0],n[1]):e(n)}catch(e){var i=t.return;throw void 0!==i&&r(i.call(t)),e}}},function(t,e,n){var r=n(59),o=n(11)("iterator"),i=Array.prototype;t.exports=function(t){return void 0!==t&&(r.Array===t||i[o]===t)}},function(t,e,n){var r=n(11)("iterator"),o=!1;try{var i=[7][r]();i.return=function(){o=!0},Array.from(i,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!o)return!1;var n=!1;try{var i=[7],a=i[r]();a.next=function(){return{done:n=!0}},i[r]=function(){return a},t(i)}catch(t){}return n}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,n){var r=n(24),o=n(87),i=n(11)("species");t.exports=function(t,e){var n,a=r(t).constructor;return void 0===a||null==(n=r(a)[i])?e:o(n)}},function(t,e,n){var r,o,i,a=n(30),u=n(562),s=n(300),c=n(173),f=n(10),l=f.process,p=f.setImmediate,d=f.clearImmediate,h=f.MessageChannel,v=f.Dispatch,y=0,g={},m=function(){var t=+this;if(g.hasOwnProperty(t)){var e=g[t];delete g[t],e()}},b=function(t){m.call(t.data)};p&&d||(p=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return g[++y]=function(){u("function"==typeof t?t:Function(t),e)},r(y),y},d=function(t){delete g[t]},"process"==n(89)(l)?r=function(t){l.nextTick(a(m,t,1))}:v&&v.now?r=function(t){v.now(a(m,t,1))}:h?(i=(o=new h).port2,o.port1.onmessage=b,r=a(i.postMessage,i,1)):f.addEventListener&&"function"==typeof postMessage&&!f.importScripts?(r=function(t){f.postMessage(t+"","*")},f.addEventListener("message",b,!1)):r="onreadystatechange"in c("script")?function(t){s.appendChild(c("script")).onreadystatechange=function(){s.removeChild(this),m.call(t)}}:function(t){setTimeout(a(m,t,1),0)}),t.exports={set:p,clear:d}},function(t,e){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},function(t,e,n){var r=n(24),o=n(17),i=n(185);t.exports=function(t,e){if(r(t),o(e)&&e.constructor===t)return e;var n=i.f(t);return(0,n.resolve)(e),n.promise}},function(t,e,n){"use strict";var r=n(10),o=n(3),i=n(19),a=n(15),u=n(11)("species");t.exports=function(t){var e="function"==typeof o[t]?o[t]:r[t];a&&e&&!e[u]&&i.f(e,u,{configurable:!0,get:function(){return this}})}},function(t,e,n){"use strict";var r=n(19).f,o=n(119),i=n(186),a=n(30),u=n(184),s=n(93),c=n(182),f=n(305),l=n(310),p=n(15),d=n(123).fastKey,h=n(187),v=p?"_s":"size",y=function(t,e){var n,r=d(e);if("F"!==r)return t._i[r];for(n=t._f;n;n=n.n)if(n.k==e)return n};t.exports={getConstructor:function(t,e,n,c){var f=t(function(t,r){u(t,f,e,"_i"),t._t=e,t._i=o(null),t._f=void 0,t._l=void 0,t[v]=0,null!=r&&s(r,n,t[c],t)});return i(f.prototype,{clear:function(){for(var t=h(this,e),n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[v]=0},delete:function(t){var n=h(this,e),r=y(n,t);if(r){var o=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=o),o&&(o.p=i),n._f==r&&(n._f=o),n._l==r&&(n._l=i),n[v]--}return!!r},forEach:function(t){h(this,e);for(var n,r=a(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(h(this,e),t)}}),p&&r(f.prototype,"size",{get:function(){return h(this,e)[v]}}),f},def:function(t,e,n){var r,o,i=y(t,e);return i?i.v=n:(t._l=i={i:o=d(e,!0),k:e,v:n,p:r=t._l,n:void 0,r:!1},t._f||(t._f=i),r&&(r.n=i),t[v]++,"F"!==o&&(t._i[o]=i)),t},getEntry:y,setStrong:function(t,e,n){c(t,e,function(t,n){this._t=h(t,e),this._k=n,this._l=void 0},function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?f(0,"keys"==t?e.k:"values"==t?e.v:[e.k,e.v]):(this._t=void 0,f(1))},n?"entries":"values",!n,!0),l(e)}}},function(t,e,n){"use strict";var r=n(10),o=n(5),i=n(123),a=n(43),u=n(34),s=n(186),c=n(93),f=n(184),l=n(17),p=n(92),d=n(19).f,h=n(570)(0),v=n(15);t.exports=function(t,e,n,y,g,m){var b=r[t],x=b,w=g?"set":"add",_=x&&x.prototype,k={};return v&&"function"==typeof x&&(m||_.forEach&&!a(function(){(new x).entries().next()}))?(x=e(function(e,n){f(e,x,t,"_c"),e._c=new b,null!=n&&c(n,g,e[w],e)}),h("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(t){var e="add"==t||"set"==t;t in _&&(!m||"clear"!=t)&&u(x.prototype,t,function(n,r){if(f(this,x,t),!e&&m&&!l(n))return"get"==t&&void 0;var o=this._c[t](0===n?0:n,r);return e?this:o})}),m||d(x.prototype,"size",{get:function(){return this._c.size}})):(x=y.getConstructor(e,t,g,w),s(x.prototype,n),i.NEED=!0),p(x,t),k[t]=x,o(o.G+o.W+o.F,k),m||y.setStrong(x,t,g),x}},function(t,e,n){var r=n(89);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,e,n){var r=n(120),o=n(574);t.exports=function(t){return function(){if(r(this)!=t)throw TypeError(t+"#toJSON isn't generic");return o(this)}}},function(t,e,n){"use strict";var r=n(5);t.exports=function(t){r(r.S,t,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}})}},function(t,e,n){"use strict";var r=n(5),o=n(87),i=n(30),a=n(93);t.exports=function(t){r(r.S,t,{from:function(t){var e,n,r,u,s=arguments[1];return o(this),(e=void 0!==s)&&o(s),null==t?new this:(n=[],e?(r=0,u=i(s,arguments[2],2),a(t,!1,function(t){n.push(u(t,r++))})):a(t,!1,n.push,n),new this(n))}})}},function(t,e,n){t.exports={default:n(587),__esModule:!0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.REGISTRATION_ABORT="REGISTRATION_ABORT"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=f(n(48)),o=f(n(8)),i=f(n(1)),a=f(n(2)),u=f(n(12)),s=f(n(13)),c=n(49);function f(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.client,r=t.stackClient;(0,i.default)(this,e);var a=(0,u.default)(this,(e.__proto__||(0,o.default)(e)).call(this));return n&&console.info("Using options.client is deprecated, prefer options.stackClient"),a.stackClient=r||n,a}return(0,s.default)(e,t),(0,a.default)(e,[{key:"registerClient",value:function(t){this.stackClient=t.stackClient||t.client}},{key:"reset",value:function(){this.stackClient=null}},{key:"request",value:function(t,e,n){return t.mutationType?this.executeMutation(t,e,n):this.executeQuery(t)}},{key:"executeQuery",value:function(t){var e=t.doctype,n=t.selector,o=t.id,i=t.ids,a=t.referenced,u=(0,r.default)(t,["doctype","selector","id","ids","referenced"]);if(!e)throw console.warn("Bad query",t),new Error("No doctype found in a query definition");var s=this.stackClient.collection(e);return o?s.get(o):i?s.getAll(i):a?s.findReferencedBy(a,u):n||u.sort?s.find(n,u):s.all(u)}},{key:"executeMutation",value:function(t,e,n){var o=t.mutationType,i=(0,r.default)(t,["mutationType"]);switch(o){case c.MutationTypes.CREATE_DOCUMENT:return this.stackClient.collection(i.document._type).create(i.document);case c.MutationTypes.UPDATE_DOCUMENT:return this.stackClient.collection(i.document._type).update(i.document);case c.MutationTypes.DELETE_DOCUMENT:return this.stackClient.collection(i.document._type).destroy(i.document);case c.MutationTypes.ADD_REFERENCES_TO:return this.stackClient.collection(i.referencedDocuments[0]._type).addReferencesTo(i.document,i.referencedDocuments);case c.MutationTypes.REMOVE_REFERENCES_TO:return this.stackClient.collection(i.referencedDocuments[0]._type).removeReferencesTo(i.document,i.referencedDocuments);case c.MutationTypes.ADD_REFERENCED_BY:if("io.cozy.files"===i.document._type)return this.stackClient.collection("io.cozy.files").addReferencedBy(i.document,i.referencedDocuments);throw new Error("The document type should be io.cozy.files");case c.MutationTypes.REMOVE_REFERENCED_BY:if("io.cozy.files"===i.document._type)return this.stackClient.collection("io.cozy.files").removeReferencedBy(i.document,i.referencedDocuments);throw new Error("The document type should be io.cozy.files");case c.MutationTypes.UPLOAD_FILE:return this.stackClient.collection("io.cozy.files").upload(i.file,i.dirPath);default:return n(t,e)}}}]),e}(f(n(192)).default);e.default=l},function(t,e,n){var r=n(297),o=n(180).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,e,n){var r=n(50),o=n(9),i=n(20),a="[object String]";t.exports=function(t){return"string"==typeof t||!o(t)&&i(t)&&r(t)==a}},function(t,e){var n="object"==typeof global&&global&&global.Object===Object&&global;t.exports=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.create=e.resolveClass=e.attachRelationships=e.responseToRelationship=e.pickTypeAndId=void 0;var r=p(n(4)),o=p(n(610)),i=p(n(646)),a=p(n(70)),u=p(n(346)),s=p(n(347)),c=p(n(139)),f=p(n(360)),l=p(n(361));function p(t){return t&&t.__esModule?t:{default:t}}var d=e.pickTypeAndId=function(t){return(0,o.default)(t,"_type","_id")},h=(e.responseToRelationship=function(t){return(0,i.default)({data:(e=d,n=t.data,Array.isArray(n)?n.map(e):e(n)),meta:t.meta,next:t.next,skip:t.skip});var e,n},function(t,e){return(0,r.default)({},t,{relationships:(0,r.default)({},t.relationships,e)})}),v=(e.attachRelationships=function(t,e){if(Array.isArray(t.data))return(0,r.default)({},t,{data:t.data.map(function(t){return h(t,e[t._id])})});var n=t.data;return(0,r.default)({},t,{data:h(n,e[n._id])})},{"io.cozy.files:has-many":l.default,"has-many":c.default,"belongs-to-in-place":s.default,"has-one":u.default,"has-one-in-place":s.default,"has-many-in-place":f.default});e.resolveClass=function(t,e){if(void 0===e)throw new Error("Undefined type for "+t);if("string"!=typeof e)return e;var n=v[t+":"+e]||v[e];if(n)return n;throw new Error("Unknown association '"+e+"'")},e.create=function(t,e,n){var r=e.name,o=e.type,i=e.doctype;if(t[r]instanceof a.default)throw new Error("Association "+r+" already exists");return new o(t,r,i,n)}},function(t,e,n){var r=n(126),o=n(326),i=n(65);t.exports=function(t,e,n){for(var a=-1,u=e.length,s={};++a<u;){var c=e[a],f=r(t,c);n(f,c)&&o(s,i(c,t),f)}return s}},function(t,e){var n=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return n.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,e,n){var r=n(199),o=n(65),i=n(131),a=n(26),u=n(66);t.exports=function(t,e,n,s){if(!a(t))return t;for(var c=-1,f=(e=o(e,t)).length,l=f-1,p=t;null!=p&&++c<f;){var d=u(e[c]),h=n;if(c!=l){var v=p[d];void 0===(h=s?s(v,d,p):void 0)&&(h=a(v)?v:i(e[c+1])?[]:{})}r(p,d,h),p=p[d]}return t}},function(t,e,n){var r=n(51),o=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=o},function(t,e,n){var r=n(638),o=n(639);t.exports=function(t,e){return null!=t&&o(t,e,r)}},function(t,e,n){var r=n(642),o=Math.max;t.exports=function(t,e,n){return e=o(void 0===e?t.length-1:e,0),function(){for(var i=arguments,a=-1,u=o(i.length-e,0),s=Array(u);++a<u;)s[a]=i[e+a];a=-1;for(var c=Array(e+1);++a<e;)c[a]=i[a];return c[e]=n(s),r(t,this,c)}}},function(t,e,n){var r=n(643),o=n(645)(r);t.exports=o},function(t,e,n){var r=n(135),o=n(657),i=n(136),a=1,u=2;t.exports=function(t,e,n,s,c,f){var l=n&a,p=t.length,d=e.length;if(p!=d&&!(l&&d>p))return!1;var h=f.get(t);if(h&&f.get(e))return h==e;var v=-1,y=!0,g=n&u?new r:void 0;for(f.set(t,e),f.set(e,t);++v<p;){var m=t[v],b=e[v];if(s)var x=l?s(b,m,v,e,t,f):s(m,b,v,t,e,f);if(void 0!==x){if(x)continue;y=!1;break}if(g){if(!o(e,function(t,e){if(!i(g,e)&&(m===t||c(m,t,n,s,f)))return g.push(e)})){y=!1;break}}else if(m!==b&&!c(m,b,n,s,f)){y=!1;break}}return f.delete(t),f.delete(e),y}},function(t,e,n){var r=n(25).Uint8Array;t.exports=r},function(t,e,n){var r=n(334),o=n(207),i=n(97);t.exports=function(t){return r(t,i,o)}},function(t,e,n){var r=n(204),o=n(9);t.exports=function(t,e,n){var i=e(t);return o(t)?i:r(i,n(t))}},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[o++]=a)}return i}},function(t,e){t.exports=function(){return[]}},function(t,e,n){var r=n(338),o=n(132),i=n(9),a=n(137),u=n(131),s=n(208),c=Object.prototype.hasOwnProperty;t.exports=function(t,e){var n=i(t),f=!n&&o(t),l=!n&&!f&&a(t),p=!n&&!f&&!l&&s(t),d=n||f||l||p,h=d?r(t.length,String):[],v=h.length;for(var y in t)!e&&!c.call(t,y)||d&&("length"==y||l&&("offset"==y||"parent"==y)||p&&("buffer"==y||"byteLength"==y||"byteOffset"==y)||u(y,v))||h.push(y);return h}},function(t,e){t.exports=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}},function(t,e,n){var r=n(210),o=n(663),i=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return o(t);var e=[];for(var n in Object(t))i.call(t,n)&&"constructor"!=n&&e.push(n);return e}},function(t,e){t.exports=function(t,e){return function(n){return t(e(n))}}},function(t,e,n){var r=n(51)(n(25),"Set");t.exports=r},function(t,e,n){var r=n(51)(n(25),"WeakMap");t.exports=r},function(t,e,n){var r=n(26);t.exports=function(t){return t==t&&!r(t)}},function(t,e){t.exports=function(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}},function(t,e,n){var r=n(204),o=n(213),i=n(207),a=n(336),u=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)r(e,i(t)),t=o(t);return e}:a;t.exports=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=p(n(38)),o=p(n(4)),i=p(n(8)),a=p(n(1)),u=p(n(2)),s=p(n(12)),c=p(n(13)),f=p(n(69)),l=p(n(672));function p(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(){return(0,a.default)(this,e),(0,s.default)(this,(e.__proto__||(0,i.default)(e)).apply(this,arguments))}return(0,c.default)(e,t),(0,u.default)(e,[{key:"set",value:function(t){if(t&&t._type!==this.doctype)throw new Error("Tried to associate a "+t._type+" document to a HasOne relationship on "+this.doctype+" document");var e="relationships["+this.name+"].data";t?(0,l.default)(this.target,e,{_id:t._id,_type:t._type}):(0,l.default)(this.target,e,void 0)}},{key:"unset",value:function(){this.set(void 0)}},{key:"dehydrate",value:function(t){return(0,o.default)({},t,{relationships:(0,o.default)({},t.relationships,(0,r.default)({},this.name,{data:this.raw}))})}},{key:"raw",get:function(){return(0,f.default)(this.target,"relationships["+this.name+"].data",null)}},{key:"data",get:function(){return this.raw?this.get(this.doctype,this.raw._id):null}}],[{key:"query",value:function(t,e,n){var r=(0,f.default)(t,"relationships."+n.name+".data",{});return e.get(n.doctype,r._id)}}]),e}(p(n(70)).default);e.default=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BelongsToInPlace=void 0;var r=f(n(38)),o=f(n(4)),i=f(n(8)),a=f(n(1)),u=f(n(2)),s=f(n(12)),c=f(n(13));function f(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(){return(0,a.default)(this,e),(0,s.default)(this,(e.__proto__||(0,i.default)(e)).apply(this,arguments))}return(0,c.default)(e,t),(0,u.default)(e,[{key:"dehydrate",value:function(t){return(0,o.default)({},t,(0,r.default)({},this.name,this.raw||void 0))}},{key:"raw",get:function(){return this.target[this.name]}},{key:"data",get:function(){return this.get(this.doctype,this.raw)}}],[{key:"query",value:function(t,e,n){var r=t[n.name];return e.getDocumentFromState(n.doctype,r)||e.get(n.doctype,r)}}]),e}(f(n(70)).default);e.default=l;e.BelongsToInPlace=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getQueryFromSlice=e.receiveQueryError=e.receiveQueryResult=e.initQuery=e.convert$gtNullSelectors=e.isReceivingData=e.isQueryAction=void 0;var r=b(n(38)),o=b(n(116)),i=b(n(36)),a=b(n(121)),u=b(n(62)),s=b(n(4)),c=b(n(140)),f=b(n(674)),l=b(n(680)),p=b(n(682)),d=b(n(216)),h=n(354),v=n(217),y=n(359),g=b(n(686)),m=b(n(69));function b(t){return t&&t.__esModule?t:{default:t}}var x="INIT_QUERY",w="RECEIVE_QUERY_RESULT",_="RECEIVE_QUERY_ERROR",k=e.isQueryAction=function(t){return-1!==[x,w,_].indexOf(t.type)},O=(e.isReceivingData=function(t){return t.type===w},{id:null,definition:null,fetchStatus:"pending",lastFetch:null,lastUpdate:null,lastError:null,hasMore:!1,count:0,data:[]}),j=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,e=arguments[1];switch(e.type){case x:return(0,s.default)({},t,{id:e.queryId,definition:e.queryDefinition,fetchStatus:"loading"});case w:var n=e.response,r={fetchStatus:"loaded",lastFetch:Date.now(),lastUpdate:Date.now()};return n.data?Array.isArray(n.data)?(0,s.default)({},t,r,{hasMore:void 0!==n.next?n.next:t.hasMore,count:n.meta&&n.meta.count?n.meta.count:n.data.length,data:0===n.skip?n.data.map(y.properId):[].concat((0,u.default)(t.data),(0,u.default)(n.data.map(y.properId)))}):(0,s.default)({},t,r,{hasMore:!1,count:1,data:[(0,y.properId)(n.data)]}):t;case _:return(0,s.default)({},t,{id:e.queryId,fetchStatus:"failed",lastError:e.error});default:return t}},S=e.convert$gtNullSelectors=function t(e){var n={},r=!0,u=!1,s=void 0;try{for(var c,f=(0,i.default)((0,o.default)(e));!(r=(c=f.next()).done);r=!0){var l=c.value,p=(0,a.default)(l,2),h=p[0],v=p[1],y=(0,d.default)(v)?t(v):v;n["$gt"===h&&null===y?"$gtnull":h]=y}}catch(t){u=!0,s=t}finally{try{!r&&f.return&&f.return()}finally{if(u)throw s}}return n},E=function(t){var e,n=t.definition.doctype,r=(e=t.definition).selector?(g.default.use({$gtnull:function(t,e){return!!e}}),(0,g.default)(S(e.selector))):e.id?(0,g.default)({_id:e.id}):null;return function(t){return t._type===n&&(!(r&&!r(t))&&!t._deleted)}},A=function(t){return function(e){var n=(0,m.default)(t,"response.data")||(0,m.default)(t,"definition.document");return n?(Array.isArray(n)||(n=[n]),n.length?e.definition.doctype!==n[0]._type?e:function(t,e){var n=E(t),r=e.filter(function(t){return n(t)}).map(y.properId),o=e.filter(function(t){return!n(t)}).map(y.properId),i=t.data,a=(0,p.default)(i,o),u=(0,l.default)(r,i),c=(0,p.default)(i,r),d=a.length||u.length||c.length,h=(0,l.default)((0,f.default)(i,u),a);return(0,s.default)({},t,{data:h,count:h.length,lastUpdate:d?Date.now():t.lastUpdate})}(e,n):e):e}},C=function(t,e){return function(n){var r=t.updateQueries,o=t.response,i=r[n.id];if(!i)return n;var a=n.definition.doctype,u=n.data,c=i(T(e,a,u),o).map(y.properId);return(0,s.default)({},n,{data:c,count:c.length,lastUpdate:Date.now()})}};e.default=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.type==x)return(0,s.default)({},t,(0,r.default)({},e.queryId,j(t[e.queryId],e)));if(k(e)){var i=A(e);return(0,c.default)(t,function(t){return t.id==e.queryId?j(t,e):o?i(t):t})}if((0,v.isReceivingMutationResult)(e)){var a=e.updateQueries?C(e,n):A(e);return(0,c.default)(t,a)}return t};e.initQuery=function(t,e){if(!e.doctype)throw new Error("Cannot init query with no doctype");return{type:x,queryId:t,queryDefinition:e}},e.receiveQueryResult=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,s.default)({type:w,queryId:t,response:e},n)},e.receiveQueryError=function(t,e){return{type:_,queryId:t,error:e}};var T=function(t,e,n){return n.map(function(n){return(0,h.getDocumentFromSlice)(t,e,n)})};e.getQueryFromSlice=function(t,e,n){if(!t||!t[e])return(0,s.default)({},O,{data:null});var r=t[e];return n?(0,s.default)({},r,{data:T(n,r.definition.doctype,r.data)}):r}},function(t,e,n){var r=n(350),o=n(97);t.exports=function(t,e){return t&&r(t,e,o)}},function(t,e,n){var r=n(673)();t.exports=r},function(t,e){t.exports=function(){}},function(t,e,n){var r=n(135),o=n(214),i=n(215),a=n(37),u=n(98),s=n(136),c=Math.min;t.exports=function(t,e,n){for(var f=n?i:o,l=t[0].length,p=t.length,d=p,h=Array(p),v=1/0,y=[];d--;){var g=t[d];d&&e&&(g=a(g,u(e))),v=c(g.length,v),h[d]=!n&&(e||l>=120&&g.length>=120)?new r(d&&g):void 0}g=t[0];var m=-1,b=h[0];t:for(;++m<l&&y.length<v;){var x=g[m],w=e?e(x):x;if(x=n||0!==x?x:0,!(b?s(b,w):f(y,w,n))){for(d=p;--d;){var _=h[d];if(!(_?s(_,w):f(t[d],w,n)))continue t}b&&b.push(w),y.push(x)}}return y}},function(t,e,n){var r=n(101);t.exports=function(t){return r(t)?t:[]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.extractAndMergeDocument=e.getCollectionFromSlice=e.getDocumentFromSlice=e.mergeDocumentsWithRelationships=void 0;var r=p(n(94)),o=p(n(38)),i=p(n(4)),a=n(348),u=n(217),s=p(n(355)),c=p(n(69)),f=p(n(358)),l=n(359);function p(t){return t&&t.__esModule?t:{default:t}}var d=function(t,e){var n=e._type;if(!n)throw new Error("Document without _type");if(!(0,l.properId)(e))throw new Error("Document without id");var r=(0,c.default)(t,[n,(0,l.properId)(e)]);return(0,f.default)(r,e)?t:(0,i.default)({},t,(0,o.default)({},n,(0,i.default)({},t[n],(0,o.default)({},(0,l.properId)(e),h(r,e)))))},h=e.mergeDocumentsWithRelationships=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,i.default)({},t,e);return(t.relationships||e.relationships)&&(n.relationships=(0,i.default)({},t.relationships,e.relationships)),n};e.default=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];if(!(0,a.isReceivingData)(e)&&!(0,u.isReceivingMutationResult)(e))return t;var n=e.response,r=n.data,o=n.included;if(!r||Array.isArray(r)&&0===r.length)return t;var i=o?o.reduce(d,t):t;return Array.isArray(r)?v(r,i):d(i,r)};e.getDocumentFromSlice=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1],n=arguments[2];if(!e)throw new Error("getDocumentFromSlice: Cannot retrieve document with undefined doctype");if(!n)throw new Error("getDocumentFromSlice: Cannot retrieve document with undefined id");return t[e]&&t[e][n]?t[e][n]:null},e.getCollectionFromSlice=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];if(!e)throw new Error("getDocumentFromSlice: Cannot retrieve document with undefined doctype");return t[e]?(0,r.default)(t[e]):null};var v=e.extractAndMergeDocument=function(t,e){var n=t[0]._type;if(!n)throw new Error("Document without _type",t[0]);var o=(0,s.default)(t,l.properId),a={};return e&&e[n]&&(0,r.default)(e[n]).map(function(t){a[n]||(a[n]={});var e=(0,l.properId)(t);o[e]?a[n][e]=(0,i.default)({},t,o[e],a[n][e]):a[n][e]=(0,i.default)({},t,a[n][e])}),(0,r.default)(o).map(function(t){a[n]||(a[n]={});var e=(0,l.properId)(t);a[n][e]?a[n][e]=(0,i.default)({},a[n][e],t):a[n][e]=t}),(0,i.default)({},e,a)}},function(t,e,n){var r=n(67),o=n(356)(function(t,e,n){r(t,n,e)});t.exports=o},function(t,e,n){var r=n(683),o=n(684),i=n(96),a=n(9);t.exports=function(t,e){return function(n,u){var s=a(n)?r:o,c=e?e():{};return s(n,t,i(u,2),c)}}},function(t,e,n){var r=n(349),o=n(685)(r);t.exports=o},function(t,e,n){var r=n(205);t.exports=function(t,e){return r(t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.properId=function(t){return t.id||t._id}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=p(n(38)),o=p(n(4)),i=p(n(8)),a=p(n(1)),u=p(n(2)),s=p(n(12)),c=p(n(13)),f=p(n(70)),l=p(n(49));function p(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(){return(0,a.default)(this,e),(0,s.default)(this,(e.__proto__||(0,i.default)(e)).apply(this,arguments))}return(0,c.default)(e,t),(0,u.default)(e,[{key:"addById",value:function(t){this.getRelationship().push(t)}},{key:"removeById",value:function(t){var e=this.getRelationship(),n=e.indexOf(t);-1!==n&&e.splice(n,1)}},{key:"existsById",value:function(t){return-1!==this.getRelationship().indexOf(t)}},{key:"getRelationship",value:function(){return this.target[this.name]=this.target[this.name]||[],this.target[this.name]}},{key:"dehydrate",value:function(t){return(0,o.default)({},t,(0,r.default)({},this.name,this.raw||[]))}},{key:"raw",get:function(){return this.target[this.name]}},{key:"data",get:function(){var t=this,e=this.doctype;return(this.raw||[]).map(function(n){return t.get(e,n)})}}],[{key:"query",value:function(){return this.raw&&this.raw.length>0?(0,l.default)({doctype:this.doctype,ids:this.raw}):null}}]),e}(f.default);e.default=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=g(n(6)),o=g(n(62)),i=g(n(4)),a=g(n(7)),u=g(n(8)),s=g(n(1)),c=g(n(2)),f=g(n(12)),l=g(n(142)),p=g(n(13)),d=g(n(692)),h=g(n(139)),v=n(49),y=n(100);function g(t){return t&&t.__esModule?t:{default:t}}var m=function(t){function e(){return(0,s.default)(this,e),(0,f.default)(this,(e.__proto__||(0,u.default)(e)).apply(this,arguments))}var n,h,g;return(0,p.default)(e,t),(0,c.default)(e,[{key:"fetchMore",value:(g=(0,a.default)(r.default.mark(function t(){var e,n,u,s=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new v.QueryDefinition({doctype:"io.cozy.files"}),n=this.getRelationship().data,u=n[n.length-1],t.next=5,this.dispatch(function(){var t=(0,a.default)(r.default.mark(function t(a,c){var f,l,p,d,h,v;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f=(0,y.getDocumentFromState)(c(),u._type,u._id),l=f.attributes.metadata.datetime,p=[s.target._type,s.target._id,l],d=n[n.length-1]._id,h=[p,d],t.next=7,s.query(e.referencedBy(s.target).offsetCursor(h));case 7:return(v=t.sent).data.shift(),t.next=11,s.dispatch(s.updateRelationshipData(function(t){return(0,i.default)({},t,{data:[].concat((0,o.default)(t.data),(0,o.default)(v.data)),next:v.next})}));case 11:case"end":return t.stop()}},t,s)}));return function(e,n){return t.apply(this,arguments)}}());case 5:case"end":return t.stop()}},t,this)})),function(){return g.apply(this,arguments)})},{key:"addById",value:(h=(0,a.default)(r.default.mark(function t(n){var o,i=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=Array.isArray(n)?n:[n],o=n.map(function(t){return{_id:t,_type:i.doctype}}),t.next=4,this.mutate(this.insertDocuments(o));case 4:return t.next=6,(0,l.default)(e.prototype.__proto__||(0,u.default)(e.prototype),"addById",this).call(this,n);case 6:case"end":return t.stop()}},t,this)})),function(t){return h.apply(this,arguments)})},{key:"removeById",value:(n=(0,a.default)(r.default.mark(function t(n){var o,i=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=Array.isArray(n)?n:[n],o=n.map(function(t){return{_id:t,_type:i.doctype}}),t.next=4,this.mutate(this.removeDocuments(o));case 4:return t.next=6,(0,l.default)(e.prototype.__proto__||(0,u.default)(e.prototype),"removeById",this).call(this,n);case 6:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"insertDocuments",value:function(t){if("io.cozy.files"===this.target._type)return v.Mutations.addReferencedBy(this.target,t);if("io.cozy.files"===t[0]._type)return v.Mutations.addReferencesTo(this.target,t);throw new Error("Either the document or the references should be io.cozy.files")}},{key:"removeDocuments",value:function(t){if("io.cozy.files"===this.target._type)return v.Mutations.removeReferencedBy(this.target,t);if("io.cozy.files"===t[0]._type)return v.Mutations.removeReferencesTo(this.target,t);throw new Error("Either the document or the references should be io.cozy.files")}},{key:"dehydrate",value:function(t){return(0,d.default)(t,[this.name,"relationships."+this.name])}}],[{key:"query",value:function(t,e,n){var r=[[t._type,t._id],""];return e.find(n.doctype).referencedBy(t).offsetCursor(r)}}]),e}(h.default);e.default=m},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}},function(t,e,n){(function(t){var r=n(25),o=e&&!e.nodeType&&e,i=o&&"object"==typeof t&&t&&!t.nodeType&&t,a=i&&i.exports===o?r.Buffer:void 0,u=a?a.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=u?u(n):new t.constructor(n);return t.copy(r),r}}).call(this,n(23)(t))},function(t,e,n){var r=n(219);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},function(t,e,n){var r=n(220),o=n(213),i=n(210);t.exports=function(t){return"function"!=typeof t.constructor||i(t)?{}:r(o(t))}},function(t,e){t.exports=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.dehydrate=void 0;var r=a(n(121)),o=a(n(116)),i=n(125);function a(t){return t&&t.__esModule?t:{default:t}}e.dehydrate=function(t){return(0,o.default)(t).reduce(function(t,e){var n=(0,r.default)(e,2),o=n[0],a=n[1];if(a instanceof i.Association){if(!a.dehydrate)throw new Error("Association on key "+o+" should have a dehydrate method");t=a.dehydrate(t)}else t[o]=a;return t},{})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FetchError=void 0;var r=A(n(8)),o=A(n(12)),i=A(n(13)),a=A(n(193)),u=A(n(6)),s=A(n(7)),c=A(n(4)),f=A(n(1)),l=A(n(2)),p=n(369),d=A(p),h=A(n(836)),v=A(n(52)),y=A(n(245)),g=n(399),m=A(g),b=n(842),x=A(b),w=A(n(843)),_=A(n(844)),k=n(845),O=A(k),j=A(n(846)),S=A(n(400)),E=A(n(848));function A(t){return t&&t.__esModule?t:{default:t}}var C=function(){function t(e){(0,f.default)(this,t);var n=(0,c.default)({},e),r=n.token,o=n.uri,i=void 0===o?"":o;this.options=n,this.setUri(i),this.setToken(r),this.konnectors=new x.default(this),this.jobs=new m.default(this)}var e,n,r,o;return(0,l.default)(t,[{key:"collection",value:function(t){if(!t)throw new Error("CozyStackClient.collection() called without a doctype");switch(t){case p.APPS_DOCTYPE:return new d.default(this);case b.KONNECTORS_DOCTYPE:return new x.default(this);case"io.cozy.files":return new y.default(t,this);case"io.cozy.sharings":return new w.default(t,this);case"io.cozy.permissions":return new _.default(t,this);case k.TRIGGERS_DOCTYPE:return new O.default(this);case g.JOBS_DOCTYPE:return new m.default(this);default:return new v.default(t,this)}}},{key:"fetch",value:function(t){function e(e,n,r){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((o=(0,s.default)(u.default.mark(function t(e,n,r){var o,i,a=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(o=(0,c.default)({},s)).method=e,i=o.headers=(0,c.default)({},s.headers),"GET"!==e&&"HEAD"!==e&&void 0!==r&&i["Content-Type"]&&(o.body=r),i.Authorization||(i.Authorization=this.getAuthorizationHeader()),o.credentials="include",t.abrupt("return",fetch(this.fullpath(n),o).catch(function(t){throw a.checkForRevocation(t),t}));case 7:case"end":return t.stop()}},t,this)})),function(t,e,n){return o.apply(this,arguments)}))},{key:"checkForRevocation",value:function(t){t.message&&E.default.CLIENT_NOT_FOUND.test(t.message)&&this.onRevocationChange(!0)}},{key:"onRevocationChange",value:function(t){this.options&&this.options.onRevocationChange&&this.options.onRevocationChange(t)}},{key:"refreshToken",value:(r=(0,s.default)(u.default.mark(function t(){var e,n,r,o,i,a,s,c;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.token){t.next=2;break}throw new Error("Cannot refresh an empty token");case 2:return e={method:"GET",credentials:"include"},t.next=5,fetch("/",e);case 5:if((n=t.sent).ok){t.next=8;break}throw new Error("couldn't fetch a new token - response "+n.statusCode);case 8:return t.next=10,n.text();case 10:if(r=t.sent,o=new DOMParser,i=o.parseFromString(r,"text/html")){t.next=15;break}throw Error("couldn't fetch a new token - doc is not html");case 15:if(a=i.querySelector('div[role="application"]')){t.next=18;break}throw Error("couldn't fetch a new token - no div[role=application]");case 18:if(s=a.dataset.cozyToken){t.next=21;break}throw Error("couldn't fetch a new token -- missing data-cozy-token attribute");case 21:return c=new h.default(s),this.onTokenRefresh&&"function"==typeof this.onTokenRefresh&&this.onTokenRefresh(c),t.abrupt("return",c);case 24:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"fetchJSON",value:(n=(0,s.default)(u.default.mark(function t(e,n,r){var o,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.fetchJSONWithCurrentToken(e,n,r,i);case 3:return t.abrupt("return",t.sent);case 6:if(t.prev=6,t.t0=t.catch(0),!E.default.EXPIRED_TOKEN.test(t.t0.message)){t.next=18;break}return t.next=11,this.refreshToken();case 11:return o=t.sent,this.setToken(o),t.next=15,this.fetchJSONWithCurrentToken(e,n,r,i);case 15:return t.abrupt("return",t.sent);case 18:throw t.t0;case 19:case"end":return t.stop()}},t,this,[[0,6]])})),function(t,e,r){return n.apply(this,arguments)})},{key:"fetchJSONWithCurrentToken",value:(e=(0,s.default)(u.default.mark(function t(e,n,r){var o,i,s,c,f,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(o=l.headers=l.headers||{}).Accept="application/json","GET"!==e&&"HEAD"!==e&&void 0!==r&&(o["Content-Type"]||(o["Content-Type"]="application/json",r=(0,a.default)(r))),t.next=5,this.fetch(e,n,r,l);case 5:return i=t.sent,s=i.headers.get("content-type"),c=s&&s.indexOf("json")>=0,t.next=10,c?i.json():i.text();case 10:if(f=t.sent,!i.ok){t.next=13;break}return t.abrupt("return",f);case 13:throw new T(i,f);case 14:case"end":return t.stop()}},t,this)})),function(t,n,r){return e.apply(this,arguments)})},{key:"fullpath",value:function(t){return t.startsWith("http")?t:this.uri+t}},{key:"getAuthorizationHeader",value:function(){return this.token?this.token.toAuthHeader():null}},{key:"setCredentials",value:function(t){return(0,S.default)("CozyStackClient::setCredentials is deprecated, use CozyStackClient::setToken"),this.setToken(t)}},{key:"getCredentials",value:function(){return(0,S.default)("CozyStackClient::getCredentials is deprecated, use CozyStackClient::getAuthorizationHeader"),this.getAuthorizationHeader()}},{key:"setToken",value:function(t){this.token=t?new h.default(t):null,t&&this.onRevocationChange(!1)}},{key:"getAccessToken",value:function(){return this.token&&this.token.getAccessToken()}},{key:"setUri",value:function(t){this.uri=function(t){if(null===t)return null;for(;"/"===t[t.length-1];)t=t.slice(0,-1);return t}(t)}},{key:"getIconURL",value:function(t){return(0,j.default)(this,t)}}]),t}(),T=e.FetchError=function(t){function e(t,n){(0,f.default)(this,e);var i=(0,o.default)(this,(e.__proto__||(0,r.default)(e)).call(this));return Error.captureStackTrace&&Error.captureStackTrace(i,i.constructor),i.name="FetchError",i.response=t,i.url=t.url,i.status=t.status,i.reason=n,Object.defineProperty(i,"message",{value:n.message||("string"==typeof n?n:(0,a.default)(n))}),i}return(0,i.default)(e,t),e}(Error);e.default=C},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.normalizeApp=e.APPS_DOCTYPE=void 0;var r=d(n(6)),o=d(n(7)),i=d(n(8)),a=d(n(1)),u=d(n(2)),s=d(n(12)),c=d(n(13)),f=d(n(4)),l=n(52),p=d(l);function d(t){return t&&t.__esModule?t:{default:t}}var h=e.APPS_DOCTYPE="io.cozy.apps",v=e.normalizeApp=function(t,e){return(0,f.default)({},t,(0,l.normalizeDoc)(t,e),t.attributes)},y=function(t){function e(t){(0,a.default)(this,e);var n=(0,s.default)(this,(e.__proto__||(0,i.default)(e)).call(this,h,t));return n.endpoint="/apps/",n}var n,f,l,p,d;return(0,c.default)(e,t),(0,u.default)(e,[{key:"all",value:(d=(0,o.default)(r.default.mark(function t(){var e,n=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("GET",this.endpoint);case 2:return e=t.sent,t.abrupt("return",{data:e.data.map(function(t){return v(t,n.doctype)}),meta:{count:e.meta.count},skip:0,next:!1});case 4:case"end":return t.stop()}},t,this)})),function(){return d.apply(this,arguments)})},{key:"get",value:(p=(0,o.default)(r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("get() method is not yet implemented");case 1:case"end":return t.stop()}},t,this)})),function(){return p.apply(this,arguments)})},{key:"create",value:(l=(0,o.default)(r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("create() method is not available for applications");case 1:case"end":return t.stop()}},t,this)})),function(){return l.apply(this,arguments)})},{key:"update",value:(f=(0,o.default)(r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("update() method is not available for applications");case 1:case"end":return t.stop()}},t,this)})),function(){return f.apply(this,arguments)})},{key:"destroy",value:(n=(0,o.default)(r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("destroy() method is not available for applications");case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})}]),e}(p.default);y.normalizeDoctype=p.default.normalizeDoctypeJsonApi,e.default=y},function(t,e,n){var r=n(143),o=n(225),i=n(226),a=n(148),u=n(754),s=n(227),c=200;t.exports=function(t,e,n){var f=-1,l=o,p=t.length,d=!0,h=[],v=h;if(n)d=!1,l=i;else if(p>=c){var y=e?null:u(t);if(y)return s(y);d=!1,l=a,v=new r}else v=e?[]:h;t:for(;++f<p;){var g=t[f],m=e?e(g):g;if(g=n||0!==g?g:0,d&&m==m){for(var b=v.length;b--;)if(v[b]===m)continue t;e&&v.push(m),h.push(g)}else l(v,m,n)||(v!==h&&v.push(m),h.push(g))}return h}},function(t,e){var n="object"==typeof global&&global&&global.Object===Object&&global;t.exports=n},function(t,e){var n=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return n.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,e,n){var r=n(53)(n(27),"Set");t.exports=r},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}},function(t,e,n){var r=n(31),o=Object.create,i=function(){function t(){}return function(e){if(!r(e))return{};if(o)return o(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();t.exports=i},function(t,e,n){var r=n(760),o=n(228),i=n(21),a=n(149),u=n(229),s=n(230),c=Object.prototype.hasOwnProperty;t.exports=function(t,e){var n=i(t),f=!n&&o(t),l=!n&&!f&&a(t),p=!n&&!f&&!l&&s(t),d=n||f||l||p,h=d?r(t.length,String):[],v=h.length;for(var y in t)!e&&!c.call(t,y)||d&&("length"==y||l&&("offset"==y||"parent"==y)||p&&("buffer"==y||"byteLength"==y||"byteOffset"==y)||u(y,v))||h.push(y);return h}},function(t,e){t.exports=function(t,e){return function(n){return t(e(n))}}},function(t,e,n){var r=n(766),o=n(783),i=n(239),a=n(21),u=n(789);t.exports=function(t){return"function"==typeof t?t:null==t?i:"object"==typeof t?a(t)?o(t[0],t[1]):r(t):u(t)}},function(t,e,n){var r=n(773),o=n(32);t.exports=function t(e,n,i,a,u){return e===n||(null==e||null==n||!o(e)&&!o(n)?e!=e&&n!=n:r(e,n,i,a,t,u))}},function(t,e,n){var r=n(143),o=n(774),i=n(148),a=1,u=2;t.exports=function(t,e,n,s,c,f){var l=n&a,p=t.length,d=e.length;if(p!=d&&!(l&&d>p))return!1;var h=f.get(t);if(h&&f.get(e))return h==e;var v=-1,y=!0,g=n&u?new r:void 0;for(f.set(t,e),f.set(e,t);++v<p;){var m=t[v],b=e[v];if(s)var x=l?s(b,m,v,e,t,f):s(m,b,v,t,e,f);if(void 0!==x){if(x)continue;y=!1;break}if(g){if(!o(e,function(t,e){if(!i(g,e)&&(m===t||c(m,t,n,s,f)))return g.push(e)})){y=!1;break}}else if(m!==b&&!c(m,b,n,s,f)){y=!1;break}}return f.delete(t),f.delete(e),y}},function(t,e,n){var r=n(27).Uint8Array;t.exports=r},function(t,e,n){var r=n(383),o=n(237),i=n(102);t.exports=function(t){return r(t,i,o)}},function(t,e,n){var r=n(236),o=n(21);t.exports=function(t,e,n){var i=e(t);return o(t)?i:r(i,n(t))}},function(t,e){t.exports=function(){return[]}},function(t,e,n){var r=n(31);t.exports=function(t){return t==t&&!r(t)}},function(t,e){t.exports=function(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}},function(t,e,n){var r=n(76),o=n(78),i=n(21),a=n(152),u=1/0,s=r?r.prototype:void 0,c=s?s.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(i(e))return o(e,t)+"";if(a(e))return c?c.call(e):"";var n=e+"";return"0"==n&&1/e==-u?"-0":n}},function(t,e,n){var r=n(77),o=n(228),i=n(21),a=n(229),u=n(231),s=n(79);t.exports=function(t,e,n){for(var c=-1,f=(e=r(e,t)).length,l=!1;++c<f;){var p=s(e[c]);if(!(l=null!=t&&n(t,p)))break;t=t[p]}return l||++c!=f?l:!!(f=null==t?0:t.length)&&u(f)&&a(p,f)&&(i(t)||o(t))}},function(t,e,n){var r=n(390);t.exports=function(t,e,n){"__proto__"==e&&r?r(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},function(t,e,n){var r=n(53),o=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=o},function(t,e,n){var r=n(376),o=n(797),i=n(234);t.exports=function(t){return i(t)?r(t,!0):o(t)}},function(t,e,n){var r=n(236),o=n(154),i=n(237),a=n(384),u=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)r(e,i(t)),t=o(t);return e}:a;t.exports=u},function(t,e){t.exports=function(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i}},function(t,e,n){var r=n(821),o=Math.max;t.exports=function(t,e,n){return e=o(void 0===e?t.length-1:e,0),function(){for(var i=arguments,a=-1,u=o(i.length-e,0),s=Array(u);++a<u;)s[a]=i[e+a];a=-1;for(var c=Array(e+1);++a<e;)c[a]=i[a];return c[e]=n(s),r(t,this,c)}}},function(t,e,n){var r=n(822),o=n(824)(r);t.exports=o},function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,o=Array.isArray,i=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),a=function(t,e){for(var n=e&&e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)void 0!==t[r]&&(n[r]=t[r]);return n};t.exports={arrayToObject:a,assign:function(t,e){return Object.keys(e).reduce(function(t,n){return t[n]=e[n],t},t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],r=0;r<e.length;++r)for(var i=e[r],a=i.obj[i.prop],u=Object.keys(a),s=0;s<u.length;++s){var c=u[s],f=a[c];"object"==typeof f&&null!==f&&-1===n.indexOf(f)&&(e.push({obj:a,prop:c}),n.push(f))}return function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(o(n)){for(var r=[],i=0;i<n.length;++i)void 0!==n[i]&&r.push(n[i]);e.obj[e.prop]=r}}}(e),t},decode:function(t,e,n){var r=t.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(t){return r}},encode:function(t,e,n){if(0===t.length)return t;var r="string"==typeof t?t:String(t);if("iso-8859-1"===n)return escape(r).replace(/%u[0-9a-f]{4}/gi,function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"});for(var o="",a=0;a<r.length;++a){var u=r.charCodeAt(a);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122?o+=r.charAt(a):u<128?o+=i[u]:u<2048?o+=i[192|u>>6]+i[128|63&u]:u<55296||u>=57344?o+=i[224|u>>12]+i[128|u>>6&63]+i[128|63&u]:(a+=1,u=65536+((1023&u)<<10|1023&r.charCodeAt(a)),o+=i[240|u>>18]+i[128|u>>12&63]+i[128|u>>6&63]+i[128|63&u])}return o},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},merge:function t(e,n,i){if(!n)return e;if("object"!=typeof n){if(o(e))e.push(n);else{if(!e||"object"!=typeof e)return[e,n];(i&&(i.plainObjects||i.allowPrototypes)||!r.call(Object.prototype,n))&&(e[n]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(n);var u=e;return o(e)&&!o(n)&&(u=a(e,i)),o(e)&&o(n)?(n.forEach(function(n,o){if(r.call(e,o)){var a=e[o];a&&"object"==typeof a&&n&&"object"==typeof n?e[o]=t(a,n,i):e.push(n)}else e[o]=n}),e):Object.keys(n).reduce(function(e,o){var a=n[o];return r.call(e,o)?e[o]=t(e[o],a,i):e[o]=a,e},u)}}},function(t,e,n){"use strict";var r=String.prototype.replace,o=/%20/g;t.exports={default:"RFC3986",formatters:{RFC1738:function(t){return r.call(t,o,"+")},RFC3986:function(t){return t}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.buildURL=e.encode=void 0;var r=a(n(121)),o=a(n(116)),i=a(n(833));function a(t){return t&&t.__esModule?t:{default:t}}var u=e.encode=function(t){return(0,o.default)(t).map(function(t){var e=(0,r.default)(t,2);return e[0]+"="+function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Array.isArray(e)?"["+e.map(function(e){return t(e,!0)}).join(",")+"]":n?encodeURIComponent('"'+e+'"'):encodeURIComponent(e)}(e[1])}).join("&")};e.buildURL=function(t,e){var n=u((0,i.default)(e));return n?t+"?"+n:t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.normalizeJob=e.JOBS_DOCTYPE=void 0;var r=d(n(6)),o=d(n(73)),i=d(n(7)),a=d(n(1)),u=d(n(2)),s=d(n(4)),c=(0,o.default)(["/jobs/",""],["/jobs/",""]),f=d(n(244)),l=n(52),p=n(74);function d(t){return t&&t.__esModule?t:{default:t}}var h=e.JOBS_DOCTYPE="io.cozy.jobs",v=e.normalizeJob=function(t){return(0,s.default)({},t,(0,l.normalizeDoc)(t,h),t.attributes)},y=function(){function t(e){(0,a.default)(this,t),this.stackClient=e}var e;return(0,u.default)(t,[{key:"queued",value:function(t){return this.stackClient.fetchJSON("GET","/jobs/queue/"+t)}},{key:"create",value:function(t,e,n){return this.stackClient.fetchJSON("POST","/jobs/queue/"+t,{data:{type:h,attributes:{arguments:e||{},options:n||{}}}})}},{key:"get",value:(e=(0,i.default)(r.default.mark(function t(e){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",f.default.get(this.stackClient,(0,p.uri)(c,e),{normalize:v}));case 1:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})}]),t}();e.default=y},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(){var t;(t=console).warn.apply(t,arguments)}},function(t,e){var n=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");t.exports=function(t){return n.test(t)}},function(t,e,n){t.exports=n(862)},function(t,e,n){var r=n(67),o=n(95);t.exports=function(t,e,n){(void 0===n||o(t[e],n))&&(void 0!==n||e in t)||r(t,e,n)}},function(t,e){t.exports=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}},function(t,e,n){var r=n(892),o=n(351),i=r?function(t){return r.get(t)}:o;t.exports=i},function(t,e,n){var r=n(893),o=Object.prototype.hasOwnProperty;t.exports=function(t){for(var e=t.name+"",n=r[e],i=o.call(r,e)?n.length:0;i--;){var a=n[i],u=a.func;if(null==u||u==t)return a.name}return e}},function(t,e){const n=function(t){return Object.assign(this,t),this};n.prototype.toString=function(){throw new Error("Cannot convert Secret to string")},t.exports=n},function(t,e,n){var r=n(913),o={};for(var i in r)r.hasOwnProperty(i)&&(o[r[i]]=i);var a=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var u in a)if(a.hasOwnProperty(u)){if(!("channels"in a[u]))throw new Error("missing channels property: "+u);if(!("labels"in a[u]))throw new Error("missing channel labels property: "+u);if(a[u].labels.length!==a[u].channels)throw new Error("channel and label counts mismatch: "+u);var s=a[u].channels,c=a[u].labels;delete a[u].channels,delete a[u].labels,Object.defineProperty(a[u],"channels",{value:s}),Object.defineProperty(a[u],"labels",{value:c})}a.rgb.hsl=function(t){var e,n,r=t[0]/255,o=t[1]/255,i=t[2]/255,a=Math.min(r,o,i),u=Math.max(r,o,i),s=u-a;return u===a?e=0:r===u?e=(o-i)/s:o===u?e=2+(i-r)/s:i===u&&(e=4+(r-o)/s),(e=Math.min(60*e,360))<0&&(e+=360),n=(a+u)/2,[e,100*(u===a?0:n<=.5?s/(u+a):s/(2-u-a)),100*n]},a.rgb.hsv=function(t){var e,n,r,o,i,a=t[0]/255,u=t[1]/255,s=t[2]/255,c=Math.max(a,u,s),f=c-Math.min(a,u,s),l=function(t){return(c-t)/6/f+.5};return 0===f?o=i=0:(i=f/c,e=l(a),n=l(u),r=l(s),a===c?o=r-n:u===c?o=1/3+e-r:s===c&&(o=2/3+n-e),o<0?o+=1:o>1&&(o-=1)),[360*o,100*i,100*c]},a.rgb.hwb=function(t){var e=t[0],n=t[1],r=t[2];return[a.rgb.hsl(t)[0],100*(1/255*Math.min(e,Math.min(n,r))),100*(r=1-1/255*Math.max(e,Math.max(n,r)))]},a.rgb.cmyk=function(t){var e,n=t[0]/255,r=t[1]/255,o=t[2]/255;return[100*((1-n-(e=Math.min(1-n,1-r,1-o)))/(1-e)||0),100*((1-r-e)/(1-e)||0),100*((1-o-e)/(1-e)||0),100*e]},a.rgb.keyword=function(t){var e=o[t];if(e)return e;var n,i,a,u=1/0;for(var s in r)if(r.hasOwnProperty(s)){var c=r[s],f=(i=t,a=c,Math.pow(i[0]-a[0],2)+Math.pow(i[1]-a[1],2)+Math.pow(i[2]-a[2],2));f<u&&(u=f,n=s)}return n},a.keyword.rgb=function(t){return r[t]},a.rgb.xyz=function(t){var e=t[0]/255,n=t[1]/255,r=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*e+.7152*n+.0722*r),100*(.0193*e+.1192*n+.9505*r)]},a.rgb.lab=function(t){var e=a.rgb.xyz(t),n=e[0],r=e[1],o=e[2];return r/=100,o/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(n-r),200*(r-(o=o>.008856?Math.pow(o,1/3):7.787*o+16/116))]},a.hsl.rgb=function(t){var e,n,r,o,i,a=t[0]/360,u=t[1]/100,s=t[2]/100;if(0===u)return[i=255*s,i,i];e=2*s-(n=s<.5?s*(1+u):s+u-s*u),o=[0,0,0];for(var c=0;c<3;c++)(r=a+1/3*-(c-1))<0&&r++,r>1&&r--,i=6*r<1?e+6*(n-e)*r:2*r<1?n:3*r<2?e+(n-e)*(2/3-r)*6:e,o[c]=255*i;return o},a.hsl.hsv=function(t){var e=t[0],n=t[1]/100,r=t[2]/100,o=n,i=Math.max(r,.01);return n*=(r*=2)<=1?r:2-r,o*=i<=1?i:2-i,[e,100*(0===r?2*o/(i+o):2*n/(r+n)),100*((r+n)/2)]},a.hsv.rgb=function(t){var e=t[0]/60,n=t[1]/100,r=t[2]/100,o=Math.floor(e)%6,i=e-Math.floor(e),a=255*r*(1-n),u=255*r*(1-n*i),s=255*r*(1-n*(1-i));switch(r*=255,o){case 0:return[r,s,a];case 1:return[u,r,a];case 2:return[a,r,s];case 3:return[a,u,r];case 4:return[s,a,r];case 5:return[r,a,u]}},a.hsv.hsl=function(t){var e,n,r,o=t[0],i=t[1]/100,a=t[2]/100,u=Math.max(a,.01);return r=(2-i)*a,n=i*u,[o,100*(n=(n/=(e=(2-i)*u)<=1?e:2-e)||0),100*(r/=2)]},a.hwb.rgb=function(t){var e,n,r,o,i,a,u,s=t[0]/360,c=t[1]/100,f=t[2]/100,l=c+f;switch(l>1&&(c/=l,f/=l),r=6*s-(e=Math.floor(6*s)),0!=(1&e)&&(r=1-r),o=c+r*((n=1-f)-c),e){default:case 6:case 0:i=n,a=o,u=c;break;case 1:i=o,a=n,u=c;break;case 2:i=c,a=n,u=o;break;case 3:i=c,a=o,u=n;break;case 4:i=o,a=c,u=n;break;case 5:i=n,a=c,u=o}return[255*i,255*a,255*u]},a.cmyk.rgb=function(t){var e=t[0]/100,n=t[1]/100,r=t[2]/100,o=t[3]/100;return[255*(1-Math.min(1,e*(1-o)+o)),255*(1-Math.min(1,n*(1-o)+o)),255*(1-Math.min(1,r*(1-o)+o))]},a.xyz.rgb=function(t){var e,n,r,o=t[0]/100,i=t[1]/100,a=t[2]/100;return n=-.9689*o+1.8758*i+.0415*a,r=.0557*o+-.204*i+1.057*a,e=(e=3.2406*o+-1.5372*i+-.4986*a)>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(e=Math.min(Math.max(0,e),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]},a.xyz.lab=function(t){var e=t[0],n=t[1],r=t[2];return n/=100,r/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(e-n),200*(n-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},a.lab.xyz=function(t){var e,n,r,o=t[0];e=t[1]/500+(n=(o+16)/116),r=n-t[2]/200;var i=Math.pow(n,3),a=Math.pow(e,3),u=Math.pow(r,3);return n=i>.008856?i:(n-16/116)/7.787,e=a>.008856?a:(e-16/116)/7.787,r=u>.008856?u:(r-16/116)/7.787,[e*=95.047,n*=100,r*=108.883]},a.lab.lch=function(t){var e,n=t[0],r=t[1],o=t[2];return(e=360*Math.atan2(o,r)/2/Math.PI)<0&&(e+=360),[n,Math.sqrt(r*r+o*o),e]},a.lch.lab=function(t){var e,n=t[0],r=t[1];return e=t[2]/360*2*Math.PI,[n,r*Math.cos(e),r*Math.sin(e)]},a.rgb.ansi16=function(t){var e=t[0],n=t[1],r=t[2],o=1 in arguments?arguments[1]:a.rgb.hsv(t)[2];if(0===(o=Math.round(o/50)))return 30;var i=30+(Math.round(r/255)<<2|Math.round(n/255)<<1|Math.round(e/255));return 2===o&&(i+=60),i},a.hsv.ansi16=function(t){return a.rgb.ansi16(a.hsv.rgb(t),t[2])},a.rgb.ansi256=function(t){var e=t[0],n=t[1],r=t[2];return e===n&&n===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)},a.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];var n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},a.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var n;return t-=16,[Math.floor(t/36)/5*255,Math.floor((n=t%36)/6)/5*255,n%6/5*255]},a.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},a.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var n=e[0];3===e[0].length&&(n=n.split("").map(function(t){return t+t}).join(""));var r=parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},a.rgb.hcg=function(t){var e,n=t[0]/255,r=t[1]/255,o=t[2]/255,i=Math.max(Math.max(n,r),o),a=Math.min(Math.min(n,r),o),u=i-a;return e=u<=0?0:i===n?(r-o)/u%6:i===r?2+(o-n)/u:4+(n-r)/u+4,e/=6,[360*(e%=1),100*u,100*(u<1?a/(1-u):0)]},a.hsl.hcg=function(t){var e=t[1]/100,n=t[2]/100,r=1,o=0;return(r=n<.5?2*e*n:2*e*(1-n))<1&&(o=(n-.5*r)/(1-r)),[t[0],100*r,100*o]},a.hsv.hcg=function(t){var e=t[1]/100,n=t[2]/100,r=e*n,o=0;return r<1&&(o=(n-r)/(1-r)),[t[0],100*r,100*o]},a.hcg.rgb=function(t){var e=t[0]/360,n=t[1]/100,r=t[2]/100;if(0===n)return[255*r,255*r,255*r];var o,i=[0,0,0],a=e%1*6,u=a%1,s=1-u;switch(Math.floor(a)){case 0:i[0]=1,i[1]=u,i[2]=0;break;case 1:i[0]=s,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=u;break;case 3:i[0]=0,i[1]=s,i[2]=1;break;case 4:i[0]=u,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=s}return o=(1-n)*r,[255*(n*i[0]+o),255*(n*i[1]+o),255*(n*i[2]+o)]},a.hcg.hsv=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e),r=0;return n>0&&(r=e/n),[t[0],100*r,100*n]},a.hcg.hsl=function(t){var e=t[1]/100,n=t[2]/100*(1-e)+.5*e,r=0;return n>0&&n<.5?r=e/(2*n):n>=.5&&n<1&&(r=e/(2*(1-n))),[t[0],100*r,100*n]},a.hcg.hwb=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},a.hwb.hcg=function(t){var e=t[1]/100,n=1-t[2]/100,r=n-e,o=0;return r<1&&(o=(n-r)/(1-r)),[t[0],100*r,100*o]},a.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},a.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},a.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},a.gray.hsl=a.gray.hsv=function(t){return[0,0,t[0]]},a.gray.hwb=function(t){return[0,100,t[0]]},a.gray.cmyk=function(t){return[0,0,0,t[0]]},a.gray.lab=function(t){return[t[0],0,0]},a.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},a.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}},function(t,e,n){const r=n(410),o=n(86),i=n(411),a=n(16),u=t=>e=>e[t]&&0!==e[t].length?e[t].find(t=>t.primary)||e[t][0]:"";class s extends a{static isContact(t){return t._type===s.doctype}static getInitials(t){if("string"==typeof t)return i("warn","Passing a string to Contact.getInitials will be deprecated soon."),t[0].toUpperCase();if(t.name)return["givenName","familyName"].map(e=>o(t,["name",e,0],"")).join("").toUpperCase();const e=s.getPrimaryEmail(t);return e?e[0].toUpperCase():(i("warn","Contact has no name and no email."),"")}static getPrimaryEmail(t){return Array.isArray(t.email)?u("email")(t).address:t.email}static getPrimaryCozy(t){return Array.isArray(t.cozy)?u("cozy")(t).url:t.url}static getPrimaryPhone(t){return u("phone")(t).number}static getPrimaryAddress(t){return u("address")(t).formattedAddress}static getFullname(t){return t.fullname?t.fullname:t.name?["namePrefix","givenName","additionalName","familyName","nameSuffix"].map(e=>t.name[e]).filter(t=>void 0!==t).join(" ").trim():void 0}static getDisplayName(t){return s.getFullname(t)||s.getPrimaryEmail(t)}}const c=r.shape({_id:r.string.isRequired,_type:r.string.isRequired,fullname:r.string,name:r.shape({givenName:r.string,familyName:r.string,additionalName:r.string,namePrefix:r.string,nameSuffix:r.string}),birthday:r.string,note:r.string,email:r.arrayOf(r.shape({address:r.string.isRequired,label:r.string,type:r.string,primary:r.bool})),address:r.arrayOf(r.shape({street:r.string,pobox:r.string,city:r.string,region:r.string,postcode:r.string,country:r.string,type:r.string,primary:r.bool,label:r.string,formattedAddress:r.string})),phone:r.arrayOf(r.shape({number:r.string.isRequired,type:r.string,label:r.string,primary:r.bool})),cozy:r.arrayOf(r.shape({url:r.string.isRequired,label:r.string,primary:r.bool})),company:r.string,jobTitle:r.string,trashed:r.bool,me:r.bool,relationships:r.shape({accounts:r.shape({data:r.arrayOf(r.shape({_id:r.string.isRequired,_type:r.string.isRequired}))}),groups:r.shape({data:r.arrayOf(r.shape({_id:r.string.isRequired,_type:r.string.isRequired}))})})});s.doctype="io.cozy.contacts",s.propType=c,t.exports=s},function(t,e,n){t.exports=n(921)()},function(t,e,n){const r=n(0).namespace("doctypes");t.exports=r},function(t,e,n){const r=n(16);class o extends r{}o.schema={doctype:"io.cozy.apps",attributes:{}},o.doctype="io.cozy.apps",t.exports=o},function(t,e){t.exports={eitherIncludes:(t,e)=>Boolean(t&&e&&(t.includes(e)||e.includes(t)))}},function(t,e,n){const r=n(925),o=Object.entries(r).map(([t,e])=>"/"===t[0]&&"/"===t[t.length-1]?[new RegExp(t.substr(1,t.length-2),"i"),e]:[t,e]);t.exports={getSlugFromInstitutionLabel:t=>{if(t)for(const[e,n]of o)if(e instanceof RegExp){if(t.match(e))return n}else if(e.toLowerCase()===t.toLowerCase())return n}}},function(t,e,n){var r=n(933),o=n(934),i=36e5,a=6e4,u=2,s=/[T ]/,c=/:/,f=/^(\d{2})$/,l=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],p=/^(\d{4})/,d=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],h=/^-(\d{2})$/,v=/^-?(\d{3})$/,y=/^-?(\d{2})-?(\d{2})$/,g=/^-?W(\d{2})$/,m=/^-?W(\d{2})-?(\d{1})$/,b=/^(\d{2}([.,]\d*)?)$/,x=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,w=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,_=/([Z+-].*)$/,k=/^(Z)$/,O=/^([+-])(\d{2})$/,j=/^([+-])(\d{2}):?(\d{2})$/;function S(t,e,n){e=e||0,n=n||0;var r=new Date(0);r.setUTCFullYear(t,0,4);var o=7*e+n+1-(r.getUTCDay()||7);return r.setUTCDate(r.getUTCDate()+o),r}t.exports=function(t,e){if(o(t))return new Date(t.getTime());if("string"!=typeof t)return new Date(t);var n=(e||{}).additionalDigits;n=null==n?u:Number(n);var E=function(t){var e,n={},r=t.split(s);c.test(r[0])?(n.date=null,e=r[0]):(n.date=r[0],e=r[1]);if(e){var o=_.exec(e);o?(n.time=e.replace(o[1],""),n.timezone=o[1]):n.time=e}return n}(t),A=function(t,e){var n,r=l[e],o=d[e];if(n=p.exec(t)||o.exec(t)){var i=n[1];return{year:parseInt(i,10),restDateString:t.slice(i.length)}}if(n=f.exec(t)||r.exec(t)){var a=n[1];return{year:100*parseInt(a,10),restDateString:t.slice(a.length)}}return{year:null}}(E.date,n),C=A.year,T=function(t,e){if(null===e)return null;var n,r,o,i;if(0===t.length)return(r=new Date(0)).setUTCFullYear(e),r;if(n=h.exec(t))return r=new Date(0),o=parseInt(n[1],10)-1,r.setUTCFullYear(e,o),r;if(n=v.exec(t)){r=new Date(0);var a=parseInt(n[1],10);return r.setUTCFullYear(e,0,a),r}if(n=y.exec(t)){r=new Date(0),o=parseInt(n[1],10)-1;var u=parseInt(n[2],10);return r.setUTCFullYear(e,o,u),r}if(n=g.exec(t))return i=parseInt(n[1],10)-1,S(e,i);if(n=m.exec(t)){i=parseInt(n[1],10)-1;var s=parseInt(n[2],10)-1;return S(e,i,s)}return null}(A.restDateString,C);if(T){var P,M=T.getTime(),D=0;if(E.time&&(D=function(t){var e,n,r;if(e=b.exec(t))return(n=parseFloat(e[1].replace(",",".")))%24*i;if(e=x.exec(t))return n=parseInt(e[1],10),r=parseFloat(e[2].replace(",",".")),n%24*i+r*a;if(e=w.exec(t)){n=parseInt(e[1],10),r=parseInt(e[2],10);var o=parseFloat(e[3].replace(",","."));return n%24*i+r*a+1e3*o}return null}(E.time)),E.timezone)P=function(t){var e,n;if(e=k.exec(t))return 0;if(e=O.exec(t))return n=60*parseInt(e[2],10),"+"===e[1]?-n:n;if(e=j.exec(t))return n=60*parseInt(e[2],10)+parseInt(e[3],10),"+"===e[1]?-n:n;return 0}(E.timezone)*a;else{var R=M+D,I=new Date(R);P=r(I);var z=new Date(R);z.setDate(I.getDate()+1);var N=r(z)-r(I);N>0&&(P+=N)}return new Date(M+D+P)}return new Date(t)}},function(t,e,n){const r=n(940),o=n(16),i=/(.+)(\..*)$/;class a extends o{static async getFullpath(t,e){if(!t)throw new Error("You must provide a dirId");const n=await this.get(t);return`${r(n.path,"/")}/${e}`}static async move(t,e,n=!1){const{folderId:r,path:o}=e,i=this.cozyClient.collection("io.cozy.files");try{return{moved:(await i.updateFileMetadata(t,{dir_id:r})).data,deleted:null}}catch(e){if(409===e.status&&n){let e;if(o)e=o;else{const n=(await this.get(t)).name;e=await this.getFullpath(r,n)}const n=await i.statByPath(e);return await i.destroy(n.data),{moved:(await i.updateFileMetadata(t,{dir_id:r})).data,deleted:n.data.id}}throw e}}static splitFilename(t){if(!t.name)throw new Error("file should have a name property ");if("file"===t.type){const e=t.name.match(i);if(e)return{filename:e[1],extension:e[2]}}return{filename:t.name,extension:""}}static async overrideFileForPath(t,e,n){t.endsWith("/")||(t+="/");const r=this.cozyClient.collection("io.cozy.files");try{const o=await r.statByPath(t+e.name),{id:i,dir_id:a}=o.data;return await r.updateFile(e,{dirId:a,fileId:i,metadata:n})}catch(o){if(/Not Found/.test(o)){const o=await r.ensureDirectoryExists(t);return await r.createFile(e,{dirId:o,metadata:n})}throw o}}}a.doctype="io.cozy.files",t.exports=a},function(t,e,n){"use strict";function r(t){var e,n=t.Symbol;return"function"==typeof n?n.observable?e=n.observable:(e=n("observable"),n.observable=e):e="@@observable",e}n.d(e,"a",function(){return r})},function(t,e){t.exports=require("https")},function(t,e,n){var r,o,i;
/**
 * k-d Tree JavaScript - V 1.01
 *
 * https://github.com/ubilabs/kd-tree-javascript
 *
 * @author Mircea Pricop <pricop@ubilabs.net>, 2012
 * @author Martin Kleppe <kleppe@ubilabs.net>, 2012
 * @author Ubilabs http://ubilabs.net, 2012
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 */o=[e],void 0===(i="function"==typeof(r=function(t){function e(t,e,n){this.obj=t,this.left=null,this.right=null,this.parent=n,this.dimension=e}function n(t){this.content=[],this.scoreFunction=t}n.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,n=0;n<e;n++)if(this.content[n]==t){var r=this.content.pop();return void(n!=e-1&&(this.content[n]=r,this.scoreFunction(r)<this.scoreFunction(t)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var n=Math.floor((t+1)/2)-1,r=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[n]=e,this.content[t]=r,t=n}},sinkDown:function(t){for(var e=this.content.length,n=this.content[t],r=this.scoreFunction(n);;){var o=2*(t+1),i=o-1,a=null;if(i<e){var u=this.content[i],s=this.scoreFunction(u);s<r&&(a=i)}if(o<e){var c=this.content[o];this.scoreFunction(c)<(null==a?r:s)&&(a=o)}if(null==a)break;this.content[t]=this.content[a],this.content[a]=n,t=a}}},t.kdTree=function(t,r,o){var i=this;Array.isArray(t)?this.root=function t(n,r,i){var a,u,s=r%o.length;return 0===n.length?null:1===n.length?new e(n[0],s,i):(n.sort(function(t,e){return t[o[s]]-e[o[s]]}),(u=new e(n[a=Math.floor(n.length/2)],s,i)).left=t(n.slice(0,a),r+1,u),u.right=t(n.slice(a+1),r+1,u),u)}(t,0,null):function(t){i.root=t,function t(e){e.left&&(e.left.parent=e,t(e.left)),e.right&&(e.right.parent=e,t(e.right))}(i.root)}(t),this.toJSON=function(t){t||(t=this.root);var n=new e(t.obj,t.dimension,null);return t.left&&(n.left=i.toJSON(t.left)),t.right&&(n.right=i.toJSON(t.right)),n},this.insert=function(t){var n,r,i=function e(n,r){if(null===n)return r;var i=o[n.dimension];return t[i]<n.obj[i]?e(n.left,n):e(n.right,n)}(this.root,null);null!==i?(n=new e(t,(i.dimension+1)%o.length,i),r=o[i.dimension],t[r]<i.obj[r]?i.left=n:i.right=n):this.root=new e(t,0,null)},this.remove=function(t){var e;null!==(e=function e(n){if(null===n)return null;if(n.obj===t)return n;var r=o[n.dimension];return t[r]<n.obj[r]?e(n.left):e(n.right)}(i.root))&&function t(e){function n(t,e){var r,i,a,u,s;return null===t?null:(r=o[e],t.dimension===e?null!==t.left?n(t.left,e):t:(i=t.obj[r],a=n(t.left,e),u=n(t.right,e),s=t,null!==a&&a.obj[r]<i&&(s=a),null!==u&&u.obj[r]<s.obj[r]&&(s=u),s))}var r,a,u;if(null===e.left&&null===e.right)return null===e.parent?void(i.root=null):(u=o[e.parent.dimension],void(e.obj[u]<e.parent.obj[u]?e.parent.left=null:e.parent.right=null));null!==e.right?(a=(r=n(e.right,e.dimension)).obj,t(r),e.obj=a):(a=(r=n(e.left,e.dimension)).obj,t(r),e.right=e.left,e.left=null,e.obj=a)}(e)},this.nearest=function(t,e,a){var u,s,c;if(c=new n(function(t){return-t[1]}),a)for(u=0;u<e;u+=1)c.push([null,a]);for(i.root&&function n(i){function a(t,n){c.push([t,n]),c.size()>e&&c.pop()}var u,s,f,l,p=o[i.dimension],d=r(t,i.obj),h={};for(l=0;l<o.length;l+=1)l===i.dimension?h[o[l]]=t[o[l]]:h[o[l]]=i.obj[o[l]];s=r(h,i.obj),null!==i.right||null!==i.left?(n(u=null===i.right?i.left:null===i.left?i.right:t[p]<i.obj[p]?i.left:i.right),(c.size()<e||d<c.peek()[1])&&a(i,d),(c.size()<e||Math.abs(s)<c.peek()[1])&&null!==(f=u===i.left?i.right:i.left)&&n(f)):(c.size()<e||d<c.peek()[1])&&a(i,d)}(i.root),s=[],u=0;u<Math.min(e,c.content.length);u+=1)c.content[u][0]&&s.push([c.content[u][0].obj,c.content[u][1]]);return s},this.balanceFactor=function(){return function t(e){return null===e?0:Math.max(t(e.left),t(e.right))+1}(i.root)/(Math.log(function t(e){return null===e?0:t(e.left)+t(e.right)+1}(i.root))/Math.log(2))}},t.BinaryHeap=n})?r.apply(e,o):r)||(t.exports=i)},function(t,e,n){var r=n(243),o=n(253),i=n(370),a=n(254),u=o(function(t){return i(r(t,1,a,!0))});t.exports=u},function(t,e,n){var r=n(78),o=n(953),i=n(253),a=n(954),u=i(function(t){var e=r(t,a);return e.length&&e[0]===t[0]?o(e):[]});t.exports=u},function(t,e,n){const r=n(16);class o extends r{}o.schema={doctype:"io.cozy.accounts",attributes:{},relationships:{master:{type:"has-one",doctype:"io.cozy.accounts"}}},t.exports=o},function(t,e,n){var r=n(81),o=n(424),i=n(484),a=n(56),u=n(82),s=n(490),c=n(278),f=n(168),l=c(function(t,e){var n={};if(null==t)return n;var c=!1;e=r(e,function(e){return e=a(e,t),c||(c=e.length>1),e}),u(t,f(t),n),c&&(n=o(n,7,s));for(var l=e.length;l--;)i(n,e[l]);return n});t.exports=l},function(t,e,n){var r=n(156),o=n(453),i=n(159),a=n(454),u=n(460),s=n(463),c=n(464),f=n(465),l=n(467),p=n(272),d=n(168),h=n(84),v=n(472),y=n(473),g=n(478),m=n(14),b=n(161),x=n(480),w=n(33),_=n(482),k=n(83),O=1,j=2,S=4,E="[object Arguments]",A="[object Function]",C="[object GeneratorFunction]",T="[object Object]",P={};P[E]=P["[object Array]"]=P["[object ArrayBuffer]"]=P["[object DataView]"]=P["[object Boolean]"]=P["[object Date]"]=P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Map]"]=P["[object Number]"]=P[T]=P["[object RegExp]"]=P["[object Set]"]=P["[object String]"]=P["[object Symbol]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P["[object Error]"]=P[A]=P["[object WeakMap]"]=!1,t.exports=function t(e,n,M,D,R,I){var z,N=n&O,L=n&j,F=n&S;if(M&&(z=R?M(e,D,R,I):M(e)),void 0!==z)return z;if(!w(e))return e;var B=m(e);if(B){if(z=v(e),!N)return c(e,z)}else{var U=h(e),$=U==A||U==C;if(b(e))return s(e,N);if(U==T||U==E||$&&!R){if(z=L||$?{}:g(e),!N)return L?l(e,u(z,e)):f(e,a(z,e))}else{if(!P[U])return R?e:{};z=y(e,U,N)}}I||(I=new r);var q=I.get(e);if(q)return q;I.set(e,z),_(e)?e.forEach(function(r){z.add(t(r,n,M,r,e,I))}):x(e)&&e.forEach(function(r,o){z.set(o,t(r,n,M,o,e,I))});var J=F?L?d:p:L?keysIn:k,V=B?void 0:J(e);return o(V||e,function(r,o){V&&(r=e[o=r]),i(z,o,t(r,n,M,o,e,I))}),z}},function(t,e){t.exports=function(){this.__data__=[],this.size=0}},function(t,e,n){var r=n(106),o=Array.prototype.splice;t.exports=function(t){var e=this.__data__,n=r(e,t);return!(n<0)&&(n==e.length-1?e.pop():o.call(e,n,1),--this.size,!0)}},function(t,e,n){var r=n(106);t.exports=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]}},function(t,e,n){var r=n(106);t.exports=function(t){return r(this.__data__,t)>-1}},function(t,e,n){var r=n(106);t.exports=function(t,e){var n=this.__data__,o=r(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this}},function(t,e,n){var r=n(105);t.exports=function(){this.__data__=new r,this.size=0}},function(t,e){t.exports=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}},function(t,e){t.exports=function(t){return this.__data__.get(t)}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e,n){var r=n(105),o=n(157),i=n(158),a=200;t.exports=function(t,e){var n=this.__data__;if(n instanceof r){var u=n.__data__;if(!o||u.length<a-1)return u.push([t,e]),this.size=++n.size,this;n=this.__data__=new i(u)}return n.set(t,e),this.size=n.size,this}},function(t,e,n){var r=n(261),o=n(438),i=n(33),a=n(263),u=/^\[object .+?Constructor\]$/,s=Function.prototype,c=Object.prototype,f=s.toString,l=c.hasOwnProperty,p=RegExp("^"+f.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!i(t)||o(t))&&(r(t)?p:u).test(a(t))}},function(t,e,n){var r=n(54),o=Object.prototype,i=o.hasOwnProperty,a=o.toString,u=r?r.toStringTag:void 0;t.exports=function(t){var e=i.call(t,u),n=t[u];try{t[u]=void 0;var r=!0}catch(t){}var o=a.call(t);return r&&(e?t[u]=n:delete t[u]),o}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e,n){var r,o=n(439),i=(r=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";t.exports=function(t){return!!i&&i in t}},function(t,e,n){var r=n(22)["__core-js_shared__"];t.exports=r},function(t,e){t.exports=function(t,e){return null==t?void 0:t[e]}},function(t,e,n){var r=n(442),o=n(105),i=n(157);t.exports=function(){this.size=0,this.__data__={hash:new r,map:new(i||o),string:new r}}},function(t,e,n){var r=n(443),o=n(444),i=n(445),a=n(446),u=n(447);function s(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=a,s.prototype.set=u,t.exports=s},function(t,e,n){var r=n(108);t.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(t,e){t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},function(t,e,n){var r=n(108),o="__lodash_hash_undefined__",i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(r){var n=e[t];return n===o?void 0:n}return i.call(e,t)?e[t]:void 0}},function(t,e,n){var r=n(108),o=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return r?void 0!==e[t]:o.call(e,t)}},function(t,e,n){var r=n(108),o="__lodash_hash_undefined__";t.exports=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=r&&void 0===e?o:e,this}},function(t,e,n){var r=n(109);t.exports=function(t){var e=r(this,t).delete(t);return this.size-=e?1:0,e}},function(t,e){t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},function(t,e,n){var r=n(109);t.exports=function(t){return r(this,t).get(t)}},function(t,e,n){var r=n(109);t.exports=function(t){return r(this,t).has(t)}},function(t,e,n){var r=n(109);t.exports=function(t,e){var n=r(this,t),o=n.size;return n.set(t,e),this.size+=n.size==o?0:1,this}},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}},function(t,e,n){var r=n(82),o=n(83);t.exports=function(t,e){return t&&r(e,o(e),t)}},function(t,e){t.exports=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}},function(t,e,n){var r=n(41),o=n(29),i="[object Arguments]";t.exports=function(t){return o(t)&&r(t)==i}},function(t,e){t.exports=function(){return!1}},function(t,e,n){var r=n(41),o=n(162),i=n(29),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,t.exports=function(t){return i(t)&&o(t.length)&&!!a[r(t)]}},function(t,e,n){var r=n(268)(Object.keys,Object);t.exports=r},function(t,e,n){var r=n(82),o=n(269);t.exports=function(t,e){return t&&r(e,o(e),t)}},function(t,e,n){var r=n(33),o=n(164),i=n(462),a=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return i(t);var e=o(t),n=[];for(var u in t)("constructor"!=u||!e&&a.call(t,u))&&n.push(u);return n}},function(t,e){t.exports=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}},function(t,e,n){(function(t){var r=n(22),o=e&&!e.nodeType&&e,i=o&&"object"==typeof t&&t&&!t.nodeType&&t,a=i&&i.exports===o?r.Buffer:void 0,u=a?a.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=u?u(n):new t.constructor(n);return t.copy(r),r}}).call(this,n(23)(t))},function(t,e){t.exports=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}},function(t,e,n){var r=n(82),o=n(165);t.exports=function(t,e){return r(t,o(t),e)}},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[o++]=a)}return i}},function(t,e,n){var r=n(82),o=n(271);t.exports=function(t,e){return r(t,o(t),e)}},function(t,e,n){var r=n(40)(n(22),"DataView");t.exports=r},function(t,e,n){var r=n(40)(n(22),"Promise");t.exports=r},function(t,e,n){var r=n(40)(n(22),"Set");t.exports=r},function(t,e,n){var r=n(40)(n(22),"WeakMap");t.exports=r},function(t,e){var n=Object.prototype.hasOwnProperty;t.exports=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&n.call(t,"index")&&(r.index=t.index,r.input=t.input),r}},function(t,e,n){var r=n(169),o=n(474),i=n(475),a=n(476),u=n(477),s="[object Boolean]",c="[object Date]",f="[object Map]",l="[object Number]",p="[object RegExp]",d="[object Set]",h="[object String]",v="[object Symbol]",y="[object ArrayBuffer]",g="[object DataView]",m="[object Float32Array]",b="[object Float64Array]",x="[object Int8Array]",w="[object Int16Array]",_="[object Int32Array]",k="[object Uint8Array]",O="[object Uint8ClampedArray]",j="[object Uint16Array]",S="[object Uint32Array]";t.exports=function(t,e,n){var E=t.constructor;switch(e){case y:return r(t);case s:case c:return new E(+t);case g:return o(t,n);case m:case b:case x:case w:case _:case k:case O:case j:case S:return u(t,n);case f:return new E;case l:case h:return new E(t);case p:return i(t);case d:return new E;case v:return a(t)}}},function(t,e,n){var r=n(169);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},function(t,e){var n=/\w*$/;t.exports=function(t){var e=new t.constructor(t.source,n.exec(t));return e.lastIndex=t.lastIndex,e}},function(t,e,n){var r=n(54),o=r?r.prototype:void 0,i=o?o.valueOf:void 0;t.exports=function(t){return i?Object(i.call(t)):{}}},function(t,e,n){var r=n(169);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},function(t,e,n){var r=n(479),o=n(167),i=n(164);t.exports=function(t){return"function"!=typeof t.constructor||i(t)?{}:r(o(t))}},function(t,e,n){var r=n(33),o=Object.create,i=function(){function t(){}return function(e){if(!r(e))return{};if(o)return o(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();t.exports=i},function(t,e,n){var r=n(481),o=n(112),i=n(163),a=i&&i.isMap,u=a?o(a):r;t.exports=u},function(t,e,n){var r=n(84),o=n(29),i="[object Map]";t.exports=function(t){return o(t)&&r(t)==i}},function(t,e,n){var r=n(483),o=n(112),i=n(163),a=i&&i.isSet,u=a?o(a):r;t.exports=u},function(t,e,n){var r=n(84),o=n(29),i="[object Set]";t.exports=function(t){return o(t)&&r(t)==i}},function(t,e,n){var r=n(56),o=n(488),i=n(489),a=n(57);t.exports=function(t,e){return e=r(e,t),null==(t=i(t,e))||delete t[a(o(e))]}},function(t,e,n){var r=n(486),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,a=r(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(o,function(t,n,r,o){e.push(r?o.replace(i,"$1"):n||t)}),e});t.exports=a},function(t,e,n){var r=n(487),o=500;t.exports=function(t){var e=r(t,function(t){return n.size===o&&n.clear(),t}),n=e.cache;return e}},function(t,e,n){var r=n(158),o="Expected a function";function i(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(o);var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var a=t.apply(this,r);return n.cache=i.set(o,a)||i,a};return n.cache=new(i.Cache||r),n}i.Cache=r,t.exports=i},function(t,e){t.exports=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}},function(t,e,n){var r=n(113),o=n(277);t.exports=function(t,e){return e.length<2?t:r(t,o(e,0,-1))}},function(t,e,n){var r=n(491);t.exports=function(t){return r(t)?void 0:t}},function(t,e,n){var r=n(41),o=n(167),i=n(29),a="[object Object]",u=Function.prototype,s=Object.prototype,c=u.toString,f=s.hasOwnProperty,l=c.call(Object);t.exports=function(t){if(!i(t)||r(t)!=a)return!1;var e=o(t);if(null===e)return!0;var n=f.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&c.call(n)==l}},function(t,e,n){var r=n(54),o=n(160),i=n(14),a=r?r.isConcatSpreadable:void 0;t.exports=function(t){return i(t)||o(t)||!!(a&&t&&t[a])}},function(t,e){t.exports=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}},function(t,e,n){var r=n(495),o=n(264),i=n(114),a=o?function(t,e){return o(t,"toString",{configurable:!0,enumerable:!1,value:r(e),writable:!0})}:i;t.exports=a},function(t,e){t.exports=function(t){return function(){return t}}},function(t,e){var n=800,r=16,o=Date.now;t.exports=function(t){var e=0,i=0;return function(){var a=o(),u=r-(a-i);if(i=a,u>0){if(++e>=n)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}},function(t,e,n){var r=n(498),o=n(278)(function(t,e){return null==t?{}:r(t,e)});t.exports=o},function(t,e,n){var r=n(282),o=n(283);t.exports=function(t,e){return r(t,e,function(e,n){return o(t,n)})}},function(t,e,n){var r=n(159),o=n(56),i=n(111),a=n(33),u=n(57);t.exports=function(t,e,n,s){if(!a(t))return t;for(var c=-1,f=(e=o(e,t)).length,l=f-1,p=t;null!=p&&++c<f;){var d=u(e[c]),h=n;if(c!=l){var v=p[d];void 0===(h=s?s(v,d,p):void 0)&&(h=a(v)?v:i(e[c+1])?[]:{})}r(p,d,h),p=p[d]}return t}},function(t,e){t.exports=function(t,e){return null!=t&&e in Object(t)}},function(t,e,n){var r=n(56),o=n(160),i=n(14),a=n(111),u=n(162),s=n(57);t.exports=function(t,e,n){for(var c=-1,f=(e=r(e,t)).length,l=!1;++c<f;){var p=s(e[c]);if(!(l=null!=t&&n(t,p)))break;t=t[p]}return l||++c!=f?l:!!(f=null==t?0:t.length)&&u(f)&&a(p,f)&&(i(t)||o(t))}},function(t,e,n){var r=n(267),o=n(84),i=n(55),a=n(503),u=n(504),s="[object Map]",c="[object Set]";t.exports=function(t){if(null==t)return 0;if(i(t))return a(t)?u(t):t.length;var e=o(t);return e==s||e==c?t.size:r(t).length}},function(t,e,n){var r=n(41),o=n(14),i=n(29),a="[object String]";t.exports=function(t){return"string"==typeof t||!o(t)&&i(t)&&r(t)==a}},function(t,e,n){var r=n(505),o=n(285),i=n(506);t.exports=function(t){return o(t)?i(t):r(t)}},function(t,e,n){var r=n(284)("length");t.exports=r},function(t,e){var n="[\\ud800-\\udfff]",r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",o="\\ud83c[\\udffb-\\udfff]",i="[^\\ud800-\\udfff]",a="(?:\\ud83c[\\udde6-\\uddff]){2}",u="[\\ud800-\\udbff][\\udc00-\\udfff]",s="(?:"+r+"|"+o+")"+"?",c="[\\ufe0e\\ufe0f]?"+s+("(?:\\u200d(?:"+[i,a,u].join("|")+")[\\ufe0e\\ufe0f]?"+s+")*"),f="(?:"+[i+r+"?",r,a,u,n].join("|")+")",l=RegExp(o+"(?="+o+")|"+f+c,"g");t.exports=function(t){for(var e=l.lastIndex=0;l.test(t);)++e;return e}},function(t,e,n){var r=n(42),o=n(524),i=n(290);t.exports=function(t,e){return i(t,o(r(e)))}},function(t,e,n){var r=n(509),o=n(520),i=n(289);t.exports=function(t){var e=o(t);return 1==e.length&&e[0][2]?i(e[0][0],e[0][1]):function(n){return n===t||r(n,t,e)}}},function(t,e,n){var r=n(156),o=n(286),i=1,a=2;t.exports=function(t,e,n,u){var s=n.length,c=s,f=!u;if(null==t)return!c;for(t=Object(t);s--;){var l=n[s];if(f&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<c;){var p=(l=n[s])[0],d=t[p],h=l[1];if(f&&l[2]){if(void 0===d&&!(p in t))return!1}else{var v=new r;if(u)var y=u(d,h,p,t,e,v);if(!(void 0===y?o(h,d,i|a,u,v):y))return!1}}return!0}},function(t,e,n){var r=n(156),o=n(287),i=n(516),a=n(519),u=n(84),s=n(14),c=n(161),f=n(266),l=1,p="[object Arguments]",d="[object Array]",h="[object Object]",v=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,y,g,m){var b=s(t),x=s(e),w=b?d:u(t),_=x?d:u(e),k=(w=w==p?h:w)==h,O=(_=_==p?h:_)==h,j=w==_;if(j&&c(t)){if(!c(e))return!1;b=!0,k=!1}if(j&&!k)return m||(m=new r),b||f(t)?o(t,e,n,y,g,m):i(t,e,w,n,y,g,m);if(!(n&l)){var S=k&&v.call(t,"__wrapped__"),E=O&&v.call(e,"__wrapped__");if(S||E){var A=S?t.value():t,C=E?e.value():e;return m||(m=new r),g(A,C,n,y,m)}}return!!j&&(m||(m=new r),a(t,e,n,y,g,m))}},function(t,e,n){var r=n(158),o=n(512),i=n(513);function a(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new r;++e<n;)this.add(t[e])}a.prototype.add=a.prototype.push=o,a.prototype.has=i,t.exports=a},function(t,e){var n="__lodash_hash_undefined__";t.exports=function(t){return this.__data__.set(t,n),this}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}},function(t,e){t.exports=function(t,e){return t.has(e)}},function(t,e,n){var r=n(54),o=n(274),i=n(107),a=n(287),u=n(517),s=n(518),c=1,f=2,l="[object Boolean]",p="[object Date]",d="[object Error]",h="[object Map]",v="[object Number]",y="[object RegExp]",g="[object Set]",m="[object String]",b="[object Symbol]",x="[object ArrayBuffer]",w="[object DataView]",_=r?r.prototype:void 0,k=_?_.valueOf:void 0;t.exports=function(t,e,n,r,_,O,j){switch(n){case w:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case x:return!(t.byteLength!=e.byteLength||!O(new o(t),new o(e)));case l:case p:case v:return i(+t,+e);case d:return t.name==e.name&&t.message==e.message;case y:case m:return t==e+"";case h:var S=u;case g:var E=r&c;if(S||(S=s),t.size!=e.size&&!E)return!1;var A=j.get(t);if(A)return A==e;r|=f,j.set(t,e);var C=a(S(t),S(e),r,_,O,j);return j.delete(t),C;case b:if(k)return k.call(t)==k.call(e)}return!1}},function(t,e){t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}},function(t,e){t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}},function(t,e,n){var r=n(272),o=1,i=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,a,u,s){var c=n&o,f=r(t),l=f.length;if(l!=r(e).length&&!c)return!1;for(var p=l;p--;){var d=f[p];if(!(c?d in e:i.call(e,d)))return!1}var h=s.get(t);if(h&&s.get(e))return h==e;var v=!0;s.set(t,e),s.set(e,t);for(var y=c;++p<l;){var g=t[d=f[p]],m=e[d];if(a)var b=c?a(m,g,d,e,t,s):a(g,m,d,t,e,s);if(!(void 0===b?g===m||u(g,m,n,a,s):b)){v=!1;break}y||(y="constructor"==d)}if(v&&!y){var x=t.constructor,w=e.constructor;x!=w&&"constructor"in t&&"constructor"in e&&!("function"==typeof x&&x instanceof x&&"function"==typeof w&&w instanceof w)&&(v=!1)}return s.delete(t),s.delete(e),v}},function(t,e,n){var r=n(288),o=n(83);t.exports=function(t){for(var e=o(t),n=e.length;n--;){var i=e[n],a=t[i];e[n]=[i,a,r(a)]}return e}},function(t,e,n){var r=n(286),o=n(86),i=n(283),a=n(170),u=n(288),s=n(289),c=n(57),f=1,l=2;t.exports=function(t,e){return a(t)&&u(e)?s(c(t),e):function(n){var a=o(n,t);return void 0===a&&a===e?i(n,t):r(e,a,f|l)}}},function(t,e,n){var r=n(284),o=n(523),i=n(170),a=n(57);t.exports=function(t){return i(t)?r(a(t)):o(t)}},function(t,e,n){var r=n(113);t.exports=function(t){return function(e){return r(e,t)}}},function(t,e){var n="Expected a function";t.exports=function(t){if("function"!=typeof t)throw new TypeError(n);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}},function(t,e){t.exports=function(t){return void 0===t}},function(t,e,n){var r=n(171),o=n(527);t.exports=function(t,e){return r(o(t,e),1)}},function(t,e,n){var r=n(81),o=n(42),i=n(292),a=n(14);t.exports=function(t,e){return(a(t)?r:i)(t,o(e,3))}},function(t,e,n){var r=n(529),o=n(83);t.exports=function(t,e){return t&&r(t,e,o)}},function(t,e,n){var r=n(530)();t.exports=r},function(t,e){t.exports=function(t){return function(e,n,r){for(var o=-1,i=Object(e),a=r(e),u=a.length;u--;){var s=a[t?u:++o];if(!1===n(i[s],s,i))break}return e}}},function(t,e,n){var r=n(55);t.exports=function(t,e){return function(n,o){if(null==n)return n;if(!r(n))return t(n,o);for(var i=n.length,a=e?i:-1,u=Object(n);(e?a--:++a<i)&&!1!==o(u[a],a,u););return n}}},function(t,e){t.exports=function(t,e,n,r){for(var o=-1,i=null==t?0:t.length;++o<i;){var a=t[o];e(r,a,n(a),t)}return r}},function(t,e,n){var r=n(293);t.exports=function(t,e,n,o){return r(t,function(t,r,i){e(o,t,n(t),i)}),o}},function(t,e,n){var r=n(81),o=n(42),i=n(292),a=n(535),u=n(112),s=n(536),c=n(114);t.exports=function(t,e,n){var f=-1;e=r(e.length?e:[c],u(o));var l=i(t,function(t,n,o){return{criteria:r(e,function(e){return e(t)}),index:++f,value:t}});return a(l,function(t,e){return s(t,e,n)})}},function(t,e){t.exports=function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}},function(t,e,n){var r=n(537);t.exports=function(t,e,n){for(var o=-1,i=t.criteria,a=e.criteria,u=i.length,s=n.length;++o<u;){var c=r(i[o],a[o]);if(c)return o>=s?c:c*("desc"==n[o]?-1:1)}return t.index-e.index}},function(t,e,n){var r=n(85);t.exports=function(t,e){if(t!==e){var n=void 0!==t,o=null===t,i=t==t,a=r(t),u=void 0!==e,s=null===e,c=e==e,f=r(e);if(!s&&!f&&!a&&t>e||a&&u&&c&&!s&&!f||o&&u&&c||!n&&c||!i)return 1;if(!o&&!a&&!f&&t<e||f&&n&&i&&!o&&!a||s&&n&&i||!u&&i||!c)return-1}return 0}},function(t,e,n){var r=n(114),o=n(280),i=n(281);t.exports=function(t,e){return i(o(t,e,r),t+"")}},function(t,e,n){var r=n(107),o=n(55),i=n(111),a=n(33);t.exports=function(t,e,n){if(!a(n))return!1;var u=typeof e;return!!("number"==u?o(n)&&i(e,n.length):"string"==u&&e in n)&&r(n[e],t)}},function(t,e,n){const r=n(541);t.exports={parallelMap:(t,e,n)=>{const o=[];return new r(function*(){for(let n of t)yield e(n).then(t=>o.push(t))},n=n||30).start().then(()=>o)}}},function(t,e,n){var r,o,i;o=[],void 0===(i="function"==typeof(r=function(){"use strict";var t=function(){this._listeners={}};t.prototype.addEventListener=function(t,e){this._listeners[t]=this._listeners[t]||[],this._listeners[t].indexOf(e)<0&&this._listeners[t].push(e)},t.prototype.removeEventListener=function(t,e){if(this._listeners[t]){var n=this._listeners[t].indexOf(e);n>=0&&this._listeners[t].splice(n,1)}},t.prototype.dispatchEvent=function(t){if(this._listeners[t.type]&&this._listeners[t.type].length)for(var e=this._listeners[t.type].slice(),n=0,r=e.length;n<r;++n)e[n].call(this,t)};var e=function(t){var e=!1;return{next:function(){return e?{done:!0}:(e=!0,{value:t})}}},n=function(t,e,n){this.target=t,this.type=e,this.data=n},r=function(n,r,o){if(t.call(this),"number"!=typeof r||Math.floor(r)!==r||r<1)throw new Error("Invalid concurrency");this._concurrency=r,this._options=o||{},this._options.promise=this._options.promise||Promise,this._iterator=function(t,n){var r,o=typeof t;if("object"===o){if("function"==typeof t.next)return t;if("function"==typeof t.then)return e(t)}return"function"===o?"function"==typeof(r=t).constructor&&"GeneratorFunction"===r.constructor.name?t():function(t){return{next:function(){var e=t();return e?{value:e}:{done:!0}}}}(t):e(n.resolve(t))}(n,this._options.promise),this._done=!1,this._size=0,this._promise=null,this._callbacks=null};return(r.prototype=new t).constructor=r,r.prototype.concurrency=function(t){return void 0!==t&&(this._concurrency=t,this.active()&&this._proceed()),this._concurrency},r.prototype.size=function(){return this._size},r.prototype.active=function(){return!!this._promise},r.prototype.promise=function(){return this._promise},r.prototype.start=function(){var t=this,e=this._options.promise;return this._promise=new e(function(e,n){t._callbacks={reject:n,resolve:e},t._proceed()}),this._promise},r.prototype._fireEvent=function(t,e){this.dispatchEvent(new n(this,t,e))},r.prototype._settle=function(t){t?this._callbacks.reject(t):this._callbacks.resolve(),this._promise=null,this._callbacks=null},r.prototype._onPooledPromiseFulfilled=function(t,e){this._size--,this.active()&&(this._fireEvent("fulfilled",{promise:t,result:e}),this._proceed())},r.prototype._onPooledPromiseRejected=function(t,e){this._size--,this.active()&&(this._fireEvent("rejected",{promise:t,error:e}),this._settle(e||new Error("Unknown error")))},r.prototype._trackPromise=function(t){var e=this;t.then(function(n){e._onPooledPromiseFulfilled(t,n)},function(n){e._onPooledPromiseRejected(t,n)}).catch(function(t){e._settle(new Error("Promise processing failed: "+t))})},r.prototype._proceed=function(){if(!this._done){for(var t={done:!1};this._size<this._concurrency&&!(t=this._iterator.next()).done;)this._size++,this._trackPromise(t.value);this._done=null===t||!!t.done}this._done&&0===this._size&&this._settle()},r.PromisePoolEvent=n,r.PromisePool=r,r})?r.apply(e,o):r)||(t.exports=i)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=U(n(116)),o=U(n(547)),i=U(n(121)),a=U(n(61)),u=U(n(567)),s=U(n(47)),c=U(n(94)),f=U(n(62)),l=U(n(4)),p=U(n(6)),d=U(n(7)),h=U(n(36)),v=U(n(48)),y=U(n(1)),g=U(n(2)),m=n(318),b=U(n(319)),x=n(125),w=n(323),_=n(367),k=n(49),O=n(712),j=U(O),S=n(851),E=U(n(865)),A=n(100),C=U(A),T=U(n(869)),P=n(192),M=U(n(882)),D=U(n(140)),R=U(n(883)),I=U(n(202)),z=U(n(884)),N=U(n(885)),L=U(n(887)),F=U(n(69)),B=U(n(889));function U(t){return t&&t.__esModule?t:{default:t}}var $=function(t){return Array.isArray(t)?t:[t]},q=function(t){return{get:function(e,n){return console.warn(t),e[n]}}},J=function(){function t(e){var n=e.link,r=e.links,o=e.schema,i=void 0===o?{}:o,a=e.appMetadata,u=void 0===a?{}:a,s=(0,v.default)(e,["link","links","schema","appMetadata"]);(0,y.default)(this,t),n&&console.warn("`link` is deprecated, use `links`"),this.appMetadata=u,this.options=s,this.idCounter=1,this.isLogged=!1,this.handleRevocationChange=this.handleRevocationChange.bind(this),this.handleTokenRefresh=this.handleTokenRefresh.bind(this),this.createClient(),this.links=$(n||r||new b.default),this.registerClientOnLinks(),this.chain=(0,P.chain)(this.links),this.schema=new T.default(i,this.getStackClient()),s.uri&&s.token&&this.login()}var e,n,B,U,J,V,G,H,Q,Y,W,K,Z;return(0,g.default)(t,[{key:"addSchema",value:function(t){this.schema.add(t)}},{key:"registerClientOnLinks",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,o=(0,h.default)(this.links);!(t=(r=o.next()).done);t=!0){var i=r.value;if(i.registerClient)try{i.registerClient(this)}catch(t){console.warn(t)}}}catch(t){e=!0,n=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw n}}}},{key:"login",value:function(t){return this.isLogged&&!this.isRevoked?(console.warn("CozyClient is already logged."),this.loginPromise):this.loginPromise=this._login(t)}},{key:"_login",value:(Z=(0,d.default)(p.default.mark(function t(e){var n,r,o,i,a,u;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.emit("beforeLogin"),this.registerClientOnLinks(),e&&(e.uri&&this.stackClient.setUri(e.uri),e.token&&this.stackClient.setToken(e.token)),n=!0,r=!1,o=void 0,t.prev=6,i=(0,h.default)(this.links);case 8:if(n=(a=i.next()).done){t.next=16;break}if(!(u=a.value).onLogin){t.next=13;break}return t.next=13,u.onLogin();case 13:n=!0,t.next=8;break;case 16:t.next=22;break;case 18:t.prev=18,t.t0=t.catch(6),r=!0,o=t.t0;case 22:t.prev=22,t.prev=23,!n&&i.return&&i.return();case 25:if(t.prev=25,!r){t.next=28;break}throw o;case 28:return t.finish(25);case 29:return t.finish(22);case 30:this.isLogged=!0,this.isRevoked=!1,this.emit("login");case 33:case"end":return t.stop()}},t,this,[[6,18,22,30],[23,,25,29]])})),function(t){return Z.apply(this,arguments)})},{key:"logout",value:(K=(0,d.default)(p.default.mark(function t(){var e,n,r,o,i,a;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isLogged){t.next=3;break}return console.warn("CozyClient isn't logged."),t.abrupt("return");case 3:if(this.emit("beforeLogout"),this.isLogged=!1,t.prev=5,!this.stackClient.unregister||this.stackClient.isRegistered&&!this.stackClient.isRegistered()){t.next=9;break}return t.next=9,this.stackClient.unregister();case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),console.warn("Impossible to unregister client on stack: "+t.t0);case 14:e=!0,n=!1,r=void 0,t.prev=17,o=(0,h.default)(this.links);case 19:if(e=(i=o.next()).done){t.next=33;break}if(!(a=i.value).reset){t.next=30;break}return t.prev=22,t.next=25,a.reset();case 25:t.next=30;break;case 27:t.prev=27,t.t1=t.catch(22),console.warn(t.t1);case 30:e=!0,t.next=19;break;case 33:t.next=39;break;case 35:t.prev=35,t.t2=t.catch(17),n=!0,r=t.t2;case 39:t.prev=39,t.prev=40,!e&&o.return&&o.return();case 42:if(t.prev=42,!n){t.next=45;break}throw r;case 45:return t.finish(42);case 46:return t.finish(39);case 47:this.emit("logout");case 48:case"end":return t.stop()}},t,this,[[5,11],[17,35,39,47],[22,27],[40,,42,46]])})),function(){return K.apply(this,arguments)})},{key:"collection",value:function(t){return this.getStackClient().collection(t)}},{key:"fetch",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.getStackClient().fetch(t,e,n,r)}},{key:"all",value:function(t){return new k.QueryDefinition({doctype:t})}},{key:"find",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return new k.QueryDefinition({doctype:t,selector:e})}},{key:"get",value:function(t,e){return new k.QueryDefinition({doctype:t,id:e})}},{key:"create",value:(W=(0,d.default)(p.default.mark(function t(e,n,r){n._type;var o,i=(0,v.default)(n,["_type"]),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=(0,l.default)({_type:e},i),t.next=3,this.schema.validate(o);case 3:if(!0===t.sent){t.next=6;break}throw new Error("Validation failed");case 6:return t.abrupt("return",this.mutate(this.getDocumentSavePlan(o,r),a));case 7:case"end":return t.stop()}},t,this)})),function(t,e,n){return W.apply(this,arguments)})},{key:"validate",value:function(t){return this.schema.validate(t)}},{key:"save",value:(Y=(0,d.default)(p.default.mark(function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.schema.validate(e);case 2:if(!0===t.sent){t.next=5;break}throw new Error("Validation failed");case 5:return t.abrupt("return",this.mutate(this.getDocumentSavePlan(e),n));case 6:case"end":return t.stop()}},t,this)})),function(t){return Y.apply(this,arguments)})},{key:"ensureCozyMetadata",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{event:"creation"},n=1;if(void 0===this.appMetadata)return t;var r=void 0;if(t._type){var o=this.schema.getDoctypeSchema(t._type);r=(0,F.default)(o,"doctypeVersion")}var i=this.appMetadata,a=i.slug,u=i.sourceAccount,s=i.version,c=(new Date).toISOString(),p=(0,F.default)(t,"cozyMetadata",{});return"creation"===e.event?p=(0,l.default)({metadataVersion:n,doctypeVersion:r,createdByApp:a,sourceAccount:u,createdAt:c,createdByAppVersion:s,updatedAt:c,updatedByApps:a?[{date:c,slug:a,version:s}]:[]},p):"update"===e.event&&(p=(0,l.default)({},p,{updatedAt:c,updatedByApps:[{date:c,slug:a,version:s}].concat((0,f.default)((0,F.default)(t,"cozyMetadata.updatedByApps",[]).filter(function(t){return t.slug!==a})))})),(0,l.default)({},t,{cozyMetadata:p})}},{key:"getDocumentSavePlan",value:function(t,e){var n=this,r=!t._rev,o=this.ensureCozyMetadata((0,_.dehydrate)(t),{event:r?"creation":"update"}),i=r?k.Mutations.createDocument(o):k.Mutations.updateDocument(o);if(!(e&&(0,c.default)(e).filter(function(t){return Array.isArray(t)?t.length>0:t}).length>0))return i;if(e&&!r)throw new Error("Unable to save relationships on a not-new document");return[i,function(t){var r=n.hydrateDocument(t.data);return(0,s.default)(e).map(function(t){var n=e[t];return Array.isArray(n)?r[t].insertDocuments(n):r[t].setDocument(n)})}]}},{key:"triggerHook",value:function(e,n){if(t.hooks){var r=(t.hooks[n._type]||{})[e]||[],o=!0,i=!1,a=void 0;try{for(var u,s=(0,h.default)(r);!(o=(u=s.next()).done);o=!0){(0,u.value)(this,n)}}catch(t){i=!0,a=t}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}}}},{key:"destroy",value:(Q=(0,d.default)(p.default.mark(function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.triggerHook("before:destroy",e);case 2:return t.next=4,this.mutate(k.Mutations.deleteDocument(e),r);case 4:return n=t.sent,t.next=7,this.triggerHook("after:destroy",e);case 7:return t.abrupt("return",n);case 8:case"end":return t.stop()}},t,this)})),function(t){return Q.apply(this,arguments)})},{key:"upload",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.mutate(k.Mutations.uploadFile(t,e),n)}},{key:"ensureQueryExists",value:function(t,e){this.ensureStore(),"loaded"===(0,A.getQueryFromState)(this.store.getState(),t).fetchStatus&&e.skip||this.dispatch((0,A.initQuery)(t,e))}},{key:"query",value:(H=(0,d.default)(p.default.mark(function t(e){var n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=o.update,a=(0,v.default)(o,["update"]);return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureStore(),n=a.as||this.generateId(),this.ensureQueryExists(n,e),t.prev=3,t.next=6,this.requestQuery(e);case 6:return r=t.sent,this.dispatch((0,A.receiveQueryResult)(n,r,{update:i})),t.abrupt("return",r);case 11:throw t.prev=11,t.t0=t.catch(3),this.dispatch((0,A.receiveQueryError)(n,t.t0)),t.t0;case 15:case"end":return t.stop()}},t,this,[[3,11]])})),function(t){return H.apply(this,arguments)})},{key:"queryAll",value:(G=(0,d.default)(p.default.mark(function t(e,n){var r,o;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=[],o={next:!0};case 2:if(!o||!o.next){t.next=9;break}return t.next=5,this.query(e.offset(r.length),n);case 5:o=t.sent,r.push.apply(r,(0,f.default)(o.data)),t.next=2;break;case 9:return t.abrupt("return",r);case 10:case"end":return t.stop()}},t,this)})),function(t,e){return G.apply(this,arguments)})},{key:"watchQuery",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.ensureStore();var n=e.as||this.generateId();return this.ensureQueryExists(n,t),new M.default(n,t,this)}},{key:"mutate",value:(V=(0,d.default)(p.default.mark(function t(e){var n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=o.update,a=o.updateQueries,u=(0,v.default)(o,["update","updateQueries"]);return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureStore(),n=u.as||this.generateId(),this.dispatch((0,A.initMutation)(n,e)),t.prev=3,t.next=6,this.requestMutation(e);case 6:return r=t.sent,this.dispatch((0,A.receiveMutationResult)(n,r,{update:i,updateQueries:a},e)),t.abrupt("return",r);case 11:throw t.prev=11,t.t0=t.catch(3),this.dispatch((0,A.receiveMutationError)(n,t.t0,e)),t.t0;case 15:case"end":return t.stop()}},t,this,[[3,11]])})),function(t){return V.apply(this,arguments)})},{key:"requestQuery",value:(J=(0,d.default)(p.default.mark(function t(e){var n,r;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.chain.request(e);case 2:if(n=t.sent,e.includes){t.next=5;break}return t.abrupt("return",n);case 5:return t.next=7,this.fetchRelationships(n,this.getIncludesRelationships(e));case 7:return r=t.sent,t.abrupt("return",r);case 9:case"end":return t.stop()}},t,this)})),function(t){return J.apply(this,arguments)})},{key:"fetchRelationships",value:(U=(0,d.default)(p.default.mark(function t(e,n){var r,o,s,c,f,d,v,y,g,m,b,x,_,O,j,S,A,C,T,P,M,D,R,F=this;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((r=!Array.isArray(e.data))||0!==e.data.length){t.next=3;break}return t.abrupt("return",e);case 3:return o=r?[e.data]:e.data,s=new u.default,c=[],f=[],o.forEach(function(t){return(0,L.default)(n,function(e,n){var r=e.type.query(t,F,e),o=t._id;s.set(r,[o,n]),r instanceof k.QueryDefinition?f.push(r):c.push(r)})}),d=(0,E.default)(f),t.next=11,a.default.all(d.map(function(t){return F.chain.request(t)}));case 11:for(v=t.sent,y=(0,z.default)((0,I.default)(c),"_id"),g=(0,I.default)(v.map(function(t){return t.included||t.data})).concat(y).filter(Boolean),m={},b=!0,x=!1,_=void 0,t.prev=18,O=(0,h.default)((0,N.default)(d,v));!(b=(j=O.next()).done);b=!0)S=j.value,A=(0,i.default)(S,2),C=A[0],T=A[1],(P=s.get(C))&&(M=(0,i.default)(P,2),D=M[0],R=M[1],m[D]=m[D]||{},m[D][R]=(0,w.responseToRelationship)(T));t.next=26;break;case 22:t.prev=22,t.t0=t.catch(18),x=!0,_=t.t0;case 26:t.prev=26,t.prev=27,!b&&O.return&&O.return();case 29:if(t.prev=29,!x){t.next=32;break}throw _;case 32:return t.finish(29);case 33:return t.finish(26);case 34:return t.abrupt("return",(0,l.default)({},(0,w.attachRelationships)(e,m),{included:g}));case 35:case"end":return t.stop()}},t,this,[[18,22,26,34],[27,,29,33]])})),function(t,e){return U.apply(this,arguments)})},{key:"requestMutation",value:(B=(0,d.default)(p.default.mark(function t(e){var n,r,i,u,s=this;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!Array.isArray(e)){t.next=8;break}return n=(0,o.default)(e),r=n[0],i=n.slice(1),t.next=4,this.requestMutation(r);case 4:return u=t.sent,t.next=7,a.default.all(i.map(function(t){return"function"==typeof t?s.requestMutation(t(u)):s.requestMutation(t)}));case 7:return t.abrupt("return",u);case 8:return t.abrupt("return",this.chain.request(e));case 9:case"end":return t.stop()}},t,this)})),function(t){return B.apply(this,arguments)})},{key:"getIncludesRelationships",value:function(t){var e=this,n=t.includes,r=t.doctype;return n?(0,R.default)(n.map(function(t){return[t,e.schema.getRelationship(r,t)]})):{}}},{key:"hydrateDocuments",value:function(t,e){var n=this;if(!1===this.options.autoHydrate)return e;var r=this.schema.getDoctypeSchema(t);return r.relationships?e.map(function(t){return n.hydrateDocument(t,r)}):e}},{key:"hydrateDocument",value:function(t,e){return t?(e=e||this.schema.getDoctypeSchema(t._type),(0,l.default)({},t,this.hydrateRelationships(t,e.relationships))):t}},{key:"hydrateRelationships",value:function(t,e){var n=this.getRelationshipStoreAccessors();return(0,D.default)(e,function(e,r){return(0,x.create)(t,e,n)})}},{key:"makeNewDocument",value:function(t){var e={_type:t};return this.hydrateDocument(e)}},{key:"getAssociation",value:function(t,e){return(0,x.create)(t,this.schema.getAssociation(t._type,e),this.getRelationshipStoreAccessors())}},{key:"getRelationshipStoreAccessors",value:function(){var t=this;return this.storeAccesors||(this.storeAccessors={get:this.getDocumentFromState.bind(this),save:function(e,n){return t.save.call(t,e,n)},dispatch:this.dispatch.bind(this),query:function(e,n){return t.query.call(t,e,n)},mutate:function(e,n){return t.mutate.call(t,e,n)}}),this.storeAccessors}},{key:"getCollectionFromState",value:function(t){try{return(0,A.getCollectionFromState)(this.store.getState(),t)}catch(e){return console.warn("Could not getCollectionFromState",t,e.message),null}}},{key:"getDocumentFromState",value:function(t,e){try{return(0,A.getDocumentFromState)(this.store.getState(),t,e)}catch(n){return console.warn("Could not getDocumentFromState",t,e,n.message),null}}},{key:"register",value:function(t){return this.getStackClient().setUri(t),this.startOAuthFlow(S.authenticateWithCordova)}},{key:"startOAuthFlow",value:(n=(0,d.default)(p.default.mark(function t(e){var n;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getStackClient(),t.next=3,n.register();case 3:return t.abrupt("return",this.authorize(e));case 4:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"authorize",value:(e=(0,d.default)(p.default.mark(function t(e){var n,r,o,i,a,u;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=this.getStackClient(),r=n.generateStateCode(),o=n.getAuthCodeURL(r),t.next=6,e(o);case 6:return i=t.sent,a=n.getAccessCodeFromURL(i,r),t.next=10,n.fetchAccessToken(a);case 10:return u=t.sent,n.setToken(u),t.abrupt("return",{token:u,infos:n.oauthOptions,client:n.oauthOptions});case 15:throw t.prev=15,t.t0=t.catch(0),t.t0.message===m.REGISTRATION_ABORT&&this.getStackClient().unregister(),t.t0;case 19:case"end":return t.stop()}},t,this,[[0,15]])})),function(t){return e.apply(this,arguments)})},{key:"renewAuthorization",value:function(){return this.authorize(S.authenticateWithCordova)}},{key:"setStore",value:function(t){if(void 0===t)throw new Error("Store is undefined");this.store=t}},{key:"ensureStore",value:function(){this.store||this.setStore((0,A.createStore)())}},{key:"handleRevocationChange",value:function(t){t?(this.isRevoked=!0,this.emit("revoked")):(this.isRevoked=!1,this.emit("unrevoked"))}},{key:"handleTokenRefresh",value:function(t){this.emit("tokenRefreshed"),this.options.onTokenRefresh&&(q("Using onTokenRefresh is deprecated, please use events like this: cozyClient.on('tokenUpdated', token => console.log('Token is updated', token)). https://git.io/fj3M3"),this.options.onTokenRefresh(t))}},{key:"createClient",value:function(){this.options.client&&console.warn("CozyClient: Using options.client is deprecated, please use options.stackClient.");var t=void 0===this.options.warningForCustomHandlers||this.options.warningForCustomHandlers,e=this.options.client||this.options.stackClient,n={onRevocationChange:this.handleRevocationChange,onTokenRefresh:this.handleTokenRefresh};if(e){this.stackClient=e,e.options||(e.options={});var r=!0,o=!1,i=void 0;try{for(var a,u=(0,h.default)((0,s.default)(n));!(r=(a=u.next()).done);r=!0){var c=a.value;e.options[c]?t&&console.warn("You passed a stackClient with its own "+c+". It is not supported, unexpected things might happen."):e.options[c]=n[c]}}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}}else{var f=(0,l.default)({},this.options,n);this.stackClient=this.options.oauth?new O.OAuthClient(f):new j.default(f)}this.client=new Proxy(this.stackClient,q("Using cozyClient.client is deprecated, please use cozyClient.stackClient."))}},{key:"getClient",value:function(){return console.warn("CozyClient: getClient() is deprecated, please use getStackClient()."),this.getStackClient()}},{key:"getStackClient",value:function(){return this.stackClient||this.createClient(),this.stackClient}},{key:"reducer",value:function(){return C.default}},{key:"dispatch",value:function(t){return this.store.dispatch(t)}},{key:"generateId",value:function(){var t=this.idCounter;return this.idCounter++,t}},{key:"setData",value:function(t){var e=this;this.ensureStore(),(0,r.default)(t).forEach(function(t){var n=(0,i.default)(t,2),r=(n[0],n[1]);e.dispatch((0,A.receiveQueryResult)(null,{data:r}))})}}],[{key:"fromEnv",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e=e||("undefined"!=typeof process?process.env:{}),o=r.COZY_URL,i=r.COZY_CREDENTIALS,a=r.NODE_ENV;if(!o||!i)throw new Error("Env used to instantiate CozyClient must have COZY_URL and COZY_CREDENTIALS");return"development"===a?n.oauth=JSON.parse(i):n.token=i.trim(),n.uri=o.trim(),new t((0,l.default)({},n))}},{key:"registerHook",value:function(e,n,r){t.hooks=t.hooks||{};var o=t.hooks[e]=t.hooks[e]||{};o[n]=o[n]||[],o[n].push(r)}}]),t}();B.default.mixin(J),e.default=J},function(t,e,n){n(544),t.exports=n(3).Object.entries},function(t,e,n){var r=n(5),o=n(296)(!0);r(r.S,"Object",{entries:function(t){return o(t)}})},function(t,e,n){var r=n(35),o=n(117),i=n(546);t.exports=function(t){return function(e,n,a){var u,s=r(e),c=o(s.length),f=i(a,c);if(t&&n!=n){for(;c>f;)if((u=s[f++])!=u)return!0}else for(;c>f;f++)if((t||f in s)&&s[f]===n)return t||f||0;return!t&&-1}}},function(t,e,n){var r=n(177),o=Math.max,i=Math.min;t.exports=function(t,e){return(t=r(t))<0?o(t+e,0):i(t,e)}},function(t,e,n){"use strict";e.__esModule=!0;var r,o=n(181),i=(r=o)&&r.__esModule?r:{default:r};e.default=function(t){return Array.isArray(t)?t:(0,i.default)(t)}},function(t,e,n){n(45),n(551),t.exports=n(3).Array.from},function(t,e,n){var r=n(177),o=n(176);t.exports=function(t){return function(e,n){var i,a,u=String(o(e)),s=r(n),c=u.length;return s<0||s>=c?t?"":void 0:(i=u.charCodeAt(s))<55296||i>56319||s+1===c||(a=u.charCodeAt(s+1))<56320||a>57343?t?u.charAt(s):i:t?u.slice(s,s+2):a-56320+(i-55296<<10)+65536}}},function(t,e,n){"use strict";var r=n(119),o=n(88),i=n(92),a={};n(34)(a,n(11)("iterator"),function(){return this}),t.exports=function(t,e,n){t.prototype=r(a,{next:o(1,n)}),i(t,e+" Iterator")}},function(t,e,n){"use strict";var r=n(30),o=n(5),i=n(46),a=n(302),u=n(303),s=n(117),c=n(552),f=n(183);o(o.S+o.F*!n(304)(function(t){Array.from(t)}),"Array",{from:function(t){var e,n,o,l,p=i(t),d="function"==typeof this?this:Array,h=arguments.length,v=h>1?arguments[1]:void 0,y=void 0!==v,g=0,m=f(p);if(y&&(v=r(v,h>2?arguments[2]:void 0,2)),null==m||d==Array&&u(m))for(n=new d(e=s(p.length));e>g;g++)c(n,g,y?v(p[g],g):p[g]);else for(l=m.call(p),n=new d;!(o=l.next()).done;g++)c(n,g,y?a(l,v,[o.value,g],!0):o.value);return n.length=g,n}})},function(t,e,n){"use strict";var r=n(19),o=n(88);t.exports=function(t,e,n){e in t?r.f(t,e,o(0,n)):t[e]=n}},function(t,e,n){t.exports={default:n(554),__esModule:!0}},function(t,e,n){n(60),n(45),t.exports=n(557)},function(t,e,n){"use strict";var r=n(556),o=n(305),i=n(59),a=n(35);t.exports=n(182)(Array,"Array",function(t,e){this._t=a(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,o(1)):o(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(t,e){t.exports=function(){}},function(t,e,n){var r=n(120),o=n(11)("iterator"),i=n(59);t.exports=n(3).isIterable=function(t){var e=Object(t);return void 0!==e[o]||"@@iterator"in e||i.hasOwnProperty(r(e))}},function(t,e,n){n(60),n(45),t.exports=n(559)},function(t,e,n){var r=n(24),o=n(183);t.exports=n(3).getIterator=function(t){var e=o(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return r(e.call(t))}},function(t,e,n){n(122),n(45),n(60),n(561),n(565),n(566),t.exports=n(3).Promise},function(t,e,n){"use strict";var r,o,i,a,u=n(90),s=n(10),c=n(30),f=n(120),l=n(5),p=n(17),d=n(87),h=n(184),v=n(93),y=n(306),g=n(307).set,m=n(563)(),b=n(185),x=n(308),w=n(564),_=n(309),k=s.TypeError,O=s.process,j=O&&O.versions,S=j&&j.v8||"",E=s.Promise,A="process"==f(O),C=function(){},T=o=b.f,P=!!function(){try{var t=E.resolve(1),e=(t.constructor={})[n(11)("species")]=function(t){t(C,C)};return(A||"function"==typeof PromiseRejectionEvent)&&t.then(C)instanceof e&&0!==S.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(t){}}(),M=function(t){var e;return!(!p(t)||"function"!=typeof(e=t.then))&&e},D=function(t,e){if(!t._n){t._n=!0;var n=t._c;m(function(){for(var r=t._v,o=1==t._s,i=0,a=function(e){var n,i,a,u=o?e.ok:e.fail,s=e.resolve,c=e.reject,f=e.domain;try{u?(o||(2==t._h&&z(t),t._h=1),!0===u?n=r:(f&&f.enter(),n=u(r),f&&(f.exit(),a=!0)),n===e.promise?c(k("Promise-chain cycle")):(i=M(n))?i.call(n,s,c):s(n)):c(r)}catch(t){f&&!a&&f.exit(),c(t)}};n.length>i;)a(n[i++]);t._c=[],t._n=!1,e&&!t._h&&R(t)})}},R=function(t){g.call(s,function(){var e,n,r,o=t._v,i=I(t);if(i&&(e=x(function(){A?O.emit("unhandledRejection",o,t):(n=s.onunhandledrejection)?n({promise:t,reason:o}):(r=s.console)&&r.error&&r.error("Unhandled promise rejection",o)}),t._h=A||I(t)?2:1),t._a=void 0,i&&e.e)throw e.v})},I=function(t){return 1!==t._h&&0===(t._a||t._c).length},z=function(t){g.call(s,function(){var e;A?O.emit("rejectionHandled",t):(e=s.onrejectionhandled)&&e({promise:t,reason:t._v})})},N=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),D(e,!0))},L=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw k("Promise can't be resolved itself");(e=M(t))?m(function(){var r={_w:n,_d:!1};try{e.call(t,c(L,r,1),c(N,r,1))}catch(t){N.call(r,t)}}):(n._v=t,n._s=1,D(n,!1))}catch(t){N.call({_w:n,_d:!1},t)}}};P||(E=function(t){h(this,E,"Promise","_h"),d(t),r.call(this);try{t(c(L,this,1),c(N,this,1))}catch(t){N.call(this,t)}},(r=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(186)(E.prototype,{then:function(t,e){var n=T(y(this,E));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=A?O.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&D(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),i=function(){var t=new r;this.promise=t,this.resolve=c(L,t,1),this.reject=c(N,t,1)},b.f=T=function(t){return t===E||t===a?new i(t):o(t)}),l(l.G+l.W+l.F*!P,{Promise:E}),n(92)(E,"Promise"),n(310)("Promise"),a=n(3).Promise,l(l.S+l.F*!P,"Promise",{reject:function(t){var e=T(this);return(0,e.reject)(t),e.promise}}),l(l.S+l.F*(u||!P),"Promise",{resolve:function(t){return _(u&&this===a?E:this,t)}}),l(l.S+l.F*!(P&&n(304)(function(t){E.all(t).catch(C)})),"Promise",{all:function(t){var e=this,n=T(e),r=n.resolve,o=n.reject,i=x(function(){var n=[],i=0,a=1;v(t,!1,function(t){var u=i++,s=!1;n.push(void 0),a++,e.resolve(t).then(function(t){s||(s=!0,n[u]=t,--a||r(n))},o)}),--a||r(n)});return i.e&&o(i.v),n.promise},race:function(t){var e=this,n=T(e),r=n.reject,o=x(function(){v(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return o.e&&r(o.v),n.promise}})},function(t,e){t.exports=function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}return t.apply(n,e)}},function(t,e,n){var r=n(10),o=n(307).set,i=r.MutationObserver||r.WebKitMutationObserver,a=r.process,u=r.Promise,s="process"==n(89)(a);t.exports=function(){var t,e,n,c=function(){var r,o;for(s&&(r=a.domain)&&r.exit();t;){o=t.fn,t=t.next;try{o()}catch(r){throw t?n():e=void 0,r}}e=void 0,r&&r.enter()};if(s)n=function(){a.nextTick(c)};else if(!i||r.navigator&&r.navigator.standalone)if(u&&u.resolve){var f=u.resolve(void 0);n=function(){f.then(c)}}else n=function(){o.call(r,c)};else{var l=!0,p=document.createTextNode("");new i(c).observe(p,{characterData:!0}),n=function(){p.data=l=!l}}return function(r){var o={fn:r,next:void 0};e&&(e.next=o),t||(t=o,n()),e=o}}},function(t,e,n){var r=n(10).navigator;t.exports=r&&r.userAgent||""},function(t,e,n){"use strict";var r=n(5),o=n(3),i=n(10),a=n(306),u=n(309);r(r.P+r.R,"Promise",{finally:function(t){var e=a(this,o.Promise||i.Promise),n="function"==typeof t;return this.then(n?function(n){return u(e,t()).then(function(){return n})}:t,n?function(n){return u(e,t()).then(function(){throw n})}:t)}})},function(t,e,n){"use strict";var r=n(5),o=n(185),i=n(308);r(r.S,"Promise",{try:function(t){var e=o.f(this),n=i(t);return(n.e?e.reject:e.resolve)(n.v),e.promise}})},function(t,e,n){t.exports={default:n(568),__esModule:!0}},function(t,e,n){n(122),n(45),n(60),n(569),n(573),n(575),n(576),t.exports=n(3).Map},function(t,e,n){"use strict";var r=n(311),o=n(187);t.exports=n(312)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=r.getEntry(o(this,"Map"),t);return e&&e.v},set:function(t,e){return r.def(o(this,"Map"),0===t?0:t,e)}},r,!0)},function(t,e,n){var r=n(30),o=n(175),i=n(46),a=n(117),u=n(571);t.exports=function(t,e){var n=1==t,s=2==t,c=3==t,f=4==t,l=6==t,p=5==t||l,d=e||u;return function(e,u,h){for(var v,y,g=i(e),m=o(g),b=r(u,h,3),x=a(m.length),w=0,_=n?d(e,x):s?d(e,0):void 0;x>w;w++)if((p||w in m)&&(y=b(v=m[w],w,g),t))if(n)_[w]=y;else if(y)switch(t){case 3:return!0;case 5:return v;case 6:return w;case 2:_.push(v)}else if(f)return!1;return l?-1:c||f?f:_}}},function(t,e,n){var r=n(572);t.exports=function(t,e){return new(r(t))(e)}},function(t,e,n){var r=n(17),o=n(313),i=n(11)("species");t.exports=function(t){var e;return o(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!o(e.prototype)||(e=void 0),r(e)&&null===(e=e[i])&&(e=void 0)),void 0===e?Array:e}},function(t,e,n){var r=n(5);r(r.P+r.R,"Map",{toJSON:n(314)("Map")})},function(t,e,n){var r=n(93);t.exports=function(t,e){var n=[];return r(t,!1,n.push,n,e),n}},function(t,e,n){n(315)("Map")},function(t,e,n){n(316)("Map")},function(t,e,n){n(578),t.exports=n(3).Object.keys},function(t,e,n){var r=n(46),o=n(58);n(124)("keys",function(){return function(t){return o(r(t))}})},function(t,e,n){n(580),t.exports=n(3).Object.values},function(t,e,n){var r=n(5),o=n(296)(!1);r(r.S,"Object",{values:function(t){return o(t)}})},function(t,e,n){t.exports={default:n(582),__esModule:!0}},function(t,e,n){n(583),t.exports=n(3).Object.assign},function(t,e,n){var r=n(5);r(r.S+r.F,"Object",{assign:n(584)})},function(t,e,n){"use strict";var r=n(15),o=n(58),i=n(188),a=n(91),u=n(46),s=n(175),c=Object.assign;t.exports=!c||n(43)(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=c({},t)[n]||Object.keys(c({},e)).join("")!=r})?function(t,e){for(var n=u(t),c=arguments.length,f=1,l=i.f,p=a.f;c>f;)for(var d,h=s(arguments[f++]),v=l?o(h).concat(l(h)):o(h),y=v.length,g=0;y>g;)d=v[g++],r&&!p.call(h,d)||(n[d]=h[d]);return n}:c},function(t,e,n){var r=function(){return this}()||Function("return this")(),o=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,i=o&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,t.exports=n(586),o)r.regeneratorRuntime=i;else try{delete r.regeneratorRuntime}catch(t){r.regeneratorRuntime=void 0}},function(t,e){!function(e){"use strict";var n,r=Object.prototype,o=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag",c="object"==typeof t,f=e.regeneratorRuntime;if(f)c&&(t.exports=f);else{(f=e.regeneratorRuntime=c?t.exports:{}).wrap=x;var l="suspendedStart",p="suspendedYield",d="executing",h="completed",v={},y={};y[a]=function(){return this};var g=Object.getPrototypeOf,m=g&&g(g(P([])));m&&m!==r&&o.call(m,a)&&(y=m);var b=O.prototype=_.prototype=Object.create(y);k.prototype=b.constructor=O,O.constructor=k,O[s]=k.displayName="GeneratorFunction",f.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===k||"GeneratorFunction"===(e.displayName||e.name))},f.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,O):(t.__proto__=O,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(b),t},f.awrap=function(t){return{__await:t}},j(S.prototype),S.prototype[u]=function(){return this},f.AsyncIterator=S,f.async=function(t,e,n,r){var o=new S(x(t,e,n,r));return f.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},j(b),b[s]="Generator",b[a]=function(){return this},b.toString=function(){return"[object Generator]"},f.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},f.values=P,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(C),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,o){return u.type="throw",u.arg=t,e.next=r,o&&(e.method="next",e.arg=n),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),C(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;C(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:P(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=n),v}}}function x(t,e,n,r){var o=e&&e.prototype instanceof _?e:_,i=Object.create(o.prototype),a=new T(r||[]);return i._invoke=function(t,e,n){var r=l;return function(o,i){if(r===d)throw new Error("Generator is already running");if(r===h){if("throw"===o)throw i;return M()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var u=E(a,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var s=w(t,e,n);if("normal"===s.type){if(r=n.done?h:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r=h,n.method="throw",n.arg=s.arg)}}}(t,n,a),i}function w(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function _(){}function k(){}function O(){}function j(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function S(t){var e;this._invoke=function(n,r){function i(){return new Promise(function(e,i){!function e(n,r,i,a){var u=w(t[n],t,r);if("throw"!==u.type){var s=u.arg,c=s.value;return c&&"object"==typeof c&&o.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,i,a)},function(t){e("throw",t,i,a)}):Promise.resolve(c).then(function(t){s.value=t,i(s)},a)}a(u.arg)}(n,r,e,i)})}return e=e?e.then(i,i):i()}}function E(t,e){var r=t.iterator[e.method];if(r===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=n,E(t,e),"throw"===e.method))return v;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=w(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,v;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=n),e.delegate=null,v):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,v)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function P(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(o.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=n,e.done=!0,e};return i.next=i}}return{next:M}}function M(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},function(t,e,n){n(588);var r=n(3).Object;t.exports=function(t,e,n){return r.defineProperty(t,e,n)}},function(t,e,n){var r=n(5);r(r.S+r.F*!n(15),"Object",{defineProperty:n(19).f})},function(t,e,n){n(590),t.exports=n(3).Object.getPrototypeOf},function(t,e,n){var r=n(46),o=n(301);n(124)("getPrototypeOf",function(){return function(t){return o(r(t))}})},function(t,e,n){t.exports={default:n(592),__esModule:!0}},function(t,e,n){n(45),n(60),t.exports=n(189).f("iterator")},function(t,e,n){t.exports={default:n(594),__esModule:!0}},function(t,e,n){n(595),n(122),n(598),n(599),t.exports=n(3).Symbol},function(t,e,n){"use strict";var r=n(10),o=n(44),i=n(15),a=n(5),u=n(298),s=n(123).KEY,c=n(43),f=n(179),l=n(92),p=n(118),d=n(11),h=n(189),v=n(190),y=n(596),g=n(313),m=n(24),b=n(17),x=n(46),w=n(35),_=n(174),k=n(88),O=n(119),j=n(597),S=n(191),E=n(188),A=n(19),C=n(58),T=S.f,P=A.f,M=j.f,D=r.Symbol,R=r.JSON,I=R&&R.stringify,z=d("_hidden"),N=d("toPrimitive"),L={}.propertyIsEnumerable,F=f("symbol-registry"),B=f("symbols"),U=f("op-symbols"),$=Object.prototype,q="function"==typeof D&&!!E.f,J=r.QObject,V=!J||!J.prototype||!J.prototype.findChild,G=i&&c(function(){return 7!=O(P({},"a",{get:function(){return P(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=T($,e);r&&delete $[e],P(t,e,n),r&&t!==$&&P($,e,r)}:P,H=function(t){var e=B[t]=O(D.prototype);return e._k=t,e},Q=q&&"symbol"==typeof D.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof D},Y=function(t,e,n){return t===$&&Y(U,e,n),m(t),e=_(e,!0),m(n),o(B,e)?(n.enumerable?(o(t,z)&&t[z][e]&&(t[z][e]=!1),n=O(n,{enumerable:k(0,!1)})):(o(t,z)||P(t,z,k(1,{})),t[z][e]=!0),G(t,e,n)):P(t,e,n)},W=function(t,e){m(t);for(var n,r=y(e=w(e)),o=0,i=r.length;i>o;)Y(t,n=r[o++],e[n]);return t},K=function(t){var e=L.call(this,t=_(t,!0));return!(this===$&&o(B,t)&&!o(U,t))&&(!(e||!o(this,t)||!o(B,t)||o(this,z)&&this[z][t])||e)},Z=function(t,e){if(t=w(t),e=_(e,!0),t!==$||!o(B,e)||o(U,e)){var n=T(t,e);return!n||!o(B,e)||o(t,z)&&t[z][e]||(n.enumerable=!0),n}},X=function(t){for(var e,n=M(w(t)),r=[],i=0;n.length>i;)o(B,e=n[i++])||e==z||e==s||r.push(e);return r},tt=function(t){for(var e,n=t===$,r=M(n?U:w(t)),i=[],a=0;r.length>a;)!o(B,e=r[a++])||n&&!o($,e)||i.push(B[e]);return i};q||(u((D=function(){if(this instanceof D)throw TypeError("Symbol is not a constructor!");var t=p(arguments.length>0?arguments[0]:void 0),e=function(n){this===$&&e.call(U,n),o(this,z)&&o(this[z],t)&&(this[z][t]=!1),G(this,t,k(1,n))};return i&&V&&G($,t,{configurable:!0,set:e}),H(t)}).prototype,"toString",function(){return this._k}),S.f=Z,A.f=Y,n(320).f=j.f=X,n(91).f=K,E.f=tt,i&&!n(90)&&u($,"propertyIsEnumerable",K,!0),h.f=function(t){return H(d(t))}),a(a.G+a.W+a.F*!q,{Symbol:D});for(var et="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),nt=0;et.length>nt;)d(et[nt++]);for(var rt=C(d.store),ot=0;rt.length>ot;)v(rt[ot++]);a(a.S+a.F*!q,"Symbol",{for:function(t){return o(F,t+="")?F[t]:F[t]=D(t)},keyFor:function(t){if(!Q(t))throw TypeError(t+" is not a symbol!");for(var e in F)if(F[e]===t)return e},useSetter:function(){V=!0},useSimple:function(){V=!1}}),a(a.S+a.F*!q,"Object",{create:function(t,e){return void 0===e?O(t):W(O(t),e)},defineProperty:Y,defineProperties:W,getOwnPropertyDescriptor:Z,getOwnPropertyNames:X,getOwnPropertySymbols:tt});var it=c(function(){E.f(1)});a(a.S+a.F*it,"Object",{getOwnPropertySymbols:function(t){return E.f(x(t))}}),R&&a(a.S+a.F*(!q||c(function(){var t=D();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){for(var e,n,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);if(n=e=r[1],(b(e)||void 0!==t)&&!Q(t))return g(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!Q(e))return e}),r[1]=e,I.apply(R,r)}}),D.prototype[N]||n(34)(D.prototype,N,D.prototype.valueOf),l(D,"Symbol"),l(Math,"Math",!0),l(r.JSON,"JSON",!0)},function(t,e,n){var r=n(58),o=n(188),i=n(91);t.exports=function(t){var e=r(t),n=o.f;if(n)for(var a,u=n(t),s=i.f,c=0;u.length>c;)s.call(t,a=u[c++])&&e.push(a);return e}},function(t,e,n){var r=n(35),o=n(320).f,i={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return a&&"[object Window]"==i.call(t)?function(t){try{return o(t)}catch(t){return a.slice()}}(t):o(r(t))}},function(t,e,n){n(190)("asyncIterator")},function(t,e,n){n(190)("observable")},function(t,e,n){t.exports={default:n(601),__esModule:!0}},function(t,e,n){n(602),t.exports=n(3).Object.setPrototypeOf},function(t,e,n){var r=n(5);r(r.S,"Object",{setPrototypeOf:n(603).set})},function(t,e,n){var r=n(17),o=n(24),i=function(t,e){if(o(t),!r(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,r){try{(r=n(30)(Function.call,n(191).f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,n){return i(t,n),e?t.__proto__=n:r(t,n),t}}({},!1):void 0),check:i}},function(t,e,n){t.exports={default:n(605),__esModule:!0}},function(t,e,n){n(606);var r=n(3).Object;t.exports=function(t,e){return r.create(t,e)}},function(t,e,n){var r=n(5);r(r.S,"Object",{create:n(119)})},function(t,e,n){var r=n(64),o=Object.prototype,i=o.hasOwnProperty,a=o.toString,u=r?r.toStringTag:void 0;t.exports=function(t){var e=i.call(t,u),n=t[u];try{t[u]=void 0;var r=!0}catch(t){}var o=a.call(t);return r&&(e?t[u]=n:delete t[u]),o}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e,n){var r=n(3),o=r.JSON||(r.JSON={stringify:JSON.stringify});t.exports=function(t){return o.stringify.apply(o,arguments)}},function(t,e,n){var r=n(611),o=n(201)(function(t,e){return null==t?{}:r(t,e)});t.exports=o},function(t,e,n){var r=n(324),o=n(328);t.exports=function(t,e){return r(t,e,function(e,n){return o(t,n)})}},function(t,e,n){var r=n(613),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,a=r(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(o,function(t,n,r,o){e.push(r?o.replace(i,"$1"):n||t)}),e});t.exports=a},function(t,e,n){var r=n(614),o=500;t.exports=function(t){var e=r(t,function(t){return n.size===o&&n.clear(),t}),n=e.cache;return e}},function(t,e,n){var r=n(196),o="Expected a function";function i(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(o);var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var a=t.apply(this,r);return n.cache=i.set(o,a)||i,a};return n.cache=new(i.Cache||r),n}i.Cache=r,t.exports=i},function(t,e,n){var r=n(616),o=n(128),i=n(198);t.exports=function(){this.size=0,this.__data__={hash:new r,map:new(i||o),string:new r}}},function(t,e,n){var r=n(617),o=n(622),i=n(623),a=n(624),u=n(625);function s(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=a,s.prototype.set=u,t.exports=s},function(t,e,n){var r=n(127);t.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(t,e,n){var r=n(197),o=n(619),i=n(26),a=n(325),u=/^\[object .+?Constructor\]$/,s=Function.prototype,c=Object.prototype,f=s.toString,l=c.hasOwnProperty,p=RegExp("^"+f.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!i(t)||o(t))&&(r(t)?p:u).test(a(t))}},function(t,e,n){var r,o=n(620),i=(r=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";t.exports=function(t){return!!i&&i in t}},function(t,e,n){var r=n(25)["__core-js_shared__"];t.exports=r},function(t,e){t.exports=function(t,e){return null==t?void 0:t[e]}},function(t,e){t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},function(t,e,n){var r=n(127),o="__lodash_hash_undefined__",i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(r){var n=e[t];return n===o?void 0:n}return i.call(e,t)?e[t]:void 0}},function(t,e,n){var r=n(127),o=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return r?void 0!==e[t]:o.call(e,t)}},function(t,e,n){var r=n(127),o="__lodash_hash_undefined__";t.exports=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=r&&void 0===e?o:e,this}},function(t,e){t.exports=function(){this.__data__=[],this.size=0}},function(t,e,n){var r=n(129),o=Array.prototype.splice;t.exports=function(t){var e=this.__data__,n=r(e,t);return!(n<0)&&(n==e.length-1?e.pop():o.call(e,n,1),--this.size,!0)}},function(t,e,n){var r=n(129);t.exports=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]}},function(t,e,n){var r=n(129);t.exports=function(t){return r(this.__data__,t)>-1}},function(t,e,n){var r=n(129);t.exports=function(t,e){var n=this.__data__,o=r(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this}},function(t,e,n){var r=n(130);t.exports=function(t){var e=r(this,t).delete(t);return this.size-=e?1:0,e}},function(t,e){t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},function(t,e,n){var r=n(130);t.exports=function(t){return r(this,t).get(t)}},function(t,e,n){var r=n(130);t.exports=function(t){return r(this,t).has(t)}},function(t,e,n){var r=n(130);t.exports=function(t,e){var n=r(this,t),o=n.size;return n.set(t,e),this.size+=n.size==o?0:1,this}},function(t,e,n){var r=n(637);t.exports=function(t){return null==t?"":r(t)}},function(t,e,n){var r=n(64),o=n(37),i=n(9),a=n(195),u=1/0,s=r?r.prototype:void 0,c=s?s.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(i(e))return o(e,t)+"";if(a(e))return c?c.call(e):"";var n=e+"";return"0"==n&&1/e==-u?"-0":n}},function(t,e){t.exports=function(t,e){return null!=t&&e in Object(t)}},function(t,e,n){var r=n(65),o=n(132),i=n(9),a=n(131),u=n(200),s=n(66);t.exports=function(t,e,n){for(var c=-1,f=(e=r(e,t)).length,l=!1;++c<f;){var p=s(e[c]);if(!(l=null!=t&&n(t,p)))break;t=t[p]}return l||++c!=f?l:!!(f=null==t?0:t.length)&&u(f)&&a(p,f)&&(i(t)||o(t))}},function(t,e,n){var r=n(50),o=n(20),i="[object Arguments]";t.exports=function(t){return o(t)&&r(t)==i}},function(t,e,n){var r=n(64),o=n(132),i=n(9),a=r?r.isConcatSpreadable:void 0;t.exports=function(t){return i(t)||o(t)||!!(a&&t&&t[a])}},function(t,e){t.exports=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}},function(t,e,n){var r=n(644),o=n(327),i=n(133),a=o?function(t,e){return o(t,"toString",{configurable:!0,enumerable:!1,value:r(e),writable:!0})}:i;t.exports=a},function(t,e){t.exports=function(t){return function(){return t}}},function(t,e){var n=800,r=16,o=Date.now;t.exports=function(t){var e=0,i=0;return function(){var a=o(),u=r-(a-i);if(i=a,u>0){if(++e>=n)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}},function(t,e,n){var r=n(37),o=n(96),i=n(324),a=n(212);t.exports=function(t,e){if(null==t)return{};var n=r(a(t),function(t){return[t]});return e=o(e),i(t,n,function(t,n){return e(t,n[0])})}},function(t,e,n){var r=n(648),o=n(666),i=n(344);t.exports=function(t){var e=o(t);return 1==e.length&&e[0][2]?i(e[0][0],e[0][1]):function(n){return n===t||r(n,t,e)}}},function(t,e,n){var r=n(134),o=n(205),i=1,a=2;t.exports=function(t,e,n,u){var s=n.length,c=s,f=!u;if(null==t)return!c;for(t=Object(t);s--;){var l=n[s];if(f&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<c;){var p=(l=n[s])[0],d=t[p],h=l[1];if(f&&l[2]){if(void 0===d&&!(p in t))return!1}else{var v=new r;if(u)var y=u(d,h,p,t,e,v);if(!(void 0===y?o(h,d,i|a,u,v):y))return!1}}return!0}},function(t,e,n){var r=n(128);t.exports=function(){this.__data__=new r,this.size=0}},function(t,e){t.exports=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}},function(t,e){t.exports=function(t){return this.__data__.get(t)}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e,n){var r=n(128),o=n(198),i=n(196),a=200;t.exports=function(t,e){var n=this.__data__;if(n instanceof r){var u=n.__data__;if(!o||u.length<a-1)return u.push([t,e]),this.size=++n.size,this;n=this.__data__=new i(u)}return n.set(t,e),this.size=n.size,this}},function(t,e,n){var r=n(134),o=n(331),i=n(658),a=n(660),u=n(99),s=n(9),c=n(137),f=n(208),l=1,p="[object Arguments]",d="[object Array]",h="[object Object]",v=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,y,g,m){var b=s(t),x=s(e),w=b?d:u(t),_=x?d:u(e),k=(w=w==p?h:w)==h,O=(_=_==p?h:_)==h,j=w==_;if(j&&c(t)){if(!c(e))return!1;b=!0,k=!1}if(j&&!k)return m||(m=new r),b||f(t)?o(t,e,n,y,g,m):i(t,e,w,n,y,g,m);if(!(n&l)){var S=k&&v.call(t,"__wrapped__"),E=O&&v.call(e,"__wrapped__");if(S||E){var A=S?t.value():t,C=E?e.value():e;return m||(m=new r),g(A,C,n,y,m)}}return!!j&&(m||(m=new r),a(t,e,n,y,g,m))}},function(t,e){var n="__lodash_hash_undefined__";t.exports=function(t){return this.__data__.set(t,n),this}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}},function(t,e,n){var r=n(64),o=n(332),i=n(95),a=n(331),u=n(659),s=n(206),c=1,f=2,l="[object Boolean]",p="[object Date]",d="[object Error]",h="[object Map]",v="[object Number]",y="[object RegExp]",g="[object Set]",m="[object String]",b="[object Symbol]",x="[object ArrayBuffer]",w="[object DataView]",_=r?r.prototype:void 0,k=_?_.valueOf:void 0;t.exports=function(t,e,n,r,_,O,j){switch(n){case w:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case x:return!(t.byteLength!=e.byteLength||!O(new o(t),new o(e)));case l:case p:case v:return i(+t,+e);case d:return t.name==e.name&&t.message==e.message;case y:case m:return t==e+"";case h:var S=u;case g:var E=r&c;if(S||(S=s),t.size!=e.size&&!E)return!1;var A=j.get(t);if(A)return A==e;r|=f,j.set(t,e);var C=a(S(t),S(e),r,_,O,j);return j.delete(t),C;case b:if(k)return k.call(t)==k.call(e)}return!1}},function(t,e){t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}},function(t,e,n){var r=n(333),o=1,i=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,a,u,s){var c=n&o,f=r(t),l=f.length;if(l!=r(e).length&&!c)return!1;for(var p=l;p--;){var d=f[p];if(!(c?d in e:i.call(e,d)))return!1}var h=s.get(t);if(h&&s.get(e))return h==e;var v=!0;s.set(t,e),s.set(e,t);for(var y=c;++p<l;){var g=t[d=f[p]],m=e[d];if(a)var b=c?a(m,g,d,e,t,s):a(g,m,d,t,e,s);if(!(void 0===b?g===m||u(g,m,n,a,s):b)){v=!1;break}y||(y="constructor"==d)}if(v&&!y){var x=t.constructor,w=e.constructor;x!=w&&"constructor"in t&&"constructor"in e&&!("function"==typeof x&&x instanceof x&&"function"==typeof w&&w instanceof w)&&(v=!1)}return s.delete(t),s.delete(e),v}},function(t,e){t.exports=function(){return!1}},function(t,e,n){var r=n(50),o=n(200),i=n(20),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,t.exports=function(t){return i(t)&&o(t.length)&&!!a[r(t)]}},function(t,e,n){var r=n(340)(Object.keys,Object);t.exports=r},function(t,e,n){var r=n(51)(n(25),"DataView");t.exports=r},function(t,e,n){var r=n(51)(n(25),"Promise");t.exports=r},function(t,e,n){var r=n(343),o=n(97);t.exports=function(t){for(var e=o(t),n=e.length;n--;){var i=e[n],a=t[i];e[n]=[i,a,r(a)]}return e}},function(t,e,n){var r=n(205),o=n(69),i=n(328),a=n(194),u=n(343),s=n(344),c=n(66),f=1,l=2;t.exports=function(t,e){return a(t)&&u(e)?s(c(t),e):function(n){var a=o(n,t);return void 0===a&&a===e?i(n,t):r(e,a,f|l)}}},function(t,e,n){var r=n(211),o=n(669),i=n(194),a=n(66);t.exports=function(t){return i(t)?r(a(t)):o(t)}},function(t,e,n){var r=n(126);t.exports=function(t){return function(e){return r(e,t)}}},function(t,e,n){var r=n(26),o=n(210),i=n(671),a=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return i(t);var e=o(t),n=[];for(var u in t)("constructor"!=u||!e&&a.call(t,u))&&n.push(u);return n}},function(t,e){t.exports=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}},function(t,e,n){var r=n(326);t.exports=function(t,e,n){return null==t?t:r(t,e,n)}},function(t,e){t.exports=function(t){return function(e,n,r){for(var o=-1,i=Object(e),a=r(e),u=a.length;u--;){var s=a[t?u:++o];if(!1===n(i[s],s,i))break}return e}}},function(t,e,n){var r=n(203),o=n(71),i=n(141),a=n(101),u=o(function(t){return i(r(t,1,a,!0))});t.exports=u},function(t,e,n){var r=n(676),o=n(677),i=n(678);t.exports=function(t,e,n){return e==e?i(t,e,n):r(t,o,n)}},function(t,e){t.exports=function(t,e,n,r){for(var o=t.length,i=n+(r?1:-1);r?i--:++i<o;)if(e(t[i],i,t))return i;return-1}},function(t,e){t.exports=function(t){return t!=t}},function(t,e){t.exports=function(t,e,n){for(var r=n-1,o=t.length;++r<o;)if(t[r]===e)return r;return-1}},function(t,e,n){var r=n(341),o=n(351),i=n(206),a=r&&1/i(new r([,-0]))[1]==1/0?function(t){return new r(t)}:o;t.exports=a},function(t,e,n){var r=n(681),o=n(203),i=n(71),a=n(101),u=i(function(t,e){return a(t)?r(t,o(e,1,a,!0)):[]});t.exports=u},function(t,e,n){var r=n(135),o=n(214),i=n(215),a=n(37),u=n(98),s=n(136),c=200;t.exports=function(t,e,n,f){var l=-1,p=o,d=!0,h=t.length,v=[],y=e.length;if(!h)return v;n&&(e=a(e,u(n))),f?(p=i,d=!1):e.length>=c&&(p=s,d=!1,e=new r(e));t:for(;++l<h;){var g=t[l],m=null==n?g:n(g);if(g=f||0!==g?g:0,d&&m==m){for(var b=y;b--;)if(e[b]===m)continue t;v.push(g)}else p(e,m,f)||v.push(g)}return v}},function(t,e,n){var r=n(37),o=n(352),i=n(71),a=n(353),u=i(function(t){var e=r(t,a);return e.length&&e[0]===t[0]?o(e):[]});t.exports=u},function(t,e){t.exports=function(t,e,n,r){for(var o=-1,i=null==t?0:t.length;++o<i;){var a=t[o];e(r,a,n(a),t)}return r}},function(t,e,n){var r=n(357);t.exports=function(t,e,n,o){return r(t,function(t,r,i){e(o,t,n(t),i)}),o}},function(t,e,n){var r=n(68);t.exports=function(t,e){return function(n,o){if(null==n)return n;if(!r(n))return t(n,o);for(var i=n.length,a=e?i:-1,u=Object(n);(e?a--:++a<i)&&!1!==o(u[a],a,u););return n}}},function(t,e,n){!function(){"use strict";function n(t){return"function"==typeof t}function r(t){return"[object Array]"===Object.prototype.toString.call(t)}function o(t){return t instanceof Date?t.getTime():r(t)?t.map(o):t&&"function"==typeof t.toJSON?t.toJSON():t}function i(t,e){return n(t.get)?t.get(e):t[e]}function a(t){return function(e,n){if(!r(n)||!n.length)return t(e,n);for(var o=0,a=n.length;o<a;o++)if(t(e,i(n,o)))return!0;return!1}}function u(t,e,n,r){return t.v(t.a,e,n,r)}var s,c={$eq:a(function(t,e){return t(e)}),$ne:(s=function(t,e){return!t(e)},function(t,e){if(!r(e)||!e.length)return s(t,e);for(var n=0,o=e.length;n<o;n++)if(!s(t,i(e,n)))return!1;return!0}),$gt:a(function(t,e){return g.compare(o(e),t)>0}),$gte:a(function(t,e){return g.compare(o(e),t)>=0}),$lt:a(function(t,e){return g.compare(o(e),t)<0}),$lte:a(function(t,e){return g.compare(o(e),t)<=0}),$mod:a(function(t,e){return e%t[0]==t[1]}),$in:function(t,e){if(!(e instanceof Array)){var n=o(e);if(n===e&&"object"==typeof e)for(a=t.length;a--;)if(String(t[a])===String(e)&&"[object Object]"!==String(e))return!0;if(void 0===n)for(a=t.length;a--;)if(null==t[a])return!0;for(a=t.length;a--;){var r=u(y(i(t,a),void 0),e,a,t);if(r&&"[object Object]"!==String(r)&&"[object Object]"!==String(e))return!0}return!!~t.indexOf(n)}for(var a=e.length;a--;)if(~t.indexOf(o(i(e,a))))return!0;return!1},$nin:function(t,e,n,r){return!c.$in(t,e,n,r)},$not:function(t,e,n,r){return!u(t,e,n,r)},$type:function(t,e){return null!=e&&(e instanceof t||e.constructor==t)},$all:function(t,e,n,r){return c.$and(t,e,n,r)},$size:function(t,e){return!!e&&t===e.length},$or:function(t,e,n,r){for(var o=0,a=t.length;o<a;o++)if(u(i(t,o),e,n,r))return!0;return!1},$nor:function(t,e,n,r){return!c.$or(t,e,n,r)},$and:function(t,e,n,r){for(var o=0,a=t.length;o<a;o++)if(!u(i(t,o),e,n,r))return!1;return!0},$regex:a(function(t,e){return"string"==typeof e&&t.test(e)}),$where:function(t,e,n,r){return t.call(e,e,n,r)},$elemMatch:function(t,e,n,o){return r(e)?!!~l(e,t):u(t,e,n,o)},$exists:function(t,e,n,r){return r.hasOwnProperty(n)===t}},f={$eq:function(t){return t instanceof RegExp?function(e){return"string"==typeof e&&t.test(e)}:t instanceof Function?t:r(t)&&!t.length?function(t){return r(t)&&!t.length}:null===t?function(t){return null==t}:function(e){return 0===g.compare(o(e),t)}},$ne:function(t){return f.$eq(t)},$and:function(t){return t.map(v)},$all:function(t){return f.$and(t)},$or:function(t){return t.map(v)},$nor:function(t){return t.map(v)},$not:function(t){return v(t)},$regex:function(t,e){return new RegExp(t,e.$options)},$where:function(t){return"string"==typeof t?new Function("obj","return "+t):t},$elemMatch:function(t){return v(t)},$exists:function(t){return!!t}};function l(t,e){for(var n=0;n<t.length;n++){i(t,n);if(u(e,i(t,n)))return n}return-1}function p(t,e){return{a:t,v:e}}function d(t,e){var n=[];if(function t(e,n,o,a,u){if(o===n.length||null==e)return void u.push([e,n[o-1],a]);var s=i(n,o);if(r(e)&&isNaN(Number(s)))for(var c=0,f=e.length;c<f;c++)t(i(e,c),n,o,e,u);else t(i(e,s),n,o+1,e,u)}(e,t.k,0,e,n),1===n.length){var o=n[0];return u(t.nv,o[0],o[1],o[2])}for(var a=t&&t.q&&void 0!==t.q.$ne,s=a,c=0;c<n.length;c++){var f=n[c],l=u(t.nv,f[0],f[1],f[2]);a?s&=l:s|=l}return s}function h(t,e,n){return{a:{k:t,nv:e,q:n},v:d}}function v(t){var e;(t=o(t))&&((e=t)&&e.constructor===Object)||(t={$eq:t});var n=[];for(var r in t){var i=t[r];if("$options"!==r)if(c[r])f[r]&&(i=f[r](i,t)),n.push(p(o(i),c[r]));else{if(36===r.charCodeAt(0))throw new Error("Unknown operation "+r);n.push(h(r.split("."),v(i),i))}}return 1===n.length?n[0]:p(n,c.$and)}function y(t,e){var n=v(t);return e&&(n={a:n,v:function(t,n,r,o){return u(t,e(n),r,o)}}),n}function g(t,e,r){n(e)&&(r=e,e=void 0);var o=y(t,r);function i(t,e,n){return u(o,t,e,n)}return e?e.filter(i):i}g.use=function(t){if(n(t))return t(g);for(var e in t)36===e.charCodeAt(0)&&(c[e]=t[e])},g.indexOf=function(t,e,n){return l(e,y(t,n))},g.compare=function(t,e){if(t===e)return 0;if(typeof t==typeof e){if(t>e)return 1;if(t<e)return-1}},void 0!==t.exports&&(Object.defineProperty(e,"__esModule",{value:!0}),t.exports=g,e.default=t.exports.default=g),"undefined"!=typeof window&&(window.sift=g)}()},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e,n){"use strict";function r(t){return function(e){var n=e.dispatch,r=e.getState;return function(e){return function(o){return"function"==typeof o?o(n,r,t):e(o)}}}}n.r(e);var o=r();o.withExtraArgument=r,e.default=o},function(t,e,n){t.exports={default:n(690),__esModule:!0}},function(t,e,n){n(691);var r=n(3).Object;t.exports=function(t,e){return r.getOwnPropertyDescriptor(t,e)}},function(t,e,n){var r=n(35),o=n(191).f;n(124)("getOwnPropertyDescriptor",function(){return function(t,e){return o(r(t),e)}})},function(t,e,n){var r=n(37),o=n(693),i=n(707),a=n(65),u=n(72),s=n(710),c=n(201),f=n(212),l=c(function(t,e){var n={};if(null==t)return n;var c=!1;e=r(e,function(e){return e=a(e,t),c||(c=e.length>1),e}),u(t,f(t),n),c&&(n=o(n,7,s));for(var l=e.length;l--;)i(n,e[l]);return n});t.exports=l},function(t,e,n){var r=n(134),o=n(362),i=n(199),a=n(694),u=n(695),s=n(363),c=n(218),f=n(696),l=n(697),p=n(333),d=n(212),h=n(99),v=n(698),y=n(699),g=n(365),m=n(9),b=n(137),x=n(703),w=n(26),_=n(705),k=n(97),O=1,j=2,S=4,E="[object Arguments]",A="[object Function]",C="[object GeneratorFunction]",T="[object Object]",P={};P[E]=P["[object Array]"]=P["[object ArrayBuffer]"]=P["[object DataView]"]=P["[object Boolean]"]=P["[object Date]"]=P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Map]"]=P["[object Number]"]=P[T]=P["[object RegExp]"]=P["[object Set]"]=P["[object String]"]=P["[object Symbol]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P["[object Error]"]=P[A]=P["[object WeakMap]"]=!1,t.exports=function t(e,n,M,D,R,I){var z,N=n&O,L=n&j,F=n&S;if(M&&(z=R?M(e,D,R,I):M(e)),void 0!==z)return z;if(!w(e))return e;var B=m(e);if(B){if(z=v(e),!N)return c(e,z)}else{var U=h(e),$=U==A||U==C;if(b(e))return s(e,N);if(U==T||U==E||$&&!R){if(z=L||$?{}:g(e),!N)return L?l(e,u(z,e)):f(e,a(z,e))}else{if(!P[U])return R?e:{};z=y(e,U,N)}}I||(I=new r);var q=I.get(e);if(q)return q;I.set(e,z),_(e)?e.forEach(function(r){z.add(t(r,n,M,r,e,I))}):x(e)&&e.forEach(function(r,o){z.set(o,t(r,n,M,o,e,I))});var J=F?L?d:p:L?keysIn:k,V=B?void 0:J(e);return o(V||e,function(r,o){V&&(r=e[o=r]),i(z,o,t(r,n,M,o,e,I))}),z}},function(t,e,n){var r=n(72),o=n(97);t.exports=function(t,e){return t&&r(e,o(e),t)}},function(t,e,n){var r=n(72),o=n(138);t.exports=function(t,e){return t&&r(e,o(e),t)}},function(t,e,n){var r=n(72),o=n(207);t.exports=function(t,e){return r(t,o(t),e)}},function(t,e,n){var r=n(72),o=n(345);t.exports=function(t,e){return r(t,o(t),e)}},function(t,e){var n=Object.prototype.hasOwnProperty;t.exports=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&n.call(t,"index")&&(r.index=t.index,r.input=t.input),r}},function(t,e,n){var r=n(219),o=n(700),i=n(701),a=n(702),u=n(364),s="[object Boolean]",c="[object Date]",f="[object Map]",l="[object Number]",p="[object RegExp]",d="[object Set]",h="[object String]",v="[object Symbol]",y="[object ArrayBuffer]",g="[object DataView]",m="[object Float32Array]",b="[object Float64Array]",x="[object Int8Array]",w="[object Int16Array]",_="[object Int32Array]",k="[object Uint8Array]",O="[object Uint8ClampedArray]",j="[object Uint16Array]",S="[object Uint32Array]";t.exports=function(t,e,n){var E=t.constructor;switch(e){case y:return r(t);case s:case c:return new E(+t);case g:return o(t,n);case m:case b:case x:case w:case _:case k:case O:case j:case S:return u(t,n);case f:return new E;case l:case h:return new E(t);case p:return i(t);case d:return new E;case v:return a(t)}}},function(t,e,n){var r=n(219);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},function(t,e){var n=/\w*$/;t.exports=function(t){var e=new t.constructor(t.source,n.exec(t));return e.lastIndex=t.lastIndex,e}},function(t,e,n){var r=n(64),o=r?r.prototype:void 0,i=o?o.valueOf:void 0;t.exports=function(t){return i?Object(i.call(t)):{}}},function(t,e,n){var r=n(704),o=n(98),i=n(209),a=i&&i.isMap,u=a?o(a):r;t.exports=u},function(t,e,n){var r=n(99),o=n(20),i="[object Map]";t.exports=function(t){return o(t)&&r(t)==i}},function(t,e,n){var r=n(706),o=n(98),i=n(209),a=i&&i.isSet,u=a?o(a):r;t.exports=u},function(t,e,n){var r=n(99),o=n(20),i="[object Set]";t.exports=function(t){return o(t)&&r(t)==i}},function(t,e,n){var r=n(65),o=n(366),i=n(708),a=n(66);t.exports=function(t,e){return e=r(e,t),null==(t=i(t,e))||delete t[a(o(e))]}},function(t,e,n){var r=n(126),o=n(709);t.exports=function(t,e){return e.length<2?t:r(t,o(e,0,-1))}},function(t,e){t.exports=function(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i}},function(t,e,n){var r=n(216);t.exports=function(t){return r(t)?void 0:t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=f(n(8)),o=f(n(1)),i=f(n(2)),a=f(n(12)),u=f(n(142)),s=f(n(13)),c=f(n(139));function f(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(){return(0,o.default)(this,e),(0,a.default)(this,(e.__proto__||(0,r.default)(e)).apply(this,arguments))}return(0,s.default)(e,t),(0,i.default)(e,[{key:"data",get:function(){var t=this;return(0,u.default)(e.prototype.__proto__||(0,r.default)(e.prototype),"data",this).filter(function(e){return e.slug===t.target.slug})}}],[{key:"query",value:function(t,e){return e.all("io.cozy.triggers").where({worker:"konnector"})}}]),e}(c.default);e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(368);Object.defineProperty(e,"default",{enumerable:!0,get:function(){return i(r).default}});var o=n(849);function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"OAuthClient",{enumerable:!0,get:function(){return i(o).default}})},function(t,e,n){t.exports={default:n(714),__esModule:!0}},function(t,e,n){n(122),n(45),n(60),n(715),n(716),n(717),n(718),t.exports=n(3).Set},function(t,e,n){"use strict";var r=n(311),o=n(187);t.exports=n(312)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return r.def(o(this,"Set"),t=0===t?0:t,t)}},r)},function(t,e,n){var r=n(5);r(r.P+r.R,"Set",{toJSON:n(314)("Set")})},function(t,e,n){n(315)("Set")},function(t,e,n){n(316)("Set")},function(t,e,n){t.exports={default:n(720),__esModule:!0}},function(t,e,n){n(721);var r=n(3).Object;t.exports=function(t,e){return r.defineProperties(t,e)}},function(t,e,n){var r=n(5);r(r.S+r.F*!n(15),"Object",{defineProperties:n(299)})},function(t,e,n){t.exports={default:n(723),__esModule:!0}},function(t,e,n){n(724),t.exports=n(3).Object.freeze},function(t,e,n){var r=n(17),o=n(123).onFreeze;n(124)("freeze",function(t){return function(e){return t&&r(e)?t(o(e)):e}})},function(t,e,n){var r=n(726),o=n(145),i=n(224);t.exports=function(){this.size=0,this.__data__={hash:new r,map:new(i||o),string:new r}}},function(t,e,n){var r=n(727),o=n(734),i=n(735),a=n(736),u=n(737);function s(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=a,s.prototype.set=u,t.exports=s},function(t,e,n){var r=n(144);t.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(t,e,n){var r=n(222),o=n(731),i=n(31),a=n(372),u=/^\[object .+?Constructor\]$/,s=Function.prototype,c=Object.prototype,f=s.toString,l=c.hasOwnProperty,p=RegExp("^"+f.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!i(t)||o(t))&&(r(t)?p:u).test(a(t))}},function(t,e,n){var r=n(76),o=Object.prototype,i=o.hasOwnProperty,a=o.toString,u=r?r.toStringTag:void 0;t.exports=function(t){var e=i.call(t,u),n=t[u];try{t[u]=void 0;var r=!0}catch(t){}var o=a.call(t);return r&&(e?t[u]=n:delete t[u]),o}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e,n){var r,o=n(732),i=(r=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";t.exports=function(t){return!!i&&i in t}},function(t,e,n){var r=n(27)["__core-js_shared__"];t.exports=r},function(t,e){t.exports=function(t,e){return null==t?void 0:t[e]}},function(t,e){t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},function(t,e,n){var r=n(144),o="__lodash_hash_undefined__",i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(r){var n=e[t];return n===o?void 0:n}return i.call(e,t)?e[t]:void 0}},function(t,e,n){var r=n(144),o=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return r?void 0!==e[t]:o.call(e,t)}},function(t,e,n){var r=n(144),o="__lodash_hash_undefined__";t.exports=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=r&&void 0===e?o:e,this}},function(t,e){t.exports=function(){this.__data__=[],this.size=0}},function(t,e,n){var r=n(146),o=Array.prototype.splice;t.exports=function(t){var e=this.__data__,n=r(e,t);return!(n<0)&&(n==e.length-1?e.pop():o.call(e,n,1),--this.size,!0)}},function(t,e,n){var r=n(146);t.exports=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]}},function(t,e,n){var r=n(146);t.exports=function(t){return r(this.__data__,t)>-1}},function(t,e,n){var r=n(146);t.exports=function(t,e){var n=this.__data__,o=r(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this}},function(t,e,n){var r=n(147);t.exports=function(t){var e=r(this,t).delete(t);return this.size-=e?1:0,e}},function(t,e){t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},function(t,e,n){var r=n(147);t.exports=function(t){return r(this,t).get(t)}},function(t,e,n){var r=n(147);t.exports=function(t){return r(this,t).has(t)}},function(t,e,n){var r=n(147);t.exports=function(t,e){var n=r(this,t),o=n.size;return n.set(t,e),this.size+=n.size==o?0:1,this}},function(t,e){var n="__lodash_hash_undefined__";t.exports=function(t){return this.__data__.set(t,n),this}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e,n){var r=n(751),o=n(752),i=n(753);t.exports=function(t,e,n){return e==e?i(t,e,n):r(t,o,n)}},function(t,e){t.exports=function(t,e,n,r){for(var o=t.length,i=n+(r?1:-1);r?i--:++i<o;)if(e(t[i],i,t))return i;return-1}},function(t,e){t.exports=function(t){return t!=t}},function(t,e){t.exports=function(t,e,n){for(var r=n-1,o=t.length;++r<o;)if(t[r]===e)return r;return-1}},function(t,e,n){var r=n(373),o=n(755),i=n(227),a=r&&1/i(new r([,-0]))[1]==1/0?function(t){return new r(t)}:o;t.exports=a},function(t,e){t.exports=function(){}},function(t,e,n){var r=n(374),o=n(375),i=n(757),a=n(378),u=n(154),s=n(21),c=n(149),f=n(222),l=n(31),p=n(230);t.exports=function(t,e,n){var d=s(t),h=d||c(t)||p(t);if(e=a(e,4),null==n){var v=t&&t.constructor;n=h?d?new v:[]:l(t)&&f(v)?o(u(t)):{}}return(h?r:i)(t,function(t,r,o){return e(n,t,r,o)}),n}},function(t,e,n){var r=n(758),o=n(102);t.exports=function(t,e){return t&&r(t,e,o)}},function(t,e,n){var r=n(759)();t.exports=r},function(t,e){t.exports=function(t){return function(e,n,r){for(var o=-1,i=Object(e),a=r(e),u=a.length;u--;){var s=a[t?u:++o];if(!1===n(i[s],s,i))break}return e}}},function(t,e){t.exports=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}},function(t,e,n){var r=n(75),o=n(32),i="[object Arguments]";t.exports=function(t){return o(t)&&r(t)==i}},function(t,e){t.exports=function(){return!1}},function(t,e,n){var r=n(75),o=n(231),i=n(32),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,t.exports=function(t){return i(t)&&o(t.length)&&!!a[r(t)]}},function(t,e,n){var r=n(233),o=n(765),i=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return o(t);var e=[];for(var n in Object(t))i.call(t,n)&&"constructor"!=n&&e.push(n);return e}},function(t,e,n){var r=n(377)(Object.keys,Object);t.exports=r},function(t,e,n){var r=n(767),o=n(782),i=n(386);t.exports=function(t){var e=o(t);return 1==e.length&&e[0][2]?i(e[0][0],e[0][1]):function(n){return n===t||r(n,t,e)}}},function(t,e,n){var r=n(235),o=n(379),i=1,a=2;t.exports=function(t,e,n,u){var s=n.length,c=s,f=!u;if(null==t)return!c;for(t=Object(t);s--;){var l=n[s];if(f&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<c;){var p=(l=n[s])[0],d=t[p],h=l[1];if(f&&l[2]){if(void 0===d&&!(p in t))return!1}else{var v=new r;if(u)var y=u(d,h,p,t,e,v);if(!(void 0===y?o(h,d,i|a,u,v):y))return!1}}return!0}},function(t,e,n){var r=n(145);t.exports=function(){this.__data__=new r,this.size=0}},function(t,e){t.exports=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}},function(t,e){t.exports=function(t){return this.__data__.get(t)}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e,n){var r=n(145),o=n(224),i=n(221),a=200;t.exports=function(t,e){var n=this.__data__;if(n instanceof r){var u=n.__data__;if(!o||u.length<a-1)return u.push([t,e]),this.size=++n.size,this;n=this.__data__=new i(u)}return n.set(t,e),this.size=n.size,this}},function(t,e,n){var r=n(235),o=n(380),i=n(775),a=n(777),u=n(150),s=n(21),c=n(149),f=n(230),l=1,p="[object Arguments]",d="[object Array]",h="[object Object]",v=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,y,g,m){var b=s(t),x=s(e),w=b?d:u(t),_=x?d:u(e),k=(w=w==p?h:w)==h,O=(_=_==p?h:_)==h,j=w==_;if(j&&c(t)){if(!c(e))return!1;b=!0,k=!1}if(j&&!k)return m||(m=new r),b||f(t)?o(t,e,n,y,g,m):i(t,e,w,n,y,g,m);if(!(n&l)){var S=k&&v.call(t,"__wrapped__"),E=O&&v.call(e,"__wrapped__");if(S||E){var A=S?t.value():t,C=E?e.value():e;return m||(m=new r),g(A,C,n,y,m)}}return!!j&&(m||(m=new r),a(t,e,n,y,g,m))}},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}},function(t,e,n){var r=n(76),o=n(381),i=n(223),a=n(380),u=n(776),s=n(227),c=1,f=2,l="[object Boolean]",p="[object Date]",d="[object Error]",h="[object Map]",v="[object Number]",y="[object RegExp]",g="[object Set]",m="[object String]",b="[object Symbol]",x="[object ArrayBuffer]",w="[object DataView]",_=r?r.prototype:void 0,k=_?_.valueOf:void 0;t.exports=function(t,e,n,r,_,O,j){switch(n){case w:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case x:return!(t.byteLength!=e.byteLength||!O(new o(t),new o(e)));case l:case p:case v:return i(+t,+e);case d:return t.name==e.name&&t.message==e.message;case y:case m:return t==e+"";case h:var S=u;case g:var E=r&c;if(S||(S=s),t.size!=e.size&&!E)return!1;var A=j.get(t);if(A)return A==e;r|=f,j.set(t,e);var C=a(S(t),S(e),r,_,O,j);return j.delete(t),C;case b:if(k)return k.call(t)==k.call(e)}return!1}},function(t,e){t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}},function(t,e,n){var r=n(382),o=1,i=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,a,u,s){var c=n&o,f=r(t),l=f.length;if(l!=r(e).length&&!c)return!1;for(var p=l;p--;){var d=f[p];if(!(c?d in e:i.call(e,d)))return!1}var h=s.get(t);if(h&&s.get(e))return h==e;var v=!0;s.set(t,e),s.set(e,t);for(var y=c;++p<l;){var g=t[d=f[p]],m=e[d];if(a)var b=c?a(m,g,d,e,t,s):a(g,m,d,t,e,s);if(!(void 0===b?g===m||u(g,m,n,a,s):b)){v=!1;break}y||(y="constructor"==d)}if(v&&!y){var x=t.constructor,w=e.constructor;x!=w&&"constructor"in t&&"constructor"in e&&!("function"==typeof x&&x instanceof x&&"function"==typeof w&&w instanceof w)&&(v=!1)}return s.delete(t),s.delete(e),v}},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[o++]=a)}return i}},function(t,e,n){var r=n(53)(n(27),"DataView");t.exports=r},function(t,e,n){var r=n(53)(n(27),"Promise");t.exports=r},function(t,e,n){var r=n(53)(n(27),"WeakMap");t.exports=r},function(t,e,n){var r=n(385),o=n(102);t.exports=function(t){for(var e=o(t),n=e.length;n--;){var i=e[n],a=t[i];e[n]=[i,a,r(a)]}return e}},function(t,e,n){var r=n(379),o=n(256),i=n(787),a=n(238),u=n(385),s=n(386),c=n(79),f=1,l=2;t.exports=function(t,e){return a(t)&&u(e)?s(c(t),e):function(n){var a=o(n,t);return void 0===a&&a===e?i(n,t):r(e,a,f|l)}}},function(t,e,n){var r=n(785),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,a=r(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(o,function(t,n,r,o){e.push(r?o.replace(i,"$1"):n||t)}),e});t.exports=a},function(t,e,n){var r=n(786),o=500;t.exports=function(t){var e=r(t,function(t){return n.size===o&&n.clear(),t}),n=e.cache;return e}},function(t,e,n){var r=n(221),o="Expected a function";function i(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(o);var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var a=t.apply(this,r);return n.cache=i.set(o,a)||i,a};return n.cache=new(i.Cache||r),n}i.Cache=r,t.exports=i},function(t,e,n){var r=n(788),o=n(388);t.exports=function(t,e){return null!=t&&o(t,e,r)}},function(t,e){t.exports=function(t,e){return null!=t&&e in Object(t)}},function(t,e,n){var r=n(790),o=n(791),i=n(238),a=n(79);t.exports=function(t){return i(t)?r(a(t)):o(t)}},function(t,e){t.exports=function(t){return function(e){return null==e?void 0:e[t]}}},function(t,e,n){var r=n(151);t.exports=function(t){return function(e){return r(e,t)}}},function(t,e){t.exports=function(t){return t&&t.length?t[0]:void 0}},function(t,e,n){var r=n(78),o=n(794),i=n(814),a=n(77),u=n(104),s=n(817),c=n(819),f=n(241),l=c(function(t,e){var n={};if(null==t)return n;var c=!1;e=r(e,function(e){return e=a(e,t),c||(c=e.length>1),e}),u(t,f(t),n),c&&(n=o(n,7,s));for(var l=e.length;l--;)i(n,e[l]);return n});t.exports=l},function(t,e,n){var r=n(235),o=n(374),i=n(240),a=n(795),u=n(796),s=n(799),c=n(800),f=n(801),l=n(802),p=n(382),d=n(241),h=n(150),v=n(803),y=n(804),g=n(809),m=n(21),b=n(149),x=n(810),w=n(31),_=n(812),k=n(102),O=1,j=2,S=4,E="[object Arguments]",A="[object Function]",C="[object GeneratorFunction]",T="[object Object]",P={};P[E]=P["[object Array]"]=P["[object ArrayBuffer]"]=P["[object DataView]"]=P["[object Boolean]"]=P["[object Date]"]=P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Map]"]=P["[object Number]"]=P[T]=P["[object RegExp]"]=P["[object Set]"]=P["[object String]"]=P["[object Symbol]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P["[object Error]"]=P[A]=P["[object WeakMap]"]=!1,t.exports=function t(e,n,M,D,R,I){var z,N=n&O,L=n&j,F=n&S;if(M&&(z=R?M(e,D,R,I):M(e)),void 0!==z)return z;if(!w(e))return e;var B=m(e);if(B){if(z=v(e),!N)return c(e,z)}else{var U=h(e),$=U==A||U==C;if(b(e))return s(e,N);if(U==T||U==E||$&&!R){if(z=L||$?{}:g(e),!N)return L?l(e,u(z,e)):f(e,a(z,e))}else{if(!P[U])return R?e:{};z=y(e,U,N)}}I||(I=new r);var q=I.get(e);if(q)return q;I.set(e,z),_(e)?e.forEach(function(r){z.add(t(r,n,M,r,e,I))}):x(e)&&e.forEach(function(r,o){z.set(o,t(r,n,M,o,e,I))});var J=F?L?d:p:L?keysIn:k,V=B?void 0:J(e);return o(V||e,function(r,o){V&&(r=e[o=r]),i(z,o,t(r,n,M,o,e,I))}),z}},function(t,e,n){var r=n(104),o=n(102);t.exports=function(t,e){return t&&r(e,o(e),t)}},function(t,e,n){var r=n(104),o=n(391);t.exports=function(t,e){return t&&r(e,o(e),t)}},function(t,e,n){var r=n(31),o=n(233),i=n(798),a=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return i(t);var e=o(t),n=[];for(var u in t)("constructor"!=u||!e&&a.call(t,u))&&n.push(u);return n}},function(t,e){t.exports=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}},function(t,e,n){(function(t){var r=n(27),o=e&&!e.nodeType&&e,i=o&&"object"==typeof t&&t&&!t.nodeType&&t,a=i&&i.exports===o?r.Buffer:void 0,u=a?a.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=u?u(n):new t.constructor(n);return t.copy(r),r}}).call(this,n(23)(t))},function(t,e){t.exports=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}},function(t,e,n){var r=n(104),o=n(237);t.exports=function(t,e){return r(t,o(t),e)}},function(t,e,n){var r=n(104),o=n(392);t.exports=function(t,e){return r(t,o(t),e)}},function(t,e){var n=Object.prototype.hasOwnProperty;t.exports=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&n.call(t,"index")&&(r.index=t.index,r.input=t.input),r}},function(t,e,n){var r=n(242),o=n(805),i=n(806),a=n(807),u=n(808),s="[object Boolean]",c="[object Date]",f="[object Map]",l="[object Number]",p="[object RegExp]",d="[object Set]",h="[object String]",v="[object Symbol]",y="[object ArrayBuffer]",g="[object DataView]",m="[object Float32Array]",b="[object Float64Array]",x="[object Int8Array]",w="[object Int16Array]",_="[object Int32Array]",k="[object Uint8Array]",O="[object Uint8ClampedArray]",j="[object Uint16Array]",S="[object Uint32Array]";t.exports=function(t,e,n){var E=t.constructor;switch(e){case y:return r(t);case s:case c:return new E(+t);case g:return o(t,n);case m:case b:case x:case w:case _:case k:case O:case j:case S:return u(t,n);case f:return new E;case l:case h:return new E(t);case p:return i(t);case d:return new E;case v:return a(t)}}},function(t,e,n){var r=n(242);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},function(t,e){var n=/\w*$/;t.exports=function(t){var e=new t.constructor(t.source,n.exec(t));return e.lastIndex=t.lastIndex,e}},function(t,e,n){var r=n(76),o=r?r.prototype:void 0,i=o?o.valueOf:void 0;t.exports=function(t){return i?Object(i.call(t)):{}}},function(t,e,n){var r=n(242);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},function(t,e,n){var r=n(375),o=n(154),i=n(233);t.exports=function(t){return"function"!=typeof t.constructor||i(t)?{}:r(o(t))}},function(t,e,n){var r=n(811),o=n(103),i=n(232),a=i&&i.isMap,u=a?o(a):r;t.exports=u},function(t,e,n){var r=n(150),o=n(32),i="[object Map]";t.exports=function(t){return o(t)&&r(t)==i}},function(t,e,n){var r=n(813),o=n(103),i=n(232),a=i&&i.isSet,u=a?o(a):r;t.exports=u},function(t,e,n){var r=n(150),o=n(32),i="[object Set]";t.exports=function(t){return o(t)&&r(t)==i}},function(t,e,n){var r=n(77),o=n(815),i=n(816),a=n(79);t.exports=function(t,e){return e=r(e,t),null==(t=i(t,e))||delete t[a(o(e))]}},function(t,e){t.exports=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}},function(t,e,n){var r=n(151),o=n(393);t.exports=function(t,e){return e.length<2?t:r(t,o(e,0,-1))}},function(t,e,n){var r=n(818);t.exports=function(t){return r(t)?void 0:t}},function(t,e,n){var r=n(75),o=n(154),i=n(32),a="[object Object]",u=Function.prototype,s=Object.prototype,c=u.toString,f=s.hasOwnProperty,l=c.call(Object);t.exports=function(t){if(!i(t)||r(t)!=a)return!1;var e=o(t);if(null===e)return!0;var n=f.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&c.call(n)==l}},function(t,e,n){var r=n(257),o=n(394),i=n(395);t.exports=function(t){return i(o(t,void 0,r),t+"")}},function(t,e,n){var r=n(76),o=n(228),i=n(21),a=r?r.isConcatSpreadable:void 0;t.exports=function(t){return i(t)||o(t)||!!(a&&t&&t[a])}},function(t,e){t.exports=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}},function(t,e,n){var r=n(823),o=n(390),i=n(239),a=o?function(t,e){return o(t,"toString",{configurable:!0,enumerable:!1,value:r(e),writable:!0})}:i;t.exports=a},function(t,e){t.exports=function(t){return function(){return t}}},function(t,e){var n=800,r=16,o=Date.now;t.exports=function(t){var e=0,i=0;return function(){var a=o(),u=r-(a-i);if(i=a,u>0){if(++e>=n)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}},function(t,e,n){var r=n(826),o=n(387),i=n(827),a=n(153);t.exports=function(t,e,n){return t=a(t),n=null==n?0:r(i(n),0,t.length),e=o(e),t.slice(n,n+e.length)==e}},function(t,e){t.exports=function(t,e,n){return t==t&&(void 0!==n&&(t=t<=n?t:n),void 0!==e&&(t=t>=e?t:e)),t}},function(t,e,n){var r=n(828);t.exports=function(t){var e=r(t),n=e%1;return e==e?n?e-n:e:0}},function(t,e,n){var r=n(829),o=1/0,i=17976931348623157e292;t.exports=function(t){return t?(t=r(t))===o||t===-o?(t<0?-1:1)*i:t==t?t:0:0===t?t:0}},function(t,e,n){var r=n(31),o=n(152),i=NaN,a=/^\s+|\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,f=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(o(t))return i;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var n=s.test(t);return n||c.test(t)?f(t.slice(2),n?2:8):u.test(t)?i:+t}},function(t,e,n){"use strict";var r=n(831),o=n(832),i=n(397);t.exports={formats:i,parse:o,stringify:r}},function(t,e,n){"use strict";var r=n(396),o=n(397),i=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},u=Array.isArray,s=Array.prototype.push,c=function(t,e){s.apply(t,u(e)?e:[e])},f=Date.prototype.toISOString,l={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,formatter:o.formatters[o.default],indices:!1,serializeDate:function(t){return f.call(t)},skipNulls:!1,strictNullHandling:!1},p=function t(e,n,o,i,a,s,f,p,d,h,v,y,g){var m=e;if("function"==typeof f?m=f(n,m):m instanceof Date?m=h(m):"comma"===o&&u(m)&&(m=m.join(",")),null===m){if(i)return s&&!y?s(n,l.encoder,g):n;m=""}if("string"==typeof m||"number"==typeof m||"boolean"==typeof m||r.isBuffer(m))return s?[v(y?n:s(n,l.encoder,g))+"="+v(s(m,l.encoder,g))]:[v(n)+"="+v(String(m))];var b,x=[];if(void 0===m)return x;if(u(f))b=f;else{var w=Object.keys(m);b=p?w.sort(p):w}for(var _=0;_<b.length;++_){var k=b[_];a&&null===m[k]||(u(m)?c(x,t(m[k],"function"==typeof o?o(n,k):n,o,i,a,s,f,p,d,h,v,y,g)):c(x,t(m[k],n+(d?"."+k:"["+k+"]"),o,i,a,s,f,p,d,h,v,y,g)))}return x};t.exports=function(t,e){var n,r=t,s=function(t){if(!t)return l;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||l.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=o.default;if(void 0!==t.format){if(!i.call(o.formatters,t.format))throw new TypeError("Unknown format option provided.");n=t.format}var r=o.formatters[n],a=l.filter;return("function"==typeof t.filter||u(t.filter))&&(a=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:l.addQueryPrefix,allowDots:void 0===t.allowDots?l.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:l.charsetSentinel,delimiter:void 0===t.delimiter?l.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:l.encode,encoder:"function"==typeof t.encoder?t.encoder:l.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:l.encodeValuesOnly,filter:a,formatter:r,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:l.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:l.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:l.strictNullHandling}}(e);"function"==typeof s.filter?r=(0,s.filter)("",r):u(s.filter)&&(n=s.filter);var f,d=[];if("object"!=typeof r||null===r)return"";f=e&&e.arrayFormat in a?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var h=a[f];n||(n=Object.keys(r)),s.sort&&n.sort(s.sort);for(var v=0;v<n.length;++v){var y=n[v];s.skipNulls&&null===r[y]||c(d,p(r[y],y,h,s.strictNullHandling,s.skipNulls,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.formatter,s.encodeValuesOnly,s.charset))}var g=d.join(s.delimiter),m=!0===s.addQueryPrefix?"?":"";return s.charsetSentinel&&("iso-8859-1"===s.charset?m+="utf8=%26%2310003%3B&":m+="utf8=%E2%9C%93&"),g.length>0?m+g:""}},function(t,e,n){"use strict";var r=n(396),o=Object.prototype.hasOwnProperty,i={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},u=function(t,e,n){if(t){var r=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,i=/(\[[^[\]]*])/g,a=/(\[[^[\]]*])/.exec(r),u=a?r.slice(0,a.index):r,s=[];if(u){if(!n.plainObjects&&o.call(Object.prototype,u)&&!n.allowPrototypes)return;s.push(u)}for(var c=0;null!==(a=i.exec(r))&&c<n.depth;){if(c+=1,!n.plainObjects&&o.call(Object.prototype,a[1].slice(1,-1))&&!n.allowPrototypes)return;s.push(a[1])}return a&&s.push("["+r.slice(a.index)+"]"),function(t,e,n){for(var r=e,o=t.length-1;o>=0;--o){var i,a=t[o];if("[]"===a&&n.parseArrays)i=[].concat(r);else{i=n.plainObjects?Object.create(null):{};var u="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,s=parseInt(u,10);n.parseArrays||""!==u?!isNaN(s)&&a!==u&&String(s)===u&&s>=0&&n.parseArrays&&s<=n.arrayLimit?(i=[])[s]=r:i[u]=r:i={0:r}}r=i}return r}(s,e,n)}};t.exports=function(t,e){var n=function(t){if(!t)return i;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?i.charset:t.charset;return{allowDots:void 0===t.allowDots?i.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:i.allowPrototypes,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:i.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:i.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:i.comma,decoder:"function"==typeof t.decoder?t.decoder:i.decoder,delimiter:"string"==typeof t.delimiter||r.isRegExp(t.delimiter)?t.delimiter:i.delimiter,depth:"number"==typeof t.depth?t.depth:i.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:i.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:i.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:i.strictNullHandling}}(e);if(""===t||null==t)return n.plainObjects?Object.create(null):{};for(var s="string"==typeof t?function(t,e){var n,u={},s=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,c=e.parameterLimit===1/0?void 0:e.parameterLimit,f=s.split(e.delimiter,c),l=-1,p=e.charset;if(e.charsetSentinel)for(n=0;n<f.length;++n)0===f[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===f[n]?p="utf-8":"utf8=%26%2310003%3B"===f[n]&&(p="iso-8859-1"),l=n,n=f.length);for(n=0;n<f.length;++n)if(n!==l){var d,h,v=f[n],y=v.indexOf("]="),g=-1===y?v.indexOf("="):y+1;-1===g?(d=e.decoder(v,i.decoder,p),h=e.strictNullHandling?null:""):(d=e.decoder(v.slice(0,g),i.decoder,p),h=e.decoder(v.slice(g+1),i.decoder,p)),h&&e.interpretNumericEntities&&"iso-8859-1"===p&&(h=a(h)),h&&e.comma&&h.indexOf(",")>-1&&(h=h.split(",")),o.call(u,d)?u[d]=r.combine(u[d],h):u[d]=h}return u}(t,n):t,c=n.plainObjects?Object.create(null):{},f=Object.keys(s),l=0;l<f.length;++l){var p=f[l],d=u(p,s[p],n);c=r.merge(c,d,n)}return r.compact(c)}},function(t,e,n){var r=n(78),o=n(378),i=n(834),a=n(241);t.exports=function(t,e){if(null==t)return{};var n=r(a(t),function(t){return[t]});return e=o(e),i(t,n,function(t,n){return e(t,n[0])})}},function(t,e,n){var r=n(151),o=n(835),i=n(77);t.exports=function(t,e,n){for(var a=-1,u=e.length,s={};++a<u;){var c=e[a],f=r(t,c);n(f,c)&&o(s,i(c,t),f)}return s}},function(t,e,n){var r=n(240),o=n(77),i=n(229),a=n(31),u=n(79);t.exports=function(t,e,n,s){if(!a(t))return t;for(var c=-1,f=(e=o(e,t)).length,l=f-1,p=t;null!=p&&++c<f;){var d=u(e[c]),h=n;if(c!=l){var v=p[d];void 0===(h=s?s(v,d,p):void 0)&&(h=a(v)?v:i(e[c+1])?[]:{})}r(p,d,h),p=p[d]}return t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(n(1)),o=i(n(2));function i(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(e){(0,r.default)(this,t),this.token=e||""}return(0,o.default)(t,[{key:"toAuthHeader",value:function(){return"Bearer "+this.token}},{key:"toBasicAuth",value:function(){return"user:"+this.token+"@"}},{key:"getAccessToken",value:function(){return this.token}}]),t}();e.default=a},function(t,e,n){"use strict";var r=n(838);t.exports=new r(n(839))},function(t,e,n){"use strict";function r(){this._types=Object.create(null),this._extensions=Object.create(null);for(var t=0;t<arguments.length;t++)this.define(arguments[t]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}r.prototype.define=function(t,e){for(var n in t){for(var r=t[n],o=0;o<r.length;o++){if("*"!=(i=r[o])[0]){if(!e&&i in this._types)throw new Error('Attempt to change mapping for "'+i+'" extension from "'+this._types[i]+'" to "'+n+'". Pass `force=true` to allow this, otherwise remove "'+i+'" from the list of extensions for "'+n+'".');this._types[i]=n}}if(e||!this._extensions[n]){var i=r[0];this._extensions[n]="*"!=i[0]?i:i.substr(1)}}},r.prototype.getType=function(t){var e=(t=String(t)).replace(/^.*[\/\\]/,"").toLowerCase(),n=e.replace(/^.*\./,"").toLowerCase(),r=e.length<t.length;return(n.length<e.length-1||!r)&&this._types[n]||null},r.prototype.getExtension=function(t){return(t=/^\s*([^;\s]*)/.test(t)&&RegExp.$1)&&this._extensions[t.toLowerCase()]||null},t.exports=r},function(t){t.exports={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomsvc+xml":["atomsvc"],"application/bdoc":["bdoc"],"application/ccxml+xml":["ccxml"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma","es"],"application/emma+xml":["emma"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-diff+xml":["xdf"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/ktx":["ktx"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["x3db","x3dbz"],"model/x3d+vrml":["x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]}},function(t,e,n){var r=n(841),o=n(388);t.exports=function(t,e){return null!=t&&o(t,e,r)}},function(t,e){var n=Object.prototype.hasOwnProperty;t.exports=function(t,e){return null!=t&&n.call(t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.KONNECTORS_DOCTYPE=void 0;var r=l(n(6)),o=l(n(7)),i=l(n(8)),a=l(n(1)),u=l(n(2)),s=l(n(12)),c=l(n(13)),f=l(n(369));function l(t){return t&&t.__esModule?t:{default:t}}var p=e.KONNECTORS_DOCTYPE="io.cozy.konnectors",d=function(t){function e(t){(0,a.default)(this,e);var n=(0,s.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t));return n.doctype=p,n.endpoint="/konnectors/",n}var n,f,l;return(0,c.default)(e,t),(0,u.default)(e,[{key:"create",value:(l=(0,o.default)(r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("create() method is not available for konnectors");case 1:case"end":return t.stop()}},t,this)})),function(){return l.apply(this,arguments)})},{key:"destroy",value:(f=(0,o.default)(r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("destroy() method is not available for konnectors");case 1:case"end":return t.stop()}},t,this)})),function(){return f.apply(this,arguments)})},{key:"update",value:(n=(0,o.default)(r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("update() method is not available for konnectors");case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})}]),e}(f.default);e.default=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=x(n(6)),o=x(n(4)),i=x(n(73)),a=x(n(7)),u=x(n(8)),s=x(n(1)),c=x(n(2)),f=x(n(12)),l=x(n(13)),p=(0,i.default)(["/sharings/doctype/",""],["/sharings/doctype/",""]),d=(0,i.default)(["/sharings/","/recipients"],["/sharings/","/recipients"]),h=(0,i.default)(["/sharings/","/recipients/",""],["/sharings/","/recipients/",""]),v=(0,i.default)(["/sharings/","/recipients/self"],["/sharings/","/recipients/self"]),y=n(52),g=x(y),m=n(245),b=n(74);function x(t){return t&&t.__esModule?t:{default:t}}var w=function(t){return(0,y.normalizeDoc)(t,"io.cozy.sharings")},_=function(t){function e(){return(0,s.default)(this,e),(0,f.default)(this,(e.__proto__||(0,u.default)(e)).apply(this,arguments))}var n,i,y;return(0,l.default)(e,t),(0,c.default)(e,[{key:"findByDoctype",value:(y=(0,a.default)(r.default.mark(function t(e){var n;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("GET",(0,b.uri)(p,e));case 2:return n=t.sent,t.abrupt("return",(0,o.default)({},n,{data:n.data.map(w)}));case 4:case"end":return t.stop()}},t,this)})),function(t){return y.apply(this,arguments)})},{key:"share",value:(i=(0,a.default)(r.default.mark(function t(e,n,o,i){var a,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("POST","/sharings/",{data:{type:"io.cozy.sharings",attributes:{description:i,preview_path:u,open_sharing:"two-way"===o,rules:k(e,o)},relationships:{recipients:{data:n.map(function(t){return{id:t._id,type:t._type}})}}}});case 2:return a=t.sent,t.abrupt("return",{data:w(a.data)});case 4:case"end":return t.stop()}},t,this)})),function(t,e,n,r){return i.apply(this,arguments)})},{key:"getDiscoveryLink",value:function(t,e){return this.stackClient.fullpath("/sharings/"+t+"/discovery?sharecode="+e)}},{key:"addRecipients",value:(n=(0,a.default)(r.default.mark(function t(e,n,o){var i,a;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i={data:n.map(function(t){return{id:t._id,type:t._type}})},t.next=3,this.stackClient.fetchJSON("POST",(0,b.uri)(d,e._id),{data:{type:"io.cozy.sharings",id:e._id,relationships:"two-way"===o?{recipients:i}:{read_only_recipients:i}}});case 3:return a=t.sent,t.abrupt("return",{data:w(a.data)});case 5:case"end":return t.stop()}},t,this)})),function(t,e,r){return n.apply(this,arguments)})},{key:"revokeRecipient",value:function(t,e){return this.stackClient.fetchJSON("DELETE",(0,b.uri)(h,t._id,e))}},{key:"revokeSelf",value:function(t){return this.stackClient.fetchJSON("DELETE",(0,b.uri)(v,t._id))}}]),e}(g.default);_.normalizeDoctype=g.default.normalizeDoctypeJsonApi;var k=function(t,e){var n=t._id,r=t._type;return(0,m.isFile)(t)?[(0,o.default)({title:t.name,doctype:"io.cozy.files",values:[n]},O(t,e))]:[(0,o.default)({title:"collection",doctype:r,values:[n]},O(t,e)),(0,o.default)({title:"items",doctype:"io.cozy.files",values:[r+"/"+n],selector:"referenced_by"},"two-way"===e?{add:"sync",update:"sync",remove:"sync"}:{add:"push",update:"none",remove:"push"})]},O=function(t,e){return(0,m.isFile)(t)&&(0,m.isDirectory)(t)?"two-way"===e?{add:"sync",update:"sync",remove:"sync"}:{add:"push",update:"push",remove:"push"}:"two-way"===e?{update:"sync",remove:"revoke"}:{update:"push",remove:"revoke"}};e.default=_},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=w(n(36)),o=w(n(4)),i=w(n(48)),a=w(n(6)),u=w(n(73)),s=w(n(7)),c=w(n(8)),f=w(n(1)),l=w(n(2)),p=w(n(12)),d=w(n(13)),h=(0,u.default)(["/permissions/",""],["/permissions/",""]),v=(0,u.default)(["/permissions"],["/permissions"]),y=(0,u.default)(["/permissions/doctype/","/shared-by-link"],["/permissions/doctype/","/shared-by-link"]),g=n(52),m=w(g),b=n(245),x=n(74);function w(t){return t&&t.__esModule?t:{default:t}}var _=function(t){return(0,g.normalizeDoc)(t,"io.cozy.permissions")},k=function(t){function e(){return(0,f.default)(this,e),(0,p.default)(this,(e.__proto__||(0,c.default)(e)).apply(this,arguments))}var n,u,g,m,b,w,k,S;return(0,d.default)(e,t),(0,l.default)(e,[{key:"get",value:(S=(0,s.default)(a.default.mark(function t(e){var n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("GET",(0,x.uri)(h,e));case 2:return n=t.sent,t.abrupt("return",{data:_(n.data)});case 4:case"end":return t.stop()}},t,this)})),function(t){return S.apply(this,arguments)})},{key:"create",value:(k=(0,s.default)(a.default.mark(function t(e){e._id,e._type;var n,r=(0,i.default)(e,["_id","_type"]);return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("POST",(0,x.uri)(v),{data:{type:"io.cozy.permissions",attributes:r}});case 2:return n=t.sent,t.abrupt("return",{data:_(n.data)});case 4:case"end":return t.stop()}},t,this)})),function(t){return k.apply(this,arguments)})},{key:"add",value:(w=(0,s.default)(a.default.mark(function t(e,n){var r,o;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=void 0,t.t0=e._type,t.next="io.cozy.apps"===t.t0?4:"io.cozy.konnectors"===t.t0?6:"io.cozy.permissions"===t.t0?8:10;break;case 4:return r="/permissions/apps/"+e.slug,t.abrupt("break",11);case 6:return r="/permissions/konnectors/"+e.slug,t.abrupt("break",11);case 8:return r="/permissions/"+e._id,t.abrupt("break",11);case 10:throw new Error("Permissions can only be added on existing permissions, apps and konnectors.");case 11:return t.next=13,this.stackClient.fetchJSON("PATCH",r,{data:{type:"io.cozy.permissions",attributes:{permissions:n}}});case 13:return o=t.sent,t.abrupt("return",o.data);case 15:case"end":return t.stop()}},t,this)})),function(t,e){return w.apply(this,arguments)})},{key:"destroy",value:function(t){return this.stackClient.fetchJSON("DELETE",(0,x.uri)(h,t.id))}},{key:"findLinksByDoctype",value:(b=(0,s.default)(a.default.mark(function t(e){var n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("GET",(0,x.uri)(y,e));case 2:return n=t.sent,t.abrupt("return",(0,o.default)({},n,{data:n.data.map(_)}));case 4:case"end":return t.stop()}},t,this)})),function(t){return b.apply(this,arguments)})},{key:"findApps",value:(m=(0,s.default)(a.default.mark(function t(){var e;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("GET","/apps/");case 2:return e=t.sent,t.abrupt("return",(0,o.default)({},e,{data:e.data.map(function(t){return(0,o.default)({_id:t.id},t)})}));case 4:case"end":return t.stop()}},t,this)})),function(){return m.apply(this,arguments)})},{key:"createSharingLink",value:(g=(0,s.default)(a.default.mark(function t(e){var n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("POST","/permissions?codes=email",{data:{type:"io.cozy.permissions",attributes:{permissions:O(e,!0)}}});case 2:return n=t.sent,t.abrupt("return",{data:_(n.data)});case 4:case"end":return t.stop()}},t,this)})),function(t){return g.apply(this,arguments)})},{key:"revokeSharingLink",value:(u=(0,s.default)(a.default.mark(function t(e){var n,o,i,u,s,c,f,l;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.findLinksByDoctype(e._type);case 2:n=t.sent,o=n.data.filter(function(t){return j(t,e)}),i=!0,u=!1,s=void 0,t.prev=7,c=(0,r.default)(o);case 9:if(i=(f=c.next()).done){t.next=16;break}return l=f.value,t.next=13,this.destroy(l);case 13:i=!0,t.next=9;break;case 16:t.next=22;break;case 18:t.prev=18,t.t0=t.catch(7),u=!0,s=t.t0;case 22:t.prev=22,t.prev=23,!i&&c.return&&c.return();case 25:if(t.prev=25,!u){t.next=28;break}throw s;case 28:return t.finish(25);case 29:return t.finish(22);case 30:case"end":return t.stop()}},t,this,[[7,18,22,30],[23,,25,29]])})),function(t){return u.apply(this,arguments)})},{key:"getOwnPermissions",value:(n=(0,s.default)(a.default.mark(function t(){var e;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stackClient.fetchJSON("GET","/permissions/self");case 2:return e=t.sent,t.abrupt("return",{data:_(e.data)});case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})}]),e}(m.default),O=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t._id,r=t._type,o=e?["GET"]:["ALL"];return(0,b.isFile)(t)?{files:{type:"io.cozy.files",verbs:o,values:[n]}}:{collection:{type:r,verbs:o,values:[n]},files:{type:"io.cozy.files",verbs:o,values:[r+"/"+n],selector:"referenced_by"}}};k.normalizeDoctype=m.default.normalizeDoctypeJsonApi;var j=function(t,e){var n=e._id;return(0,b.isFile)(e)?-1!==t.attributes.permissions.files.values.indexOf(n):-1!==t.attributes.permissions.collection.values.indexOf(n)};e.default=k},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.normalizeTrigger=e.TRIGGERS_DOCTYPE=e.JOBS_DOCTYPE=void 0;var r=k(n(47)),o=k(n(73)),i=k(n(6)),a=k(n(7)),u=k(n(8)),s=k(n(1)),c=k(n(2)),f=k(n(12)),l=k(n(142)),p=k(n(13)),d=k(n(4)),h=(0,o.default)(["/jobs/triggers"],["/jobs/triggers"]),v=(0,o.default)(["/jobs/triggers/",""],["/jobs/triggers/",""]),y=(0,o.default)(["/jobs/triggers/","/launch"],["/jobs/triggers/","/launch"]),g=n(244),m=k(g),b=n(52),x=k(b),w=n(399),_=n(74);function k(t){return t&&t.__esModule?t:{default:t}}e.JOBS_DOCTYPE="io.cozy.jobs";var O=e.TRIGGERS_DOCTYPE="io.cozy.triggers",j=e.normalizeTrigger=function(t){return(0,d.default)({},t,(0,b.normalizeDoc)(t,O),t.attributes)},S=function(t){function e(t){return(0,s.default)(this,e),(0,f.default)(this,(e.__proto__||(0,u.default)(e)).call(this,O,t))}var n,o,b,x,k,S,E;return(0,p.default)(e,t),(0,c.default)(e,[{key:"all",value:(E=(0,a.default)(i.default.mark(function t(){var e;return arguments.length>0&&void 0!==arguments[0]&&arguments[0],i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.stackClient.fetchJSON("GET","/jobs/triggers");case 3:return e=t.sent,t.abrupt("return",{data:e.data.map(function(t){return j(t,O)}),meta:{count:e.data.length},next:!1,skip:0});case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",(0,g.dontThrowNotFoundError)(t.t0));case 10:case"end":return t.stop()}},t,this,[[0,7]])})),function(){return E.apply(this,arguments)})},{key:"create",value:(S=(0,a.default)(i.default.mark(function t(e){var n,r;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,_.uri)(h),t.next=3,this.stackClient.fetchJSON("POST",n,{data:{attributes:e}});case 3:return r=t.sent,t.abrupt("return",{data:j(r.data)});case 5:case"end":return t.stop()}},t,this)})),function(t){return S.apply(this,arguments)})},{key:"destroy",value:(k=(0,a.default)(i.default.mark(function t(e){var n;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e._id){t.next=3;break}throw new Error("TriggerCollection.destroy needs a document with an _id");case 3:return t.next=5,this.stackClient.fetchJSON("DELETE",(0,_.uri)(v,n));case 5:return t.abrupt("return",{data:j((0,d.default)({},e,{_deleted:!0}))});case 6:case"end":return t.stop()}},t,this)})),function(t){return k.apply(this,arguments)})},{key:"find",value:(x=(0,a.default)(i.default.mark(function t(){var n,o,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(1!==(0,r.default)(a).length||!a.worker){t.next=14;break}return n="/jobs/triggers?Worker="+a.worker,t.prev=2,t.next=5,this.stackClient.fetchJSON("GET",n);case 5:return o=t.sent,t.abrupt("return",{data:o.data.map(function(t){return j(t,O)}),meta:{count:o.data.length},next:!1,skip:0});case 9:return t.prev=9,t.t0=t.catch(2),t.abrupt("return",(0,g.dontThrowNotFoundError)(t.t0));case 12:t.next=15;break;case 14:return t.abrupt("return",(0,l.default)(e.prototype.__proto__||(0,u.default)(e.prototype),"find",this).call(this,a,s));case 15:case"end":return t.stop()}},t,this,[[2,9]])})),function(){return x.apply(this,arguments)})},{key:"get",value:(b=(0,a.default)(i.default.mark(function t(e){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",m.default.get(this.stackClient,(0,_.uri)(v,e),{normalize:j}));case 1:case"end":return t.stop()}},t,this)})),function(t){return b.apply(this,arguments)})},{key:"launch",value:(o=(0,a.default)(i.default.mark(function t(e){var n,r;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,_.uri)(y,e._id),t.next=3,this.stackClient.fetchJSON("POST",n);case 3:return r=t.sent,t.abrupt("return",{data:(0,w.normalizeJob)(r.data)});case 5:case"end":return t.stop()}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"update",value:(n=(0,a.default)(i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("update() method is not available for triggers");case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})}]),e}(x.default);S.normalizeDoctype=x.default.normalizeDoctypeJsonApi,e.default=S},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getIconURL=void 0;var r=u(n(6)),o=u(n(36)),i=u(n(7)),a=u(n(847));function u(t){return t&&t.__esModule?t:{default:t}}var s,c,f={gif:"image/gif",ico:"image/vnd.microsoft.icon",jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml"},l=function(t){if(!t.icon)throw new Error(t.name+": Cannot detect icon mime type since app has no icon");var e=t.icon.split(".").pop();if(!e)throw new Error(t.name+": Unable to detect icon mime type from extension ("+t.icon+")");return e},p=(s=(0,i.default)(r.default.mark(function t(e,n){var i,a,u,s,c,f,l,p;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=void 0,a=!0,u=!1,s=void 0,t.prev=4,c=(0,o.default)(e);case 6:if(a=(f=c.next()).done){t.next=22;break}return l=f.value,t.prev=8,t.next=11,l();case 11:return p=t.sent,n&&n(p),t.abrupt("return",p);case 16:t.prev=16,t.t0=t.catch(8),i=t.t0;case 19:a=!0,t.next=6;break;case 22:t.next=28;break;case 24:t.prev=24,t.t1=t.catch(4),u=!0,s=t.t1;case 28:t.prev=28,t.prev=29,!a&&c.return&&c.return();case 31:if(t.prev=31,!u){t.next=34;break}throw s;case 34:return t.finish(31);case 35:return t.finish(28);case 36:throw i;case 37:case"end":return t.stop()}},t,void 0,[[4,24,28,36],[8,16],[29,,31,35]])})),function(t,e){return s.apply(this,arguments)}),d=function(t,e,n){return t.fetchJSON("GET","/"+e+"s/"+n).then(function(t){return t.data.attributes})},h=function(t,e,n){return t.fetchJSON("GET","/registry/"+n).then(function(t){return t.latest_version.manifest})},v=(c=(0,i.default)(r.default.mark(function t(e,n){var o,i,a,u,s,c,v,y,g,m,b;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=n.type,i=n.slug,a=n.appData,u=n.priority,c=[function(){return e.fetch("GET","/"+o+"s/"+i+"/icon")},function(){return e.fetch("GET","/registry/"+i+"/icon")}],"registry"===(s=void 0===u?"stack":u)&&c.reverse(),t.next=5,p(c,function(t){if(!t.ok)throw new Error("Error while fetching icon "+t.statusText)});case 5:return v=t.sent,t.next=8,v.blob();case 8:if(y=t.sent,g=void 0,y.type){t.next=26;break}if(m=[function(){return d(e,o,i)},function(){return h(e,0,i)}],"registry"===s&&m.reverse(),t.t1=a,t.t1){t.next=18;break}return t.next=17,p(m);case 17:t.t1=t.sent;case 18:if(t.t0=t.t1,t.t0){t.next=21;break}t.t0={};case 21:if(g=t.t0,b=l(g),f[b]){t.next=25;break}throw new Error('Unknown image extension "'+b+'" for app '+g.name);case 25:y=new Blob([y],{type:f[b]});case 26:return t.abrupt("return",URL.createObjectURL(y));case 27:case"end":return t.stop()}},t,void 0)})),function(t,e){return c.apply(this,arguments)}),y=function(){return v.apply(this,arguments).catch(function(t){return console.warn(t),""})};e.default=(0,a.default)(y,{maxDuration:3e5,key:function(t,e){var n=e.type,r=e.slug,o=e.priority;return t.uri+NaN+n+":"+r+":"+o}}),e.getIconURL=y},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(n(47)),o=i(n(36));function i(t){return t&&t.__esModule?t:{default:t}}var a=function(t,e){var n=Date.now(),i=!0,a=!1,u=void 0;try{for(var s,c=(0,o.default)((0,r.default)(t));!(i=(s=c.next()).done);i=!0){var f=s.value;n-t[f].date>e&&delete t[f]}}catch(t){a=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(a)throw u}}};e.default=function(t,e){var n={};return function(){var r=e.key.apply(null,arguments);a(n,e.maxDuration);var o=n[r];if(o)return o.result;var i=t.apply(this,arguments);return n[r]={result:i,date:Date.now()},i}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={EXPIRED_TOKEN:/Expired token/,CLIENT_NOT_FOUND:/Client not found/}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=g(n(6)),o=g(n(7)),i=g(n(47)),a=g(n(4)),u=g(n(8)),s=g(n(48)),c=g(n(1)),f=g(n(2)),l=g(n(12)),p=g(n(142)),d=g(n(13)),h=g(n(368)),v=g(n(850)),y=g(n(400));function g(t){return t&&t.__esModule?t:{default:t}}var m={clientID:"",clientName:"",clientKind:"",clientSecret:"",clientURI:"",registrationAccessToken:"",redirectURI:"",softwareID:"",softwareVersion:"",logoURI:"",policyURI:"",notificationPlatform:"",notificationDeviceToken:""},b=function(t){function e(t){var n=t.oauth,r=t.scope,o=void 0===r?[]:r,i=t.onTokenRefresh,f=(0,s.default)(t,["oauth","scope","onTokenRefresh"]);(0,c.default)(this,e);var p=(0,l.default)(this,(e.__proto__||(0,u.default)(e)).call(this,f));return p.setOAuthOptions((0,a.default)({},m,n)),n.token&&p.setToken(n.token),p.scope=o,p.onTokenRefresh=i,p}var n,h,g,b,w,_;return(0,d.default)(e,t),(0,f.default)(e,[{key:"isRegistered",value:function(){return""!==this.oauthOptions.clientID}},{key:"snakeCaseOAuthData",value:function(t){var e={softwareID:"software_id",softwareVersion:"software_version",clientID:"client_id",clientName:"client_name",clientKind:"client_kind",clientURI:"client_uri",logoURI:"logo_uri",policyURI:"policy_uri",notificationPlatform:"notification_platform",notificationDeviceToken:"notification_device_token",redirectURI:"redirect_uris"},n={};return(0,i.default)(t).forEach(function(r){var o=e[r]||r,i=t[r];n[o]=i}),n.redirect_uris&&n.redirect_uris instanceof Array==!1&&(n.redirect_uris=[n.redirect_uris]),n}},{key:"camelCaseOAuthData",value:function(t){var e={client_id:"clientID",client_name:"clientName",client_secret:"clientSecret",registration_access_token:"registrationAccessToken",software_id:"softwareID",redirect_uris:"redirectURI"},n={};return(0,i.default)(t).forEach(function(r){var o=e[r]||r,i=t[r];n[o]=i}),n}},{key:"register",value:(_=(0,o.default)(r.default.mark(function t(){var e,n,o,u;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isRegistered()){t.next=2;break}throw new Error("Client already registered");case 2:if(e=["redirectURI"],n=(0,i.default)(this.oauthOptions),!((o=e.filter(function(t){return n[t]})).length>0)){t.next=7;break}throw new Error("Can't register client : missing "+o+" fields");case 7:return t.next=9,this.fetchJSON("POST","/auth/register",this.snakeCaseOAuthData({redirectURI:this.oauthOptions.redirectURI,clientName:this.oauthOptions.clientName,softwareID:this.oauthOptions.softwareID,clientKind:this.oauthOptions.clientKind,clientURI:this.oauthOptions.clientURI,logoURI:this.oauthOptions.logoURI,policyURI:this.oauthOptions.policyURI,softwareVersion:this.oauthOptions.softwareVersion,notificationPlatform:this.oauthOptions.notificationPlatform,notificationDeviceToken:this.oauthOptions.notificationDeviceToken}));case 9:return u=t.sent,this.setOAuthOptions((0,a.default)({},this.oauthOptions,{client_id:u.client_id,client_name:u.client_name,client_secret:u.client_secret,registration_access_token:u.registration_access_token,software_id:u.software_id})),t.abrupt("return",this.oauthOptions);case 12:case"end":return t.stop()}},t,this)})),function(){return _.apply(this,arguments)})},{key:"unregister",value:(w=(0,o.default)(r.default.mark(function t(){var e;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isRegistered()){t.next=2;break}throw new x;case 2:return e=this.oauthOptions.clientID,this.oauthOptions.clientID="",t.abrupt("return",this.fetchJSON("DELETE","/auth/register/"+e,null,{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}}));case 5:case"end":return t.stop()}},t,this)})),function(){return w.apply(this,arguments)})},{key:"fetchInformation",value:(b=(0,o.default)(r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isRegistered()){t.next=2;break}throw new x;case 2:return t.abrupt("return",this.fetchJSON("GET","/auth/register/"+this.oauthOptions.clientID,null,{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}}));case 3:case"end":return t.stop()}},t,this)})),function(){return b.apply(this,arguments)})},{key:"updateInformation",value:(g=(0,o.default)(r.default.mark(function t(e){var n,o,i,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isRegistered()){t.next=2;break}throw new x;case 2:return n={clientID:this.oauthOptions.clientID,clientName:this.oauthOptions.clientName,redirectURI:this.oauthOptions.redirectURI,softwareID:this.oauthOptions.softwareID},o=this.snakeCaseOAuthData((0,a.default)({},n,e)),u&&(o.client_secret=this.oauthOptions.clientSecret),t.next=7,this.fetchJSON("PUT","/auth/register/"+this.oauthOptions.clientID,o,{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}});case 7:return i=t.sent,this.setOAuthOptions((0,a.default)({},o,i)),t.abrupt("return",this.oauthOptions);case 10:case"end":return t.stop()}},t,this)})),function(t){return g.apply(this,arguments)})},{key:"generateStateCode",value:function(){var t=void 0;if("undefined"!=typeof window&&void 0!==window.crypto&&"function"==typeof window.crypto.getRandomValues)t=new Uint8Array(16),window.crypto.getRandomValues(t);else{t=new Array(16);for(var e=0;e<t.length;e++)t[e]=Math.floor(255*Math.random())}return btoa(String.fromCharCode.apply(null,t)).replace(/=+$/,"").replace(/\//g,"_").replace(/\+/g,"-")}},{key:"getAuthCodeURL",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scope;if(!this.isRegistered())throw new x;var n={client_id:this.oauthOptions.clientID,redirect_uri:this.oauthOptions.redirectURI,state:t,response_type:"code",scope:e.join(" ")};return this.uri+"/auth/authorize?"+this.dataToQueryString(n)}},{key:"dataToQueryString",value:function(t){return(0,i.default)(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}},{key:"getAccessCodeFromURL",value:function(t,e){if(!e)throw new Error("Missing state code");var n=new URL(t).searchParams,r=n.get("state"),o=n.get("access_code");if(e!==r)throw new Error("Given state does not match url query state");return o}},{key:"fetchAccessToken",value:(h=(0,o.default)(r.default.mark(function t(e,n,o){var i,a;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isRegistered()||n){t.next=2;break}throw new x;case 2:return n=n||this.oauthOptions,i={grant_type:"authorization_code",code:e,client_id:n.clientID,client_secret:n.clientSecret},t.next=6,this.fetchJSON("POST",(o||"")+"/auth/access_token",this.dataToQueryString(i),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 6:return a=t.sent,t.abrupt("return",new v.default(a));case 8:case"end":return t.stop()}},t,this)})),function(t,e,n){return h.apply(this,arguments)})},{key:"refreshToken",value:(n=(0,o.default)(r.default.mark(function t(){var n,o,i;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isRegistered()){t.next=2;break}throw new x;case 2:if(this.token){t.next=4;break}throw new Error("No token to refresh");case 4:return n={grant_type:"refresh_token",refresh_token:this.token.refreshToken,client_id:this.oauthOptions.clientID,client_secret:this.oauthOptions.clientSecret},t.next=7,(0,p.default)(e.prototype.__proto__||(0,u.default)(e.prototype),"fetchJSON",this).call(this,"POST","/auth/access_token",this.dataToQueryString(n),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 7:return o=t.sent,i=new v.default((0,a.default)({refresh_token:this.token.refreshToken},o)),this.onTokenRefresh&&"function"==typeof this.onTokenRefresh&&this.onTokenRefresh(i),t.abrupt("return",i);case 11:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"exchangeOAuthSecret",value:function(t,e){return this.fetchJSON("POST",t+"/auth/secret_exchange",{secret:e})}},{key:"setToken",value:function(t){this.token=t?t instanceof v.default?t:new v.default(t):null}},{key:"setCredentials",value:function(t){return(0,y.default)("setCredentials is deprecated, please replace by setToken"),this.setToken(t)}},{key:"setOAuthOptions",value:function(t){this.oauthOptions=this.camelCaseOAuthData(t)}},{key:"resetClientId",value:function(){this.oauthOptions.clientID=""}},{key:"resetClient",value:function(){this.resetClientId(),this.setUri(null),this.setToken(null)}},{key:"registrationAccessTokenToAuthHeader",value:function(){if(!this.oauthOptions.registrationAccessToken)throw new Error("No registration access token");return"Bearer "+this.oauthOptions.registrationAccessToken}}]),e}(h.default),x=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Client not registered or missing OAuth information";(0,c.default)(this,e);var n=(0,l.default)(this,(e.__proto__||(0,u.default)(e)).call(this,t));return n.message=t,n.name="NotRegisteredException",n}return(0,d.default)(e,t),e}(Error);e.default=b},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a(n(193)),o=a(n(1)),i=a(n(2));function a(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(e){(0,o.default)(this,t),"string"==typeof e&&(e=JSON.parse(e)),this.tokenType=e.token_type||e.tokenType,this.accessToken=e.access_token||e.accessToken,this.refreshToken=e.refresh_token||e.refreshToken,this.scope=e.scope}return(0,i.default)(t,[{key:"toAuthHeader",value:function(){return"Bearer "+this.accessToken}},{key:"toBasicAuth",value:function(){return"user:"+this.accessToken+"@"}},{key:"toJSON",value:function(){return{tokenType:this.tokenType,accessToken:this.accessToken,refreshToken:this.refreshToken,scope:this.scope}}},{key:"toString",value:function(){return(0,r.default)(this.toJSON())}},{key:"getAccessToken",value:function(){return this.accessToken}}]),t}();e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.authenticateWithCordova=void 0;var r=s(n(6)),o=s(n(7)),i=s(n(61)),a=n(318),u=n(852);function s(t){return t&&t.__esModule?t:{default:t}}var c,f=function(t){return new i.default(function(e,n){window.SafariViewController.show({url:t,transition:"curl"},function(t){"closed"===t.event&&n(new Error(a.REGISTRATION_ABORT))},function(t){console.log("KO: "+t),n(new Error(a.REGISTRATION_ABORT))});var r=window.handleOpenURL;window.handleOpenURL=function(t){window.SafariViewController.hide(),e(t),r&&(window.handleOpenURL=r)}})},l=function(t){return new i.default(function(e,n){var r=window.cordova.InAppBrowser.open(t,"_blank","clearcache=yes,zoom=no"),o=function(){r.removeEventListener("loadstart",i),r.removeEventListener("exit",u)},i=function(t){var n=t.url,i=/\?access_code=(.+)$/.test(n),a=/\?state=(.+)$/.test(n);(i||a)&&(e(n),o(),r.close())},u=function(){n(new Error(a.REGISTRATION_ABORT)),o(),r.close()};r.addEventListener("loadstart",i),r.addEventListener("exit",u)})};e.authenticateWithCordova=(c=(0,o.default)(r.default.mark(function t(e){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=(0,u.isIOSApp)(),!t.t0){t.next=5;break}return t.next=4,(0,u.hasSafariPlugin)();case 4:t.t0=t.sent;case 5:if(!t.t0){t.next=9;break}return t.abrupt("return",f(e));case 9:if(!(0,u.hasInAppBrowserPlugin)()){t.next=13;break}return t.abrupt("return",l(e));case 13:return console.log(e),t.abrupt("return",new i.default(function(t){setTimeout(function(){var e=prompt("Paste the url here:");t(e)},5e3)}));case 15:case"end":return t.stop()}},t,void 0)})),function(t){return c.apply(this,arguments)})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"getPlatform",{enumerable:!0,get:function(){return r.getPlatform}}),Object.defineProperty(e,"isIOSApp",{enumerable:!0,get:function(){return r.isIOSApp}}),Object.defineProperty(e,"isAndroidApp",{enumerable:!0,get:function(){return r.isAndroidApp}}),Object.defineProperty(e,"isWebApp",{enumerable:!0,get:function(){return r.isWebApp}}),Object.defineProperty(e,"isMobileApp",{enumerable:!0,get:function(){return r.isMobileApp}}),Object.defineProperty(e,"isAndroid",{enumerable:!0,get:function(){return r.isAndroid}}),Object.defineProperty(e,"isIOS",{enumerable:!0,get:function(){return r.isIOS}}),Object.defineProperty(e,"isMobile",{enumerable:!0,get:function(){return r.isMobile}}),Object.defineProperty(e,"getDeviceName",{enumerable:!0,get:function(){return o.getDeviceName}}),Object.defineProperty(e,"checkApp",{enumerable:!0,get:function(){return i.checkApp}}),Object.defineProperty(e,"startApp",{enumerable:!0,get:function(){return i.startApp}}),Object.defineProperty(e,"hasDevicePlugin",{enumerable:!0,get:function(){return a.hasDevicePlugin}}),Object.defineProperty(e,"hasInAppBrowserPlugin",{enumerable:!0,get:function(){return a.hasInAppBrowserPlugin}}),Object.defineProperty(e,"hasSafariPlugin",{enumerable:!0,get:function(){return a.hasSafariPlugin}}),Object.defineProperty(e,"nativeLinkOpen",{enumerable:!0,get:function(){return u.nativeLinkOpen}}),Object.defineProperty(e,"openDeeplinkOrRedirect",{enumerable:!0,get:function(){return s.openDeeplinkOrRedirect}});var r=n(246),o=n(853),i=n(861),a=n(248),u=n(863),s=n(864)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getDeviceName=void 0;var r,o=(r=n(854))&&r.__esModule?r:{default:r},i=n(247),a=n(248),u=n(246);e.getDeviceName=function(){if(!(0,a.hasDevicePlugin)())return(0,i.isCordova)()&&console.warn("You should install `cordova-plugin-device`."),"Device";var t=window.device,e=t.manufacturer,n=t.model,r=(0,u.isIOSApp)()?function(t){for(var e=["iPhone","iPad","Watch","AppleTV"],n=0;n<e.length;n++){var r=e[n];if(t.match(new RegExp(r)))return r}return"Device"}(n):n;return"".concat((0,o.default)(e)," ").concat(r)}},function(t,e,n){var r=n(153),o=n(855);t.exports=function(t){return o(r(t).toLowerCase())}},function(t,e,n){var r=n(856)("toUpperCase");t.exports=r},function(t,e,n){var r=n(857),o=n(401),i=n(858),a=n(153);t.exports=function(t){return function(e){e=a(e);var n=o(e)?i(e):void 0,u=n?n[0]:e.charAt(0),s=n?r(n,1).join(""):e.slice(1);return u[t]()+s}}},function(t,e,n){var r=n(393);t.exports=function(t,e,n){var o=t.length;return n=void 0===n?o:n,!e&&n>=o?t:r(t,e,n)}},function(t,e,n){var r=n(859),o=n(401),i=n(860);t.exports=function(t){return o(t)?i(t):r(t)}},function(t,e){t.exports=function(t){return t.split("")}},function(t,e){var n="[\\ud800-\\udfff]",r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",o="\\ud83c[\\udffb-\\udfff]",i="[^\\ud800-\\udfff]",a="(?:\\ud83c[\\udde6-\\uddff]){2}",u="[\\ud800-\\udbff][\\udc00-\\udfff]",s="(?:"+r+"|"+o+")"+"?",c="[\\ufe0e\\ufe0f]?"+s+("(?:\\u200d(?:"+[i,a,u].join("|")+")[\\ufe0e\\ufe0f]?"+s+")*"),f="(?:"+[i+r+"?",r,a,u,n].join("|")+")",l=RegExp(o+"(?="+o+")|"+f+c,"g");t.exports=function(t){return t.match(l)||[]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.startApp=e.checkApp=void 0;var r,o=(r=n(402))&&r.__esModule?r:{default:r},i=n(246);function a(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function u(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function u(t){a(i,r,o,u,s,"next",t)}function s(t){a(i,r,o,u,s,"throw",t)}u(void 0)})}}var s=function(){return window.startApp},c=function(t){var e=t.appId,n=t.uri;return(0,i.isAndroidApp)()?{package:e}:n},f={},l=f.startApp=function(){var t=u(o.default.mark(function t(e){var n,r;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=window.startApp,t.next=3,f.checkApp(e);case 3:if(!t.sent){t.next=9;break}return r=c(e),t.abrupt("return",new Promise(function(t,e){s()?n.set(r).start(t,e):e(new Error("Cordova plugin 'com.lampa.startapp' is not installed. This plugin is needed to start a native app. Required by cozy-bar"))}));case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}();e.startApp=l;var p=f.checkApp=function(){var t=u(o.default.mark(function t(e){var n,r;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=window.startApp,r=c(e),t.abrupt("return",new Promise(function(t,e){s()?n.set(r).check(function(e){t("OK"===e||e)},function(n){!1===n||0===n.indexOf("NameNotFoundException")?t(!1):e(n)}):e(new Error("Cordova plugin 'com.lampa.startapp' is not installed."))}));case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}();e.checkApp=p;var d=f;e.default=d},function(t,e,n){var r=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function s(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,i=Object.create(o.prototype),a=new E(r||[]);return i._invoke=function(t,e,n){var r=f;return function(o,i){if(r===p)throw new Error("Generator is already running");if(r===d){if("throw"===o)throw i;return C()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var u=O(a,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var s=c(t,e,n);if("normal"===s.type){if(r=n.done?d:l,s.arg===h)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r=d,n.method="throw",n.arg=s.arg)}}}(t,n,a),i}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var f="suspendedStart",l="suspendedYield",p="executing",d="completed",h={};function v(){}function y(){}function g(){}var m={};m[i]=function(){return this};var b=Object.getPrototypeOf,x=b&&b(b(A([])));x&&x!==n&&r.call(x,i)&&(m=x);var w=g.prototype=v.prototype=Object.create(m);function _(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function k(t){var e;this._invoke=function(n,o){function i(){return new Promise(function(e,i){!function e(n,o,i,a){var u=c(t[n],t,o);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==typeof f&&r.call(f,"__await")?Promise.resolve(f.__await).then(function(t){e("next",t,i,a)},function(t){e("throw",t,i,a)}):Promise.resolve(f).then(function(t){s.value=t,i(s)},function(t){return e("throw",t,i,a)})}a(u.arg)}(n,o,e,i)})}return e=e?e.then(i,i):i()}}function O(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method))return h;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var o=c(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,h;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,h):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function A(t){if(t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}return{next:C}}function C(){return{value:e,done:!0}}return y.prototype=w.constructor=g,g.constructor=y,g[u]=y.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,u in t||(t[u]="GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},_(k.prototype),k.prototype[a]=function(){return this},t.AsyncIterator=k,t.async=function(e,n,r,o){var i=new k(s(e,n,r,o));return t.isGeneratorFunction(n)?i:i.next().then(function(t){return t.done?t.value:i.next()})},_(w),w[u]="Generator",w[i]=function(){return this},w.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return u.type="throw",u.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:A(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),h}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.nativeLinkOpen=void 0;var r,o=(r=n(402))&&r.__esModule?r:{default:r},i=n(248);function a(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}var u=function(){var t,e=(t=o.default.mark(function t(e){var n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.url,t.next=3,(0,i.hasSafariPlugin)();case 3:if(t.t0=t.sent,!t.t0){t.next=6;break}t.t0=window.SafariViewController;case 6:if(!t.t0){t.next=10;break}window.SafariViewController.show({url:n,transition:"curl"},function(t){"closed"===t.event&&window.SafariViewController.hide()},function(){window.SafariViewController.hide()}),t.next=11;break;case 10:(0,i.hasInAppBrowserPlugin)()?window.cordova.InAppBrowser.open(n,"_blank","clearcache=yes,zoom=no"):window.location=n;case 11:case"end":return t.stop()}},t)}),function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function u(t){a(i,r,o,u,s,"next",t)}function s(t){a(i,r,o,u,s,"throw",t)}u(void 0)})});return function(t){return e.apply(this,arguments)}}();e.nativeLinkOpen=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.openDeeplinkOrRedirect=void 0;var r=function(t,e){var n=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);window.addEventListener("blur",i);var r=function(t,e,n){var r=document.createElement("iframe");return r.src=e,r.id="hiddenIframe_".concat(n),r.style.display="none",t.appendChild(r),r}(document.body,"about:blank",n),o=setTimeout(function(){e(),window.removeEventListener("blur",i),r.parentElement.removeChild(r)},500);function i(){clearTimeout(o),window.removeEventListener("blur",i),r.parentElement.removeChild(r)}r.contentWindow.location.href=t};e.openDeeplinkOrRedirect=function(t,e){if(navigator.msLaunchUri)!function(t,e){navigator.msLaunchUri(t,void 0,e)}(t,e);else{var n=(o=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,i=navigator.userAgent.toLowerCase(),a=i.includes("safari")&&!i.includes("chrome")||Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,u=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,s=u&&(i.includes("os 12_2")||i.includes("os 12_3")),{isOpera:o,isFirefox:"undefined"!=typeof InstallTrigger,isSafari:a,isChrome:!!window.chrome&&!o,isIOS122:s,isIOS:u});n.isChrome||n.isIOS&&!n.isIOS122?function(t,e){for(var n=setTimeout(function(){e(),r.removeEventListener("blur",o)},500),r=window;r!=r.parent;)r=r.parent;function o(){clearTimeout(n),r.removeEventListener("blur",o)}r.addEventListener("blur",o),window.location=t}(t,e):n.isSafari&&!n.isIOS122||n.isFirefox?r(t,e):e()}var o,i,a,u,s}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=l(n(94)),o=l(n(140)),i=l(n(866)),a=l(n(202)),u=l(n(358)),s=l(n(867)),c=l(n(868)),f=n(49);function l(t){return t&&t.__esModule?t:{default:t}}var p=function(t){var e=(0,i.default)(t,function(t){return(e=t).id||e.ids?"idQueries":"others";var e}),n=e.idQueries,r=void 0===n?[]:n,o=e.others,l=void 0===o?[]:o,p=r.length>0?new f.QueryDefinition({doctype:t[0].doctype,ids:(0,s.default)((0,a.default)(r.map(function(t){return t.id||t.ids})))}):[];return(0,c.default)(l,u.default).concat(p)};e.default=function(t){var e=(0,i.default)(t,function(t){return t.doctype});return(0,a.default)((0,r.default)((0,o.default)(e,p)))}},function(t,e,n){var r=n(67),o=n(356),i=Object.prototype.hasOwnProperty,a=o(function(t,e,n){i.call(t,n)?t[n].push(e):r(t,n,[e])});t.exports=a},function(t,e,n){var r=n(141);t.exports=function(t){return t&&t.length?r(t):[]}},function(t,e,n){var r=n(141);t.exports=function(t,e){return e="function"==typeof e?e:void 0,t&&t.length?r(t,void 0,e):[]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=y(n(6)),o=y(n(47)),i=y(n(7)),a=y(n(94)),u=y(n(1)),s=y(n(2)),c=y(n(4)),f=y(n(355)),l=y(n(140)),p=y(n(870)),d=y(n(876)),h=y(n(881)),v=n(125);function y(t){return t&&t.__esModule?t:{default:t}}var g=function(t){var e=(0,l.default)(t.relationships||{},function(t,e){return(0,c.default)({},t,{name:e,type:(0,v.resolveClass)(t.doctype,t.type)})});return(0,c.default)({},t,{relationships:(0,d.default)(e)>0?(0,f.default)(e,"name"):null})},m=function(t,e){if(!t)throw new Error(e)},b=function(t,e){var n=(0,h.default)(t,e,function(t){return t.name});m(0===n.length,"Duplicated names in schemas being added: "+n.map(function(t){return t.name}).join(", "));var r=(0,h.default)(t,e,function(t){return t.doctype});m(0===r.length,"Duplicated doctypes in schemas being added: "+r.map(function(t){return t.name}).join(", "))},x=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,u.default)(this,t),this.byDoctype={},this.add(e),this.client=n}var e,n;return(0,s.default)(t,[{key:"add",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=(0,l.default)(t,function(t,e){return(0,c.default)({name:e},g(t))});b((0,a.default)(e),(0,a.default)(this.byDoctype)),(0,p.default)(this.byDoctype,(0,f.default)(e,function(t){return t.doctype}))}},{key:"getDoctypeSchema",value:function(t){var e=this.byDoctype[t];return e||(e=g({name:t,doctype:t}),this.byDoctype[t]=e),e}},{key:"getRelationship",value:function(t,e){return this.getDoctypeSchema(t).relationships[e]}},{key:"validate",value:(n=(0,i.default)(r.default.mark(function t(e){var n,i,a,u;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n={},i=this.byDoctype[e._type]){t.next=4;break}return t.abrupt("return",!0);case 4:if(i.attributes){t.next=6;break}return t.abrupt("return",!0);case 6:t.t0=r.default.keys(i.attributes);case 7:if((t.t1=t.t0()).done){t.next=15;break}return a=t.t1.value,t.next=11,this.validateAttribute(e,a,i.attributes[a]);case 11:!0!==(u=t.sent)&&(n[a]=u),t.next=7;break;case 15:if(0!==(0,o.default)(n).length){t.next=17;break}return t.abrupt("return",!0);case 17:return t.abrupt("return",n);case 18:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"validateAttribute",value:(e=(0,i.default)(r.default.mark(function t(e,n,o){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!o.unique||!this.client){t.next=6;break}return t.next=3,this.client.collection(e._type).checkUniquenessOf(n,e[n]);case 3:if(!0===t.sent){t.next=6;break}return t.abrupt("return","must be unique");case 6:return t.abrupt("return",!0);case 7:case"end":return t.stop()}},t,this)})),function(t,n,r){return e.apply(this,arguments)})}]),t}();e.default=x},function(t,e,n){var r=n(871),o=n(874)(function(t,e,n){r(t,e,n)});t.exports=o},function(t,e,n){var r=n(134),o=n(403),i=n(350),a=n(872),u=n(26),s=n(138),c=n(404);t.exports=function t(e,n,f,l,p){e!==n&&i(n,function(i,s){if(p||(p=new r),u(i))a(e,n,s,f,t,l,p);else{var d=l?l(c(e,s),i,s+"",e,n,p):void 0;void 0===d&&(d=i),o(e,s,d)}},s)}},function(t,e,n){var r=n(403),o=n(363),i=n(364),a=n(218),u=n(365),s=n(132),c=n(9),f=n(101),l=n(137),p=n(197),d=n(26),h=n(216),v=n(208),y=n(404),g=n(873);t.exports=function(t,e,n,m,b,x,w){var _=y(t,n),k=y(e,n),O=w.get(k);if(O)r(t,n,O);else{var j=x?x(_,k,n+"",t,e,w):void 0,S=void 0===j;if(S){var E=c(k),A=!E&&l(k),C=!E&&!A&&v(k);j=k,E||A||C?c(_)?j=_:f(_)?j=a(_):A?(S=!1,j=o(k,!0)):C?(S=!1,j=i(k,!0)):j=[]:h(k)||s(k)?(j=_,s(_)?j=g(_):d(_)&&!p(_)||(j=u(k))):S=!1}S&&(w.set(k,j),b(j,k,m,x,w),w.delete(k)),r(t,n,j)}}},function(t,e,n){var r=n(72),o=n(138);t.exports=function(t){return r(t,o(t))}},function(t,e,n){var r=n(71),o=n(875);t.exports=function(t){return r(function(e,n){var r=-1,i=n.length,a=i>1?n[i-1]:void 0,u=i>2?n[2]:void 0;for(a=t.length>3&&"function"==typeof a?(i--,a):void 0,u&&o(n[0],n[1],u)&&(a=i<3?void 0:a,i=1),e=Object(e);++r<i;){var s=n[r];s&&t(e,s,r,a)}return e})}},function(t,e,n){var r=n(95),o=n(68),i=n(131),a=n(26);t.exports=function(t,e,n){if(!a(n))return!1;var u=typeof e;return!!("number"==u?o(n)&&i(e,n.length):"string"==u&&e in n)&&r(n[e],t)}},function(t,e,n){var r=n(339),o=n(99),i=n(68),a=n(321),u=n(877),s="[object Map]",c="[object Set]";t.exports=function(t){if(null==t)return 0;if(i(t))return a(t)?u(t):t.length;var e=o(t);return e==s||e==c?t.size:r(t).length}},function(t,e,n){var r=n(878),o=n(879),i=n(880);t.exports=function(t){return o(t)?i(t):r(t)}},function(t,e,n){var r=n(211)("length");t.exports=r},function(t,e){var n=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");t.exports=function(t){return n.test(t)}},function(t,e){var n="[\\ud800-\\udfff]",r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",o="\\ud83c[\\udffb-\\udfff]",i="[^\\ud800-\\udfff]",a="(?:\\ud83c[\\udde6-\\uddff]){2}",u="[\\ud800-\\udbff][\\udc00-\\udfff]",s="(?:"+r+"|"+o+")"+"?",c="[\\ufe0e\\ufe0f]?"+s+("(?:\\u200d(?:"+[i,a,u].join("|")+")[\\ufe0e\\ufe0f]?"+s+")*"),f="(?:"+[i+r+"?",r,a,u,n].join("|")+")",l=RegExp(o+"(?="+o+")|"+f+c,"g");t.exports=function(t){for(var e=l.lastIndex=0;l.test(t);)++e;return e}},function(t,e,n){var r=n(37),o=n(352),i=n(96),a=n(71),u=n(353),s=n(366),c=a(function(t){var e=s(t),n=r(t,u);return e===s(n)?e=void 0:n.pop(),n.length&&n[0]===t[0]?o(n,i(e,2)):[]});t.exports=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=c(n(63)),o=c(n(47)),i=c(n(4)),a=c(n(1)),u=c(n(2)),s=n(100);function c(t){return t&&t.__esModule?t:{default:t}}var f=Object.prototype.hasOwnProperty,l=function(){function t(e,n,i){var u=this;if((0,a.default)(this,t),this.handleStoreChange=function(){var t=u.currentRawResult();(function(t,e){if(p(t,e))return!0;if("object"!==(void 0===t?"undefined":(0,r.default)(t))||null===t||"object"!==(void 0===e?"undefined":(0,r.default)(e))||null===e)return!1;var n=(0,o.default)(t),i=(0,o.default)(e);if(n.length!==i.length)return!1;for(var a=0;a<n.length;a++)if(!f.call(e,n[a])||!p(t[n[a]],e[n[a]]))return!1;return!0})(t,u.lastResult)||(u.lastResult=t,u.notifyObservers())},!e||!n||!i)throw new Error("ObservableQuery takes 3 arguments: queryId, definition and client");this.queryId=e,this.definition=n,this.client=i,this.observers={},this.idCounter=1,this.lastResult=this.currentRawResult(),this.unsubscribeStore=this.getStore().subscribe(this.handleStoreChange)}return(0,u.default)(t,[{key:"currentResult",value:function(){var t=(0,s.getQueryFromState)(this.getStore().getState(),this.queryId);if(!t.lastFetch)return t;var e=this.client.hydrateDocuments(this.definition.doctype,t.data);return(0,i.default)({},t,{data:this.definition.id?e[0]:e})}},{key:"fetch",value:function(){return this.client.query(this.definition,{as:this.queryId})}},{key:"fetchMore",value:function(){return this.client.query(this.definition.offset(this.currentRawResult().data.length),{as:this.queryId})}},{key:"currentRawResult",value:function(){return(0,s.getRawQueryFromState)(this.getStore().getState(),this.queryId)}},{key:"notifyObservers",value:function(){var t=this;(0,o.default)(this.observers).forEach(function(e){return t.observers[e]()})}},{key:"subscribe",value:function(t){var e=this,n=this.idCounter;return this.idCounter++,this.observers[n]=t,function(){return e.unsubscribe(n)}}},{key:"unsubscribe",value:function(t){delete this.observers[t]}},{key:"getStore",value:function(){return this.client.store}}]),t}();function p(t,e){return t===e?0!==t||0!==e||1/t==1/e:t!=t&&e!=e}e.default=l},function(t,e){t.exports=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var o=t[e];r[o[0]]=o[1]}return r}},function(t,e,n){var r=n(96),o=n(141);t.exports=function(t,e){return t&&t.length?o(t,r(e,2)):[]}},function(t,e,n){var r=n(71)(n(886));t.exports=r},function(t,e,n){var r=n(335),o=n(37),i=n(211),a=n(338),u=n(101),s=Math.max;t.exports=function(t){if(!t||!t.length)return[];var e=0;return t=r(t,function(t){if(u(t))return e=s(t.length,e),!0}),a(e,function(e){return o(t,i(e))})}},function(t,e,n){var r=n(362),o=n(357),i=n(888),a=n(9);t.exports=function(t,e){return(a(t)?r:o)(t,i(e))}},function(t,e,n){var r=n(133);t.exports=function(t){return"function"==typeof t?t:r}},function(t,e){function n(){this._events={}}n.prototype={on:function(t,e){this._events||(this._events={});var n=this._events;return(n[t]||(n[t]=[])).push(e),this},removeListener:function(t,e){var n,r=this._events[t]||[];for(n=r.length-1;n>=0&&r[n];n--)r[n]!==e&&r[n].cb!==e||r.splice(n,1)},removeAllListeners:function(t){t?this._events[t]&&(this._events[t]=[]):this._events={}},listeners:function(t){return this._events&&this._events[t]||[]},emit:function(t){this._events||(this._events={});var e,n=Array.prototype.slice.call(arguments,1),r=this._events[t]||[];for(e=r.length-1;e>=0&&r[e];e--)r[e].apply(this,n);return this},when:function(t,e){return this.once(t,e,!0)},once:function(t,e,n){if(!e)return this;function r(){n||this.removeListener(t,r),e.apply(this,arguments)&&n&&this.removeListener(t,r)}return r.cb=e,this.on(t,r),this}},n.mixin=function(t){var e,r=n.prototype;for(e in r)r.hasOwnProperty(e)&&(t.prototype[e]=r[e])},t.exports=n},function(t,e,n){var r=n(891)();t.exports=r},function(t,e,n){var r=n(249),o=n(201),i=n(405),a=n(406),u=n(9),s=n(894),c="Expected a function",f=8,l=32,p=128,d=256;t.exports=function(t){return o(function(e){var n=e.length,o=n,h=r.prototype.thru;for(t&&e.reverse();o--;){var v=e[o];if("function"!=typeof v)throw new TypeError(c);if(h&&!y&&"wrapper"==a(v))var y=new r([],!0)}for(o=y?o:n;++o<n;){v=e[o];var g=a(v),m="wrapper"==g?i(v):void 0;y=m&&s(m[0])&&m[1]==(p|f|l|d)&&!m[4].length&&1==m[9]?y[a(m[0])].apply(y,m[3]):1==v.length&&s(v)?y[g]():y.thru(v)}return function(){var t=arguments,r=t[0];if(y&&1==t.length&&u(r))return y.plant(r).value();for(var o=0,i=n?e[o].apply(this,t):r;++o<n;)i=e[o].call(this,i);return i}})}},function(t,e,n){var r=n(342),o=r&&new r;t.exports=o},function(t,e){t.exports={}},function(t,e,n){var r=n(251),o=n(405),i=n(406),a=n(895);t.exports=function(t){var e=i(t),n=a[e];if("function"!=typeof n||!(e in r.prototype))return!1;if(t===n)return!0;var u=o(n);return!!u&&t===u[0]}},function(t,e,n){var r=n(251),o=n(249),i=n(250),a=n(9),u=n(20),s=n(896),c=Object.prototype.hasOwnProperty;function f(t){if(u(t)&&!a(t)&&!(t instanceof r)){if(t instanceof o)return t;if(c.call(t,"__wrapped__"))return s(t)}return new o(t)}f.prototype=i.prototype,f.prototype.constructor=f,t.exports=f},function(t,e,n){var r=n(251),o=n(249),i=n(218);t.exports=function(t){if(t instanceof r)return t.clone();var e=new o(t.__wrapped__,t.__chain__);return e.__actions__=i(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cancelable=void 0;var r,o=n(61),i=(r=o)&&r.__esModule?r:{default:r};e.cancelable=function(t){var e=void 0,n=new i.default(function(n,r){e=r,t.then(n),t.catch(r)});return n.cancel=function(){e({canceled:!0})},n}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=c(n(6)),o=c(n(7)),i=c(n(1)),a=c(n(2));n(899);var u=c(n(900)),s=n(901);function c(t){return t&&t.__esModule?t:{default:t}}var f=function(t){var e=t.type;return"/"+(e===s.APP_TYPE.KONNECTOR||"node"===e?"konnectors":"apps")},l=function(){function t(e){if((0,i.default)(this,t),!e.client)throw new Error("Need to pass a client to instantiate a Registry API.");this.client=e.client}var e,n,s;return(0,a.default)(t,[{key:"installApp",value:(s=(0,o.default)(r.default.mark(function t(e,n){var o,i,a,s,c,l,p;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.slug,i=e.terms,a={},(s=e.installed)&&(a.PermissionsAcked=s),n&&(a.Source=n),r=void 0,r=new URLSearchParams(a).toString(),c=r?"?"+r:"",!i){t.next=9;break}return t.next=9,u.default.save(this.client,i);case 9:return l=e.installed?"PUT":"POST",p=f(e),t.abrupt("return",this.client.stackClient.fetchJSON(l,p+"/"+o+c));case 12:case"end":return t.stop()}var r},t,this)})),function(t,e){return s.apply(this,arguments)})},{key:"uninstallApp",value:(n=(0,o.default)(r.default.mark(function t(e){var n,o;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.slug,o=f(e),t.abrupt("return",this.client.stackClient.fetchJSON("DELETE",o+"/"+n));case 3:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"fetchApps",value:(e=(0,o.default)(r.default.mark(function t(e){var n,o,i,a,u;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.channel,o=e.type,i=new URLSearchParams({limit:200,versionsChannel:n,latestChannelVersion:n}).toString(),o&&(i=i+"&filter[type]="+o),t.next=6,this.client.stackClient.fetchJSON("GET","/registry?"+i);case 6:return a=t.sent,u=a.data,t.abrupt("return",u);case 9:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})}]),t}();e.default=l},function(t,e){!function(t){"use strict";var e,n=t.URLSearchParams&&t.URLSearchParams.prototype.get?t.URLSearchParams:null,r=n&&"a=1"===new n({a:1}).toString(),o=n&&"+"===new n("s=%2B").get("s"),i="__URLSearchParams__",a=!n||((e=new n).append("s"," &"),"s=+%26"===e.toString()),u=l.prototype,s=!(!t.Symbol||!t.Symbol.iterator);if(!(n&&r&&o&&a)){u.append=function(t,e){y(this[i],t,e)},u.delete=function(t){delete this[i][t]},u.get=function(t){var e=this[i];return t in e?e[t][0]:null},u.getAll=function(t){var e=this[i];return t in e?e[t].slice(0):[]},u.has=function(t){return t in this[i]},u.set=function(t,e){this[i][t]=[""+e]},u.toString=function(){var t,e,n,r,o=this[i],a=[];for(e in o)for(n=p(e),t=0,r=o[e];t<r.length;t++)a.push(n+"="+p(r[t]));return a.join("&")};var c=!!o&&n&&!r&&t.Proxy;Object.defineProperty(t,"URLSearchParams",{value:c?new Proxy(n,{construct:function(t,e){return new t(new l(e[0]).toString())}}):l});var f=t.URLSearchParams.prototype;f.polyfill=!0,f.forEach=f.forEach||function(t,e){var n=v(this.toString());Object.getOwnPropertyNames(n).forEach(function(r){n[r].forEach(function(n){t.call(e,n,r,this)},this)},this)},f.sort=f.sort||function(){var t,e,n,r=v(this.toString()),o=[];for(t in r)o.push(t);for(o.sort(),e=0;e<o.length;e++)this.delete(o[e]);for(e=0;e<o.length;e++){var i=o[e],a=r[i];for(n=0;n<a.length;n++)this.append(i,a[n])}},f.keys=f.keys||function(){var t=[];return this.forEach(function(e,n){t.push(n)}),h(t)},f.values=f.values||function(){var t=[];return this.forEach(function(e){t.push(e)}),h(t)},f.entries=f.entries||function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),h(t)},s&&(f[t.Symbol.iterator]=f[t.Symbol.iterator]||f.entries)}function l(t){((t=t||"")instanceof URLSearchParams||t instanceof l)&&(t=t.toString()),this[i]=v(t)}function p(t){var e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'\(\)~]|%20|%00/g,function(t){return e[t]})}function d(t){return t.replace(/[ +]/g,"%20").replace(/(%[a-f0-9]{2})+/gi,function(t){return decodeURIComponent(t)})}function h(e){var n={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return s&&(n[t.Symbol.iterator]=function(){return n}),n}function v(t){var e={};if("object"==typeof t)for(var n in t)t.hasOwnProperty(n)&&y(e,n,t[n]);else{0===t.indexOf("?")&&(t=t.slice(1));for(var r=t.split("&"),o=0;o<r.length;o++){var i=r[o],a=i.indexOf("=");-1<a?y(e,d(i.slice(0,a)),d(i.slice(a+1))):i&&y(e,d(i),"")}}return e}function y(t,e,n){var r="string"==typeof n?n:null!=n&&"function"==typeof n.toString?n.toString():JSON.stringify(n);e in t?t[e].push(r):t[e]=[r]}}("undefined"!=typeof global?global:"undefined"!=typeof window?window:this)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,o=c(n(6)),i=c(n(4)),a=c(n(48)),u=c(n(7)),s=(r=(0,u.default)(o.default.mark(function t(e,n){var r,u,s,c,l,p,d;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.id,u=(0,a.default)(n,["id"]),t.next=3,e.query({doctype:f,selector:{termsId:r,version:u.version},limit:1});case 3:if(s=t.sent,!(c=s.data)||!c.length){t.next=13;break}if((l=c[0]).termsId!=r||l.version!=u.version||l.url==u.url){t.next=11;break}return p=(0,i.default)({_type:f},l,{url:u.url}),t.next=11,e.save(p);case 11:t.next=16;break;case 13:return d=(0,i.default)({_type:f},u,{termsId:r,accepted:!0,acceptedAt:new Date}),t.next=16,e.save(d);case 16:case"end":return t.stop()}},t,this)})),function(t,e){return r.apply(this,arguments)});function c(t){return t&&t.__esModule?t:{default:t}}var f="io.cozy.terms";e.default={save:s}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.APP_TYPE={KONNECTOR:"konnector",WEBAPP:"webapp"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(n(63)),o=i(n(4));function i(t){return t&&t.__esModule?t:{default:t}}e.sanitizeCategories=u,e.areTermsValid=s,e.isPartnershipValid=c,e.sanitize=function(t){var e=(0,o.default)({},t);!t.categories&&t.category&&"string"==typeof t.category&&(e.categories=[t.category],delete e.category);e.categories=u(e.categories),"object"===(0,r.default)(t.name)&&(e.name=t.name.en);t.available_version&&(e.availableVersion=t.available_version,delete e.available_version);t.latest_version&&(e.latestVersion=t.latestVersion,delete e.latest_version);e.terms&&!s(e.terms)&&delete e.terms;e.partnership&&!c(e.partnership)&&delete e.partnership;return e};var a=["banking","cozy","energy","health","host_provider","insurance","isp","mes_infos","online_services","others","partners","press","productivity","ptnb","public_service","shopping","social","telecom","transport"];function u(t){if(!t)return["others"];var e=t.filter(function(t){return a.includes(t)});return e.length?e:["others"]}function s(t){return Boolean(t&&t.id&&t.url&&t.version)}function c(t){return Boolean(t&&t.description)}},function(t,e,n){const r={secret:0,debug:10,info:20,warn:30,error:40,ok:50,critical:50},o=n(407);t.exports={filterSecrets:function(t,e,n){if("secret"!==e&&n instanceof o)throw new Error("You should log a secret with log.secret")},filterLevel:function(t,e){return r[e]>=r[t]}}},function(t,e,n){const r=n(905);n(907);t.exports=r},function(t,e,n){const r=n(906),o=65535;t.exports=function(t,e,n,i){const a={time:new Date,type:t,label:n,namespace:i};"object"==typeof e?(e&&e.no_retry&&(a.no_retry=e.no_retry),e&&e.message&&(a.message=e.message)):a.message=e,a.message&&a.message.stack&&(a.message=a.message.stack);let u=a;try{u=r(a).substr(0,o)}catch(t){console.log(t.message,"cozy-logger: Failed to convert message to JSON")}return u}},function(t,e){function n(t,e){var n=[],r=[];return null==e&&(e=function(t,e){return n[0]===e?"[Circular ~]":"[Circular ~."+r.slice(0,n.indexOf(e)).join(".")+"]"}),function(o,i){if(n.length>0){var a=n.indexOf(this);~a?n.splice(a+1):n.push(this),~a?r.splice(a,1/0,o):r.push(o),~n.indexOf(i)&&(i=e.call(this,o,i))}else n.push(i);return null==t?i:t.call(this,o,i)}}(t.exports=function(t,e,r,o){return JSON.stringify(t,n(e,o),r)}).getSerialize=n},function(t,e,n){const r=n(908),o=n(909);r&&r.inspect&&r.inspect.defaultOptions&&(r.inspect.defaultOptions.maxArrayLength=null,r.inspect.defaultOptions.depth=2,r.inspect.defaultOptions.colors=!0);const i={debug:"cyan",warn:"yellow",info:"blue",error:"red",ok:"green",secret:"red",critical:"red"};t.exports=function(t,e,n,a){let u=e;"string"!=typeof u&&(u=r.inspect(u));let s=n?` : "${n}" `:"",c=a?o.magenta(`${a}: `):"",f=i[t];return`${c}${f?o[f](t):t}${s} : ${u}`}},function(t,e){t.exports=require("util")},function(t,e,n){"use strict";const r=n(910),o=n(911),i=n(915).stdout,a=n(918),u="win32"===process.platform&&!(process.env.TERM||"").toLowerCase().startsWith("xterm"),s=["ansi","ansi","ansi256","ansi16m"],c=new Set(["gray"]),f=Object.create(null);function l(t,e){e=e||{};const n=i?i.level:0;t.level=void 0===e.level?n:e.level,t.enabled="enabled"in e?e.enabled:t.level>0}function p(t){if(!this||!(this instanceof p)||this.template){const e={};return l(e,t),e.template=function(){const t=[].slice.call(arguments);return y.apply(null,[e.template].concat(t))},Object.setPrototypeOf(e,p.prototype),Object.setPrototypeOf(e.template,e),e.template.constructor=p,e.template}l(this,t)}u&&(o.blue.open="[94m");for(const t of Object.keys(o))o[t].closeRe=new RegExp(r(o[t].close),"g"),f[t]={get(){const e=o[t];return h.call(this,this._styles?this._styles.concat(e):[e],this._empty,t)}};f.visible={get(){return h.call(this,this._styles||[],!0,"visible")}},o.color.closeRe=new RegExp(r(o.color.close),"g");for(const t of Object.keys(o.color.ansi))c.has(t)||(f[t]={get(){const e=this.level;return function(){const n=o.color[s[e]][t].apply(null,arguments),r={open:n,close:o.color.close,closeRe:o.color.closeRe};return h.call(this,this._styles?this._styles.concat(r):[r],this._empty,t)}}});o.bgColor.closeRe=new RegExp(r(o.bgColor.close),"g");for(const t of Object.keys(o.bgColor.ansi)){if(c.has(t))continue;f["bg"+t[0].toUpperCase()+t.slice(1)]={get(){const e=this.level;return function(){const n=o.bgColor[s[e]][t].apply(null,arguments),r={open:n,close:o.bgColor.close,closeRe:o.bgColor.closeRe};return h.call(this,this._styles?this._styles.concat(r):[r],this._empty,t)}}}}const d=Object.defineProperties(()=>{},f);function h(t,e,n){const r=function(){return v.apply(r,arguments)};r._styles=t,r._empty=e;const o=this;return Object.defineProperty(r,"level",{enumerable:!0,get:()=>o.level,set(t){o.level=t}}),Object.defineProperty(r,"enabled",{enumerable:!0,get:()=>o.enabled,set(t){o.enabled=t}}),r.hasGrey=this.hasGrey||"gray"===n||"grey"===n,r.__proto__=d,r}function v(){const t=arguments,e=t.length;let n=String(arguments[0]);if(0===e)return"";if(e>1)for(let r=1;r<e;r++)n+=" "+t[r];if(!this.enabled||this.level<=0||!n)return this._empty?"":n;const r=o.dim.open;u&&this.hasGrey&&(o.dim.open="");for(const t of this._styles.slice().reverse())n=(n=t.open+n.replace(t.closeRe,t.open)+t.close).replace(/\r?\n/g,`${t.close}$&${t.open}`);return o.dim.open=r,n}function y(t,e){if(!Array.isArray(e))return[].slice.call(arguments,1).join(" ");const n=[].slice.call(arguments,2),r=[e.raw[0]];for(let t=1;t<e.length;t++)r.push(String(n[t-1]).replace(/[{}\\]/g,"\\$&")),r.push(String(e.raw[t]));return a(t,r.join(""))}Object.defineProperties(p.prototype,f),t.exports=p(),t.exports.supportsColor=i,t.exports.default=t.exports},function(t,e,n){"use strict";var r=/[|\\{}()[\]^$+*?.]/g;t.exports=function(t){if("string"!=typeof t)throw new TypeError("Expected a string");return t.replace(r,"\\$&")}},function(t,e,n){"use strict";(function(t){const e=n(912),r=(t,n)=>(function(){const r=t.apply(e,arguments);return`[${r+n}m`}),o=(t,n)=>(function(){const r=t.apply(e,arguments);return`[${38+n};5;${r}m`}),i=(t,n)=>(function(){const r=t.apply(e,arguments);return`[${38+n};2;${r[0]};${r[1]};${r[2]}m`});Object.defineProperty(t,"exports",{enumerable:!0,get:function(){const t=new Map,n={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};n.color.grey=n.color.gray;for(const e of Object.keys(n)){const r=n[e];for(const e of Object.keys(r)){const o=r[e];n[e]={open:`[${o[0]}m`,close:`[${o[1]}m`},r[e]=n[e],t.set(o[0],o[1])}Object.defineProperty(n,e,{value:r,enumerable:!1}),Object.defineProperty(n,"codes",{value:t,enumerable:!1})}const a=t=>t,u=(t,e,n)=>[t,e,n];n.color.close="[39m",n.bgColor.close="[49m",n.color.ansi={ansi:r(a,0)},n.color.ansi256={ansi256:o(a,0)},n.color.ansi16m={rgb:i(u,0)},n.bgColor.ansi={ansi:r(a,10)},n.bgColor.ansi256={ansi256:o(a,10)},n.bgColor.ansi16m={rgb:i(u,10)};for(let t of Object.keys(e)){if("object"!=typeof e[t])continue;const a=e[t];"ansi16"===t&&(t="ansi"),"ansi16"in a&&(n.color.ansi[t]=r(a.ansi16,0),n.bgColor.ansi[t]=r(a.ansi16,10)),"ansi256"in a&&(n.color.ansi256[t]=o(a.ansi256,0),n.bgColor.ansi256[t]=o(a.ansi256,10)),"rgb"in a&&(n.color.ansi16m[t]=i(a.rgb,0),n.bgColor.ansi16m[t]=i(a.rgb,10))}return n}})}).call(this,n(23)(t))},function(t,e,n){var r=n(408),o=n(914),i={};Object.keys(r).forEach(function(t){i[t]={},Object.defineProperty(i[t],"channels",{value:r[t].channels}),Object.defineProperty(i[t],"labels",{value:r[t].labels});var e=o(t);Object.keys(e).forEach(function(n){var r=e[n];i[t][n]=function(t){var e=function(e){if(null==e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var n=t(e);if("object"==typeof n)for(var r=n.length,o=0;o<r;o++)n[o]=Math.round(n[o]);return n};return"conversion"in t&&(e.conversion=t.conversion),e}(r),i[t][n].raw=function(t){var e=function(e){return null==e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(r)})}),t.exports=i},function(t,e,n){"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},function(t,e,n){var r=n(408);function o(t){var e=function(){for(var t={},e=Object.keys(r),n=e.length,o=0;o<n;o++)t[e[o]]={distance:-1,parent:null};return t}(),n=[t];for(e[t].distance=0;n.length;)for(var o=n.pop(),i=Object.keys(r[o]),a=i.length,u=0;u<a;u++){var s=i[u],c=e[s];-1===c.distance&&(c.distance=e[o].distance+1,c.parent=o,n.unshift(s))}return e}function i(t,e){return function(n){return e(t(n))}}function a(t,e){for(var n=[e[t].parent,t],o=r[e[t].parent][t],a=e[t].parent;e[a].parent;)n.unshift(e[a].parent),o=i(r[e[a].parent][a],o),a=e[a].parent;return o.conversion=n,o}t.exports=function(t){for(var e=o(t),n={},r=Object.keys(e),i=r.length,u=0;u<i;u++){var s=r[u];null!==e[s].parent&&(n[s]=a(s,e))}return n}},function(t,e,n){"use strict";const r=n(916),o=n(917),i=process.env;let a;function u(t){return function(t){return 0!==t&&{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}(function(t){if(!1===a)return 0;if(o("color=16m")||o("color=full")||o("color=truecolor"))return 3;if(o("color=256"))return 2;if(t&&!t.isTTY&&!0!==a)return 0;const e=a?1:0;if("win32"===process.platform){const t=r.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in i)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in i)||"codeship"===i.CI_NAME?1:e;if("TEAMCITY_VERSION"in i)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(i.TEAMCITY_VERSION)?1:0;if("truecolor"===i.COLORTERM)return 3;if("TERM_PROGRAM"in i){const t=parseInt((i.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(i.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(i.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(i.TERM)?1:"COLORTERM"in i?1:(i.TERM,e)}(t))}o("no-color")||o("no-colors")||o("color=false")?a=!1:(o("color")||o("colors")||o("color=true")||o("color=always"))&&(a=!0),"FORCE_COLOR"in i&&(a=0===i.FORCE_COLOR.length||0!==parseInt(i.FORCE_COLOR,10)),t.exports={supportsColor:u,stdout:u(process.stdout),stderr:u(process.stderr)}},function(t,e){t.exports=require("os")},function(t,e,n){"use strict";t.exports=(t,e)=>{e=e||process.argv;const n=t.startsWith("-")?"":1===t.length?"-":"--",r=e.indexOf(n+t),o=e.indexOf("--");return-1!==r&&(-1===o||r<o)}},function(t,e,n){"use strict";const r=/(?:\\(u[a-f\d]{4}|x[a-f\d]{2}|.))|(?:\{(~)?(\w+(?:\([^)]*\))?(?:\.\w+(?:\([^)]*\))?)*)(?:[ \t]|(?=\r?\n)))|(\})|((?:.|[\r\n\f])+?)/gi,o=/(?:^|\.)(\w+)(?:\(([^)]*)\))?/g,i=/^(['"])((?:\\.|(?!\1)[^\\])*)\1$/,a=/\\(u[a-f\d]{4}|x[a-f\d]{2}|.)|([^\\])/gi,u=new Map([["n","\n"],["r","\r"],["t","\t"],["b","\b"],["f","\f"],["v","\v"],["0","\0"],["\\","\\"],["e",""],["a",""]]);function s(t){return"u"===t[0]&&5===t.length||"x"===t[0]&&3===t.length?String.fromCharCode(parseInt(t.slice(1),16)):u.get(t)||t}function c(t,e){const n=[],r=e.trim().split(/\s*,\s*/g);let o;for(const e of r)if(isNaN(e)){if(!(o=e.match(i)))throw new Error(`Invalid Chalk template style argument: ${e} (in style '${t}')`);n.push(o[2].replace(a,(t,e,n)=>e?s(e):n))}else n.push(Number(e));return n}function f(t){o.lastIndex=0;const e=[];let n;for(;null!==(n=o.exec(t));){const t=n[1];if(n[2]){const r=c(t,n[2]);e.push([t].concat(r))}else e.push([t])}return e}function l(t,e){const n={};for(const t of e)for(const e of t.styles)n[e[0]]=t.inverse?null:e.slice(1);let r=t;for(const t of Object.keys(n))if(Array.isArray(n[t])){if(!(t in r))throw new Error(`Unknown Chalk style: ${t}`);r=n[t].length>0?r[t].apply(r,n[t]):r[t]}return r}t.exports=(t,e)=>{const n=[],o=[];let i=[];if(e.replace(r,(e,r,a,u,c,p)=>{if(r)i.push(s(r));else if(u){const e=i.join("");i=[],o.push(0===n.length?e:l(t,n)(e)),n.push({inverse:a,styles:f(u)})}else if(c){if(0===n.length)throw new Error("Found extraneous } in Chalk template literal");o.push(l(t,n)(i.join(""))),i=[],n.pop()}else i.push(p)}),o.push(i.join("")),n.length>0){const t=`Chalk template literal is missing ${n.length} closing bracket${1===n.length?"":"s"} (\`}\`)`;throw new Error(t)}return o.join("")}},function(t,e){t.exports=require("querystring")},function(t,e,n){const r=n(86),o=n(279),i=n(409),a=n(16);class u extends a{static getPersonalData(t,e){const n={firstname:{path:"name.givenName"},lastname:{path:"name.familyName"},address:{getter:i.getPrimaryAddress},email:{getter:i.getPrimaryEmail},phone:{getter:i.getPrimaryPhone}};let o={};return e.forEach(e=>{const i=r(n,e,e);let a;if(i.getter)a=i.getter(t);else{const n=r(i,"path",e);a=r(t,n)}void 0!==a&&(o[e]=a)}),o}static async getFilesByRules(t){const{rules:e,count:n}=t,r={trashed:!1,type:"file",...e};return await this.cozyClient.collection("io.cozy.files").createIndex(["metadata.datetime","metadata.classification"]),await this.cozyClient.collection("io.cozy.files").find(r,{indexedFields:["metadata.datetime","metadata.classification"],sort:[{"metadata.datetime":"desc"},{"metadata.classification":"desc"}],limit:n||1})}static create(t,e){const{documentsData:n,personalData:r,procedureData:i}=t,a=Object.keys(n).map(t=>n[t].files.map(e=>{if(e)return{_id:e.id,_type:"io.cozy.files",templateDocumentId:t}}));return{personalData:r,procedureData:i,submissionDate:new Date,templateId:e.type,templateVersion:e.version,relationships:{files:{data:o(a)}}}}static createJson(t){return JSON.stringify(t)}}u.doctype="io.cozy.procedures.administratives",t.exports=u},function(t,e,n){"use strict";var r=n(922);function o(){}function i(){}i.resetWarningCache=o,t.exports=function(){function t(t,e,n,o,i,a){if(a!==r){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}function e(){return t}t.isRequired=t;var n={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:i,resetWarningCache:o};return n.PropTypes=n,n}},function(t,e,n){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(t,e,n){const r=n(16),o=n(252);class i extends r{static async getByYearAndAccount(t,e){const n=await r.getIndex(this.doctype,this.idAttributes),o={selector:{year:t,"relationships.account.data._id":e},limit:1},[i]=await r.query(n,o);return i||this.getEmptyDocument(t,e)}static getEmptyDocument(t,e){return{year:t,balances:{},metadata:{version:this.version},relationships:{account:{data:{_id:e,_type:o.doctype}}}}}}i.doctype="io.cozy.bank.balancehistories",i.idAttributes=["year","relationships.account.data._id"],i.version=1,i.checkedAttributes=["balances"],t.exports=i},function(t,e,n){const r=n(172),{eitherIncludes:o}=n(413),{getSlugFromInstitutionLabel:i}=n(414),a=(t,e,n)=>{const r=n.filter(n=>n[t]===e[t]);return 1===r.length?{match:r[0],method:t+"-exact"}:r.length>1?{matches:r,method:t+"-exact"}:null},u=/^(?:[A-Za-z]+)?-?([0-9]+)-?(?:[A-Za-z]+)?$/,s=/xxxx xxxx xxxx (\d{4})/,c=(t,e)=>{let n;return e=e&&e.replace(/\s/g,""),t=t&&!t.match(s)?t.replace(/\s/g,""):t,e&&27==e.length?e.substr(14,11):t?t&&23==t.length?t.substr(10,11):t&&16==t.length?t.substr(5,11):t&&t.length>11&&(n=t.match(u))?n[1]:t:void 0},f=(t,e)=>{const n=[],r={account:e,methods:n};let a=0;if(((t,e)=>{const n=i(t.institutionLabel),r=i(e.institutionLabel);return!n||!r||n===r})(t,e)||(a-=1e3),((t,e)=>e.number&&t.number&&(11===e.number.length||11===t.number.length)&&o(e.number,t.number))(t,e)?(a+=50,n.push("approx-number")):a-=50,t.type===e.type&&(a+=50,n.push("same-type")),"CreditCard"!==t.type&&"CreditCard"!==e.type||!((t,e)=>{let n,r;for(let o of[t,e]){const t=o.number.match(s);t&&(n=o,r=t[1])}if((n===t?e:t).number.slice(-4)===r)return!0})(t,e)||(a+=150,n.push("credit-card-number")),t.currency){(e.rawNumber&&e.rawNumber.includes(t.currency)||e.label&&e.label.includes(t.currency)||e.originalBankLabel&&e.originalBankLabel.includes(t.currency))&&(a+=50,n.push("currency"))}return r.points=a,r},l=t=>{const e=c(t.number,t.iban);return{...t,rawNumber:t.number,number:e}},p=["iban","number"],d=(t,e)=>t&&t===e,h=(t,e)=>{for(const n of p)if(t[n]){const r=a(n,t,e);if(r&&r.match)return r}const n=e.find(e=>d(t.originalNumber,e.number)||d(t.number,e.originalNumber));if(n)return{match:n,method:"originalNumber-exact"};const o=r(e.map(e=>f(t,e)),t=>-t.points).filter(t=>t.points>0);return o.length>0?{match:o[0].account,method:o[0].methods.join("-")}:void 0};t.exports={matchAccounts:(t,e)=>{t=t.map(l);const n=[...e].map(l),r=[];for(let e of t){const t=h(e,n);if(t){const o=n.indexOf(t.match);n.splice(o,1),r.push({account:e,...t})}else r.push({account:e})}return r},normalizeAccountNumber:c,score:f}},function(t,e){t.exports={"AXA Banque":"axabanque102","/Banque Populaire.*/":"banquepopulaire",BforBank:"bforbank97","BNP Paribas":"bnpparibas82",BNPP:"bnpparibas82","/Boursorama.*/":"boursorama83",casden:"casden173","/Hello bank!.*/":"hellobank145",Bred:"bred",CA:"caatlantica3","Carrefour Banque":"carrefour159","/Caisse d'Épargne.*/":"caissedepargne1","Compte Nickel":"comptenickel168","/^CIC.*/":"cic63","Crédit Agricole":"caatlantica3","Crédit Coopératif":"creditcooperatif148","/Crédit du Nord.*/":"cdngroup88","/Crédit Maritime.*/":"creditmaritime","/Crédit Mutuel.*/":"cic45",Fortuneo:"fortuneo84","Hello bank!":"hellobank145","HSBC France":"hsbc119",HSBC:"hsbc119","/^ING.*/":"ingdirect95","/La Banque Postale.*/":"labanquepostale44","/LCL.*/":"lcl-linxo",Milleis:"barclays136",Monabanq:"monabanq96","Société Générale":"societegenerale","Société marseillaise de crédit":"cdngroup109"}},function(t,e,n){const r=n(291),o=n(0).namespace("BankingReconciliator");t.exports=class{constructor(t){this.options=t}async saveAccounts(t,e){const{BankAccount:n}=this.options,r=await n.fetchAll(),i=n.reconciliate(t,r);o("info","Saving accounts...");const a=await n.bulkSave(i);return e.onAccountsSaved&&e.onAccountsSaved(a),{savedAccounts:a,reconciliatedAccounts:i}}async save(t,e,n={}){const{BankAccount:i,BankTransaction:a}=this.options,{reconciliatedAccounts:u,savedAccounts:s}=await this.saveAccounts(t,n),c=r(s.map(t=>[t[i.vendorIdAttr],t._id]));o("info","Linking transactions to accounts..."),o("info",JSON.stringify(c)),e.forEach(t=>{if(t.account=c[t[a.vendorAccountIdAttr]],void 0===t.account)throw o("warn",`Transaction without account, vendorAccountIdAttr: ${a.vendorAccountIdAttr}`),o("warn","transaction: "+JSON.stringify(t)),new Error("Transaction without account.")});const f=new Set(u.filter(t=>t._id).map(t=>t._id)),l=(await a.fetchAll()).filter(t=>f.has(t.account)),p=a.reconciliate(e,l,n);o("info","Saving transactions...");let d=1;return{accounts:s,transactions:await a.bulkSave(p,30,t=>{o("debug",`[bulkSave] ${d++} Saving ${t.date} ${t.label}`)})}}}},function(t,e,n){const r=n(928),o=n(115),i=n(929),a=n(932),u=n(935),s=n(16),c=n(411),f=n(252),{matchTransactions:l}=n(936),p=(t,e)=>{const n=i(t,e);return n?e(n):null},d=t=>{return(t.realisationDate||t.date).slice(0,10)},h=t=>p(t,d),v=t=>t instanceof Date?t.toISOString():t;class y extends s{static getDate(t){return t}isAfter(t){if(t){const e=v(this.date).slice(0,10);return"NaN"!==e?e>t:(c("warn","transaction date could not be parsed. transaction: "+JSON.stringify(this)),!1)}return!0}isBeforeOrSame(t){if(t){const e=v(this.date).slice(0,10);return"NaN"!==e?e<=t:(c("warn","transaction date could not be parsed. transaction: "+JSON.stringify(this)),!1)}return!0}getIdentifier(){return`${this.amount}-${this.originalBankLabel}-${this.date}`}static getMissedTransactions(t,e,n={}){const r=p(e,d),o=a(r,-7),i=t.filter(t=>u(d(t),o)),s=Array.from(l(i,e)).filter(t=>!t.match).map(t=>t.transaction),f=n.trackEvent;if("function"==typeof f)try{const t=s.length,n=e.length;f({e_a:"ReconciliateMissing",e_n:"MissedTransactionPct",e_v:parseFloat((t/n).toFixed(2),10)}),f({e_a:"ReconciliateMissing",e_n:"MissedTransactionAbs",e_v:t})}catch(t){c("warn",`Could not send MissedTransaction event: ${t.message}`)}return s}static reconciliate(t,e,n={}){const r=o(t,t=>(t=>e.find(e=>e.vendorId===t.vendorId))(t)?"updatedTransactions":"newTransactions");let i=r.newTransactions||[];const a=r.updatedTransactions||[],u=h(e);if(u){"function"==typeof n.trackEvent&&n.trackEvent({e_a:"ReconciliateSplitDate"});const t=t=>y.prototype.isAfter.call(t,u),r=t=>y.prototype.isBeforeOrSame.call(t,u),o=i.filter(t);o.length>0?c("info",`Found ${o.length} transactions after ${u}`):c("info",`No transaction after ${u}`);const a=i.filter(r);c("info",`Found ${a.length} transactions before ${u}`);const s=y.getMissedTransactions(a,e,n);s.length>0?c("info",`Found ${s.length} missed transactions before ${u}`):c("info",`No missed transactions before ${u}`),i=[...o,...s]}else c("info","Can't find a split date, saving all new transactions");return c("info",`Transaction reconciliation: new ${i.length}, updated ${a.length}, split date ${u} `),[].concat(i).concat(a)}static async getMostRecentForAccounts(t){try{c("debug","Transaction.getLast");const e=await s.getIndex(this.doctype,["date","account"]),n={selector:{date:{$gte:null},account:{$in:t}},sort:[{date:"desc"}]},r=await s.query(e,n);return c("info","last transactions length: "+r.length),r}catch(t){return c("error",t),[]}}static async deleteOrphans(){c("info","Deleting up orphan operations");const t=r(await f.fetchAll(),"_id"),e=await this.fetchAll(),n=e.filter(e=>!t[e.account]);if(c("info",`Total number of operations: ${e.length}`),c("info",`Total number of orphan operations: ${n.length}`),c("info",`Deleting ${n.length} orphan operations...`),n.length>0)return this.deleteAll(n)}getVendorAccountId(){return this[this.constructor.vendorAccountIdAttr]}}y.doctype="io.cozy.bank.operations",y.version=1,y.vendorAccountIdAttr="vendorAccountId",y.vendorIdAttr="vendorId",y.idAttributes=["vendorId"],y.checkedAttributes=["label","originalBankLabel","automaticCategoryId","account"],t.exports=y},function(t,e,n){var r=n(110),o=n(294)(function(t,e,n){r(t,n,e)});t.exports=o},function(t,e,n){var r=n(930),o=n(931),i=n(42);t.exports=function(t,e){return t&&t.length?r(t,i(e,2),o):void 0}},function(t,e,n){var r=n(85);t.exports=function(t,e,n){for(var o=-1,i=t.length;++o<i;){var a=t[o],u=e(a);if(null!=u&&(void 0===s?u==u&&!r(u):n(u,s)))var s=u,c=a}return c}},function(t,e){t.exports=function(t,e){return t>e}},function(t,e,n){var r=n(415);t.exports=function(t,e){var n=r(t),o=Number(e);return n.setDate(n.getDate()+o),n}},function(t,e){t.exports=function(t){var e=new Date(t.getTime()),n=e.getTimezoneOffset();return e.setSeconds(0,0),6e4*n+e.getTime()%6e4}},function(t,e){t.exports=function(t){return t instanceof Date}},function(t,e,n){var r=n(415);t.exports=function(t,e){var n=r(t),o=r(e);return n.getTime()>o.getTime()}},function(t,e,n){const r=n(115),o=n(172),{eitherIncludes:i}=n(413),a=t=>t.date.substr(0,10),u=(t,e)=>{const n=new RegExp(String.raw`${e}{2,}`,"gi");return t&&t.replace(n,e)},s=/\b[0-9X]+\b/gi,c=/\b\d{2}\/\d{2}\/\d{4}\b/g,f=t=>t&&t.replace(s,""),l=t=>t&&t.replace(c,""),p=t=>t&&t.replace(/\s/g,"").replace(/-/g,""),d=(t,e,n={})=>{const r=[],o={op:e,methods:r};if(n.maxDateDelta){if(((t,e)=>{const n=new Date(t.date.substr(0,10)),r=new Date(e.date.substr(0,10)),o=Math.abs(r-n);if(t.realisationDate){const e=new Date(t.realisationDate.substr(0,10)),n=Math.abs(r-e);return Math.min(o,n)}return o})(t,e)>n.maxDateDelta)return o.points=-1e3,o;r.push("approx-date")}const[a,s]=((t,e)=>u(e.originalBankLabel," ")===u(t.originalBankLabel," ")?[200,"originalBankLabel"]:p(e.originalBankLabel)===p(t.originalBankLabel)?[120,"originalBankLabelCompacted"]:l(e.originalBankLabel)===l(t.originalBankLabel)?[150,"originalBankLabelWithoutDate"]:e.label===t.label?[100,"label"]:i(e.label.toLowerCase(),t.label.toLowerCase())?[70,"eitherIncludes"]:i(f(e.label.toLowerCase()),f(t.label.toLowerCase()))?[50,"fuzzy-eitherIncludes"]:[-1e3,"label-penalty"])(t,e);r.push(s);const c=(0===Math.abs(e.amount-t.amount)?r.push("amount")&&100:-1e3)+a;return o.points=c,o},h=(t,e,n={})=>{const r=e.find(e=>e.vendorId&&t.vendorId&&e.vendorId===t.vendorId);if(r)return{match:r,method:"vendorId"};const i=e.map(e=>d(t,e,n)),a=o(i,t=>-t.points).filter(t=>t.points>0);return a.length>0?{match:a[0].op,method:a[0].methods.join("-")}:{candidates:a}},v=function*(t,e,n={}){const r=Array.isArray(e)?[...e]:[];for(let e of t){const t={transaction:e},o=r.length>0?h(e,r,n):null;if(o){Object.assign(t,o);const e=r.indexOf(o.match);e>-1&&r.splice(e,1)}yield t}};t.exports={matchTransactions:function*(t,e){const n=new Set(t),o=new Set(e);for(let[i,[u,s]]of function*(t,e){const n=t.map(t=>r(t,e));for(const t of Object.keys(n[0]).sort()){const e=n.map(e=>e[t]||[]);yield[t,e]}}([t,e],a))for(let t of v(u,s))t.match&&(o.delete(t.match),n.delete(t.transaction),yield t);const i=[3,4,5];for(let t of i)for(let e of v(Array.from(n),Array.from(o),{maxDateDelta:864e5*t}))e.method&&(e.method+=`-delta${t}`),e.match&&(o.delete(e.match),n.delete(e.transaction)),(e.match||t===i[i.length-1])&&(yield e)},scoreMatching:d}},function(t,e,n){const r=n(16),o=n(938);class i extends r{static checkCurrencies(t){const e=t[0].currency;for(const n of t)if(n.currency!==e)return!1;return!0}static sum(t){if(0===t.length)throw new Error("You must give at least one stats object");if(!this.checkCurrencies(t))throw new Error("Currency of all stats object must be the same.");const e=["income","additionalIncome","mortgage","loans","fixedCharges"].reduce((e,n)=>(e[n]=o(t,t=>t[n]||0),e),{});return e.currency=t[0].currency,e}}i.doctype="io.cozy.bank.accounts.stats",i.idAttributes=["_id"],i.version=1,i.checkedAttributes=null,t.exports=i},function(t,e,n){var r=n(42),o=n(939);t.exports=function(t,e){return t&&t.length?o(t,r(e,2)):0}},function(t,e){t.exports=function(t,e){for(var n,r=-1,o=t.length;++r<o;){var i=e(t[r]);void 0!==i&&(n=void 0===n?i:n+i)}return n}},function(t,e,n){var r=n(276),o=n(941),i=n(942),a=n(947),u=n(275),s=/\s+$/;t.exports=function(t,e,n){if((t=u(t))&&(n||void 0===e))return t.replace(s,"");if(!t||!(e=r(e)))return t;var c=a(t),f=i(c,a(e))+1;return o(c,0,f).join("")}},function(t,e,n){var r=n(277);t.exports=function(t,e,n){var o=t.length;return n=void 0===n?o:n,!e&&n>=o?t:r(t,e,n)}},function(t,e,n){var r=n(943);t.exports=function(t,e){for(var n=t.length;n--&&r(e,t[n],0)>-1;);return n}},function(t,e,n){var r=n(944),o=n(945),i=n(946);t.exports=function(t,e,n){return e==e?i(t,e,n):r(t,o,n)}},function(t,e){t.exports=function(t,e,n,r){for(var o=t.length,i=n+(r?1:-1);r?i--:++i<o;)if(e(t[i],i,t))return i;return-1}},function(t,e){t.exports=function(t){return t!=t}},function(t,e){t.exports=function(t,e,n){for(var r=n-1,o=t.length;++r<o;)if(t[r]===e)return r;return-1}},function(t,e,n){var r=n(948),o=n(285),i=n(949);t.exports=function(t){return o(t)?i(t):r(t)}},function(t,e){t.exports=function(t){return t.split("")}},function(t,e){var n="[\\ud800-\\udfff]",r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",o="\\ud83c[\\udffb-\\udfff]",i="[^\\ud800-\\udfff]",a="(?:\\ud83c[\\udde6-\\uddff]){2}",u="[\\ud800-\\udbff][\\udc00-\\udfff]",s="(?:"+r+"|"+o+")"+"?",c="[\\ufe0e\\ufe0f]?"+s+("(?:\\u200d(?:"+[i,a,u].join("|")+")[\\ufe0e\\ufe0f]?"+s+")*"),f="(?:"+[i+r+"?",r,a,u,n].join("|")+")",l=RegExp(o+"(?="+o+")|"+f+c,"g");t.exports=function(t){return t.match(l)||[]}},function(t,e,n){const r=n(412),o=n(416);class i extends o{static async createFolderWithReference(t,e){const n=this.cozyClient.collection(o.doctype),r=await n.ensureDirectoryExists(t);await n.addReferencesTo(e,[{_id:r}]);const{data:i}=await n.get(r);return i}static async ensureMagicFolder(t,e){const n={_type:r.doctype,_id:t},o=await i.getReferencedFolders(n),a=o.length?o[0]:null;if(a)return a;const u=Object.values(i.magicFolders);if(!u.includes(t))throw new Error(`Cannot create Magic folder with id ${t}. Allowed values are ${u.join(", ")}.`);if(!e)throw new Error("Magic folder default path must be defined");return i.createFolderWithReference(e,n)}static async getReferencedFolders(t){const{included:e}=await this.cozyClient.collection(o.doctype).findReferencedBy(t);return e.filter(t=>!i.isTrashed(t))}static async ensureFolderWithReference(t,e){const n=await i.getReferencedFolders(e);if(n.length)return n[0];const r=this.cozyClient.collection(o.doctype),a=await r.ensureDirectoryExists(t);await r.addReferencesTo(e,[{_id:a}]);const{data:u}=await r.get(a);return u}static isTrashed(t){return/^\/\.cozy_trash/.test(t.attributes.path)}}i.magicFolders={ADMINISTRATIVE:`${r.doctype}/administrative`,PHOTOS:`${r.doctype}/photos`,PHOTOS_BACKUP:`${r.doctype}/photos/mobile`,PHOTOS_UPLOAD:`${r.doctype}/photos/upload`},t.exports=i},function(t,e,n){const r=n(410),o=n(16);class i extends o{}const a=r.shape({_id:r.string.isRequired,_type:r.string.isRequired,name:r.string.isRequired,trashed:r.bool});i.doctype="io.cozy.contacts.groups",i.propType=a,t.exports=i},function(t,e,n){const r=n(16);class o extends r{}o.schema={doctype:"io.cozy.permissions",attributes:{}},t.exports=o},function(t,e,n){var r=n(143),o=n(225),i=n(226),a=n(78),u=n(103),s=n(148),c=Math.min;t.exports=function(t,e,n){for(var f=n?i:o,l=t[0].length,p=t.length,d=p,h=Array(p),v=1/0,y=[];d--;){var g=t[d];d&&e&&(g=a(g,u(e))),v=c(g.length,v),h[d]=!n&&(e||l>=120&&g.length>=120)?new r(d&&g):void 0}g=t[0];var m=-1,b=h[0];t:for(;++m<l&&y.length<v;){var x=g[m],w=e?e(x):x;if(x=n||0!==x?x:0,!(b?s(b,w):f(y,w,n))){for(d=p;--d;){var _=h[d];if(!(_?s(_,w):f(t[d],w,n)))continue t}b&&b.push(w),y.push(x)}}return y}},function(t,e,n){var r=n(254);t.exports=function(t){return r(t)?t:[]}},function(t,e,n){var r=n(143),o=n(225),i=n(226),a=n(78),u=n(103),s=n(148),c=200;t.exports=function(t,e,n,f){var l=-1,p=o,d=!0,h=t.length,v=[],y=e.length;if(!h)return v;n&&(e=a(e,u(n))),f?(p=i,d=!1):e.length>=c&&(p=s,d=!1,e=new r(e));t:for(;++l<h;){var g=t[l],m=null==n?g:n(g);if(g=f||0!==g?g:0,d&&m==m){for(var b=y;b--;)if(e[b]===m)continue t;v.push(g)}else p(e,m,f)||v.push(g)}return v}},function(t,e,n){"use strict";n.r(e);var r=n(28);class o extends r.Contact{static getInitials(t,e=""){if(o.isContact(t))return r.Contact.getInitials(t);{const n=t.public_name||t.name||t.email;return n&&n[0].toUpperCase()||e}}static getDisplayName(t,e=""){return o.isContact(t)?r.Contact.getDisplayName(t):t.public_name||t.name||t.email||e}}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const a="io.cozy.photos.albums";!function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){i(t,e,n[e])})}}({files:{doctype:"io.cozy.files"},contacts:{doctype:o.doctype,doctypeVersion:2},groups:{doctype:r.Group.doctype}},{});var u=n(80),s=n.n(u);var c={albums:{doctype:a,attributes:{name:{type:"string"}},relationships:{photos:{type:"has-many",doctype:"io.cozy.files"}}},files:{doctype:"io.cozy.files",relationships:{albums:{type:class extends u.HasMany{get data(){const t=this.target.relationships.referenced_by.data;return t?t.map(t=>this.get(t.type,t.id)).filter(Boolean):[]}static query(t,e,n){if(!t.relationships||!t.relationships.referenced_by||!t.relationships.referenced_by.data)return null;const r=t.relationships.referenced_by.data.filter(t=>t.type===n.doctype).map(t=>t.id);return new u.QueryDefinition({doctype:n.doctype,ids:r})}},doctype:a}}},contacts:{doctype:r.Contact.doctype}},f=n(0),l=n.n(f),p=n(18),d=n(259),h=n(155),v=n(418),y=n(39);const g=p.Readable,m=Symbol("buffer"),b=Symbol("type");class x{constructor(){this[b]="";const t=arguments[0],e=arguments[1],n=[];let r=0;if(t){const e=t,o=Number(e.length);for(let t=0;t<o;t++){const o=e[t];let i;r+=(i=o instanceof Buffer?o:ArrayBuffer.isView(o)?Buffer.from(o.buffer,o.byteOffset,o.byteLength):o instanceof ArrayBuffer?Buffer.from(o):o instanceof x?o[m]:Buffer.from("string"==typeof o?o:String(o))).length,n.push(i)}}this[m]=Buffer.concat(n);let o=e&&void 0!==e.type&&String(e.type).toLowerCase();o&&!/[^\u0020-\u007E]/.test(o)&&(this[b]=o)}get size(){return this[m].length}get type(){return this[b]}text(){return Promise.resolve(this[m].toString())}arrayBuffer(){const t=this[m],e=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);return Promise.resolve(e)}stream(){const t=new g;return t._read=function(){},t.push(this[m]),t.push(null),t}toString(){return"[object Blob]"}slice(){const t=this.size,e=arguments[0],n=arguments[1];let r,o;r=void 0===e?0:e<0?Math.max(t+e,0):Math.min(e,t),o=void 0===n?t:n<0?Math.max(t+n,0):Math.min(n,t);const i=Math.max(o-r,0),a=this[m].slice(r,r+i),u=new x([],{type:arguments[2]});return u[m]=a,u}}function w(t,e,n){Error.call(this,t),this.message=t,this.type=e,n&&(this.code=this.errno=n.code),Error.captureStackTrace(this,this.constructor)}let _;Object.defineProperties(x.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(x.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),w.prototype=Object.create(Error.prototype),w.prototype.constructor=w,w.prototype.name="FetchError";try{_=require("encoding").convert}catch(t){}const k=Symbol("Body internals"),O=p.PassThrough;function j(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.size;let o=void 0===r?0:r;var i=n.timeout;let a=void 0===i?0:i;null==t?t=null:E(t)?t=Buffer.from(t.toString()):A(t)||Buffer.isBuffer(t)||("[object ArrayBuffer]"===Object.prototype.toString.call(t)?t=Buffer.from(t):ArrayBuffer.isView(t)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):t instanceof p||(t=Buffer.from(String(t)))),this[k]={body:t,disturbed:!1,error:null},this.size=o,this.timeout=a,t instanceof p&&t.on("error",function(t){const n="AbortError"===t.name?t:new w(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t);e[k].error=n})}function S(){var t=this;if(this[k].disturbed)return j.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[k].disturbed=!0,this[k].error)return j.Promise.reject(this[k].error);let e=this.body;if(null===e)return j.Promise.resolve(Buffer.alloc(0));if(A(e)&&(e=e.stream()),Buffer.isBuffer(e))return j.Promise.resolve(e);if(!(e instanceof p))return j.Promise.resolve(Buffer.alloc(0));let n=[],r=0,o=!1;return new j.Promise(function(i,a){let u;t.timeout&&(u=setTimeout(function(){o=!0,a(new w(`Response timeout while trying to fetch ${t.url} (over ${t.timeout}ms)`,"body-timeout"))},t.timeout)),e.on("error",function(e){"AbortError"===e.name?(o=!0,a(e)):a(new w(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e))}),e.on("data",function(e){if(!o&&null!==e){if(t.size&&r+e.length>t.size)return o=!0,void a(new w(`content size at ${t.url} over limit: ${t.size}`,"max-size"));r+=e.length,n.push(e)}}),e.on("end",function(){if(!o){clearTimeout(u);try{i(Buffer.concat(n,r))}catch(e){a(new w(`Could not create Buffer from response body for ${t.url}: ${e.message}`,"system",e))}}})})}function E(t){return"object"==typeof t&&"function"==typeof t.append&&"function"==typeof t.delete&&"function"==typeof t.get&&"function"==typeof t.getAll&&"function"==typeof t.has&&"function"==typeof t.set&&("URLSearchParams"===t.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(t)||"function"==typeof t.sort)}function A(t){return"object"==typeof t&&"function"==typeof t.arrayBuffer&&"string"==typeof t.type&&"function"==typeof t.stream&&"function"==typeof t.constructor&&"string"==typeof t.constructor.name&&/^(Blob|File)$/.test(t.constructor.name)&&/^(Blob|File)$/.test(t[Symbol.toStringTag])}function C(t){let e,n,r=t.body;if(t.bodyUsed)throw new Error("cannot clone body after it is used");return r instanceof p&&"function"!=typeof r.getBoundary&&(e=new O,n=new O,r.pipe(e),r.pipe(n),t[k].body=e,r=n),r}function T(t){return null===t?null:"string"==typeof t?"text/plain;charset=UTF-8":E(t)?"application/x-www-form-urlencoded;charset=UTF-8":A(t)?t.type||null:Buffer.isBuffer(t)?null:"[object ArrayBuffer]"===Object.prototype.toString.call(t)?null:ArrayBuffer.isView(t)?null:"function"==typeof t.getBoundary?`multipart/form-data;boundary=${t.getBoundary()}`:t instanceof p?null:"text/plain;charset=UTF-8"}function P(t){const e=t.body;return null===e?0:A(e)?e.size:Buffer.isBuffer(e)?e.length:e&&"function"==typeof e.getLengthSync&&(e._lengthRetrievers&&0==e._lengthRetrievers.length||e.hasKnownLength&&e.hasKnownLength())?e.getLengthSync():null}j.prototype={get body(){return this[k].body},get bodyUsed(){return this[k].disturbed},arrayBuffer(){return S.call(this).then(function(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)})},blob(){let t=this.headers&&this.headers.get("content-type")||"";return S.call(this).then(function(e){return Object.assign(new x([],{type:t.toLowerCase()}),{[m]:e})})},json(){var t=this;return S.call(this).then(function(e){try{return JSON.parse(e.toString())}catch(e){return j.Promise.reject(new w(`invalid json response body at ${t.url} reason: ${e.message}`,"invalid-json"))}})},text(){return S.call(this).then(function(t){return t.toString()})},buffer(){return S.call(this)},textConverted(){var t=this;return S.call(this).then(function(e){return function(t,e){if("function"!=typeof _)throw new Error("The package `encoding` must be installed to use the textConverted() function");const n=e.get("content-type");let r,o,i="utf-8";n&&(r=/charset=([^;]*)/i.exec(n));o=t.slice(0,1024).toString(),!r&&o&&(r=/<meta.+?charset=(['"])(.+?)\1/i.exec(o));!r&&o&&(r=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(o))&&(r=/charset=(.*)/i.exec(r.pop()));!r&&o&&(r=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(o));r&&("gb2312"!==(i=r.pop())&&"gbk"!==i||(i="gb18030"));return _(t,"UTF-8",i).toString()}(e,t.headers)})}},Object.defineProperties(j.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),j.mixIn=function(t){for(const e of Object.getOwnPropertyNames(j.prototype))if(!(e in t)){const n=Object.getOwnPropertyDescriptor(j.prototype,e);Object.defineProperty(t,e,n)}},j.Promise=global.Promise;const M=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,D=/[^\t\x20-\x7e\x80-\xff]/;function R(t){if(t=`${t}`,M.test(t)||""===t)throw new TypeError(`${t} is not a legal HTTP header name`)}function I(t){if(t=`${t}`,D.test(t))throw new TypeError(`${t} is not a legal HTTP header value`)}function z(t,e){e=e.toLowerCase();for(const n in t)if(n.toLowerCase()===e)return n}const N=Symbol("map");class L{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[N]=Object.create(null),t instanceof L){const e=t.raw(),n=Object.keys(e);for(const t of n)for(const n of e[t])this.append(t,n)}else if(null==t);else{if("object"!=typeof t)throw new TypeError("Provided initializer must be an object");{const e=t[Symbol.iterator];if(null!=e){if("function"!=typeof e)throw new TypeError("Header pairs must be iterable");const n=[];for(const e of t){if("object"!=typeof e||"function"!=typeof e[Symbol.iterator])throw new TypeError("Each header pair must be iterable");n.push(Array.from(e))}for(const t of n){if(2!==t.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(t[0],t[1])}}else for(const e of Object.keys(t)){const n=t[e];this.append(e,n)}}}}get(t){R(t=`${t}`);const e=z(this[N],t);return void 0===e?null:this[N][e].join(", ")}forEach(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=F(this),r=0;for(;r<n.length;){var o=n[r];const i=o[0],a=o[1];t.call(e,a,i,this),n=F(this),r++}}set(t,e){e=`${e}`,R(t=`${t}`),I(e);const n=z(this[N],t);this[N][void 0!==n?n:t]=[e]}append(t,e){e=`${e}`,R(t=`${t}`),I(e);const n=z(this[N],t);void 0!==n?this[N][n].push(e):this[N][t]=[e]}has(t){return R(t=`${t}`),void 0!==z(this[N],t)}delete(t){R(t=`${t}`);const e=z(this[N],t);void 0!==e&&delete this[N][e]}raw(){return this[N]}keys(){return U(this,"key")}values(){return U(this,"value")}[Symbol.iterator](){return U(this,"key+value")}}function F(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";return Object.keys(t[N]).sort().map("key"===e?function(t){return t.toLowerCase()}:"value"===e?function(e){return t[N][e].join(", ")}:function(e){return[e.toLowerCase(),t[N][e].join(", ")]})}L.prototype.entries=L.prototype[Symbol.iterator],Object.defineProperty(L.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(L.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const B=Symbol("internal");function U(t,e){const n=Object.create($);return n[B]={target:t,kind:e,index:0},n}const $=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==$)throw new TypeError("Value of `this` is not a HeadersIterator");var t=this[B];const e=t.target,n=t.kind,r=t.index,o=F(e,n);return r>=o.length?{value:void 0,done:!0}:(this[B].index=r+1,{value:o[r],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function q(t){const e=Object.assign({__proto__:null},t[N]),n=z(t[N],"Host");return void 0!==n&&(e[n]=e[n][0]),e}Object.defineProperty($,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const J=Symbol("Response internals"),V=d.STATUS_CODES;class G{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};j.call(this,t,e);const n=e.status||200,r=new L(e.headers);if(null!=t&&!r.has("Content-Type")){const e=T(t);e&&r.append("Content-Type",e)}this[J]={url:e.url,status:n,statusText:e.statusText||V[n],headers:r,counter:e.counter}}get url(){return this[J].url||""}get status(){return this[J].status}get ok(){return this[J].status>=200&&this[J].status<300}get redirected(){return this[J].counter>0}get statusText(){return this[J].statusText}get headers(){return this[J].headers}clone(){return new G(C(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}j.mixIn(G.prototype),Object.defineProperties(G.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(G.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const H=Symbol("Request internals"),Q=h.parse,Y=h.format,W="destroy"in p.Readable.prototype;function K(t){return"object"==typeof t&&"object"==typeof t[H]}class Z{constructor(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};K(t)?e=Q(t.url):(e=t&&t.href?Q(t.href):Q(`${t}`),t={});let r=n.method||t.method||"GET";if(r=r.toUpperCase(),(null!=n.body||K(t)&&null!==t.body)&&("GET"===r||"HEAD"===r))throw new TypeError("Request with GET/HEAD method cannot have body");let o=null!=n.body?n.body:K(t)&&null!==t.body?C(t):null;j.call(this,o,{timeout:n.timeout||t.timeout||0,size:n.size||t.size||0});const i=new L(n.headers||t.headers||{});if(null!=o&&!i.has("Content-Type")){const t=T(o);t&&i.append("Content-Type",t)}let a=K(t)?t.signal:null;if("signal"in n&&(a=n.signal),null!=a&&!function(t){const e=t&&"object"==typeof t&&Object.getPrototypeOf(t);return!(!e||"AbortSignal"!==e.constructor.name)}(a))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[H]={method:r,redirect:n.redirect||t.redirect||"follow",headers:i,parsedURL:e,signal:a},this.follow=void 0!==n.follow?n.follow:void 0!==t.follow?t.follow:20,this.compress=void 0!==n.compress?n.compress:void 0===t.compress||t.compress,this.counter=n.counter||t.counter||0,this.agent=n.agent||t.agent}get method(){return this[H].method}get url(){return Y(this[H].parsedURL)}get headers(){return this[H].headers}get redirect(){return this[H].redirect}get signal(){return this[H].signal}clone(){return new Z(this)}}function X(t){Error.call(this,t),this.type="aborted",this.message=t,Error.captureStackTrace(this,this.constructor)}j.mixIn(Z.prototype),Object.defineProperty(Z.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Z.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),X.prototype=Object.create(Error.prototype),X.prototype.constructor=X,X.prototype.name="AbortError";const tt=p.PassThrough,et=h.resolve;function nt(t,e){if(!nt.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return j.Promise=nt.Promise,new nt.Promise(function(n,r){const o=new Z(t,e),i=function(t){const e=t[H].parsedURL,n=new L(t[H].headers);if(n.has("Accept")||n.set("Accept","*/*"),!e.protocol||!e.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(e.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(t.signal&&t.body instanceof p.Readable&&!W)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let r=null;if(null==t.body&&/^(POST|PUT)$/i.test(t.method)&&(r="0"),null!=t.body){const e=P(t);"number"==typeof e&&(r=String(e))}r&&n.set("Content-Length",r),n.has("User-Agent")||n.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),t.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip,deflate");let o=t.agent;return"function"==typeof o&&(o=o(e)),n.has("Connection")||o||n.set("Connection","close"),Object.assign({},e,{method:t.method,headers:q(n),agent:o})}(o),a=("https:"===i.protocol?v:d).request,u=o.signal;let s=null;const c=function(){let t=new X("The user aborted a request.");r(t),o.body&&o.body instanceof p.Readable&&o.body.destroy(t),s&&s.body&&s.body.emit("error",t)};if(u&&u.aborted)return void c();const f=function(){c(),g()},l=a(i);let h;function g(){l.abort(),u&&u.removeEventListener("abort",f),clearTimeout(h)}u&&u.addEventListener("abort",f),o.timeout&&l.once("socket",function(t){h=setTimeout(function(){r(new w(`network timeout at: ${o.url}`,"request-timeout")),g()},o.timeout)}),l.on("error",function(t){r(new w(`request to ${o.url} failed, reason: ${t.message}`,"system",t)),g()}),l.on("response",function(t){clearTimeout(h);const e=function(t){const e=new L;for(const n of Object.keys(t))if(!M.test(n))if(Array.isArray(t[n]))for(const r of t[n])D.test(r)||(void 0===e[N][n]?e[N][n]=[r]:e[N][n].push(r));else D.test(t[n])||(e[N][n]=[t[n]]);return e}(t.headers);if(nt.isRedirect(t.statusCode)){const i=e.get("Location"),a=null===i?null:et(o.url,i);switch(o.redirect){case"error":return r(new w(`redirect mode is set to error: ${o.url}`,"no-redirect")),void g();case"manual":if(null!==a)try{e.set("Location",a)}catch(t){r(t)}break;case"follow":if(null===a)break;if(o.counter>=o.follow)return r(new w(`maximum redirect reached at: ${o.url}`,"max-redirect")),void g();const i={headers:new L(o.headers),follow:o.follow,counter:o.counter+1,agent:o.agent,compress:o.compress,method:o.method,body:o.body,signal:o.signal,timeout:o.timeout};return 303!==t.statusCode&&o.body&&null===P(o)?(r(new w("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void g()):(303!==t.statusCode&&(301!==t.statusCode&&302!==t.statusCode||"POST"!==o.method)||(i.method="GET",i.body=void 0,i.headers.delete("content-length")),n(nt(new Z(a,i))),void g())}}t.once("end",function(){u&&u.removeEventListener("abort",f)});let i=t.pipe(new tt);const a={url:o.url,status:t.statusCode,statusText:t.statusMessage,headers:e,size:o.size,timeout:o.timeout,counter:o.counter},c=e.get("Content-Encoding");if(!o.compress||"HEAD"===o.method||null===c||204===t.statusCode||304===t.statusCode)return s=new G(i,a),void n(s);const l={flush:y.Z_SYNC_FLUSH,finishFlush:y.Z_SYNC_FLUSH};if("gzip"==c||"x-gzip"==c)return i=i.pipe(y.createGunzip(l)),s=new G(i,a),void n(s);if("deflate"!=c&&"x-deflate"!=c){if("br"==c&&"function"==typeof y.createBrotliDecompress)return i=i.pipe(y.createBrotliDecompress()),s=new G(i,a),void n(s);s=new G(i,a),n(s)}else{t.pipe(new tt).once("data",function(t){i=8==(15&t[0])?i.pipe(y.createInflate()):i.pipe(y.createInflateRaw()),s=new G(i,a),n(s)})}}),function(t,e){const n=e.body;null===n?t.end():A(n)?n.stream().pipe(t):Buffer.isBuffer(n)?(t.write(n),t.end()):n.pipe(t)}(l,o)})}nt.isRedirect=function(t){return 301===t||302===t||303===t||307===t||308===t},nt.Promise=global.Promise;var rt=nt;const ot=async(t,e,{indexDateField:n,limit:r=0}={})=>{l()("info",`Get files from ${e}`);const o=n||"metadata.datetime",i=t.find("io.cozy.files").where({[o]:{$gt:e},class:"image",trashed:!1});let a=!0,u=0,s=[];for(;a;){const e=await t.query(i.offset(u)),n=t.hydrateDocuments("io.cozy.files",e.data);s=s.concat(n),r>0&&s.length>=r&&(a=!1,s=s.slice(0,r)),u=s.length,e.meta.count<Math.pow(2,31)-2&&(a=!1)}return s},it=168,at={type:"clustering",evaluationCount:0,parameters:[]},ut=(t,e)=>Math.sqrt(1+Math.pow(e-t,2)),st=(t,e,n)=>e-t-(n-e),ct=(t,e,n,r)=>((t,e,n)=>{const r=ut(t,e),o=ut(e,n);return o===1/0?1:((t-e)*(n-e)-1)/(r*o)})(t,e,n)>r,ft=(t,e,n,r)=>{if(void 0===n)return!1;if(t<e&&e<n){return ct(t,e,e+(e-n),r)}return!1},lt=(t,e,n,r)=>{if(void 0===n)return!1;if(t>e&&e>n){return ct(e+(e-t),e,n,r)}return!1},pt=(t,e,n)=>{const r=[];let o=[t[0]];if(t.length<2)return[o];for(let i=1;i<e.length;i++){const a=e[i-1],u=e[i],s=i===e.length-1?.1:e[i+1];if(u>n.maxBound)o.length>0&&r.push(o),o=[t[i]],s>n.maxBound&&(r.push(o),o=[]);else{if(o.length>0){const t=ft(a,u,s,n.cosAngle),e=lt(u,s,n.cosAngle);(t||e)&&(r.push(o),o=[])}if(ct(a,u,s,n.cosAngle))if(st(a,u,s)<0){o.push(t[i]),s-u>0&&(r.push(o),o=[])}else o.length>0&&r.push(o),o=[t[i]];else o.push(t[i])}}return o.length>0&&r.push(o),r};function dt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){ht(t,e,n[e])})}return t}function ht(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const vt=t=>{if(!t||!t.modes)return null;const e=t.modes.find(t=>"default"===t.name);if(!e||!e.epsTemporal||!e.epsSpatial)return null;const n=Math.max(e.epsTemporal,e.epsSpatial),r=2*n<48?2*n:48,o=((t,e)=>(void 0===e&&(e=1),Math.cos(2*Math.atan(1/t))/e))(n,1);return{epsTemporal:e.epsTemporal,epsSpatial:e.epsSpatial,epsMax:n,maxBound:r,cosAngle:o}},yt=(t,e,n)=>({evaluation:{start:t[0].datetime,end:t[t.length-1].datetime},period:{start:t[0].datetime,end:t[0].datetime},modes:[{name:"default",epsTemporal:e||12,epsSpatial:n||3}],defaultEvaluation:!e}),gt=(t,e)=>{return new Date(e[e.length-1].datetime).getTime()>new Date(t.period.end).getTime()?{start:t.period.start,end:e[e.length-1].datetime}:t.period},mt=async(t,e,n,r)=>{const o=dt({},n,{period:gt(n,r)}),i=e.parameters.findIndex(t=>t.period.start===n.period.start&&t.period.end===n.period.end);if(i<0)return void l()("warn","Can not update setting: the period is incorrect");const a=[...e.parameters];return a[i]=o,(await t.save(dt({},e,{parameters:a}))).data};var bt=n(419);const xt=t=>t*Math.PI/180,wt=t=>{const e=t.map((t,e,n)=>n[e+1]-n[e]);return e.pop(),e},_t=(t,e)=>{e||(e=kt(t));const n=t.map(t=>{const n=t-e;return n*n}),r=kt(n);return Math.sqrt(r)},kt=t=>{return t.reduce((t,e)=>t+e,0)/t.length},Ot=(t,e)=>{const n=t.sort((t,e)=>t-e);e||(e=100);const r=e/100*(n.length-1);if(Math.floor(r)===r)return n[r];{const t=Math.floor(r),e=r-t;return n[t]+(n[t+1]-n[t])*e}};class jt{constructor(t,e,n){this.points=t.slice(),this.kdTree=new bt.kdTree(this.points,e,n),this.maxNeighbors=2}kNeighbors(){return this.points.map(t=>{const e=this.kdTree.nearest(t,this.maxNeighbors);if(e.length>0)return{point:e[0][0],distance:e[0][1]}})}excludeOutliers(t,e){const n=t.filter(t=>t<it),r=Ot(n,e);return n.filter(t=>t<=r)}epsSignificativeSlope(t){if(t.length<3)return null;const e=wt(t),n=e.filter(t=>t>1e-4);if(n.length>0){const r=kt(n),o=_t(n,r),i=e.findIndex(t=>t>=r+o);if(i>0)return t[i]}return null}}const St=(t,e)=>Ct(t,e),Et=(t,e)=>Math.abs(t.timestamp-e.timestamp),At=(t,e,n,r)=>{const o=n/r,i=Et(t,e);return(i+St(t,e)*o)/2||i},Ct=(t,e)=>{if(!(t.lon&&t.lat&&e.lon&&e.lat))return null;const n=xt(t.lon),r=xt(t.lat),o=xt(e.lon),i=xt(e.lat),a=o-n,u=i-r,s=Math.pow(Math.sin(u/2),2),c=Math.pow(Math.sin(a/2),2),f=s+Math.cos(r)*Math.cos(i)*c;return 6371*(2*Math.asin(Math.sqrt(f)))},Tt=(t,e,n)=>{const r=[Number.MAX_VALUE];for(let o=1;o<t.length;o++){const i=e(t[o-1],t[o],n.epsTemporal,n.epsSpatial);r.push(i)}return r},Pt=(t,e)=>{const n=Dt(t,Et,["timestamp"],e);return n>=3?n:3},Mt=(t,e)=>{const n=t.filter(t=>t.lat&&t.lon),r=Dt(n,St,["lat","lon"],e);return r>=2.5?r:2.5},Dt=(t,e,n,r)=>{const o=new jt(t,e,n);let i=o.kNeighbors(t).map(t=>t.distance).sort((t,e)=>t-e);return i=o.excludeOutliers(i,r),o.epsSignificativeSlope(i)};var Rt=n(255),It=n.n(Rt);function zt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const Nt=t=>{const e=t[0].datetime;return{start:e,end:t.length>1?t[t.length-1].datetime:e}},Lt=async(t,e,n)=>{const r=Nt(e);if(r.start!==n.period.start||r.end!==n.period.end){const o=e[0].datetime,i=n.photos.dehydrate(n),a=await t.save(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){zt(t,e,n[e])})}return t}({},i,{period:r,name:o}));return t.hydrateDocument(a.data)}return n},Ft=async(t,e,n)=>{const r=(e=Array.isArray(e)?e:[e]).map(t=>({_id:t,_type:"io.cozy.files"}));await t.mutate(n.photos.removeDocuments(r))},Bt=async(t,e,n)=>{let r=0;try{const o=[];for(const r of e)r.clusterId!==n._id&&(r.clusterId&&r.clusterId!==n._id&&await Ft(t,r.clusterId,n),o.push(r.id));o.length>0?(await(async(t,e,n)=>{const r=(e=Array.isArray(e)?e:[e]).map(t=>({_id:t,_type:"io.cozy.files"}));await t.mutate(n.photos.insertDocuments(r))})(t,o,n),l()("info",`${o.length} photos clustered into: ${JSON.stringify(n._id)}`),r=o.length):l()("info",`Nothing to clusterize for ${n._id}`)}catch(t){l()("error",t)}return r},Ut=async(t,e)=>{const n=(t=>t[0].datetime)(e),r=Nt(e),o={name:n,created_at:new Date,auto:!0,period:r},i=await t.create(a,o);return t.hydrateDocument(i.data)},$t=async(t,e,n)=>{const r=[];for(const t of e)r.push(t.id),t.clusterId="";await Ft(t,r,n)},qt=async(t,e,n=[])=>{let r=0;if(n.length>0){const o=[];for(const i of e){const e=It()(i.filter(t=>t.clusterId).map(t=>t.clusterId));if(0===e.length){const e=await Ut(t,i);r+=await Bt(t,i,e)}else if(1===e.length){const a=n.find(t=>t._id===e[0]);if(o.includes(a._id)){await $t(t,i,a);const e=await Ut(t,i);r+=await Bt(t,i,e)}else{r+=await Bt(t,i,a);const u=n.findIndex(t=>t._id===e[0]);n[u]=await Lt(t,i,a),o.push(a._id)}}else{for(const e of i)if(e.clusterId){const r=n.find(t=>t._id===e.clusterId);await $t(t,[e],r)}const e=await Ut(t,i);r+=await Bt(t,i,e)}}const i=n.filter(t=>!o.includes(t._id));i.length>0&&await(async(t,e)=>{for(const n of e)await t.destroy(n)})(t,i)}else r=await(async(t,e)=>{let n=0;for(const r of e){const e=await Ut(t,r);n+=await Bt(t,r,e)}return n})(t,e);return r};var Jt=n(420),Vt=n.n(Jt),Gt=n(421),Ht=n.n(Gt),Qt=n(260),Yt=n.n(Qt),Wt=n(256),Kt=n.n(Wt);const Zt=(t,e=[])=>{const n=e.map(t=>t._id);return t.map(t=>{const e={id:t._id||t.id,clusterId:t.clusterId,albums:t.albums},r=t.attributes?t.attributes:t;e.name=r.name;const o=r.metadata;o?(e.datetime=o.datetime,e.lat=o.gps?o.gps.lat:null,e.lon=o.gps?o.gps.long:null):e.datetime=r.created_at;const i=new Date(e.datetime).getTime()/1e3/3600;if(e.timestamp=i,!e.clusterId&&Kt()(t,"relationships.referenced_by.data")){const r=t.relationships.referenced_by.data.find(t=>t.type===a&&n.includes(t.id));r&&(e.clusterId=r.id)}return e}).sort((t,e)=>t.timestamp-e.timestamp)},Xt=(t,e)=>{const n=new Date(t.datetime).getTime(),r=new Date(e.period.start).getTime();return n<=new Date(e.period.end).getTime()&&n>=r},te=(t,e,n)=>{const r=new Date(t.datetime).getTime(),o=new Date(e.period.start).getTime(),i=new Date(n.period.end).getTime();return i&&r<o&&r>i},ee=(t,e)=>{const n=((t,e,n)=>{const r=new Date(t.datetime).getTime(),o=new Date(e.period.end).getTime(),i=new Date(n.period.start).getTime();return r>o?e:r<i?n:null})(t,e[0],e[e.length-1]);if(n)return[n];for(let n=0;n<e.length;n++){if(Xt(t,e[n]))return[e[n]];if(e[n+1]&&te(t,e[n],e[n+1]))return[e[n],e[n+1]]}return[]},ne=(t,e)=>{const n=(t=>{const e=t.reduce((t,e)=>t+e.timestamp,0)/t.length;return new Date(3600*e*1e3).getTime()})(e),r=t[t.length-1],o=t[0];return new Date(r.period.end).getTime()<=n?r:new Date(o.period.start).getTime()>=n?o:t.find(t=>new Date(t.period.end).getTime()>=n)};var re=n(257),oe=n.n(re);const ie=(t,e)=>{return t.find(t=>t.id===e.id)?t:(t.push(e),t.sort((t,e)=>t.timestamp-e.timestamp))},ae=async(t,e)=>{return oe()(await Promise.all(e.map(async e=>{const n=await(async(t,e)=>{let n=[];const r=t.find(a).getById(e._id).include(["photos"]),o=await t.query(r);let i=t.hydrateDocument(o.data);const u=await i.photos.data;for(n=n.concat(u);i.photos.hasMore;){await i.photos.fetchMore();const r=t.getDocumentFromState(a,e._id);i=t.hydrateDocument(r),n=await i.photos.data}return n})(t,e);return Zt(n,[e])}))).sort((t,e)=>t.timestamp-e.timestamp)};function ue(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){se(t,e,n[e])})}return t}function se(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"onPhotoUpload",function(){return pe}),global.fetch=rt;const ce=async(t,e,n,r)=>{const o=Tt(r,At,e),i=pt(r,o,e);return i.length>0?qt(t,i,n):0},fe=async(t,e,n,r)=>{l()("info",`Start clustering on ${n.length} photos`);let o=0;try{if(r&&r.length>0){const i=await(async(t,e,n)=>{const r=new Map;for(const o of e){const e=ee(o,n);if(e.length>0){let n=!1;for(const i of r.keys()){if(Yt()(e,i).length<1){r.set(i,ie(r.get(i),o)),n=!0;break}if(Ht()(e,i).length>0){const a=Vt()(i,e);let u=r.get(i);const s=Yt()(e,i);for(const e of s)if(r.has(e))u=u.concat(r.get(e)),r.delete(e);else{const n=await ae(t,[e]);u=u.concat(n)}u.push(o);const c=u.sort((t,e)=>t.timestamp-e.timestamp);r.set(a,c),r.delete(i),n=!0;break}}if(!n){const n=await ae(t,e);r.set(e,ie(n,o))}}}return r})(t,n,r);if(!i)return;for(const[r,a]of i.entries()){const i=ne(e.parameters,a),u=vt(i);u?(o+=await ce(t,u,r,a),e=await mt(t,e,i,n)):l()("warn","No parameters for clustering found")}}else{const r=e.parameters[e.parameters.length-1],i=vt(r);if(!i)return void l()("warn","No parameters for clustering found");o=await(async(t,e,n)=>{const r=Tt(n,At,e),o=pt(n,r,e);return qt(t,o)})(t,i,n),e=await mt(t,e,r,n)}}catch(t){return void l()("error",`An error occured during the clustering: ${JSON.stringify(t)}`)}return{setting:e,clusteredCount:o}},le=async(t,e)=>{const n=e.lastDate?e.lastDate:0,r=await ot(t,n,{indexDateField:"created_at",limit:1e3});if(r.length<1)return l()("warn","No photo found to clusterize"),{photos:[],newSetting:e};const o=await(async t=>{const e=t.find(a).where({auto:!0}).sortBy([{name:"desc"}]),n=await t.queryAll(e);return t.hydrateDocuments(a,n)})(t),i=Zt(r,o),u=await fe(t,e,i,o);if(!u)return{photos:[],newSetting:e};l()("info",`${u.clusteredCount} photos clustered since ${n}`);const s=r[r.length-1].attributes.created_at,c=e.parameters[e.parameters.length-1],f=new Date(i[0].datetime).getTime()<=new Date(c.evaluation.end).getTime()?0:u.clusteredCount;return{photos:r,newSetting:e=await(async(t,e,n,r)=>{l()("info",`Update setting for last date ${r}`);const o=n>0?e.evaluationCount+n:e.evaluationCount,i=e.runs?e.runs+1:1;return(await t.save(dt({},e,{evaluationCount:o,lastDate:r,runs:i}))).data})(t,u.setting,f,s)}},pe=async()=>{if(!((t,e)=>Math.abs((t=>{let e,n,r=0;if(0===t.length)return t;for(e=0;e<t.length;e++)r=(r<<5)-r+(n=t.charCodeAt(e)),r&=r;return r})(t))%100<=e)(process.env.COZY_URL,5))return;l()("info",`Service called with COZY_URL: ${process.env.COZY_URL}`);const t={schema:c},e=s.a.fromEnv(null,t);let n=await(async t=>{return(await t.query(t.find("io.cozy.photos.settings"))).data.find(t=>"clustering"===t.type)})(e);if(!n){const t=await(async t=>{const e=t.find("io.cozy.files").limitBy(null);return(await t.query(e)).data.filter(t=>"image"===t.class&&!t.trashed)})(e),r=Zt(t);if(0==r.length)return 0;const o=r.length>500?(t=>{l()("info",`Compute clustering parameters on ${t.length} photos`);const e=Pt(t,99.5),n=Mt(t,99.5);return yt(t,e,n)})(r):yt(r);n=await(async(t,e)=>{l()("info","Create setting");const n=at;return n.parameters[0]=e,(await t.create("io.cozy.photos.settings",n)).data})(e,o),l()("info",`Setting saved with ${JSON.stringify(o.modes)} on period ${JSON.stringify(o.period)}`)}if("running"!==n.jobStatus){if("postponed"===n.jobStatus){const t=(t=>{const e=t.indexOf("h"),n=t.indexOf("m"),r=t.indexOf("s"),o=e>0?t.substring(0,e):0,i=n>0?t.substring(e+1,n):0;return 1e3*(r>0?t.substring(n+1,r):0)+60*i*1e3+3600*o*1e3})("20m");if(n.lastExecution+t>Date.now())return void l()("warn","The service is already planned later. Abort.")}try{n=(await e.save(ue({},n,{jobStatus:"running"}))).data}catch(t){return void(409===t.status&&l()("error","Several jobs running. Abort"))}try{const t=n.parameters[n.parameters.length-1];if(t.evaluation||(t.evaluation={start:t.period.start,end:t.period.end},n=await e.save(ue({},n))),n.evaluationCount>500){const t=await(async(t,e)=>{const n=e.parameters[e.parameters.length-1],r=n.defaultEvaluation?n.evaluation.start:n.evaluation.end,o=await ot(t,r);if(o.length<500)return;l()("info",`Compute clustering parameters on ${o.length} photos`);const i=Zt(o),a=Pt(i,99.5),u=Mt(i,99.5);return yt(i,a,u)})(e,n);t&&(n=await(async(t,e,n)=>{const r=[...e.parameters,n];return(await t.save(dt({},e,{parameters:r,evaluationCount:0}))).data})(e,n,t),l()("info",`Setting updated with ${JSON.stringify(t)}`))}const{photos:r,newSetting:o}=await le(e,n);if(r.length>=1e3){const t={type:"@in",arguments:"20m",worker:"service",message:{name:"onPhotoUpload",slug:"photos"}};e.getStackClient().collection("io.cozy.triggers").create(t),await e.save(ue({},o,{jobStatus:"postponed",lastExecution:Date.now()})),l()("info","The service will be run again in 20m")}else await e.save(ue({},o,{jobStatus:""}))}catch(t){l()("error",t.reason),await e.save(ue({},n,{jobStatus:""}))}}else l()("warn","The service is already executed. Abort.")};pe()},function(t,e,n){"use strict";n.r(e);var r="object"==typeof global&&global&&global.Object===Object&&global,o="object"==typeof self&&self&&self.Object===Object&&self,i=(r||o||Function("return this")()).Symbol,a=Object.prototype,u=a.hasOwnProperty,s=a.toString,c=i?i.toStringTag:void 0;var f=function(t){var e=u.call(t,c),n=t[c];try{t[c]=void 0;var r=!0}catch(t){}var o=s.call(t);return r&&(e?t[c]=n:delete t[c]),o},l=Object.prototype.toString;var p=function(t){return l.call(t)},d="[object Null]",h="[object Undefined]",v=i?i.toStringTag:void 0;var y=function(t){return null==t?void 0===t?h:d:v&&v in Object(t)?f(t):p(t)};var g=function(t,e){return function(n){return t(e(n))}}(Object.getPrototypeOf,Object);var m=function(t){return null!=t&&"object"==typeof t},b="[object Object]",x=Function.prototype,w=Object.prototype,_=x.toString,k=w.hasOwnProperty,O=_.call(Object);var j=function(t){if(!m(t)||y(t)!=b)return!1;var e=g(t);if(null===e)return!0;var n=k.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&_.call(n)==O},S=n(258),E={INIT:"@@redux/INIT"};function A(t,e,n){var r;if("function"==typeof e&&void 0===n&&(n=e,e=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(A)(t,e)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var o=t,i=e,a=[],u=a,s=!1;function c(){u===a&&(u=a.slice())}function f(){return i}function l(t){if("function"!=typeof t)throw new Error("Expected listener to be a function.");var e=!0;return c(),u.push(t),function(){if(e){e=!1,c();var n=u.indexOf(t);u.splice(n,1)}}}function p(t){if(!j(t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(s)throw new Error("Reducers may not dispatch actions.");try{s=!0,i=o(i,t)}finally{s=!1}for(var e=a=u,n=0;n<e.length;n++){(0,e[n])()}return t}return p({type:E.INIT}),(r={dispatch:p,subscribe:l,getState:f,replaceReducer:function(t){if("function"!=typeof t)throw new Error("Expected the nextReducer to be a function.");o=t,p({type:E.INIT})}})[S.a]=function(){var t,e=l;return(t={subscribe:function(t){if("object"!=typeof t)throw new TypeError("Expected the observer to be an object.");function n(){t.next&&t.next(f())}return n(),{unsubscribe:e(n)}}})[S.a]=function(){return this},t},r}function C(t,e){var n=e&&e.type;return"Given action "+(n&&'"'+n.toString()+'"'||"an action")+', reducer "'+t+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function T(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++){var o=e[r];0,"function"==typeof t[o]&&(n[o]=t[o])}var i=Object.keys(n);var a=void 0;try{!function(t){Object.keys(t).forEach(function(e){var n=t[e];if(void 0===n(void 0,{type:E.INIT}))throw new Error('Reducer "'+e+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===n(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+e+"\" returned undefined when probed with a random type. Don't try to handle "+E.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}(n)}catch(t){a=t}return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];if(a)throw a;for(var r=!1,o={},u=0;u<i.length;u++){var s=i[u],c=n[s],f=t[s],l=c(f,e);if(void 0===l){var p=C(s,e);throw new Error(p)}o[s]=l,r=r||l!==f}return r?o:t}}function P(t,e){return function(){return e(t.apply(void 0,arguments))}}function M(t,e){if("function"==typeof t)return P(t,e);if("object"!=typeof t||null===t)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===t?"null":typeof t)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var n=Object.keys(t),r={},o=0;o<n.length;o++){var i=n[o],a=t[i];"function"==typeof a&&(r[i]=P(a,e))}return r}function D(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return 0===e.length?function(t){return t}:1===e.length?e[0]:e.reduce(function(t,e){return function(){return t(e.apply(void 0,arguments))}})}var R=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};function I(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return function(n,r,o){var i,a=t(n,r,o),u=a.dispatch,s={getState:a.getState,dispatch:function(t){return u(t)}};return i=e.map(function(t){return t(s)}),u=D.apply(void 0,i)(a.dispatch),R({},a,{dispatch:u})}}}n.d(e,"createStore",function(){return A}),n.d(e,"combineReducers",function(){return T}),n.d(e,"bindActionCreators",function(){return M}),n.d(e,"applyMiddleware",function(){return I}),n.d(e,"compose",function(){return D})}]);